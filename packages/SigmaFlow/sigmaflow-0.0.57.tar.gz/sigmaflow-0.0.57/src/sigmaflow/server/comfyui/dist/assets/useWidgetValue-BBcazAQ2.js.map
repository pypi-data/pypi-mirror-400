{"version":3,"file":"useWidgetValue-BBcazAQ2.js","sources":["../../../../../../ComfyUI_frontend/src/composables/graph/useWidgetValue.ts"],"sourcesContent":["/**\n * Composable for managing widget value synchronization between Vue and LiteGraph\n * Provides consistent pattern for immediate UI updates and LiteGraph callbacks\n */\nimport { computed, toValue, ref, watch } from 'vue'\nimport type { Ref } from 'vue'\n\nimport type { SimplifiedWidget, WidgetValue } from '@/types/simplifiedWidget'\nimport type { MaybeRefOrGetter } from '@vueuse/core'\n\ninterface UseWidgetValueOptions<T extends WidgetValue = WidgetValue, U = T> {\n  /** The widget configuration from LiteGraph */\n  widget: SimplifiedWidget<T>\n  /** The current value from parent component (can be a value or a getter function) */\n  modelValue: MaybeRefOrGetter<T>\n  /** Default value if modelValue is null/undefined */\n  defaultValue: T\n  /** Emit function from component setup */\n  emit: (event: 'update:modelValue', value: T) => void\n  /** Optional value transformer before sending to LiteGraph */\n  transform?: (value: U) => T\n}\n\ninterface UseWidgetValueReturn<T extends WidgetValue = WidgetValue, U = T> {\n  /** Local value for immediate UI updates */\n  localValue: Ref<T>\n  /** Handler for user interactions */\n  onChange: (newValue: U) => void\n}\n\n/**\n * Manages widget value synchronization with LiteGraph\n *\n * @example\n * ```vue\n * const { localValue, onChange } = useWidgetValue({\n *   widget: props.widget,\n *   modelValue: props.modelValue,\n *   defaultValue: ''\n * })\n * ```\n */\nexport function useWidgetValue<T extends WidgetValue = WidgetValue, U = T>({\n  widget,\n  modelValue,\n  defaultValue,\n  emit,\n  transform\n}: UseWidgetValueOptions<T, U>): UseWidgetValueReturn<T, U> {\n  // Ref for immediate UI feedback before value flows back through modelValue\n  const newProcessedValue = ref<T | null>(null)\n\n  // Computed that prefers the immediately processed value, then falls back to modelValue\n  const localValue = computed<T>(\n    () => newProcessedValue.value ?? toValue(modelValue) ?? defaultValue\n  )\n\n  // Clear newProcessedValue when modelValue updates (allowing external changes to flow through)\n  watch(\n    () => toValue(modelValue),\n    () => {\n      newProcessedValue.value = null\n    }\n  )\n\n  // Handle user changes\n  const onChange = (newValue: U) => {\n    // Handle different PrimeVue component signatures\n    let processedValue: T\n    if (transform) {\n      processedValue = transform(newValue)\n    } else {\n      // Ensure type safety - only cast when types are compatible\n      if (\n        typeof newValue === typeof defaultValue ||\n        newValue === null ||\n        newValue === undefined\n      ) {\n        processedValue = (newValue ?? defaultValue) as T\n      } else {\n        console.warn(\n          `useWidgetValue: Type mismatch for widget ${widget.name}. Expected ${typeof defaultValue}, got ${typeof newValue}`\n        )\n        processedValue = defaultValue\n      }\n    }\n\n    // Set for immediate UI feedback\n    newProcessedValue.value = processedValue\n\n    // Emit to parent component\n    emit('update:modelValue', processedValue)\n  }\n\n  return {\n    localValue: localValue as Ref<T>,\n    onChange\n  }\n}\n\n/**\n * Type-specific helper for string widgets\n */\nexport function useStringWidgetValue(\n  widget: SimplifiedWidget<string>,\n  modelValue: string | (() => string),\n  emit: (event: 'update:modelValue', value: string) => void\n) {\n  return useWidgetValue({\n    widget,\n    modelValue,\n    defaultValue: '',\n    emit,\n    transform: (value: string | undefined) => String(value || '') // Handle undefined from PrimeVue\n  })\n}\n\n/**\n * Type-specific helper for number widgets\n */\nexport function useNumberWidgetValue(\n  widget: SimplifiedWidget<number>,\n  modelValue: number | (() => number),\n  emit: (event: 'update:modelValue', value: number) => void\n) {\n  return useWidgetValue({\n    widget,\n    modelValue,\n    defaultValue: 0,\n    emit,\n    transform: (value: number | number[]) => {\n      // Handle PrimeVue Slider which can emit number | number[]\n      if (Array.isArray(value)) {\n        return value.length > 0 ? (value[0] ?? 0) : 0\n      }\n      return Number(value) || 0\n    }\n  })\n}\n\n/**\n * Type-specific helper for boolean widgets\n */\nexport function useBooleanWidgetValue(\n  widget: SimplifiedWidget<boolean>,\n  modelValue: boolean | (() => boolean),\n  emit: (event: 'update:modelValue', value: boolean) => void\n) {\n  return useWidgetValue({\n    widget,\n    modelValue,\n    defaultValue: false,\n    emit,\n    transform: (value: boolean) => Boolean(value)\n  })\n}\n"],"names":["useWidgetValue","widget","modelValue","defaultValue","emit","transform","newProcessedValue","ref","localValue","computed","toValue","watch","__name","newValue","processedValue","useStringWidgetValue","value","useNumberWidgetValue","useBooleanWidgetValue"],"mappings":"+IA0CO,SAASA,EAA2D,CACzE,OAAAC,EACA,WAAAC,EACA,aAAAC,EACA,KAAAC,EACA,UAAAC,CACF,EAA4D,CAEpD,MAAAC,EAAoBC,EAAc,IAAI,EAGtCC,EAAaC,EACjB,IAAMH,EAAkB,OAASI,EAAQR,CAAU,GAAKC,CAAA,EAI1D,OAAAQ,EACE,IAAMD,EAAQR,CAAU,EACxB,IAAM,CACJI,EAAkB,MAAQ,IAC5B,CAAA,EAgCK,CACL,WAAAE,EACA,SA9BeI,EAACC,GAAgB,CAE5B,IAAAC,EACAT,EACFS,EAAiBT,EAAUQ,CAAQ,EAIjC,OAAOA,GAAa,OAAOV,GAC3BU,IAAa,MACbA,IAAa,OAEbC,EAAkBD,GAAYV,GAEtB,QAAA,KACN,4CAA4CF,EAAO,IAAI,cAAc,OAAOE,CAAY,SAAS,OAAOU,CAAQ,EAAA,EAEjGC,EAAAX,GAKrBG,EAAkB,MAAQQ,EAG1BV,EAAK,oBAAqBU,CAAc,CAAA,EAzBzB,WA8Bf,CAEJ,CAxDgBF,EAAAZ,EAAA,kBA6DA,SAAAe,EACdd,EACAC,EACAE,EACA,CACA,OAAOJ,EAAe,CACpB,OAAAC,EACA,WAAAC,EACA,aAAc,GACd,KAAAE,EACA,UAAWQ,EAACI,GAA8B,OAAOA,GAAS,EAAE,EAAjD,YAAiD,CAC7D,CACH,CAZgBJ,EAAAG,EAAA,wBAiBA,SAAAE,EACdhB,EACAC,EACAE,EACA,CACA,OAAOJ,EAAe,CACpB,OAAAC,EACA,WAAAC,EACA,aAAc,EACd,KAAAE,EACA,UAAWQ,EAACI,GAEN,MAAM,QAAQA,CAAK,EACdA,EAAM,OAAS,EAAKA,EAAM,CAAC,GAAK,EAAK,EAEvC,OAAOA,CAAK,GAAK,EALf,YAMX,CACD,CACH,CAlBgBJ,EAAAK,EAAA,wBAuBA,SAAAC,EACdjB,EACAC,EACAE,EACA,CACA,OAAOJ,EAAe,CACpB,OAAAC,EACA,WAAAC,EACA,aAAc,GACd,KAAAE,EACA,UAAWQ,EAACI,GAAmB,EAAQA,EAA5B,YAAiC,CAC7C,CACH,CAZgBJ,EAAAM,EAAA"}