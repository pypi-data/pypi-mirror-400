import{j as e,r as y,G as E}from"./vendor-tanstack-BVzzyDEt.js";import{bF as T,bS as S,bP as v,bQ as C,C as M,aU as g,bH as F,bR as W,dn as I,dp as A,ad as L,w as d,ae as U,af as O,ag as R,ah as z,aj as q,ap as p,ak as x,al as j,am as b,an as w,ao as P,I as B,aq as $,bf as H,q as N,dq as V,bG as G,bM as Y,bN as Z,bO as J,r as K,s as X,t as ee,v as oe,dr as se,ds as re,A as ne}from"./index-BJkJ93Lr.js";import{d as ae,b as te,k as _,g as ie,c as k,n as Q}from"./vendor-forms-BN3tpxM2.js";import{T as le}from"./textarea-BWNxlLo9.js";import{D as ce}from"./delete-confirmation-dialog-Baib9xiM.js";const ue=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],de=T("square-pen",ue),me={READY:{label:"Ready",color:"bg-green-500",tooltip:"Work queue has at least one actively polling worker ready to execute work."},PAUSED:{label:"Paused",color:"bg-yellow-500",tooltip:"Work queue is paused. No work will be executed."},NOT_READY:{label:"Not Ready",color:"bg-red-500",tooltip:"Work queue does not have any actively polling workers ready to execute work."}},Pe=({status:o,className:s})=>{const r=me[o];return e.jsx(S,{children:e.jsxs(v,{children:[e.jsx(C,{asChild:!0,children:e.jsxs(M,{variant:"secondary",className:g("flex items-center space-x-1 cursor-help",s),children:[o==="PAUSED"?e.jsx(F,{className:"h-2 w-2 text-muted-foreground"}):e.jsx("div",{className:g("h-2 w-2 rounded-full",r.color)}),e.jsx("span",{children:r.label})]})}),e.jsx(W,{children:e.jsx("p",{children:r.tooltip})})]})})},he=te({name:k().min(1,{message:"Name is required"}).regex(/^[a-zA-Z0-9_-]+$/,{message:"Name can only contain letters, numbers, hyphens, and underscores"}),description:k().nullable().optional(),is_paused:ie().default(!1),concurrency_limit:_([k().transform(o=>{if(o===""||o===null||o===void 0)return null;const s=Number(o);if(Number.isNaN(s))return null;if(s<=0)throw new Error("Flow run concurrency must be greater than 0");return s}),Q().positive({message:"Flow run concurrency must be greater than 0"}).nullable()]).nullable().optional(),priority:_([k().transform(o=>{if(o===""||o===null||o===void 0)return null;const s=Number(o);if(Number.isNaN(s))return null;if(s<=0)throw new Error("Priority must be greater than 0");if(!Number.isInteger(s))throw new Error("Priority must be a whole number");return s}),Q().int({message:"Priority must be a whole number"}).positive({message:"Priority must be greater than 0"}).nullable()]).nullable().optional()}),f={name:"",description:"",is_paused:!1,concurrency_limit:null,priority:null},pe=({workPoolName:o,queueToEdit:s,onSubmit:r})=>{const{mutate:i,isPending:l}=I(),{mutate:n,isPending:c}=A(),a=ae({resolver:L(he),defaultValues:f});return y.useEffect(()=>{s?a.reset({name:s.name,description:s.description??"",is_paused:s.is_paused??!1,concurrency_limit:s.concurrency_limit??null,priority:s.priority??null}):a.reset(f)},[a,s]),{form:a,saveOrUpdate:u=>{const m={...u,description:u.description||null};s?n({workPoolName:o,queueName:s.name,workQueueData:{...m,is_paused:m.is_paused??s.is_paused??!1}},{onSuccess:()=>{d.success("Work queue updated"),a.reset(f),r()},onError:t=>{const D=t.message||"Unknown error while updating work queue.";a.setError("root",{message:D})}}):i({workPoolName:o,workQueueData:m},{onSuccess:()=>{d.success("Work queue created"),a.reset(f),r()},onError:t=>{const D=t.message||"Unknown error while creating work queue.";a.setError("root",{message:D})}})},isLoading:l||c}},ge=({workPoolName:o,queueToEdit:s,open:r,onOpenChange:i,onSubmit:l})=>{const{form:n,isLoading:c,saveOrUpdate:a}=pe({workPoolName:o,queueToEdit:s,onSubmit:l}),h=!!s,u=h?"Edit Work Queue":"Create Work Queue",m=h?"Save":"Create Work Queue";return e.jsx(U,{open:r,onOpenChange:i,children:e.jsxs(O,{"aria-describedby":void 0,children:[e.jsx(R,{children:e.jsx(z,{children:u})}),e.jsx(q,{...n,children:e.jsxs("form",{onSubmit:t=>{n.handleSubmit(a)(t)},className:"space-y-4",children:[e.jsx(p,{children:n.formState.errors.root?.message}),e.jsx(x,{control:n.control,name:"name",render:({field:t})=>e.jsxs(j,{children:[e.jsx(b,{children:"Name"}),e.jsx(w,{children:e.jsx(P,{type:"text",autoComplete:"off",...t})}),e.jsx(p,{})]})}),e.jsx(x,{control:n.control,name:"description",render:({field:t})=>e.jsxs(j,{children:[e.jsx(b,{children:"Description"}),e.jsx(w,{children:e.jsx(le,{...t,value:t.value||""})}),e.jsx(p,{})]})}),e.jsx(x,{control:n.control,name:"concurrency_limit",render:({field:t})=>e.jsxs(j,{children:[e.jsx(b,{children:"Flow Run Concurrency"}),e.jsx(w,{children:e.jsx(P,{type:"number",...t,value:t.value||""})}),e.jsx(p,{})]})}),e.jsx(x,{control:n.control,name:"priority",render:({field:t})=>e.jsxs(j,{children:[e.jsxs(b,{className:"flex items-center gap-2",children:["Priority",e.jsxs(v,{children:[e.jsx(C,{asChild:!0,children:e.jsx("button",{type:"button",className:"cursor-help",children:e.jsx(B,{id:"Info",className:"size-4"})})}),e.jsx(W,{children:e.jsx("p",{className:"text-xs",children:"Work on higher priority queues is executed first. Lower numbers have higher priority."})})]})]}),e.jsx(w,{children:e.jsx(P,{type:"number",...t,value:t.value||""})}),e.jsx(p,{})]})}),e.jsxs($,{children:[e.jsx(H,{asChild:!0,children:e.jsx(N,{variant:"outline",children:"Cancel"})}),e.jsx(N,{type:"submit",loading:c,children:m})]})]})})]})})},xe=({queue:o,open:s,onOpenChange:r,onDeleted:i})=>{const l=V(),n=()=>{if(!o.work_pool_name){d.error("Work pool name is required");return}l.mutate({workPoolName:o.work_pool_name,queueName:o.name},{onSuccess:()=>{d.success("Work pool queue deleted successfully"),i?.(),r(!1)},onError:()=>{d.error("Failed to delete work pool queue")}})};return e.jsx(ce,{isOpen:s,title:"Delete Work Pool Queue",description:`Are you sure you want to delete the work pool queue "${o.name}"? This action cannot be undone.`,confirmText:o.name,isLoading:l.isPending,loadingText:"Deleting...",onConfirm:n,onClose:()=>r(!1)})},je=o=>{const s=E(),[r,i]=y.useState(!1),[l,n]=y.useState(!1),c=()=>{navigator.clipboard.writeText(o.id),d.success("ID copied to clipboard")},a=()=>{n(!0)},h=()=>{s({to:"/automations/create"})},u=o.name==="default";return{menuItems:[{label:"Copy ID",icon:G,action:c,show:!0},{label:"Edit",icon:de,action:a,show:!0},{label:"Delete",icon:Y,action:()=>i(!0),show:!u,variant:"destructive"},{label:"Automate",icon:Z,action:h,show:!0}].filter(t=>t.show),showDeleteDialog:r,setShowDeleteDialog:i,showEditDialog:l,setShowEditDialog:n,triggerIcon:J}},Ne=({queue:o,onUpdate:s,className:r})=>{const{menuItems:i,showDeleteDialog:l,setShowDeleteDialog:n,showEditDialog:c,setShowEditDialog:a,triggerIcon:h}=je(o);return e.jsxs(e.Fragment,{children:[e.jsxs(K,{children:[e.jsx(X,{asChild:!0,children:e.jsxs(N,{variant:"outline",size:"icon",className:g("size-8",r),children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(h,{className:"size-4"})]})}),e.jsx(ee,{align:"end",children:i.map(u=>{const m=u.icon;return e.jsxs(oe,{onClick:u.action,className:g(u.variant==="destructive"&&"text-destructive"),children:[e.jsx(m,{className:"mr-2 h-4 w-4"}),u.label]},u.label)})})]}),e.jsx(xe,{queue:o,open:l,onOpenChange:n,onDeleted:s}),e.jsx(ge,{workPoolName:o.work_pool_name??"",queueToEdit:o,open:c,onOpenChange:a,onSubmit:()=>{a(!1),s?.()}})]})},be=(o,s)=>{const r=se(),i=re();return{handleToggle:y.useCallback(n=>{if(!o.work_pool_name){d.error("Work pool name is required");return}const c=n?i:r,a=n?"resumed":"paused";c.mutate({workPoolName:o.work_pool_name,queueName:o.name},{onSuccess:()=>{d.success(`Queue ${a} successfully`),s?.()},onError:()=>{d.error(`Failed to ${a.slice(0,-1)} queue`)}})},[o,r,i,s]),isLoading:r.isPending||i.isPending}},ve=({queue:o,onUpdate:s,disabled:r=!1,className:i})=>{const{handleToggle:l,isLoading:n}=be(o,s),c=o.status==="PAUSED",a=r||n;return e.jsx(S,{children:e.jsxs(v,{children:[e.jsx(C,{asChild:!0,children:e.jsx("div",{children:e.jsx(ne,{checked:!c,onCheckedChange:l,disabled:a,"aria-label":c?"Resume work pool queue":"Pause work pool queue",className:g(i)})})}),e.jsx(W,{children:e.jsx("p",{children:"Pause or resume this work pool queue"})})]})})};export{de as S,Pe as W,ve as a,Ne as b,ge as c};
//# sourceMappingURL=work-pool-queue-toggle-DZUkfhT0.js.map
