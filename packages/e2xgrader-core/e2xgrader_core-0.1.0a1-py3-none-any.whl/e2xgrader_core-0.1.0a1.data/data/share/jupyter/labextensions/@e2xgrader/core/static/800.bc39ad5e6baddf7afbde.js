"use strict";(self.webpackChunk_e2xgrader_core=self.webpackChunk_e2xgrader_core||[]).push([[800],{800:(e,t,r)=>{r.r(t),r.d(t,{E2XContentFactory:()=>p,E2XMarkdownCell:()=>E,E2X_BUTTON_CLASS:()=>y,E2X_GRADER_SETTINGS_CLASS:()=>h,E2X_METADATA_KEY:()=>u,E2X_UNRENDER_BUTTON_CLASS:()=>_,E2xGraderCellRegistry:()=>a,E2xGraderCellToolbar:()=>R,E2xGraderMetadata:()=>g,GradingCellModel:()=>C,NbgraderCellType:()=>M,NbgraderCellTypes:()=>T,NbgraderMetadata:()=>A,default:()=>S});var a,s,i=r(389),l=r(223),n=r(690),d=r(262),o=r(602);(s=a||(a={})).IE2xGraderCellRegistry=new d.Token("@e2xgrader/core:IE2xGraderCellRegistry"),s.E2xGraderCellRegistry=class{constructor(){this._plugins=new Map,this._pluginRegistered=new o.Signal(this)}registerPlugin(e){this._plugins.has(e.cellType)?console.warn(`Plugin for cell type ${e.cellType} is already registered.`):(this._plugins.set(e.cellType,e),this._pluginRegistered.emit({plugin:e}))}getPlugin(e){return this._plugins.get(e)}getPlugins(){return Array.from(this._plugins.values())}getPluginLabel(e){const t=this.getPlugin(e);return t?t.label:void 0}getPluginTypes(){return Array.from(this._plugins.keys())}get pluginRegistered(){return this._pluginRegistered}};var g,c=r(568);!function(e){e.E2XGRADER_METADATA_KEY="extended_cell",e.E2X_METADATA_DEFAULTS={type:void 0,options:{}}}(g||(g={}));const u="extended_cell",h="e2xgrader-options",_="e2xgrader-unrender",y="e2xgrader-button";class E extends c.MarkdownCell{constructor(e){super(e),this.__lastContent="",this._settings=e.settings,this._settings&&this._settings.changed.connect(this.onSettingsUpdated,this),this._registry=e.registry,this._registry&&this._registry.pluginRegistered.connect(this.onCellRegistered,this),this.showEditorForReadOnly=!1}get editMode(){return!!this._settings&&this._settings.get("edit_mode").composite}onSettingsUpdated(e){this._graderSection&&(this._graderSection.hidden=!e.get("edit_mode").composite)}onCellRegistered(e,t){const r=t.plugin.cellType,a=t.plugin.renderCell;console.log(`Cell type registered: ${r}, render function: ${a}`),this.e2xCellType===r&&(this.rendered=!1,this._waitForRender(this,2).then((()=>{this.postRender(this)})))}get source(){var e;return(null===(e=this.model)||void 0===e?void 0:e.sharedModel.getSource())||"Type Markdown and LaTeX: $ a^2 $"}get contentChanged(){return this.__lastContent!==this.source}get metadataDefaults(){return g.E2X_METADATA_DEFAULTS}get e2xMetadata(){var e,t;return null!==(t=null===(e=this.model)||void 0===e?void 0:e.getMetadata(u))&&void 0!==t?t:{}}get e2xCellType(){return this.e2xMetadata.type}set e2xCellType(e){var t,r;if(e!==this.e2xCellType){this.setE2xMetadataField("type",e);const a=this.model.toJSON(),s=this.cellIndex;null===(t=this.notebook.model)||void 0===t||t.sharedModel.insertCell(s+1,a),null===(r=this.notebook.model)||void 0===r||r.sharedModel.deleteCell(s)}}getE2xMetadataField(e,t={}){var r,a;return null!==(a=null===(r=this.e2xMetadata)||void 0===r?void 0:r[e])&&void 0!==a?a:t}setE2xMetadataField(e,t){var r;const a=this.e2xMetadata;a[e]=t,null===(r=this.model)||void 0===r||r.setMetadata(u,a)}_waitForRender(e,t){return new Promise((r=>{!function a(){e.node.querySelector(".jp-RenderedMarkdown *")?r(e):setTimeout(a,t)}()}))}renderInput(e){this.e2xCellType&&(this.readOnly=!0),super.renderInput(e),this.contentChanged&&(this._waitForRender(e,2).then((e=>{this.postRender(e)})),this.__lastContent=this.source)}async postRender(e){if(this._registry&&this.e2xCellType){const t=this._registry.getPlugin(this.e2xCellType);t&&await t.renderCell(e,this),this.renderGraderSection(e)}}renderGraderSection(e){var t;if(!this.e2xCellType)return;if(!(null===(t=this._registry)||void 0===t?void 0:t.getPluginTypes().includes(this.e2xCellType)))return;const r=e.node,a=document.createElement("div");a.appendChild(document.createElement("hr")),a.className=h;const s=document.createElement("button");s.classList.add(_,y),s.textContent="Edit Cell",s.onclick=()=>{this.readOnly=!1,this.rendered=!1},a.appendChild(s),this._graderSection=a,this.editMode||(a.hidden=!0);const i=r.querySelector(`.${h}`);i&&r.removeChild(i),r.appendChild(a)}get notebook(){return this.parent}get cellIndex(){return this.notebook.widgets.findIndex((e=>e===this))}}class p extends i.NotebookPanel.ContentFactory{constructor(e,t,r){super(e),this._settings=t,this._registry=r}get settings(){return this._settings}get cellRegistry(){return this._registry}createMarkdownCell(e){return e.contentFactory||(e.contentFactory=this),e.settings=this._settings,e.registry=this._registry,new E(e)}}var A,M,T;!function(e){let t;e.NBGRADER_METADATA_KEY="nbgrader",e.NBGRADER_SCHEMA_VERSION=3,e.newNbGraderMetadata=function(){return{solution:!1,task:!1,grade:!1,grade_id:`cell-${t.randomString(12)}`,locked:!1,schema_version:e.NBGRADER_SCHEMA_VERSION}},function(e){e.randomString=function(e){let t="";let r;for(r=0;r<e;r++)t+="abcdef0123456789"[Math.floor(16*Math.random())];return t}}(t||(t={}))}(A||(A={})),function(e){e.MANUALLY_GRADED_ANSWER="manual",e.AUTOGRADED_ANSWER="auto",e.TASK="task",e.AUTOGRADER_TEST="tests",e.DESCRIPTION="readonly"}(M||(M={})),function(e){const t={[M.DESCRIPTION]:{metadata:{solution:!1,grade:!1,task:!1,locked:!0},label:"Read Only",codeOnly:!1},[M.MANUALLY_GRADED_ANSWER]:{metadata:{solution:!0,grade:!0,task:!1,locked:!1},label:"Manually graded answer",codeOnly:!1},[M.AUTOGRADED_ANSWER]:{metadata:{solution:!0,grade:!1,task:!1,locked:!1},label:"Autograded answer",codeOnly:!0},[M.AUTOGRADER_TEST]:{metadata:{solution:!1,grade:!0,task:!1,locked:!0},label:"Autograder tests",codeOnly:!0},[M.TASK]:{metadata:{solution:!1,grade:!1,task:!0,locked:!0},label:"Task",codeOnly:!1}};let r;e.NBGRADER_MARKDOWN_CELL_TYPES=Object.values(M).filter((e=>!t[e].codeOnly)),e.NBGRADER_CODE_CELL_TYPES=Object.values(M),e.cellTypeConfigurations=Object.fromEntries(Object.entries(t).map((([e,{metadata:t}])=>[e,t]))),e.cellTypeLabels=Object.fromEntries(Object.entries(t).map((([e,{label:t}])=>[e,t]))),e.findMatchingCellType=function(t){for(const[a,s]of Object.entries(e.cellTypeConfigurations))if(r.metadataMatchesConfig(t,s))return a},e.matchesCellType=function(e,a){return r.metadataMatchesConfig(e,t[a].metadata)},function(e){e.metadataMatchesConfig=function(e,t){return Object.entries(t).every((([t,r])=>(null==e?void 0:e[t])===r))}}(r||(r={}))}(T||(T={}));class C{constructor(e){this._cell=e}getMetadata(e){return this._cell.getMetadata(e)}setMetadata(e,t){this._cell.setMetadata(e,t)}setNestedMetadata(e,t,r){var a;const s=null!==(a=this.getMetadata(e))&&void 0!==a?a:{};void 0===r?delete s[t]:s[t]=r,this.setMetadata(e,s)}removeNbgraderMetadata(){this._cell.deleteMetadata(A.NBGRADER_METADATA_KEY)}removeE2xgraderMetadata(){this._cell.deleteMetadata(g.E2XGRADER_METADATA_KEY)}setNbgraderMetadataKey(e,t){this.setNestedMetadata(A.NBGRADER_METADATA_KEY,e,t)}getE2xgraderMetadataKey(e,t={}){var r,a;return null!==(a=null===(r=this.e2xgraderMetadata)||void 0===r?void 0:r[e])&&void 0!==a?a:t}setE2xgraderMetadataKey(e,t){this.setNestedMetadata(g.E2XGRADER_METADATA_KEY,e,t)}get nbgraderMetadata(){return this.getMetadata(A.NBGRADER_METADATA_KEY)}get e2xgraderMetadata(){return this.getMetadata(g.E2XGRADER_METADATA_KEY)}get isNbgraderCell(){return!!this.nbgraderMetadata}get isE2xgraderCell(){return!!this.e2xgraderType}get isGrade(){var e,t;return null!==(t=null===(e=this.nbgraderMetadata)||void 0===e?void 0:e.grade)&&void 0!==t&&t}set isGrade(e){this.setNbgraderMetadataKey("grade",e)}get isSolution(){var e,t;return null!==(t=null===(e=this.nbgraderMetadata)||void 0===e?void 0:e.solution)&&void 0!==t&&t}set isSolution(e){this.setNbgraderMetadataKey("solution",e)}get isTask(){var e,t;return null!==(t=null===(e=this.nbgraderMetadata)||void 0===e?void 0:e.task)&&void 0!==t&&t}set isTask(e){this.setNbgraderMetadataKey("task",e)}get isLocked(){var e,t;return null!==(t=null===(e=this.nbgraderMetadata)||void 0===e?void 0:e.locked)&&void 0!==t&&t}set isLocked(e){this.setNbgraderMetadataKey("locked",e)}get gradeId(){var e;return null===(e=this.nbgraderMetadata)||void 0===e?void 0:e.grade_id}set gradeId(e){this.setNbgraderMetadataKey("grade_id",e)}get points(){var e;return null===(e=this.nbgraderMetadata)||void 0===e?void 0:e.points}set points(e){this.setNbgraderMetadataKey("points",e)}get e2xgraderType(){var e;return null===(e=this.e2xgraderMetadata)||void 0===e?void 0:e.type}get gradingCellType(){var e;return null!==(e=this.e2xgraderType)&&void 0!==e?e:T.findMatchingCellType(this.nbgraderMetadata)}matchesCellType(e){return T.matchesCellType(this.nbgraderMetadata,e)}get isDescription(){return this.matchesCellType(M.DESCRIPTION)}get isAutograderTest(){return this.matchesCellType(M.AUTOGRADER_TEST)}get isAutograderSolution(){return this.matchesCellType(M.AUTOGRADED_ANSWER)}get isManualGradingCell(){return this.matchesCellType(M.MANUALLY_GRADED_ANSWER)}toJSON(){return this._cell.toJSON()}}var R,v=r(409),b=r(345),m=r.n(b);!function(e){class t extends v.Toolbar{constructor(e,t){super(e),this._cell=null,this._isAttached=!1,this._gradingCellModel=null,this._registry=t,this.addClass("e2xgrader-CellToolbar")}get cell(){return this._cell}set cell(e){this._cell!==e&&(this._cell=e,this.update())}get isAttached(){return this._isAttached}get gradingCellModel(){return this._gradingCellModel}get cellRegistry(){return this._registry}onAfterAttach(e){this._cell=this.parent,this._isAttached=!0,this._gradingCellModel=new C(this._cell.model.sharedModel),this.update()}update(){Array.from(this.children()).forEach((e=>{e instanceof r&&e.update()}))}}e.CellToolbar=t;class r extends v.ReactWidget{constructor(e){super(),this._toolbar=e}get toolbar(){return this._toolbar}get cell(){return this._toolbar.cell}get gradingCellModel(){return this._toolbar.gradingCellModel}get cellRegistry(){return this._toolbar.cellRegistry}renderElement(){return m().createElement(m().Fragment,null)}render(){return this.toolbar.isAttached?this.renderElement():null}}e.ToolbarElement=r}(R||(R={}));const x="@e2xgrader/core:cell-factory",S=[{id:"@e2xgrader/core:cell-registry",provides:a.IE2xGraderCellRegistry,autoStart:!0,activate:e=>{console.log("JupyterLab extension @e2xgrader/core:cell-registry is activated!");const t=new a.E2xGraderCellRegistry;return e.serviceManager.ready.then((()=>{console.log("JupyterLab service manager is ready.")})),t}},{id:x,requires:[a.IE2xGraderCellRegistry,n.IEditorServices],optional:[l.ISettingRegistry],provides:i.NotebookPanel.IContentFactory,autoStart:!0,activate:async(e,t,r,a)=>{console.log("JupyterLab extension @e2xgrader/core:cell-factory is activated!");const s=r.factoryService.newInlineEditor;let i;if(a){const e=await a.load(x);i=new p({editorFactory:s},e,t)}else i=new p({editorFactory:s},void 0,t);return console.log("Content factory created:",i),i}}]}}]);