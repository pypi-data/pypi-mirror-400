[build-system]
requires = ["setuptools>=60"]
build-backend = "setuptools.build_meta"

[project]
name = "ai-bench-suite"
dynamic = ["version"]
requires-python = ">=3.10"
description = "AI kernel benchmarking harness"
readme = "README.md"
license = {text = "MIT"}
authors = [
    {name = "Adam Siemieniuk", email = "adam.siemieniuk@intel.com"},
    {name = "Marcin Spoczynski", email = "marcin@spoczynski.com"}
]
classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Developers",
    "Intended Audience :: Science/Research",
    "License :: OSI Approved :: MIT License",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Topic :: Scientific/Engineering :: Artificial Intelligence",
    "Topic :: System :: Benchmark",
]
keywords = [
  "benchmark", "pytorch", "triton", "helion",
  "gpu", "xpu", "kernel", "performance"
]
dependencies = [
  "PyYAML",
  "numpy",
  "python-dotenv",
]

[project.scripts]
ai-bench = "ai_bench.cli:main"

[project.urls]
Homepage = "https://github.com/libxsmm/AI-bench"
Repository = "https://github.com/libxsmm/AI-bench"

[project.optional-dependencies]
cpu = [
  "torch==2.9.1+cpu",
]
xpu = [
  "torch==2.9.1+xpu",
  "pytorch-triton-xpu",
  "helion==0.2.9",
]

[dependency-groups]
dev = [
  "ruff==0.14.10",
  "pre-commit",
  "pytest",
  "pytest-timeout",
  "mypy",
]

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
python_functions = ["test_*"]

[tool.uv]
conflicts = [
  [
    { extra = "cpu" },
    { extra = "xpu" },
  ],
]

[tool.uv.sources]
torch = { index = "pytorch" }
pytorch-triton-xpu = { index = "pytorch" }

[[tool.uv.index]]
name = "pytorch"
url = "https://download.pytorch.org/whl"
explicit = true

[tool.setuptools.packages.find]
where = ["."]
include = ["ai_bench*"]

[tool.setuptools.package-data]
ai_bench = ["py.typed"]

[tool.setuptools.dynamic]
version = {attr = "ai_bench.__version__"}

[tool.mypy]
python_version = "3.10"
warn_return_any = true
warn_unused_ignores = true

[[tool.mypy.overrides]]
module = "torch.*"
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "triton.*"
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "helion.*"
ignore_missing_imports = true

[tool.ruff]
src = ["AI-bench"]
target-version = "py310"
line-length = 88

[tool.ruff.format]
docstring-code-format = true
quote-style = "double"

[tool.ruff.lint]
preview = true
select = [
  "A", # builtin shadowing
  "D419", # empty-docstring
  "E", # Error
  "F", # Pyflakes
  "I", # isort
  "N801", # invalid-class-name
  "N804", # cls for class methods
  "N805", # self for methods
  "N818", # error-suffix-on-exception-name
  "N999", # invalid-module-name
  "PERF", # Perflint
  "RUF022", # __all__ is not sorted
  "RUF030", # print() call in assert
  "RUF034", # useless if-else
  "RUF047", # empty else
  "RUF200", # invalid pyproject.toml
  "W", # Warning
]
ignore = [
    "E501", # line-too-long
    "PERF203", # try-except-in-loop
    "PERF401", # manual-list-comprehension
]

[tool.ruff.lint.isort]
known-local-folder = ["ai_bench"]
known-third-party = ["torch", "triton", "helion"]
known-first-party = ["mlir"]
force-single-line = true  # Improves merge conflicts
force-sort-within-sections = true
