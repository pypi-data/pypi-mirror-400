{"version":3,"file":"flow-run-graph-C7hM0e5Q.js","sources":["../../src/components/flow-runs/flow-run-graph/api.ts","../../src/components/flow-runs/flow-run-graph/consts.ts","../../src/components/flow-runs/flow-run-graph/utilities.ts","../../src/components/flow-runs/flow-run-graph/flow-run-graph-center-button.tsx","../../src/components/flow-runs/flow-run-graph/flow-run-graph-fullscreen-button.tsx","../../src/components/flow-runs/flow-run-graph/flow-run-graph-settings.tsx","../../src/components/flow-runs/flow-run-graph/flow-run-graph-settings-button.tsx","../../src/components/flow-runs/flow-run-graph/flow-run-graph-actions.tsx","../../src/components/flow-runs/flow-run-graph/flow-run-graph.tsx"],"sourcesContent":["import type {\n\tEventRelatedResource,\n\tRunGraphArtifact,\n\tRunGraphData,\n\tRunGraphEvent,\n\tRunGraphEventResource,\n\tRunGraphFetchEventsContext,\n\tRunGraphNode,\n} from \"@prefecthq/graphs\";\nimport { parseISO } from \"date-fns\";\nimport type { components } from \"@/api/prefect\";\nimport { getQueryService } from \"@/api/service\";\n\n/**\n * Fetches the graph data for a flow run.\n * @param id - The ID of the flow run.\n * @returns The graph data for the flow run.\n */\nexport async function fetchFlowRunGraph(id: string): Promise<RunGraphData> {\n\tconst { data } = await (await getQueryService()).GET(\n\t\t\"/flow_runs/{id}/graph-v2\",\n\t\t{\n\t\t\tparams: { path: { id } },\n\t\t},\n\t);\n\n\tif (!data) {\n\t\tthrow new Error(\"No data returned from API\");\n\t}\n\n\treturn mapApiResponseToRunGraphData(data);\n}\n\n/**\n * Fetches events for a flow run.\n * @param since - The start date of the events to fetch.\n * @param until - The end date of the events to fetch.\n * @param nodeId - The flowRunId of the node to fetch events for.\n * @returns The events for the flow run.\n */\nexport async function fetchFlowRunEvents({\n\tsince,\n\tuntil,\n\tnodeId,\n}: RunGraphFetchEventsContext): Promise<RunGraphEvent[]> {\n\tconst { data } = await (await getQueryService()).POST(\"/events/filter\", {\n\t\tbody: {\n\t\t\tfilter: {\n\t\t\t\tany_resource: {\n\t\t\t\t\tid: [`prefect.flow-run.${nodeId}`],\n\t\t\t\t},\n\t\t\t\tevent: {\n\t\t\t\t\texclude_prefix: [\"prefect.log.write\", \"prefect.task-run.\"],\n\t\t\t\t},\n\t\t\t\toccurred: {\n\t\t\t\t\tsince: since.toISOString(),\n\t\t\t\t\tuntil: until.toISOString(),\n\t\t\t\t},\n\t\t\t\torder: \"ASC\",\n\t\t\t},\n\t\t\tlimit: 200,\n\t\t},\n\t});\n\n\tif (!data) {\n\t\tthrow new Error(\"No data returned from API\");\n\t}\n\n\treturn mapApiResponseToRunGraphEvents(data);\n}\n\ntype GraphResponse = components[\"schemas\"][\"Graph\"];\ntype GraphResponseNode = GraphResponse[\"nodes\"][number];\ntype GraphResponseArtifact = GraphResponse[\"artifacts\"][number];\ntype EventsResponse = components[\"schemas\"][\"EventPage\"];\n\nfunction mapApiResponseToRunGraphData(response: GraphResponse): RunGraphData {\n\tif (!response.start_time) {\n\t\tthrow new Error(\"Start time is required\");\n\t}\n\n\treturn {\n\t\troot_node_ids: response.root_node_ids,\n\t\tstart_time: parseISO(response.start_time),\n\t\tend_time: response.end_time ? parseISO(response.end_time) : null,\n\t\tnodes: new Map(response.nodes.map((node) => mapNode(node))),\n\t};\n}\n\nexport function mapApiResponseToRunGraphEvents(\n\tresponse: EventsResponse,\n): RunGraphEvent[] {\n\treturn response.events.map((event) => {\n\t\tif (!event.received) {\n\t\t\tthrow new Error(\"Received is required\");\n\t\t}\n\n\t\tconst runGraphEvent: RunGraphEvent = {\n\t\t\tid: event.id,\n\t\t\treceived: parseISO(event.received),\n\t\t\toccurred: parseISO(event.occurred),\n\t\t\tevent: event.event,\n\t\t\tresource: event.resource as RunGraphEventResource,\n\t\t\tpayload: event.payload,\n\t\t\trelated: (event.related ?? []) as EventRelatedResource[],\n\t\t};\n\n\t\treturn runGraphEvent;\n\t});\n}\n\nfunction mapNode([id, node]: GraphResponseNode): [string, RunGraphNode] {\n\tif (!node.start_time) {\n\t\tthrow new Error(\"Start time is required\");\n\t}\n\n\treturn [\n\t\tid,\n\t\t{\n\t\t\tkind: node.kind,\n\t\t\tid: node.id,\n\t\t\tlabel: node.label,\n\t\t\tstate_type: node.state_type,\n\t\t\tstart_time: parseISO(node.start_time),\n\t\t\tend_time: node.end_time ? parseISO(node.end_time) : null,\n\t\t\tparents: node.parents,\n\t\t\tchildren: node.children,\n\t\t\tartifacts: node.artifacts.map(mapArtifact),\n\t\t},\n\t];\n}\n\nfunction mapArtifact(artifact: GraphResponseArtifact): RunGraphArtifact {\n\tif (!artifact.type) {\n\t\tthrow new Error(\"Artifact type is required\");\n\t}\n\n\tif (artifact.type === \"progress\" && typeof artifact.data === \"number\") {\n\t\treturn {\n\t\t\tid: artifact.id,\n\t\t\tcreated: parseISO(artifact.created),\n\t\t\tkey: artifact.key ?? undefined,\n\t\t\ttype: artifact.type,\n\t\t\tdata: artifact.data,\n\t\t};\n\t}\n\n\treturn {\n\t\tid: artifact.id,\n\t\tcreated: parseISO(artifact.created),\n\t\tkey: artifact.key ?? undefined,\n\t\ttype: artifact.type as Exclude<RunGraphArtifact[\"type\"], \"progress\">,\n\t};\n}\n","import type { StateType } from \"@prefecthq/graphs\";\n\nexport const stateTypeColors: Record<StateType, string> = {\n\tCOMPLETED: \"#219D4B\",\n\tRUNNING: \"#09439B\",\n\tSCHEDULED: \"#E08504\",\n\tPENDING: \"#554B58\",\n\tFAILED: \"#DE0529\",\n\tCANCELLED: \"#333333\",\n\tCANCELLING: \"#333333\",\n\tCRASHED: \"#EA580C\",\n\tPAUSED: \"#554B58\",\n};\n","export function isEventTargetInput(target: EventTarget | null): boolean {\n\tif (!target || !(target instanceof HTMLElement)) {\n\t\treturn false;\n\t}\n\treturn [\"INPUT\", \"TEXTAREA\", \"SELECT\"].includes(target.tagName);\n}\n","import { centerViewport } from \"@prefecthq/graphs\";\nimport { useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Icon } from \"@/components/ui/icons/icon\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { isEventTargetInput } from \"./utilities\";\n\nconst center = () => {\n\tvoid centerViewport({ animate: true });\n};\n\nexport function FlowRunGraphCenterButton() {\n\tuseEffect(() => {\n\t\tconst controller = new AbortController();\n\n\t\tdocument.addEventListener(\n\t\t\t\"keydown\",\n\t\t\t(event: KeyboardEvent) => {\n\t\t\t\tif (\n\t\t\t\t\tisEventTargetInput(event.target) ||\n\t\t\t\t\tevent.metaKey ||\n\t\t\t\t\tevent.ctrlKey\n\t\t\t\t) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (event.key === \"c\") {\n\t\t\t\t\tcenter();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{ signal: controller.signal },\n\t\t);\n\n\t\treturn () => controller.abort();\n\t}, []);\n\n\treturn (\n\t\t<Tooltip>\n\t\t\t<TooltipTrigger asChild>\n\t\t\t\t<Button variant=\"outline\" size=\"icon\" onClick={center}>\n\t\t\t\t\t<Icon id=\"Crosshair\" className=\"size-4\" />\n\t\t\t\t</Button>\n\t\t\t</TooltipTrigger>\n\t\t\t<TooltipContent>Recenter (c)</TooltipContent>\n\t\t</Tooltip>\n\t);\n}\n","import { useCallback, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Icon } from \"@/components/ui/icons/icon\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { isEventTargetInput } from \"./utilities\";\n\ntype FlowRunGraphFullscreenButtonProps = {\n\tfullscreen: boolean;\n\tonFullscreenChange: (fullscreen: boolean) => void;\n};\n\nexport function FlowRunGraphFullscreenButton({\n\tfullscreen,\n\tonFullscreenChange,\n}: FlowRunGraphFullscreenButtonProps) {\n\tconst toggleFullscreen = useCallback(() => {\n\t\tonFullscreenChange(!fullscreen);\n\t}, [fullscreen, onFullscreenChange]);\n\n\tuseEffect(() => {\n\t\tconst controller = new AbortController();\n\n\t\tdocument.addEventListener(\n\t\t\t\"keydown\",\n\t\t\t(event: KeyboardEvent) => {\n\t\t\t\tif (\n\t\t\t\t\tisEventTargetInput(event.target) ||\n\t\t\t\t\tevent.metaKey ||\n\t\t\t\t\tevent.ctrlKey\n\t\t\t\t) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (event.key === \"f\") {\n\t\t\t\t\ttoggleFullscreen();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (event.key === \"Escape\") {\n\t\t\t\t\ttoggleFullscreen();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t},\n\t\t\t{ signal: controller.signal },\n\t\t);\n\n\t\treturn () => controller.abort();\n\t}, [toggleFullscreen]);\n\n\treturn (\n\t\t<Tooltip>\n\t\t\t<TooltipTrigger asChild>\n\t\t\t\t<Button variant=\"outline\" size=\"icon\" onClick={toggleFullscreen}>\n\t\t\t\t\t<Icon id=\"Expand\" className=\"size-4\" />\n\t\t\t\t</Button>\n\t\t\t</TooltipTrigger>\n\t\t\t<TooltipContent>Fullscreen (f)</TooltipContent>\n\t\t</Tooltip>\n\t);\n}\n","import {\n\tDEFAULT_HORIZONTAL_SCALE_MULTIPLIER,\n\ttype HorizontalMode,\n\tisHorizontalMode,\n\tisVerticalMode,\n\tlayout,\n\tresetHorizontalScaleMultiplier,\n\tsetDisabledArtifacts,\n\tsetDisabledEdges,\n\tsetDisabledEvents,\n\tsetHorizontalMode,\n\tsetHorizontalScaleMultiplier,\n\tsetVerticalMode,\n\ttype VerticalMode,\n} from \"@prefecthq/graphs\";\nimport { useCallback, useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Typography } from \"@/components/ui/typography\";\n\ntype LayoutOption = `${HorizontalMode}_${VerticalMode}`;\n\nconst layoutOptions: { label: string; value: LayoutOption }[] = [\n\t{\n\t\tlabel: \"Temporal dependency\",\n\t\tvalue: \"temporal_nearest-parent\",\n\t},\n\t{\n\t\tlabel: \"Temporal sequence\",\n\t\tvalue: \"temporal_waterfall\",\n\t},\n\t{\n\t\tlabel: \"Dependency grid\",\n\t\tvalue: \"dependency_nearest-parent\",\n\t},\n\t{\n\t\tlabel: \"Sequential grid\",\n\t\tvalue: \"dependency_waterfall\",\n\t},\n\t{\n\t\tlabel: \"Comparative duration\",\n\t\tvalue: \"left-aligned_duration-sorted\",\n\t},\n];\n\nconst increaseScale = () => {\n\tconst multiplier = DEFAULT_HORIZONTAL_SCALE_MULTIPLIER + 1;\n\tconst scale = layout.horizontalScaleMultiplier * multiplier;\n\tsetHorizontalScaleMultiplier(scale);\n};\n\nconst decreaseScale = () => {\n\tconst multiplier = Math.abs(DEFAULT_HORIZONTAL_SCALE_MULTIPLIER - 1);\n\tconst scale = layout.horizontalScaleMultiplier * multiplier;\n\tsetHorizontalScaleMultiplier(scale);\n};\n\nconst resetScale = () => {\n\tresetHorizontalScaleMultiplier();\n};\n\nfunction isLayoutOption(value: string): value is LayoutOption {\n\tconst [horizontal, vertical] = value.split(\"_\");\n\treturn isHorizontalMode(horizontal) && isVerticalMode(vertical);\n}\n\nexport function FlowRunGraphSettings() {\n\tconst [selectedLayoutOption, setSelectedLayoutOption] = useState(\n\t\t`${layout.horizontal}_${layout.vertical}`,\n\t);\n\tconst [hideEdges, setHideEdges] = useState(layout.disableEdges);\n\tconst [hideArtifacts, setHideArtifacts] = useState(layout.disableArtifacts);\n\tconst [hideEvents, setHideEvents] = useState(layout.disableEvents);\n\n\tconst handleLayoutChange = useCallback((value: string) => {\n\t\tif (!isLayoutOption(value)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst [horizontal, vertical] = value.split(\"_\");\n\n\t\tif (!isHorizontalMode(horizontal) || !isVerticalMode(vertical)) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetSelectedLayoutOption(value);\n\t\tsetHorizontalMode(horizontal);\n\t\tsetVerticalMode(vertical);\n\t}, []);\n\n\tconst handleHideEdgesChange = useCallback((value: boolean) => {\n\t\tsetHideEdges(value);\n\t\tsetDisabledEdges(value);\n\t}, []);\n\n\tconst handleHideArtifactsChange = useCallback((value: boolean) => {\n\t\tsetHideArtifacts(value);\n\t\tsetDisabledArtifacts(value);\n\t}, []);\n\n\tconst handleHideEventsChange = useCallback((value: boolean) => {\n\t\tsetHideEvents(value);\n\t\tsetDisabledEvents(value);\n\t}, []);\n\n\treturn (\n\t\t<div className=\"flex flex-col gap-2\">\n\t\t\t<div className=\"flex flex-col gap-2\">\n\t\t\t\t<Typography variant=\"bodyLarge\">Layout</Typography>\n\t\t\t\t<div className=\"flex flex-col gap-2\">\n\t\t\t\t\t{layoutOptions.map((option) => (\n\t\t\t\t\t\t<div key={option.value} className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\t\t\tid={option.value}\n\t\t\t\t\t\t\t\tname=\"layout\"\n\t\t\t\t\t\t\t\tvalue={option.value}\n\t\t\t\t\t\t\t\tchecked={selectedLayoutOption === option.value}\n\t\t\t\t\t\t\t\tonChange={(e) => handleLayoutChange(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Label htmlFor={option.value}>{option.label}</Label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t))}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{(layout.isTemporal() || layout.isLeftAligned()) && (\n\t\t\t\t<div className=\"flex flex-col gap-2\">\n\t\t\t\t\t<Typography variant=\"bodyLarge\">Scaling</Typography>\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\tonClick={decreaseScale}\n\t\t\t\t\t\t\ttitle=\"Decrease scale (-)\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t-\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\tonClick={increaseScale}\n\t\t\t\t\t\t\ttitle=\"Increase scale (+)\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t+\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button variant=\"outline\" size=\"sm\" onClick={resetScale}>\n\t\t\t\t\t\t\tReset\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t<hr className=\"my-4\" />\n\n\t\t\t<div className=\"flex flex-col gap-2\">\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t<Switch\n\t\t\t\t\t\tid=\"hideEdges\"\n\t\t\t\t\t\tchecked={hideEdges}\n\t\t\t\t\t\tonCheckedChange={handleHideEdgesChange}\n\t\t\t\t\t/>\n\t\t\t\t\t<Label htmlFor=\"hideEdges\">Hide dependency arrows</Label>\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t<Switch\n\t\t\t\t\t\tid=\"hideArtifacts\"\n\t\t\t\t\t\tchecked={hideArtifacts}\n\t\t\t\t\t\tonCheckedChange={handleHideArtifactsChange}\n\t\t\t\t\t/>\n\t\t\t\t\t<Label htmlFor=\"hideArtifacts\">Hide artifacts</Label>\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t<Switch\n\t\t\t\t\t\tid=\"hideEvents\"\n\t\t\t\t\t\tchecked={hideEvents}\n\t\t\t\t\t\tonCheckedChange={handleHideEventsChange}\n\t\t\t\t\t/>\n\t\t\t\t\t<Label htmlFor=\"hideEvents\">Hide events</Label>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","import { Button } from \"@/components/ui/button\";\nimport { Icon } from \"@/components/ui/icons/icon\";\nimport {\n\tPopover,\n\tPopoverContent,\n\tPopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { FlowRunGraphSettings } from \"./flow-run-graph-settings\";\n\nexport function FlowRunGraphSettingsButton() {\n\treturn (\n\t\t<Popover>\n\t\t\t<PopoverTrigger>\n\t\t\t\t<Tooltip>\n\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t<Button variant=\"outline\" size=\"icon\">\n\t\t\t\t\t\t\t<Icon id=\"Cog\" className=\"size-4\" />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t<TooltipContent>Settings</TooltipContent>\n\t\t\t\t</Tooltip>\n\t\t\t</PopoverTrigger>\n\t\t\t<PopoverContent>\n\t\t\t\t<FlowRunGraphSettings />\n\t\t\t</PopoverContent>\n\t\t</Popover>\n\t);\n}\n","import { FlowRunGraphCenterButton } from \"./flow-run-graph-center-button\";\nimport { FlowRunGraphFullscreenButton } from \"./flow-run-graph-fullscreen-button\";\nimport { FlowRunGraphSettingsButton } from \"./flow-run-graph-settings-button\";\n\ntype FlowRunGraphActionsProps = {\n\tfullscreen: boolean;\n\tonFullscreenChange: (fullscreen: boolean) => void;\n};\n\nexport function FlowRunGraphActions({\n\tfullscreen,\n\tonFullscreenChange,\n}: FlowRunGraphActionsProps) {\n\treturn (\n\t\t<div className=\"flex gap-2\">\n\t\t\t<FlowRunGraphCenterButton />\n\t\t\t<FlowRunGraphFullscreenButton\n\t\t\t\tfullscreen={fullscreen}\n\t\t\t\tonFullscreenChange={onFullscreenChange}\n\t\t\t/>\n\t\t\t<FlowRunGraphSettingsButton />\n\t\t</div>\n\t);\n}\n","import {\n\temitter,\n\ttype GraphItemSelection,\n\ttype RunGraphConfig,\n\ttype RunGraphNode,\n\ttype RunGraphStateEvent,\n\tselectItem,\n\tsetConfig,\n\tstart,\n\tstop,\n\tupdateViewportFromDateRange,\n\ttype ViewportDateRange,\n} from \"@prefecthq/graphs\";\nimport { useTheme } from \"next-themes\";\nimport {\n\ttype CSSProperties,\n\tuseCallback,\n\tuseEffect,\n\tuseMemo,\n\tuseRef,\n\tuseState,\n} from \"react\";\nimport { fetchFlowRunEvents, fetchFlowRunGraph } from \"./api\";\nimport { stateTypeColors } from \"./consts\";\nimport { FlowRunGraphActions } from \"./flow-run-graph-actions\";\n\ntype FlowRunGraphProps = {\n\tflowRunId: string;\n\tviewport?: ViewportDateRange;\n\tonViewportChange?: (viewport: ViewportDateRange) => void;\n\tselected?: GraphItemSelection;\n\tonSelectedChange?: (selected: GraphItemSelection | undefined) => void;\n\tfullscreen?: boolean;\n\tonFullscreenChange?: (fullscreen: boolean) => void;\n\tclassName?: string;\n\tstyle?: CSSProperties;\n};\n\nexport function FlowRunGraph({\n\tflowRunId,\n\tviewport,\n\tonViewportChange,\n\tselected,\n\tonSelectedChange,\n\tclassName,\n\tstyle,\n\tfullscreen: controlledFullscreen,\n\tonFullscreenChange,\n}: FlowRunGraphProps) {\n\tconst stageRef = useRef<HTMLDivElement>(null);\n\tconst [internalFullscreen, setInternalFullscreen] = useState(false);\n\tconst { resolvedTheme } = useTheme();\n\n\tconst fullscreen = controlledFullscreen ?? internalFullscreen;\n\n\tconst updateFullscreen = useCallback(\n\t\t(value: boolean) => {\n\t\t\tsetInternalFullscreen(value);\n\t\t\tonFullscreenChange?.(value);\n\t\t},\n\t\t[onFullscreenChange],\n\t);\n\n\tconst config = useMemo<RunGraphConfig>(\n\t\t() => ({\n\t\t\trunId: flowRunId,\n\t\t\tfetch: fetchFlowRunGraph,\n\t\t\tfetchEvents: fetchFlowRunEvents,\n\t\t\tstyles: () => ({\n\t\t\t\tnode: (node: RunGraphNode) => ({\n\t\t\t\t\tbackground: stateTypeColors[node.state_type],\n\t\t\t\t}),\n\t\t\t\tstate: (event: RunGraphStateEvent) => ({\n\t\t\t\t\tbackground: stateTypeColors[event.type],\n\t\t\t\t}),\n\t\t\t}),\n\t\t\ttheme: resolvedTheme === \"dark\" ? \"dark\" : \"light\",\n\t\t}),\n\t\t[flowRunId, resolvedTheme],\n\t);\n\n\tuseEffect(() => {\n\t\tsetConfig(config);\n\t}, [config]);\n\n\tuseEffect(() => {\n\t\tif (!stageRef.current) {\n\t\t\tthrow new Error(\"Stage does not exist\");\n\t\t}\n\n\t\tstart({\n\t\t\tstage: stageRef.current,\n\t\t\tconfig,\n\t\t});\n\n\t\treturn () => {\n\t\t\tstop();\n\t\t};\n\t}, [config]);\n\n\tuseEffect(() => {\n\t\tselectItem(selected ?? null);\n\t}, [selected]);\n\n\tuseEffect(() => {\n\t\tvoid updateViewportFromDateRange(viewport);\n\t}, [viewport]);\n\n\tuseEffect(() => {\n\t\tconst offItemSelected = emitter.on(\"itemSelected\", (nodeId) =>\n\t\t\tonSelectedChange?.(nodeId ?? undefined),\n\t\t);\n\t\tconst offViewportDateRangeUpdated = emitter.on(\n\t\t\t\"viewportDateRangeUpdated\",\n\t\t\t(range) => onViewportChange?.(range),\n\t\t);\n\n\t\treturn () => {\n\t\t\toffItemSelected();\n\t\t\toffViewportDateRangeUpdated();\n\t\t};\n\t}, [onSelectedChange, onViewportChange]);\n\n\treturn (\n\t\t<div\n\t\t\tclassName={`${fullscreen ? \"fixed h-screen w-screen z-20\" : \"relative h-[500px] w-full \"} ${className ?? \"\"}`}\n\t\t\tstyle={style}\n\t\t>\n\t\t\t<div ref={stageRef} className=\"size-full [&>canvas]:size-full\" />\n\t\t\t<div className=\"absolute bottom-0 right-0\">\n\t\t\t\t<FlowRunGraphActions\n\t\t\t\t\tfullscreen={fullscreen}\n\t\t\t\t\tonFullscreenChange={updateFullscreen}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n"],"names":["fetchFlowRunGraph","id","data","getQueryService","mapApiResponseToRunGraphData","fetchFlowRunEvents","since","until","nodeId","mapApiResponseToRunGraphEvents","response","parseISO","node","mapNode","event","mapArtifact","artifact","stateTypeColors","isEventTargetInput","target","center","centerViewport","FlowRunGraphCenterButton","useEffect","controller","Tooltip","jsx","TooltipTrigger","Button","Icon","TooltipContent","FlowRunGraphFullscreenButton","fullscreen","onFullscreenChange","toggleFullscreen","useCallback","layoutOptions","increaseScale","multiplier","DEFAULT_HORIZONTAL_SCALE_MULTIPLIER","scale","layout","setHorizontalScaleMultiplier","decreaseScale","resetScale","resetHorizontalScaleMultiplier","isLayoutOption","value","horizontal","vertical","isHorizontalMode","isVerticalMode","FlowRunGraphSettings","selectedLayoutOption","setSelectedLayoutOption","useState","hideEdges","setHideEdges","hideArtifacts","setHideArtifacts","hideEvents","setHideEvents","handleLayoutChange","setHorizontalMode","setVerticalMode","handleHideEdgesChange","setDisabledEdges","handleHideArtifactsChange","setDisabledArtifacts","handleHideEventsChange","setDisabledEvents","jsxs","Typography","option","e","Label","Switch","FlowRunGraphSettingsButton","Popover","PopoverTrigger","PopoverContent","FlowRunGraphActions","FlowRunGraph","flowRunId","viewport","onViewportChange","selected","onSelectedChange","className","style","controlledFullscreen","stageRef","useRef","internalFullscreen","setInternalFullscreen","resolvedTheme","useTheme","updateFullscreen","config","useMemo","setConfig","start","stop","selectItem","updateViewportFromDateRange","offItemSelected","emitter","offViewportDateRangeUpdated","range"],"mappings":"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"}