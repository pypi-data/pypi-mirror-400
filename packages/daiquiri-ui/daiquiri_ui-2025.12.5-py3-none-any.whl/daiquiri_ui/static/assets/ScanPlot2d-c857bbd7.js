var j=Object.defineProperty;var S=(a,n,e)=>n in a?j(a,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[n]=e;var c=(a,n,e)=>(S(a,typeof n!="symbol"?n+"":n,e),e);import{j as s,ay as g,r as p,l as N,ao as I,d as C,g as w,R as P,C as m,I as u,F as f,p as R,A as b,w as L,c as y,s as h,a0 as $,q as U}from"./index-4cf586ed.js";import{Z as D}from"./ZoomPanCanvas-1365066d.js";import{D as x}from"./DropdownButton-9a594aef.js";import{I as A}from"./Image-c1578ac2.js";import"./CanvasEnhancer-abaa5025.js";import"./types-0be7083b.js";function E(a){const n=`resources/icons/lut/${a.name}.png`,e=a.active?{border:"2px solid black"}:{border:"2px solid transparent"};return s.jsx(A,{style:e,src:n,roundedCircle:!0})}function M(a){const{as:n,onSelect:e,value:t}=a,o=t.replace(/^\w/,i=>i.toUpperCase()).replace("_r"," (reversed)");function r(i,l){const d=t===i;return s.jsxs(g.Item,{eventKey:i,children:[s.jsx(E,{name:i,active:d}),"  ",l]})}return s.jsxs(x,{as:n,title:o,id:"bg-vertical-dropdown-7",onSelect:e,children:[r("gray","Gray"),r("gray_r","Gray (reversed)"),r("viridis","Viridis"),r("cividis","Cividis"),r("magma","Magma"),r("inferno","Inferno"),r("plasma","Plasma")]})}function Z(a){const{as:n,onSelect:e,value:t}=a,o=t.replace(/^\w/,i=>i.toUpperCase());function r(i,l){const d=t===i?"fa fa-fw fa-dot-circle-o":"fa fa-fw fa-circle-o";return s.jsxs(g.Item,{eventKey:i,children:[s.jsx("i",{className:d}),"  ",l]})}return s.jsxs(x,{as:n,title:o,id:"bg-vertical-dropdown-4",onSelect:e,children:[r("linear","Linear"),r("log","Log"),r("arcsinh","ArcsinH"),r("sqrt","Sqrt")]})}function _(a){const{as:n,onSelect:e,value:t}=a,r={stddev3:"3×std"}[t]||t.replace(/^\w/,l=>l.toUpperCase());function i(l,d){const v=t===l?"fa fa-fw fa-dot-circle-o":"fa fa-fw fa-circle-o";return s.jsxs(g.Item,{eventKey:l,children:[s.jsx("i",{className:v}),"  ",d]})}return s.jsxs(x,{as:n,title:r,id:"bg-vertical-dropdown-3",onSelect:e,children:[i("none","None"),i("minmax","Minmax"),i("stddev3","3×std")]})}let O=class extends p.Component{constructor(e){super(e);c(this,"max");c(this,"selectRef");c(this,"point");c(this,"loadImage");c(this,"onChangeNode",()=>{this.loadImage()});c(this,"onChangePoint",e=>{const{value:t}=e.target,o=Number.parseInt(t,10);o<this.max&&this.props.actions.selectPoint(o)});c(this,"onReady",()=>{this.loadImage()});c(this,"onError",(e,t,o)=>{this.setState({error:o})});c(this,"onZoomChange",e=>{this.setState({zoom:e})});c(this,"onLoadProgress",e=>{e===100?this.setState({loadingMessage:""}):this.setState({loadingMessage:`Loading ${e}%`})});c(this,"onSelectLut",e=>{e!==null&&(this.setState({lut:e}),this.loadImage())});c(this,"onSelectAutoscale",e=>{e!==null&&(this.setState({autoscale:e}),this.loadImage())});c(this,"onSelectNorm",e=>{e!==null&&(this.setState({norm:e}),this.loadImage())});this.state={loadingMessage:"",zoom:1,url:void 0,lut:"gray",autoscale:"minmax",norm:"linear",error:void 0},this.loadImage=N.debounce(this.rawLoadImage.bind(this),1e3),this.max=0,this.selectRef=p.createRef(),this.point=p.createRef()}componentDidMount(){this.loadImage()}componentDidUpdate(e){const t=this.data();if(!t||!t.scanid)return;const o=t.npoints_avail;(e.currentPoint!==this.props.currentPoint||e.selectedScan!==this.props.selectedScan||this.max!==o)&&this.loadImage(),this.max=o}componentWillUnmount(){this.loadImage.cancel()}getNodeOptions(){const e=this.data();return e?e.axes.ys.images.map(t=>s.jsx("option",{children:t},t)):null}data(){const e=this.selectedScan();if(e!==null)return this.props.data[e]}selectedScan(){return this.props.selectedScan||I(this.props.scans)}imageURL(e,t,o,r,i){var l;if((l=this.selectRef.current)!=null&&l.value)return`${C.baseUrl}/scans/image/${e}?node_name=${this.selectRef.current.value}&image_no=${t}&lut=${o}&autoscale=${r}&norm=${i}`}rawLoadImage(){this.setState({error:void 0});const e=this.data(),t=this.props.currentPoint||this.max-1;t<0||e!=null&&e.scanid&&(this.point.current&&(this.point.current.value=`${t}`),this.setState(o=>({...o,loadingMessage:`Loading Image ${t}`,url:this.props.url||this.imageURL(e.scanid,t,o.lut,o.autoscale,o.norm)})))}render(){return s.jsxs("div",{className:"plot2d-container",style:this.props.style,children:[s.jsxs("div",{className:"controls mb-1",children:[s.jsx(w,{children:s.jsxs(P,{children:[s.jsx(m,{xs:"auto",className:"gx-1",children:s.jsx(M,{value:this.state.lut,onSelect:this.onSelectLut})}),s.jsx(m,{xs:"auto",className:"gx-1",children:s.jsx(_,{value:this.state.autoscale,onSelect:this.onSelectAutoscale})}),s.jsx(m,{xs:"auto",className:"gx-1",children:s.jsx(Z,{value:this.state.norm,onSelect:this.onSelectNorm})}),s.jsx(m,{xs:"auto",className:"gx-1",children:s.jsxs(u,{children:[s.jsx(u.Text,{children:"Node"}),s.jsx(f.Control,{as:"select",onChange:this.onChangeNode,ref:this.selectRef,children:this.getNodeOptions()})]})}),s.jsx(m,{xs:"auto",className:"gx-1",children:s.jsxs(u,{children:[s.jsx(u.Text,{children:"Point"}),s.jsx(f.Control,{type:"number",ref:this.point,onChange:this.onChangePoint,min:"0",max:this.max})]})})]})}),s.jsx("div",{className:"message",children:this.state.loadingMessage}),s.jsxs("div",{className:"zoom",children:["Zoom:",(this.state.zoom*100).toFixed(0),"%"]})]}),s.jsx(R,{children:s.jsx(D,{className:"scanimage",url:this.state.url,onZoomChange:this.onZoomChange,onLoadProgress:this.onLoadProgress,onReady:this.onReady,onError:this.onError,maxZoom:4,children:s.jsx("div",{className:"plot-error",children:this.state.error&&s.jsxs(b,{variant:"danger",children:["Error loading image: ",this.state.error]})})})})]})}};function T(a,n){return{scans:n.providers.scans.list.selector("results",a),data:n.providers.scans.data.selector("results",a),spectra:n.providers.scans.spectra.selector("results",a),currentPoint:h.selector("currentPoint",a),currentImageNode:h.selector("currentImageNode",a),selectedScan:h.selector("selectedScan",a)}}function z(a,n){return{actions:{selectPoint:e=>h.dispatch("SCAN_CURRENT_POINT",Number.parseInt(e,10)),fetchScanSpectra:e=>n.providers.scans.spectra.fetch(e)}}}const K=L({scans:h})(y(T,z)(O));function J(a){const{providers:n,yamlNode:e,events:t,...o}=a;return $(e,"events",t),U(e,o),s.jsx(K,{providers:n})}export{J as default};
