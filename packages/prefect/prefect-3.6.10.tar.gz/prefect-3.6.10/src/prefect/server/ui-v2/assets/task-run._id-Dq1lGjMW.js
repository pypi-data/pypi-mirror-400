import{r as c,s as E,j as e,t as M,L as O,I as F,F as G,G as V}from"./vendor-tanstack-BVzzyDEt.js";import{bt as Q,G as $,K as U,c5 as z,aU as q,c6 as J,I as _,bl as H,aJ as K,aa as W,c7 as X,S as A,d as P,f as k,h as C,e as Y,c8 as Z,a4 as R,c9 as ee,B as se,a as ae,b as v,bq as T,bz as S,bB as te,a9 as le,r as re,s as ne,q as ie,bO as ce,t as oe,v as y,w as g,at as de,au as xe,av as p,bP as me,bQ as he,bR as fe,aw as j,L as ue,b3 as x,ca as w}from"./index-BJkJ93Lr.js";import{A as ge}from"./artifact-card-Cy3v2Lds.js";import{T as pe,a as D}from"./toggle-group-B18EYoB-.js";import{R as je,a as Ne,u as ve,C as ye}from"./index-DZTWMzXC.js";import{L as be}from"./lazy-markdown-CwRqR_1U.js";import{D as _e}from"./delete-confirmation-dialog-Baib9xiM.js";import{u as Ce}from"./use-delete-confirmation-dialog-DDTCxOIv.js";import{u as Te}from"./use-page-title-D7YuRDEL.js";import{b as Se,f as we}from"./vendor-forms-BN3tpxM2.js";import"./vendor-react-Bce9NwRC.js";import"./vendor-radix-CTAic6HB.js";import"./vendor-recharts-Mwm2qLZp.js";import"./vendor-date-2jFo9aCm.js";import"./index-BCjE1NvU.js";const De=({taskRun:s})=>{const[t,a]=c.useState("grid"),{data:n}=E(Q({artifacts:{operator:"and_",task_run_id:{any_:[s.id]},type:{not_any_:["result"]}},sort:"ID_DESC",offset:0}));return n.length===0?e.jsx($,{children:e.jsx(U,{className:"text-center",children:e.jsxs("p",{children:["This task run did not produce any artifacts; for more information on creating artifacts, see the"," ",e.jsx("a",{href:"https://docs.prefect.io/v3/develop/artifacts",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500",children:"documentation"}),"."]})})}):e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(pe,{type:"single",variant:"outline",value:t,onValueChange:r=>a(r),children:[e.jsx(D,{value:"grid","aria-label":"Grid view",children:e.jsx(z,{className:"w-4 h-4"})}),e.jsx(D,{value:"list","aria-label":"List view",children:e.jsx(je,{className:"w-4 h-4"})})]})}),e.jsx("div",{className:q("grid",t==="grid"?"grid-cols-1 lg:grid-cols-2 xl:grid-cols-3":"grid-cols-1","gap-4"),"data-testid":"task-run-artifacts-grid",children:n.map(r=>e.jsx(ge,{artifact:r,compact:t==="list"},r.id))})]})};function N(s){return s?K(s,"dateTimeNumeric"):"N/A"}function b(s){return s==null?"N/A":W(s*1e3,{maxDecimalPoints:2,units:["s"]})}const L=({taskRun:s})=>{const{data:t}=M({...J(s?.id??""),enabled:!!s?.id});return s?e.jsxs("div",{className:"flex flex-col gap-2 p-2 text-xs",children:[s.flow_run_id?e.jsxs("dl",{className:"flex flex-col gap-1 mb-2",children:[e.jsx("dt",{className:"text-gray-500",children:"Flow Run"}),e.jsx("dd",{children:e.jsxs(O,{to:"/runs/flow-run/$id",params:{id:s.flow_run_id},className:"text-blue-500 hover:underline cursor-pointer flex items-center",children:[e.jsx(_,{id:"ExternalLink",className:"mr-1 size-4"}),s.flow_run_name]})})]}):e.jsxs("dl",{className:"flex flex-col gap-1 mb-2",children:[e.jsx("dt",{className:"text-gray-500",children:"Flow Run"}),e.jsx("dd",{children:"None"})]}),e.jsxs("dl",{className:"flex flex-col gap-1 mb-2",children:[e.jsx("dt",{className:"text-gray-500",children:"Start Time"}),e.jsx("dd",{className:"font-mono",children:s.start_time?N(s.start_time):"None"})]}),e.jsxs("dl",{className:"flex flex-col gap-1 mb-2",children:[e.jsx("dt",{className:"text-gray-500",children:"Duration"}),e.jsx("dd",{className:"",children:e.jsxs("span",{className:"flex items-center",children:[e.jsx(_,{id:"Clock",className:"mr-1 size-4"}),s.total_run_time!==null&&s.total_run_time!==void 0?b(s.total_run_time):"None"]})})]}),e.jsxs("dl",{className:"flex flex-col gap-1 mb-2",children:[e.jsx("dt",{className:"text-gray-500",children:"Run Count"}),e.jsx("dd",{className:"",children:s.run_count??0})]}),e.jsxs("dl",{className:"flex flex-col gap-1 mb-2",children:[e.jsx("dt",{className:"text-gray-500",children:"Estimated Run Time"}),e.jsx("dd",{className:"",children:s.estimated_run_time!==null&&s.estimated_run_time!==void 0?b(s.estimated_run_time):"None"})]}),e.jsxs("dl",{className:"flex flex-col gap-1 mb-2",children:[e.jsx("dt",{className:"text-gray-500",children:"Created"}),e.jsx("dd",{className:"font-mono",children:s.created?N(s.created):"None"})]}),e.jsxs("dl",{className:"flex flex-col gap-1 mb-2",children:[e.jsx("dt",{className:"text-gray-500",children:"Last Updated"}),e.jsx("dd",{className:"font-mono",children:s.updated?N(s.updated):"None"})]}),e.jsxs("dl",{className:"flex flex-col gap-1 mb-2",children:[e.jsx("dt",{className:"text-gray-500",children:"Cache Key"}),e.jsx("dd",{className:"font-mono",children:s.cache_key||"None"})]}),e.jsxs("dl",{className:"flex flex-col gap-1 mb-2",children:[e.jsx("dt",{className:"text-gray-500",children:"Cache Expiration"}),e.jsx("dd",{className:"font-mono",children:s.cache_expiration?N(s.cache_expiration):"None"})]}),e.jsxs("dl",{className:"flex flex-col gap-1 mb-2",children:[e.jsx("dt",{className:"text-gray-500",children:"Dynamic Key"}),e.jsx("dd",{className:"font-mono",children:s.dynamic_key||"None"})]}),e.jsxs("dl",{className:"flex flex-col gap-1 mb-2",children:[e.jsx("dt",{className:"text-gray-500",children:"Task Run ID"}),e.jsx("dd",{className:"font-mono",children:s.id})]}),t?.description&&e.jsxs("dl",{className:"flex flex-col gap-1 mb-2",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Result"}),e.jsx("dd",{children:e.jsx("div",{className:"prose max-w-none dark:prose-invert",children:e.jsx(be,{children:t.description})})})]}),e.jsx("div",{className:"border-t border-gray-200 mt-2 pt-4"}),e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Task configuration"}),e.jsxs("dl",{className:"flex flex-col gap-1 mb-2",children:[e.jsx("dt",{className:" text-gray-500",children:"Version"}),e.jsx("dd",{className:"",children:s.task_version||"None"})]}),e.jsxs("dl",{className:"flex flex-col gap-1 mb-2",children:[e.jsx("dt",{className:"text-gray-500",children:"Retries"}),e.jsx("dd",{className:"",children:s.empirical_policy?.retries?.toString()??"0"})]}),e.jsxs("dl",{className:"flex flex-col gap-1 mb-2",children:[e.jsx("dt",{className:"text-gray-500",children:"Retry Delay"}),e.jsx("dd",{className:"",children:typeof s.empirical_policy?.retry_delay=="number"?b(s.empirical_policy.retry_delay):"None"})]}),e.jsxs("dl",{className:"flex flex-col gap-1 mb-2",children:[e.jsx("dt",{className:"text-gray-500",children:"Retry Jitter Factor"}),e.jsx("dd",{className:"",children:s.empirical_policy?.retry_jitter_factor!==null&&s.empirical_policy?.retry_jitter_factor!==void 0?s.empirical_policy.retry_jitter_factor.toString():"None"})]}),e.jsxs("dl",{className:"flex flex-col gap-1 mb-2",children:[e.jsx("dt",{className:" text-gray-500",children:"Tags"}),e.jsx("dd",{className:"",children:s.tags&&s.tags.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:s.tags.map(a=>e.jsx(H,{tag:a},a))}):"None"})]})]}):e.jsx("div",{className:"flex flex-col gap-2 bg-gray-100 p-4 rounded-md",children:e.jsx("span",{className:"text-gray-500",children:"No task run details available"})})},Le=({taskRun:s,virtualize:t=!0})=>{const[a,n]=c.useState(0),[r,l]=c.useState("TIMESTAMP_ASC"),o=c.useMemo(()=>({...X({limit:50,sort:r,logs:{operator:"and_",level:{ge_:a},task_run_id:{any_:[s.id]}}}),refetchInterval:s.state_type==="RUNNING"?5e3:!1}),[a,r,s.id,s.state_type]),{data:i,hasNextPage:d,fetchNextPage:f,isFetchingNextPage:u}=F(o),m=i.pages.length===1&&i.pages[0].length===0;let h="This run did not produce any logs.";return m&&(a>0?h="No logs match your filter criteria":s.state_type==="SCHEDULED"&&s.state_name==="Scheduled"?h="Run has not yet started. Check back soon for logs.":s.state_type==="RUNNING"&&(h="Waiting for logs...")),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-row gap-2 justify-end",children:[e.jsx(Ie,{levelFilter:a,setLevelFilter:n}),e.jsx(Ee,{sortOrder:r,setSortOrder:l})]}),m?e.jsx("div",{className:"flex flex-col gap-2 text-center bg-muted p-2 rounded-md",children:e.jsx("span",{className:"text-muted-foreground",children:h})}):e.jsx("div",{className:"rounded-md",children:e.jsx(Ne,{taskRun:s,logs:i.pages.flat(),onBottomReached:()=>{d&&!u&&f().catch(B=>{console.error(B)})},className:"max-h-[85vh]",virtualize:t})})]})},I=[{label:"All",value:0},{label:"Critical only",value:50},{label:"Error and above",value:40},{label:"Warning and above",value:30},{label:"Info and above",value:20},{label:"Debug and above",value:10}],Ie=({levelFilter:s,setLevelFilter:t})=>e.jsxs(A,{value:s.toString(),onValueChange:a=>t(Number(a)),children:[e.jsx(P,{"aria-label":"log level filter",children:e.jsx("span",{children:`Level:
							${I.find(a=>a.value===s)?.label}`})}),e.jsx(k,{children:I.map(a=>e.jsx(C,{value:a.value.toString(),children:a.label},a.value))})]}),Ee=({sortOrder:s,setSortOrder:t})=>e.jsxs(A,{value:s,onValueChange:a=>t(a),children:[e.jsx(P,{"aria-label":"log sort order",children:e.jsx(Y,{placeholder:"Sort log order"})}),e.jsxs(k,{children:[e.jsx(C,{value:"TIMESTAMP_ASC",children:"Oldest to newest"}),e.jsx(C,{value:"TIMESTAMP_DESC",children:"Newest to oldest"})]})]});function Ae(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":window.matchMedia("(prefers-color-scheme: light)").matches?"light":"no-preference"}function Pe(s){c.useEffect(()=>{const t=Ae(),a=t==="dark"?document.getElementById("favicon-16-dark"):document.getElementById("favicon-16"),n=t==="dark"?document.getElementById("favicon-32-dark"):document.getElementById("favicon-32");if(s){const r=`/${s.toLowerCase()}.svg`;a?.setAttribute("href",r),n?.setAttribute("href",r)}return()=>{t==="dark"?(a?.setAttribute("href","/favicon-16x16-dark.png"),n?.setAttribute("href","/favicon-32x32-dark.png")):(a?.setAttribute("href","/favicon-16x16.png"),n?.setAttribute("href","/favicon-32x32.png"))}},[s])}const ke=({id:s,tab:t,onTabChange:a})=>{const[n,r]=c.useState(!1),{data:l}=E({...Z(s),refetchInterval:n}),{deleteTaskRun:o}=R(),{navigate:i}=G();Te(l?.name?`Task Run: ${l.name}`:"Task Run"),Pe(l?.state_type),c.useEffect(()=>{l.state_type==="RUNNING"||l.state_type==="PENDING"?r(5e3):r(!1)},[l]);const d=()=>{o({id:l.id},{onSuccess:()=>{r(!1),g.success("Task run deleted"),l.flow_run_id?i({to:"/runs/flow-run/$id",params:{id:l.flow_run_id},replace:!0}):i({to:"/runs",replace:!0})},onError:f=>{const u=f.message||"Unknown error while deleting task run.";g.error(u)}})};return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(Be,{taskRun:l,onDeleteRunClicked:d})}),e.jsxs("div",{className:"grid lg:grid-cols-[1fr_250px] grid-cols-[1fr] gap-4",children:[e.jsx(Me,{currentTab:t,onTabChange:a,logsContent:e.jsx(c.Suspense,{fallback:e.jsx(Oe,{}),children:e.jsx(Le,{taskRun:l})}),artifactsContent:e.jsx(c.Suspense,{fallback:e.jsx(Fe,{}),children:e.jsx(De,{taskRun:l})}),taskInputsContent:e.jsx(Ge,{taskRun:l}),detailsContent:e.jsx(L,{taskRun:l})}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(L,{taskRun:l})})]})]})},Be=({taskRun:s,onDeleteRunClicked:t})=>{const[a,n]=Ce(),{open:r,onOpenChange:l,openDialog:o}=ve(),{setTaskRunState:i,isPending:d}=ee(),f=s.state_type&&["COMPLETED","FAILED","CANCELLED","CRASHED"].includes(s.state_type),u=m=>{i({id:s.id,state:{type:m.type,name:m.type.charAt(0)+m.type.slice(1).toLowerCase(),message:m.message},force:!0},{onSuccess:()=>{g.success("Task run state changed"),l(!1)},onError:h=>{g.error(h.message||"Failed to change state")}})};return e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsx(se,{children:e.jsxs(ae,{children:[e.jsx(v,{children:e.jsx(T,{to:"/runs",search:{tab:"task-runs"},className:"text-xl font-semibold",children:"Runs"})}),e.jsx(S,{}),s.flow_run_id&&e.jsxs(e.Fragment,{children:[e.jsx(v,{children:e.jsx(T,{to:"/runs/flow-run/$id",params:{id:s.flow_run_id},className:"text-xl font-semibold",children:s.flow_run_name})}),e.jsx(S,{})]}),e.jsxs(v,{className:"text-xl",children:[e.jsx(te,{className:"font-semibold",children:s.name}),s.state&&e.jsx(le,{type:s.state.type,name:s.state.name,className:"ml-2"})]})]})}),e.jsxs(re,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(ie,{variant:"outline",className:"p-2",children:e.jsx(ce,{className:"w-4 h-4"})})}),e.jsxs(oe,{children:[f&&e.jsx(y,{onClick:o,children:"Change state"}),e.jsx(y,{onClick:()=>{g.success("Copied task run ID to clipboard"),navigator.clipboard.writeText(s.id)},children:"Copy ID"}),e.jsx(y,{onClick:()=>n({title:"Delete Task Run",description:`Are you sure you want to delete task run ${s.name}?`,onConfirm:t}),children:"Delete"})]})]}),e.jsx(_e,{...a}),e.jsx(ye,{open:r,onOpenChange:l,currentState:s.state?{type:s.state.type,name:s.state.name??s.state.type.charAt(0)+s.state.type.slice(1).toLowerCase()}:null,label:"Task Run",onConfirm:u,isLoading:d})]})},Me=({currentTab:s,onTabChange:t,logsContent:a,artifactsContent:n,taskInputsContent:r,detailsContent:l})=>(c.useEffect(()=>{const o=getComputedStyle(document.documentElement).getPropertyValue("--breakpoint-lg").trim(),i=window.matchMedia(`(max-width: ${o})`),d=()=>{s==="Details"&&t("Logs")};return i.addEventListener("change",d),()=>i.removeEventListener("change",d)},[s,t]),e.jsxs(de,{value:s,onValueChange:o=>t(o),children:[e.jsxs(xe,{children:[e.jsx(p,{value:"Details",className:"lg:hidden",children:"Details"}),e.jsx(p,{value:"Logs",children:"Logs"}),e.jsx(p,{value:"Artifacts",children:"Artifacts"}),e.jsxs(p,{value:"TaskInputs",children:["Task Inputs",e.jsxs(me,{children:[e.jsx(he,{asChild:!0,children:e.jsx(_,{id:"Info",className:"w-4 h-4"})}),e.jsx(fe,{children:"Task inputs show parameter keys and can also show task run relationships."})]})]})]}),e.jsx(j,{value:"Details",children:l}),e.jsx(j,{value:"Logs",children:a}),e.jsx(j,{value:"Artifacts",children:n}),e.jsx(j,{value:"TaskInputs",children:r})]})),Oe=()=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-row gap-2 justify-end",children:[e.jsx(x,{className:"h-8 w-25"}),e.jsx(x,{className:"h-8 w-32"})]}),e.jsx(x,{className:"h-32"})]}),Fe=()=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"flex flex-row justify-end",children:e.jsx(x,{className:"h-8 w-12"})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2 xl:grid-cols-3",children:[e.jsx(x,{className:"h-40"}),e.jsx(x,{className:"h-40"}),e.jsx(x,{className:"h-40"}),e.jsx(x,{className:"h-40"})]})]}),Ge=({taskRun:s})=>e.jsx(ue,{value:JSON.stringify(s.task_inputs,null,2),disabled:!0,copy:!0});Se({tab:we(["Logs","Artifacts","TaskInputs","Details"]).default("Logs").catch("Logs")});function ss(){const{id:s}=w.useParams(),{tab:t}=w.useSearch(),a=V(),n=r=>{a({to:".",search:l=>({...l,tab:r})})};return e.jsx(ke,{id:s,tab:t,onTabChange:n})}export{ss as component};
//# sourceMappingURL=task-run._id-Dq1lGjMW.js.map
