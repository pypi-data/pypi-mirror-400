<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <template
        id="portal_ticket_list"
        inherit_id="helpdesk_mgmt.portal_ticket_list"
        name="Ticket List"
    >
        <xpath expr="//thead/tr" position="inside">
            <t
                t-set="has_timesheet_column"
                t-value="any((team.allow_timesheet and team.show_timesheet_portal) for team in tickets.team_id.sudo())"
            />
            <th t-if="has_timesheet_column">Spent Time</th>
        </xpath>
        <xpath expr="//tbody/t/tr" position="inside">
            <td class="text-right" t-if="has_timesheet_column">
                <span
                    t-field="ticket.total_hours"
                    t-options="{'widget': 'float_time'}"
                    t-if="ticket.team_id.sudo().allow_timesheet and ticket.team_id.sudo().show_timesheet_portal"
                />
            </td>
        </xpath>
    </template>

    <template
        id="portal_helpdesk_ticket_page"
        name="Ticket Portal Template"
        inherit_id="helpdesk_mgmt.portal_helpdesk_ticket_page"
    >
        <xpath expr="//div[@id='card_body']" position="inside">
            <div
                class="mb-4 mb-md-0"
                t-if="ticket.team_id.sudo().allow_timesheet and ticket.team_id.sudo().show_timesheet_portal and ticket.timesheet_ids"
            >
                <h5 class="mb-1">Timesheets</h5>
                <hr class="mt-1 mb-2" />
                <table class="table table-sm table-striped">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Description</th>
                            <th>Time Spent</th>
                            <th>Employee</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="ticket.timesheet_ids" t-as="timesheet">
                            <tr>
                                <td>
                                    <span
                                        t-field="timesheet.date"
                                        t-options='{"widget": "date"}'
                                    />
                                </td>
                                <td>
                                    <span t-field="timesheet.name" />
                                </td>
                                <td>
                                    <span
                                        t-field="timesheet.unit_amount"
                                        t-options="{'widget': 'float_time'}"
                                    />
                                </td>
                                <td>
                                    <span t-field="timesheet.employee_id" />
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </div>
        </xpath>
    </template>
</odoo>
