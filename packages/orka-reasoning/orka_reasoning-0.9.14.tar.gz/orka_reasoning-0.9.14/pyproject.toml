[build-system]
requires = ["setuptools>=61.0", "wheel"]
build-backend = "setuptools.build_meta"

[project]
name = "orka-reasoning"
version = "0.9.14"
description = "Modular agent orchestrator for reasoning pipelines"
authors = [
  { name = "Marco Somma", email = "marcosomma.work@gmail.com" }
]
readme = "README.md"
license = "Apache-2.0"
requires-python = ">=3.11"
classifiers = [
  "Programming Language :: Python :: 3",
  "Operating System :: OS Independent",
  "Development Status :: 4 - Beta",
  "Intended Audience :: Developers",
  "Topic :: Software Development :: Libraries :: Python Modules",
]

dependencies = [
  # Core Dependencies
  "redis[async,search]==4.5.5",
  "redis-om==0.3.5",
  "rmtest>=0.7.0",
  "pyyaml>=6.0.2",
  "python-dotenv>=0.19.0",
  "GPUtil>=1.4.0",
  "psutil>=7.0.0",
  # CLI runtime dependency required by litellm/uvicorn toolchain
  "click>=8.1.8,<9.0.0",
  
  # AI and LLM
  "openai>=1.0.0",
  "litellm>=1.0.0",
  "numpy>=2.3.1",
  "sentence_transformers>=5.0.0",
  
  # Search and APIs
  "ddgs>=3.0.0",
  
  # Web Framework
  "fastapi>=0.68.0",
  "uvicorn>=0.15.0",
  "pydantic>=1.8.0",
  "httpx>=0.24.0",
  "jinja2>=3.0.0",
  "async-timeout>=4.0.0",
  
  # JSON Parsing and Validation
  "json-repair>=0.25.0",
  "jsonschema>=4.20.0",
  
  # UI Components
  "rich>=13.0.0",
  "textual>=0.40.0"
]

[project.optional-dependencies]
# Development Tools
dev = [
  # Testing
  "pytest>=7.0.0",
  "pytest-asyncio>=0.21.0",
  "pytest-cov>=4.0.0",
  "coverage>=7.0.0",
  "fakeredis>=2.0.0",
  
  # Linting and Formatting
  "black>=24.2.0",
  "flake8>=7.0.0",
  "flake8-docstrings>=1.7.0",
  "flake8-bugbear>=24.1.0",
  "flake8-comprehensions>=3.14.0",
  "flake8-pytest-style>=1.7.0",
  "mypy>=1.17.0",  # Type checking with daemon support
  "types-redis>=4.2.0",  # Type stubs for redis
  "types-PyYAML>=6.0.12",
  "types-requests>=2.32.0",
  "types-psutil>=7.0.0",
  
  # Documentation
  "sphinx>=7.0.0",
  "sphinx-rtd-theme>=1.0.0"
]

# Additional optional dependencies
extra = [
  # Kept for backward compatibility, now in core dependencies
]

# Production Dependencies
prod = [
  "gunicorn>=21.0.0",
  "supervisor>=4.2.0"
]

# ML and vector embeddings for semantic search
ml = [
  "sentence-transformers>=2.2.0",
  "numpy>=1.21.0"
]

# All Dependencies (for development with all features)
all = [
  "orka-reasoning[dev,schema,prod,ml]"
]

[project.urls]
Homepage = "https://orkacore.com"
Documentation = "https://docs.orkacore.com"
Repository = "https://github.com/marcosomma/orka-reasoning"

[project.scripts]
orka = "orka.orka_cli:cli_main"
orka-start = "orka.orka_start:cli_main"

[project.entry-points."orka.agents"]
openai-answer = "orka.agents.llm_agents:OpenAIAnswerBuilder"
rag-agent = "orka.agents.rag_agent:RAGAgent"
local-llm = "orka.agents.local_llm_agents:LocalLLMAgent"
binary = "orka.agents.agents:BinaryAgent"
classification = "orka.agents.agents:ClassificationAgent"
validate-and-structure = "orka.agents.validation_and_structuring_agent:ValidationAndStructuringAgent"

[project.entry-points."orka.nodes"]
memory-writer = "orka.nodes.memory_writer_node:MemoryWriterNode"
memory-reader = "orka.nodes.memory_reader_node:MemoryReaderNode"
rag-node = "orka.nodes.rag_node:RAGNode"
fork-node = "orka.nodes.fork_node:ForkNode"
join-node = "orka.nodes.join_node:JoinNode"
failover-node = "orka.nodes.failover_node:FailoverNode"
router-node = "orka.nodes.router_node:RouterNode"
streaming-executor = "orka.nodes.executor_node:StreamingExecutorNode"
satellite-state-writer = "orka.nodes.satellite_state_writer:SatelliteStateWriter"

[tool.setuptools]
package-dir = {"" = "."}

[tool.setuptools.packages.find]
where = ["."]
exclude = ["tests*"]

[tool.setuptools.package-data]
orka = [
    "docker/*",
    "docker/*.sh",
    "docker/*.bat",
    "docker/*.yml",
    "docker/*.md",
    "docker/Dockerfile*",
    "tui/*.tcss"
]

[tool.pytest.ini_options]
addopts = "--cov=orka --cov-report=term-missing --cov-report=xml --cov-fail-under=80.0"
testpaths = ["tests/unit", "tests/integration"]
asyncio_mode = "strict"
asyncio_default_fixture_loop_scope = "function"
python_files = "test_*.py"
python_functions = "test_*"
pythonpath = ["."]
markers = [
    "unit: Unit tests with mocked external services",
    "integration: Integration tests with real services (local only)",
    "slow: marks tests as slow (deselect with '-m \"not slow\"')",
    "performance: marks tests as performance tests",
    "redis: marks tests that require Redis",
    "llm: marks tests that require LLM APIs",
    "asyncio: marks tests as async",
]
filterwarnings = [
    "ignore::DeprecationWarning:litellm.*",
    "ignore::pydantic.warnings.PydanticDeprecatedSince20",
    "ignore:.*class-based.*config.*deprecated.*",
    "ignore::RuntimeWarning:unittest.mock",
    "ignore::DeprecationWarning:datetime",
]

[tool.coverage.run]
source = ["orka"]
branch = true
parallel = true
omit = [
    "*/site-packages/*",
    "*/tests/*",
    "setup.py",
    "orka/start_redis_only.py",
    "orka/orka_start.py",
    "orka/docker/*",
    "orka/tui/*",
    "orka/startup/*",
  "scripts/*",
]

[tool.coverage.report]
precision = 2
show_missing = true
skip_covered = false
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "raise NotImplementedError",
    "if __name__ == .__main__.:",
    "pass",
    "raise ImportError",
    "except ImportError:",
    "if TYPE_CHECKING:",
    "if typing.TYPE_CHECKING:",
    "@abstractmethod",
    "return NotImplemented",
]
fail_under = 70

[tool.black]
line-length = 120
target-version = ["py311"]
include = '\.pyi?$'
extend-exclude = '''
# A regex preceded with ^/ will apply only to files and directories
# in the root of the project.
^/docs/
'''

[tool.pyright]
typeCheckingMode = "off"

[tool.flake8]
max-line-length = 120
extend-ignore = ["E203", "W503"]
exclude = [
    ".git",
    "__pycache__",
    "build",
    "dist",
    "*.egg-info",
    "venv",
    ".env",
    ".venv",
    "docs",
]
per-file-ignores = [
    "__init__.py:F401",
    "test_*.py:D100,D101,D102,D103"
]
docstring-convention = "google"
max-complexity = 10
