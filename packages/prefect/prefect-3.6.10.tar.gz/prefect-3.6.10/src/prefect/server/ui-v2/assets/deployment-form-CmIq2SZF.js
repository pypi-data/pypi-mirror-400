const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/markdown-input-BXizWLFV.js","assets/vendor-tanstack-BVzzyDEt.js","assets/vendor-react-Bce9NwRC.js","assets/vendor-codemirror-BQuppSRL.js","assets/index-BJkJ93Lr.js","assets/vendor-radix-CTAic6HB.js","assets/vendor-recharts-Mwm2qLZp.js","assets/vendor-forms-BN3tpxM2.js","assets/vendor-date-2jFo9aCm.js","assets/index-t3SW0WbL.css"])))=>i.map(i=>d[i]);
import{j as e,r as c,s as M,G as X,L as Y}from"./vendor-tanstack-BVzzyDEt.js";import{dP as Z,V as G,X as q,Y as J,Z as z,$ as R,_ as $,a0 as B,a1 as V,b3 as H,cb as K,N as ee,S as re,d as ae,e as se,f as oe,g as ne,h as Q,ad as le,dQ as te,cM as ce,w as C,aj as ie,ap as m,a3 as f,ak as d,al as u,am as p,an as h,ao as me,as as de,A as ue,L as pe,q as W}from"./index-BJkJ93Lr.js";import{u as he,L as je}from"./lazy-schema-form-Clp5QfAW.js";import"./primitives-BxgEGUr4.js";import"./toggle-group-B18EYoB-.js";import{W as xe}from"./deployment-action-header-f2FkVo9D.js";import{d as _e,b as A,c as y,r as be,g as ye,e as ge,h as ve,N as Se,f as Ce}from"./vendor-forms-BN3tpxM2.js";const fe=({presetOptions:s=[],selected:o,onSelect:a})=>e.jsx(c.Suspense,{children:e.jsx(Ee,{presetOptions:s,selected:o,onSelect:a})}),Ee=({presetOptions:s=[],selected:o,onSelect:a})=>{const[t,n]=c.useState(""),{data:i}=M(Z()),l=c.useDeferredValue(t),j=c.useMemo(()=>i.filter(r=>r.name.toLowerCase().includes(l.toLowerCase())),[i,l]),x=c.useMemo(()=>s.filter(r=>r.label.toLowerCase().includes(l.toLowerCase())),[l,s]);return e.jsxs(G,{children:[e.jsx(q,{selected:!!o,"aria-label":"Select a global concurrency limit",children:i.find(r=>r.id===o)?.name}),e.jsxs(J,{children:[e.jsx(z,{value:t,onValueChange:n,placeholder:"Search for a global concurrency limit..."}),e.jsx(R,{children:"No global concurrency limit found"}),e.jsx($,{children:e.jsxs(B,{children:[x.map(r=>e.jsx(V,{selected:o===r.value,onSelect:()=>{a(r.value),n("")},value:String(r.label),children:r.label},r.label)),j.map(r=>e.jsx(V,{selected:o===r.name,onSelect:N=>{a(N),n("")},value:r.id,children:r.name},r.id))]})})]})]})},Ne=c.lazy(()=>K(()=>import("./markdown-input-BXizWLFV.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])).then(s=>({default:s.MarkdownInput})));function we({className:s,...o}){return e.jsx(c.Suspense,{fallback:e.jsx(H,{className:`min-h-[200px] ${s??""}`}),children:e.jsx(Ne,{className:s,...o})})}const ke=({presetOptions:s=[],selected:o,onSelect:a})=>e.jsx(c.Suspense,{children:e.jsx(Le,{presetOptions:s,selected:o,onSelect:a})}),Le=({presetOptions:s=[],selected:o,onSelect:a})=>{const[t,n]=c.useState(""),{data:i}=M(ee()),l=c.useDeferredValue(t),j=c.useMemo(()=>i.filter(r=>r.name.toLowerCase().includes(l.toLowerCase())),[i,l]),x=c.useMemo(()=>s.filter(r=>r.label.toLowerCase().includes(l.toLowerCase())),[l,s]);return e.jsxs(G,{children:[e.jsx(q,{selected:!!o,"aria-label":"Select a work pool",children:o}),e.jsxs(J,{children:[e.jsx(z,{value:t,onValueChange:n,placeholder:"Search for a work pool..."}),e.jsx(R,{children:"No work pool found"}),e.jsx($,{children:e.jsxs(B,{children:[x.map(r=>e.jsx(V,{selected:o===r.value,onSelect:()=>{a(r.value),n("")},value:String(r.label),children:r.label},r.label)),j.map(r=>e.jsx(V,{selected:o===r.name,onSelect:N=>{a(N),n("")},value:r.name,children:r.name},r.id))]})})]})]})},E={ENQUEUE:"ENQUEUE",CANCEL_NEW:"CANCEL_NEW"},Fe=({onValueChange:s,value:o})=>e.jsxs(re,{value:o,onValueChange:a=>{s(a===""?void 0:a)},children:[e.jsx(ae,{children:e.jsx(se,{placeholder:E.ENQUEUE})}),e.jsx(oe,{children:e.jsxs(ne,{children:[e.jsx(Q,{value:E.ENQUEUE,children:E.ENQUEUE}),e.jsx(Q,{value:E.CANCEL_NEW,children:E.CANCEL_NEW})]})})]}),Ie=(s,{mode:o})=>A({name:y().refine(a=>o==="edit"?!0:a!==s.name,{message:"Name must be different from the original deployment"}),description:y().nullable().optional(),work_pool_name:y().nullable().optional(),work_queue_name:y().nullable().optional(),tags:ge(y()).optional(),concurrency_options:A({collision_strategy:Ce(["ENQUEUE","CANCEL_NEW"]).optional()}).nullable().optional(),job_variables:y().superRefine((a,t)=>{try{return a?JSON.parse(a):void 0}catch(n){return console.error(n),t.addIssue({code:"custom",message:"Invalid JSON"}),Se}}),enforce_parameter_schema:ye(),parameter_openapi_schema:be(ve()).optional().nullable().readonly(),global_concurrency_limit_id:y().uuid().optional().nullable()}),Ve={name:"",description:"",tags:[],job_variables:"",enforce_parameter_schema:!0,global_concurrency_limit_id:null},Oe=(s,{mode:o})=>{const a=X(),t=_e({resolver:le(Ie(s,{mode:o})),defaultValues:Ve}),{values:n,setValues:i,errors:l,validateForm:j}=he(),{createDeployment:x}=te(),{updateDeployment:r}=ce();return c.useEffect(()=>{const{name:O,description:U,work_pool_name:w,work_queue_name:k,tags:L,concurrency_options:F,parameter_openapi_schema:I,enforce_parameter_schema:g,job_variables:v,global_concurrency_limit:S}=s;i(s.parameters),t.reset({description:U,name:O,work_pool_name:w,work_queue_name:k,tags:L,concurrency_options:F,parameter_openapi_schema:I,enforce_parameter_schema:g,job_variables:v?JSON.stringify(v):"",global_concurrency_limit_id:S?.id})},[t,s,i]),{form:t,onSave:async O=>{const{name:U,job_variables:w,description:k,work_pool_name:L,work_queue_name:F,tags:I,enforce_parameter_schema:g,concurrency_options:v,parameter_openapi_schema:S,global_concurrency_limit_id:T}=O,D=w?JSON.parse(w):void 0;if(S&&g)try{await j({schema:S})}catch(b){const _="Unknown error while updating validating schema.";C.error(_),console.error(_,b)}if(l.length>0)return;const P=v?.collision_strategy?{collision_strategy:v.collision_strategy}:void 0;switch(o){case"duplicate":x({concurrency_options:P,description:k,enforce_parameter_schema:g,flow_id:s.flow_id,job_variables:D,name:U,parameters:n,parameter_openapi_schema:S||void 0,paused:s.paused,tags:I,work_pool_name:L||null,work_queue_name:F||null,global_concurrency_limit_id:T},{onSuccess:({id:b})=>{C.success("Deployment created"),a({to:"/deployments/deployment/$id",params:{id:b}})},onError:b=>{const _=b.message||"Unknown error while creating deployment.";console.error(_),C.error(_)}});break;case"edit":r({concurrency_options:P,description:k,enforce_parameter_schema:g,id:s.id,job_variables:D,parameters:n,paused:s.paused,tags:I,work_pool_name:L||null,work_queue_name:F||null,global_concurrency_limit_id:T},{onSuccess:()=>{C.success("Deployment updated"),a({to:"/deployments/deployment/$id",params:{id:s.id}})},onError:b=>{const _=b.message||"Unknown error while updating deployment.";console.error(_),C.error(_)}});break}},parametersFormValues:n,setParametersFormValues:i,parameterFormErrors:l}},Me=({deployment:s,mode:o})=>{const{form:a,onSave:t,parameterFormErrors:n,setParametersFormValues:i,parametersFormValues:l}=Oe(s,{mode:o}),j=a.watch("work_pool_name"),x=a.getValues("parameter_openapi_schema");return e.jsx(ie,{...a,children:e.jsxs("form",{onSubmit:r=>{a.handleSubmit(t)(r)},className:"space-y-4",children:[e.jsx(m,{children:a.formState.errors.root?.message}),e.jsx(f,{variant:"h3",children:"General"}),e.jsx(d,{control:a.control,name:"name",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Name"}),e.jsx(h,{children:e.jsx(me,{...r,value:r.value,disabled:o==="edit"})}),e.jsx(m,{})]})}),e.jsx(d,{control:a.control,name:"description",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Description (Optional)"}),e.jsx(h,{children:e.jsx(we,{"aria-label":"deployment description input",value:r.value??"",onChange:r.onChange})}),e.jsx(m,{})]})}),e.jsx(d,{control:a.control,name:"work_pool_name",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Work Pool (Optional)"}),e.jsx(h,{children:e.jsx(ke,{presetOptions:[{label:"None",value:""}],onSelect:r.onChange,selected:r.value})}),e.jsx(m,{})]})}),j&&e.jsx(d,{control:a.control,name:"work_queue_name",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Work Queue (Optional)"}),e.jsx(h,{children:e.jsx(xe,{workPoolName:j,presetOptions:[{label:"None",value:""}],onSelect:r.onChange,selected:r.value})}),e.jsx(m,{})]})}),e.jsx(d,{control:a.control,name:"tags",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Tags (Optional)"}),e.jsx(h,{children:e.jsx(de,{...r})}),e.jsx(m,{})]})}),e.jsx(d,{control:a.control,name:"concurrency_options.collision_strategy",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:e.jsxs("div",{className:"col gap-1 mb-0.5",children:[e.jsx(f,{variant:"bodySmall",children:"Concurrency Limit Collision Strategy (Optional)"}),e.jsx(f,{variant:"bodySmall",className:"text-muted-foreground",children:"Configure behavior for runs once the concurrency limit is reached."})]})}),e.jsx(h,{children:e.jsx(Fe,{value:r.value,onValueChange:r.onChange})}),e.jsx(m,{})]})}),e.jsx(d,{control:a.control,name:"global_concurrency_limit_id",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Global concurrency limit"}),e.jsx(h,{children:e.jsx(fe,{presetOptions:[{label:"None",value:null}],onSelect:r.onChange,selected:r.value})}),e.jsx(m,{})]})}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx(f,{variant:"h3",className:"mb-4",children:"Parameters"}),x&&e.jsx(je,{schema:x,errors:n,values:l,onValuesChange:i,kinds:["json"]}),e.jsx(d,{control:a.control,name:"enforce_parameter_schema",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Enforce Parameter Schema"}),e.jsx(h,{children:e.jsx(ue,{className:"block",checked:r.value,onCheckedChange:r.onChange})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx(f,{variant:"h3",className:"mb-4",children:"Job Variables"}),e.jsx(d,{control:a.control,name:"job_variables",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Job Variables (Optional)"}),e.jsx(h,{children:e.jsx(pe,{...r})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(Y,{to:"/deployments/deployment/$id",params:{id:s.id},children:e.jsx(W,{variant:"secondary",children:"Cancel"})}),e.jsx(W,{type:"submit",children:"Save"})]})]})})};export{Me as D};
//# sourceMappingURL=deployment-form-CmIq2SZF.js.map
