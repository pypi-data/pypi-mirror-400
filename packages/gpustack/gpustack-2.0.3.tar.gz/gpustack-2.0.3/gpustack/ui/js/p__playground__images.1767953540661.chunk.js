"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3560],{92002:function(e,t,n){n.d(t,{Yo:function(){return a},gn:function(){return i}});var r=n(15292),a=(0,r.cn)(new Map),i=function(e,t){var n=(0,r.K7)(),i=n.get(a);i.set(e,t),n.set(a,i)}},73963:function(e,t,n){var r=n(26068),a=n.n(r),i=n(27722),s=n(25466),o=n(75271),l=n(52676),c=function(e){var t=e.message,n=e.type,r=e.rows,o=void 0===r?1:r,c=e.ellipsis,u=e.style;return(0,l.jsx)(l.Fragment,{children:t?(0,l.jsxs)(s.Z.Paragraph,{type:n,ellipsis:void 0!==c?c:{rows:o,tooltip:t},style:a()({fontWeight:400,whiteSpace:"pre-line",textAlign:"center",padding:"2px 5px",borderRadius:"var(--border-radius-base)",margin:0,backgroundColor:"var(--ant-color-error-bg)"},u),children:[(0,l.jsx)(i.Z,{className:"m-r-8"}),t]}):null})};t.Z=o.memo(c)},96096:function(e,t){t.Z={"/playground/text-to-image":"/playground/text-to-image","/playground/speech":"/playground/speech"}},87879:function(e,t,n){n.r(t),n.d(t,{default:function(){return _e}});var r=n(90228),a=n.n(r),i=n(87999),s=n.n(i),o=n(48305),l=n.n(o),c=n(91962),u=n(71920),d=n(4144),f=n(37952),m=n(67996),h=n(55936),p=n(30735),g=n(53231),v=n(25383),x=n(43458),y=n(48872),w=n(81967),k=n(82187),C=n.n(k),b=n(32699),j=n.n(b),M=n(75271),R=n(7388),S=n(94213),Z=n(13507),I=n(26068),U=n.n(I),P=n(92002),N=n(73963),z=n(92829),L=n(96096),O=n(62988),_=n(48075),T=n(32791),E=n(22069),Y=n(25408),A=n(79635),D=(n(82093),n(45629)),F=n(15558),W=n.n(F),H=n(2825),K=n(41994);function B(e){(0,g.useIntl)();var t=e.scroller,n=e.paramsRef,r=(e.chunkFields,e.API),i=(0,M.useState)(!1),o=l()(i,2),c=o[0],u=o[1],d=(0,M.useState)(null),f=l()(d,2),m=f[0],h=f[1],p=(0,M.useState)([]),v=l()(p,2),x=v[0],y=v[1],w=(0,M.useState)(""),k=l()(w,2),C=k[0],b=k[1],R=(0,M.useRef)(0),S=(0,M.useRef)(null),I=(0,H.Z)().initialize,P=(0,H.Z)().initialize,N=((0,M.useRef)(null),(0,M.useRef)(0));(0,M.useEffect)((function(){t.current&&I(t.current)}),[I]),(0,M.useEffect)((function(){n.current&&P(n.current)}),[P]);var z=function(){return N.current=N.current+1,N.current},L=function(e){var t={span:12};return 1===e.n&&(t.span=24),2===e.n&&(t.span=12),3===e.n&&(t.span=12),4===e.n&&(t.span=12),t},O=function(){return R.current=R.current+1,R.current},_=j().debounce((function(){y([]),u(!1)}),200),T=function(){var e=s()(a()().mark((function e(t){var n,i,s,o,l,c,d,f,m,p,g;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.model){e.next=3;break}return e.abrupt("return");case 3:if(null===(n=S.current)||void 0===n||null===(i=n.abort)||void 0===i||i.call(n,"cancel"),S.current=new AbortController,l=z(),c=L(t),u(!0),O(),h(null),d=j().split(t.size,"x").map((function(e){return j().toNumber(e)})),f=Array(t.n).fill({}).map((function(e,t){return U()(U()({dataUrl:"data:image/png;base64,"},c),{},{progress:0,height:d[1],width:d[0],loading:!0,progressType:"dashboard",preview:!1,uid:O()})})),y(f),m={},r!==Z.U$){e.next=18;break}return e.next=17,(0,Z.Bi)({data:t,signal:S.current.signal});case 17:m=e.sent;case 18:if(r!==Z.d9){e.next=22;break}return e.next=21,(0,Z.OE)({data:t,signal:S.current.signal});case 21:m=e.sent;case 22:if(!m.error){e.next=27;break}return h({error:!0,errorMessage:(0,K.Yo)(m)}),y([]),e.abrupt("return");case 27:if(N.current===l){e.next=29;break}return e.abrupt("return");case 29:if(null===(s=m)||void 0===s||!s.error){e.next=32;break}return h({error:!0,errorMessage:(0,K.Yo)(m)}),e.abrupt("return");case 32:null===(o=m)||void 0===o||null===(o=o.data)||void 0===o||o.forEach((function(e,t){var n=f[t];e.b64_json&&(n.dataUrl="data:image/png;base64,".concat(e.b64_json)),f[t]={dataUrl:n.dataUrl,height:d[1],width:d[0],maxHeight:"".concat(d[1],"px"),maxWidth:"".concat(d[0],"px"),uid:n.uid,span:n.span,loading:!1,preview:!0,progress:100}})),y(W()(f)),e.next=43;break;case 37:e.prev=37,e.t0=e.catch(0),z(),_(),null===(p=S.current)||void 0===p||null===(g=p.abort)||void 0===g||g.call(p,"cancel");case 43:return e.prev=43,u(!1),e.finish(43);case 46:case"end":return e.stop()}}),e,null,[[0,37,43,46]])})));return function(t){return e.apply(this,arguments)}}();return(0,M.useEffect)((function(){return function(){var e,t;null===(e=S.current)||void 0===e||null===(t=e.abort)||void 0===t||t.call(e,"cancel")}}),[]),{loading:c,tokenResult:m,imageList:x,promptList:K.ce,currentPrompt:C,setImageList:y,setTokenResult:h,setCurrentPrompt:b,handleStopConversation:function(){var e,t;null===(e=S.current)||void 0===e||null===(t=e.abort)||void 0===t||t.call(e,"stop")},generateNumber:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},handleClear:function(){y([]),h(null),b("")},submitMessage:T}}n(55734),n(60669);var V=n(51884),G=n(4806),$=n(46214),X=n(36224),J=n(52676),q=(0,M.forwardRef)((function(e,t){var n=e.modelList,r=(0,g.useIntl)(),i=(0,M.useState)(!1),o=l()(i,2),c=o[0],u=o[1],d=(0,M.useState)(!1),f=l()(d,2),m=f[0],h=f[1],p=(0,M.useRef)(null),v=(0,M.useRef)(null),x=(0,M.useRef)(null),y=(0,D.M)(e,{type:"create"}),w=y.handleOnValuesChange,k=y.handleToggleParamsStyle,b=y.setParams,R=y.form,S=y.formFields,I=y.paramsConfig,F=y.initialValues,W=y.parameters,H=y.isOpenaiCompatible,K=B({scroller:p,paramsRef:v,chunkFields:["stream_options","chunk_results"],API:Z.U$}),q=K.loading,Q=K.tokenResult,ee=K.imageList,te=K.promptList,ne=K.currentPrompt,re=K.setCurrentPrompt,ae=K.handleClear,ie=K.handleStopConversation,se=K.submitMessage;(0,M.useImperativeHandle)(t,(function(){return{viewCode:function(){u(!0)},setCollapse:function(){h(!m)},collapse:m}}));var oe=(0,M.useCallback)((function(){var e,t,n,r=(t=0,n=te.length-1,Math.floor(Math.random()*(n-t+1)+t)),a=te[r];null===(e=x.current)||void 0===e||e.handleInputChange({target:{value:a}})}),[]),le=(0,M.useMemo)((function(){return"custom"===W.size?U()(U()({},j().omit(W,["width","height","preview","random_seed"])),{},{size:W.width&&W.height?"".concat(W.width,"x").concat(W.height):""}):U()({},j().omit(W,["width","height","random_seed","preview"]))}),[W]),ce=(0,M.useMemo)((function(){return H?(0,V.jX)({api:Z.U$,parameters:U()(U()({},le),{},{prompt:ne})}):(0,V.oJ)({api:Z.U$,parameters:U()(U()({},le),{},{prompt:ne})})}),[le,H,ne]),ue=function(){var e=s()(a()().mark((function e(){var t,n,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(t=R.current)||void 0===t||null===(t=t.form)||void 0===t?void 0:t.validateFields();case 3:if(W.model){e.next=5;break}return e.abrupt("return");case 5:return r=U()(U()({},j().omitBy(le,(function(e){return!e}))),{},{seed:W.random_seed?(0,_.Hq)():W.seed||null,stream:!1,prompt:ne}),b(U()(U()({},W),{},{seed:r.seed})),null===(n=R.current)||void 0===n||null===(n=n.form)||void 0===n||n.setFieldValue("seed",r.seed),(0,P.gn)(L.Z["/playground/text-to-image"],!0),e.next=13,se(r);case 13:e.next=17;break;case 15:e.prev=15,e.t0=e.catch(0);case 17:return e.prev=17,(0,P.gn)(L.Z["/playground/text-to-image"],!1),e.finish(17);case 21:case"end":return e.stop()}}),e,null,[[0,15,17,21]])})));return function(){return e.apply(this,arguments)}}(),de=(0,M.useCallback)((function(){u(!1)}),[]);return(0,J.jsxs)("div",{className:"ground-left-wrapper",children:[(0,J.jsxs)("div",{className:"ground-left",children:[(0,J.jsx)("div",{className:"message-list-wrap",ref:p,style:{paddingBottom:16},children:(0,J.jsx)(J.Fragment,{children:(0,J.jsxs)("div",{className:"content",style:{height:"100%"},children:[(0,J.jsx)(O.Z,{style:{padding:0,height:"100%",justifyContent:"center",flexDirection:"column",flexWrap:"unset",alignItems:"center"},autoBgColor:!1,editable:!1,dataList:ee,responseable:!0,gutter:[8,16],autoSize:!0}),!ee.length&&(0,J.jsxs)("div",{className:"flex-column font-size-14 flex-center gap-20 justify-center hold-wrapper",children:[(0,J.jsx)("span",{children:(0,J.jsx)(T.Z,{className:"font-size-32 text-secondary"})}),(0,J.jsx)("span",{children:r.formatMessage({id:"playground.params.empty.tips"})})]})]})})}),Q&&(0,J.jsx)("div",{style:{height:40},children:(0,J.jsx)(N.Z,{type:"danger",message:null==Q?void 0:Q.errorMessage})}),(0,J.jsx)("div",{className:"ground-left-footer",children:(0,J.jsx)($.Z,{ref:x,placeholer:r.formatMessage({id:"playground.input.prompt.holder"}),actions:[],defaultSize:{minRows:5,maxRows:5},title:r.formatMessage({id:"playground.image.prompt"}),loading:q,disabled:!W.model,isEmpty:!ee.length,handleSubmit:ue,handleAbortFetch:ie,onInputChange:function(e){re(e.target.value)},shouldResetMessage:!1,clearAll:ae,tools:(0,J.jsx)(J.Fragment,{children:(0,J.jsx)(Y.Z,{title:r.formatMessage({id:"playground.image.prompt.random"}),children:(0,J.jsx)(A.ZP,{onClick:oe,size:"middle",type:"text",icon:(0,J.jsx)(z.Z,{type:"icon-random"})})})})})})]}),(0,J.jsx)("div",{className:C()("params-wrapper",{collapsed:m}),ref:v,children:(0,J.jsx)("div",{className:"box",children:(0,J.jsx)(G.Z,{ref:R,formFields:S,parametersTitle:(0,J.jsxs)("div",{className:"flex-between flex-center",children:[(0,J.jsx)("span",{children:r.formatMessage({id:"playground.parameters"})}),(0,J.jsx)(Y.Z,{title:r.formatMessage({id:"playground.image.params.custom.tips"}),children:(0,J.jsx)(A.ZP,{size:"small",type:"text",icon:(0,J.jsx)(E.Z,{}),onClick:k,children:H?r.formatMessage({id:"playground.image.params.custom"}):r.formatMessage({id:"playground.image.params.openai"})})})]}),onValuesChange:w,paramsConfig:I,initialValues:F,modelList:n})})}),(0,J.jsx)(X.Z,{open:c,viewCodeContent:ce,onCancel:de,title:r.formatMessage({id:"playground.viewcode"})})]})})),Q=q,ee=n(91691),te=n(53649),ne=n.n(te),re=n(3246),ae=n(71656),ie=n.n(ae),se=n(67585),oe="rgba(0, 0, 255, 0.3)";function le(e){var t=e.overlayCanvasRef,n=e.canvasRef,r=e.offscreenCanvasRef,a=e.cursorRef,i=e.lineWidth,s=e.translatePos,o=e.autoScale,c=e.baseScale,u=e.isLoadingMaskRef,d=(0,M.useState)(1),f=l()(d,2),m=f[0],h=f[1],p=function(e){var a,i,l=e.deltaY>0?-.1:.1,c=t.current.getBoundingClientRect(),u=e.clientX-c.left,d=e.clientY-c.top;a=o.current,i="scale(".concat(a,")"),t.current.style.transform=i,n.current.style.transform=i,r.current.style.transform=i,function(e){if(!(o.current<=.2||o.current>=8)){var a=t.current.getBoundingClientRect(),i=e.clientX-a.left,s=e.clientY-a.top,l=i/a.width,c=s/a.height;t.current.style.transformOrigin="".concat(100*l,"% ").concat(100*c,"%"),n.current.style.transformOrigin="".concat(100*l,"% ").concat(100*c,"%"),r.current.style.transformOrigin="".concat(100*l,"% ").concat(100*c,"%")}}(e),function(e,t,n){var r=j().round(o.current+e,2);if(!(r<.2||r>8)){var a=o.current,i=s.current,l=(t-i.x)/a,c=(n-i.y)/a;o.current=r;var u=t-l*r,d=n-c*r;s.current={x:u,y:d}}}(l,u,d)},g=function(e){var t;u.current||(p(e),a.current.style.width="".concat(i*o.current,"px"),a.current.style.height="".concat(i*o.current,"px"),t=e,a.current.style.top="".concat(t.clientY-i/2*o.current,"px"),a.current.style.left="".concat(t.clientX-i/2*o.current,"px"),h(o.current))};j().throttle((function(e){g(e)}),16);return{handleOnWheel:g,setActiveScale:h,activeScale:m,autoScale:o,baseScale:c}}var ce,ue=n(65459),de=n(80415),fe=n(2593),me=n(94752),he=n(33453),pe=n(86422),ge=n(35498),ve=n(72567),xe=function(e){var t=e.disabled,n=e.loading,r=e.lineWidth,a=e.invertMask,i=e.accept,s=e.handleBrushSizeChange,o=e.undo,l=e.onClear,c=e.handleFitView,d=e.handleUpdateImageList,f=e.handleUpdateMaskList,m=(0,g.useIntl)();return(0,J.jsxs)("div",{className:"tools",children:[(0,J.jsx)(Y.Z,{placement:"bottomLeft",arrow:!1,styles:{body:{background:"var(--color-white-1)",display:"flex",alignItems:"center",justifyContent:"flex-start",width:160}},title:(0,J.jsxs)("div",{className:"flex-column",style:{width:"100%"},children:[(0,J.jsx)("span",{className:"text-secondary",children:m.formatMessage({id:"playground.image.brushSize"})}),(0,J.jsx)(ge.Z,{disabled:t,style:{marginBlock:"4px 6px",marginLeft:0,flex:1},vertical:!1,defaultValue:r,min:10,max:100,onChange:s})]}),children:(0,J.jsx)(A.ZP,{size:"middle",type:"text",children:(0,J.jsx)(de.Z,{className:"font-size-14"})})}),(0,J.jsx)(Y.Z,{title:(0,J.jsxs)("span",{children:["[",u.d4.UNDO.textKeybinding,"]",(0,J.jsx)("span",{className:"m-l-5",children:m.formatMessage({id:"common.button.undo"})})]}),children:(0,J.jsx)(A.ZP,{onClick:o,size:"middle",type:"text",disabled:t,children:(0,J.jsx)(fe.Z,{className:"font-size-14"})})}),(0,J.jsx)(Y.Z,{title:m.formatMessage({id:"common.button.clear"}),children:(0,J.jsx)(A.ZP,{onClick:l,size:"middle",type:"text",disabled:t,children:(0,J.jsx)(me.Z,{className:"font-size-14"})})}),(0,J.jsx)(ue.Z,{disabled:n||a,handleUpdateImgList:d,size:"middle",accept:i}),(0,J.jsx)(ue.Z,{title:m.formatMessage({id:"playground.image.mask.upload"}),icon:(0,J.jsx)(z.Z,{type:"icon-mosaic-2"}),disabled:n||a,handleUpdateImgList:f,size:"middle",accept:i}),(0,J.jsx)(Y.Z,{title:m.formatMessage({id:"playground.image.fitview"}),children:(0,J.jsx)(A.ZP,{onClick:c,size:"middle",type:"text",disabled:n,children:(0,J.jsx)(he.Z,{className:"font-size-14"})})})]})},ye=function(e){var t=(0,g.useIntl)(),n=e.disabled,r=e.isOriginal,a=e.invertMask,i=e.handleOnChangeMask,s=e.downloadMask,o=e.download;return(0,J.jsxs)("div",{className:"tools",children:[r&&(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(Y.Z,{title:(0,J.jsx)("span",{style:{whiteSpace:"pre-wrap"},children:t.formatMessage({id:"playground.image.negativeMask.tips"})}),children:(0,J.jsx)(ve.Z,{onChange:i,className:"flex-center",checked:a,disabled:n,children:(0,J.jsx)("span",{className:"font-size-12",children:t.formatMessage({id:"playground.image.negativeMask"})})})}),(0,J.jsx)(Y.Z,{title:t.formatMessage({id:"playground.image.saveMask"}),children:(0,J.jsx)(A.ZP,{onClick:s,size:"middle",type:"text",children:(0,J.jsx)(z.Z,{className:"font-size-14",type:"icon-save1"})})})]}),!r&&(0,J.jsx)(Y.Z,{title:t.formatMessage({id:"playground.image.download"}),children:(0,J.jsx)(A.ZP,{onClick:o,size:"middle",type:"text",children:(0,J.jsx)(pe.Z,{className:"font-size-14"})})})]})},we=se.ZP.div(ce||(ce=ne()(["\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  width: ",";\n  z-index: 100;\n"])),(function(e){return"".concat(e.width,"px")||0})),ke=function(e){var t=e.width,n=e.height;return(0,J.jsx)(we,{width:t,height:n,children:(0,J.jsx)(re.Z,{spinning:!0})})},Ce=(0,M.forwardRef)((function(e,t){var r=e.loading,i=e.imageSrc,o=e.disabled,c=e.imageStatus,u=e.maskUpload,d=e.accept,f=e.onSave,m=e.onScaleImageSize,h=e.handleUpdateImageList,p=e.handleUpdateMaskList,g=(0,M.useRef)(null),v=(0,M.useRef)(null),x=(0,M.useRef)(null),y=(0,M.useState)(60),w=l()(y,2),k=w[0],b=w[1],R=(0,M.useRef)({x:0,y:0}),S=(0,M.useRef)(!1),Z=(0,M.useState)(!1),I=l()(Z,2),U=I[0],P=I[1],N=(0,M.useRef)(null),z=(0,M.useState)({width:0,height:0,loading:!1}),L=l()(z,2),O=L[0],_=(L[1],function(e){var t=e.isDisabled,n=e.invertMask,r=e.maskUpload,a=e.lineWidth,i=e.translatePos,s=e.onSave,o=(0,M.useRef)(!1),l=(0,M.useRef)(null),c=(0,M.useRef)(null),u=(0,M.useRef)(null),d=(0,M.useRef)([]),f=(0,M.useRef)([]),m=(0,M.useRef)(!1),h=(0,M.useRef)(null),p=(0,M.useRef)(1),g=(0,M.useRef)(1),v=(0,M.useRef)({x:0,y:0}),x=(0,M.useRef)([]),y=(0,M.useRef)(!1),w=(0,M.useMemo)((function(){return t||n||!(null==r||!r.length)}),[t,n,r]),k=(0,M.useCallback)((function(e){for(var t=0;t<e.length;t+=4)e[t+3]>0&&(e[t]=255,e[t+1]=255,e[t+2]=255,e[t+3]=255)}),[]),C=(0,M.useCallback)((function(){return l.current.toDataURL("image/png")}),[]),b=(0,M.useCallback)((function(){if(0===f.current.length&&0===x.current.length)return null;var e=c.current,t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d"),r=e.getContext("2d").getImageData(0,0,e.width,e.height),a=r.data;return k(a),n.putImageData(r,0,0),n.globalCompositeOperation="destination-over",n.fillStyle="black",n.fillRect(0,0,t.width,t.height),t.toDataURL("image/png")}),[]),R=function(){var e=b(),t=C();s({mask:e,img:t})},S=(0,M.useCallback)((function(){u.current||(u.current=document.createElement("canvas"))}),[]),Z=(0,M.useCallback)((function(){var e,t,n;S();var r=null===(e=l.current)||void 0===e?void 0:e.getContext("2d"),a=null===(t=c.current)||void 0===t?void 0:t.getContext("2d"),s=null===(n=u.current)||void 0===n?void 0:n.getContext("2d");if(r&&a){r.resetTransform(),a.resetTransform(),s.resetTransform();var o=p.current,d=i.current,f=d.x,m=d.y;r.setTransform(o,0,0,o,f,m),a.setTransform(o,0,0,o,f,m),s.setTransform(o,0,0,o,f,m)}}),[]),I=function(e,t){var n=p.current,r=i.current;return{x:(e-r.x)/n,y:(t-r.y)/n}},U=function(){return((arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)||a)/p.current},P=(0,M.useCallback)((function(e,t,n){var r=n.lineWidth,a=n.color,i=n.compositeOperation;e.lineWidth=U(r),e.lineCap="round",e.lineJoin="round",e.globalCompositeOperation=i;var s=I(t.x,t.y),o=s.x,l=s.y;e.lineTo(o,l),"source-over"===i&&(e.strokeStyle=a),e.stroke()}),[U]),N=(0,M.useCallback)((function(e,t,n){var r=n.color,a=n.compositeOperation;e.lineCap="round",e.lineJoin="round",e.globalCompositeOperation=a,e.save(),e.beginPath(),t.forEach((function(t,n){var r=I(t.x,t.y),a=r.x,i=r.y;e.lineWidth=U(t.lineWidth),0===n?e.moveTo(a,i):e.lineTo(a,i)})),"source-over"===a&&(e.strokeStyle=r),e.stroke(),e.restore()}),[U,I]),z=function(e){if(!w&&m.current&&o.current){var t=e.nativeEvent,n=t.offsetX,r=t.offsetY;d.current.push({x:n,y:r,lineWidth:a});var i=c.current.getContext("2d");i.save(),P(i,{x:n,y:r,lineWidth:a},{lineWidth:a,color:oe,compositeOperation:"destination-out"}),P(i,{x:n,y:r,lineWidth:a},{lineWidth:a,color:oe,compositeOperation:"source-over"}),i.restore()}},L=(0,M.useCallback)((function(){var e,t=c.current.getContext("2d"),n=null===(e=u.current)||void 0===e?void 0:e.getContext("2d");n.resetTransform(),t.resetTransform(),t.clearRect(0,0,c.current.width,c.current.height),n.clearRect(0,0,c.current.width,c.current.height)}),[]),O=(0,M.useCallback)((function(){var e,t=l.current,n=l.current.getContext("2d"),r=null===(e=u.current)||void 0===e?void 0:e.getContext("2d");n.resetTransform(),n.clearRect(0,0,t.width,t.height),r.resetTransform(),r.clearRect(0,0,t.width,t.height)}),[]),_=(0,M.useCallback)((function(){var e,t=l.current,n=c.current,r=u.current,s=t.getContext("2d"),o=n.getContext("2d"),d=null===(e=u.current)||void 0===e?void 0:e.getContext("2d");p.current=1,g.current=1,i.current={x:0,y:0},v.current={x:0,y:0},t.style.transform="scale(1)",n.style.transform="scale(1)",r.style.transform="scale(1)",h.current.style.width="".concat(a,"px"),h.current.style.height="".concat(a,"px"),s.resetTransform(),o.resetTransform(),d.resetTransform()}),[]);return{canvasRef:l,overlayCanvasRef:c,offscreenCanvasRef:u,cursorRef:h,strokesRef:f,currentStroke:d,isDrawing:m,mouseDownState:o,autoScale:p,baseScale:g,maskStorkeRef:x,isLoadingMaskRef:y,creatOffscreenCanvas:S,setMaskStrokes:function(e){x.current=e},fitView:function(){_(),p.current=g.current,i.current={x:0,y:0},Z(),c.current.style.transform="scale(".concat(p.current,")"),l.current.style.transform="scale(".concat(p.current,")"),u.current.style.transform="scale(".concat(p.current,")")},setStrokes:function(e){f.current=e},resetCanvas:_,draw:z,getTransformLineWidth:U,getTransformedPoint:I,drawStroke:N,startDrawing:function(e){if(!w){m.current=!0,d.current=[];var t=e.nativeEvent,n=t.offsetX,r=t.offsetY;d.current.push({x:n,y:r,lineWidth:a});var i=c.current.getContext("2d");Z();var s=I(n,r),o=s.x,l=s.y;i.beginPath(),i.moveTo(o,l),z(e)}},endDrawing:function(e){w||m.current&&(m.current=!1,f.current.push(j().cloneDeep(d.current)),d.current=[],R())},handleMouseMove:function(e){w||(c.current.style.cursor="none",h.current.style.display="block",h.current.style.top="".concat(e.clientY-a/2*p.current,"px"),h.current.style.left="".concat(e.clientX-a/2*p.current,"px"))},handleMouseLeave:function(){w||(m.current=!1,c.current.style.cursor="default",h.current.style.display="none")},handleMouseEnter:function(e){w?c.current.style.cursor="default":(c.current.style.cursor="none",h.current.style.display="block",h.current.style.top="".concat(e.clientY-a/2*p.current,"px"),h.current.style.left="".concat(e.clientX-a/2*p.current,"px"))},saveImage:R,generateMask:b,generateImage:C,setTransform:Z,clearOverlayCanvas:L,clearCanvas:O}}({lineWidth:k,translatePos:R,isDisabled:o,invertMask:U,maskUpload:u,onSave:f})),T=_.canvasRef,E=_.overlayCanvasRef,Y=_.offscreenCanvasRef,A=_.cursorRef,D=_.strokesRef,F=_.currentStroke,W=_.mouseDownState,H=_.autoScale,K=_.baseScale,B=_.maskStorkeRef,V=_.isLoadingMaskRef,G=_.setMaskStrokes,$=_.draw,X=(_.drawStroke,_.startDrawing),q=_.endDrawing,Q=_.handleMouseMove,ee=_.handleMouseLeave,te=_.handleMouseEnter,ne=_.saveImage,re=_.resetCanvas,ae=_.creatOffscreenCanvas,se=_.generateMask,ce=(_.getTransformLineWidth,_.getTransformedPoint,_.setStrokes),ue=_.setTransform,de=_.clearOverlayCanvas,fe=_.clearCanvas,me=_.fitView,he=le({overlayCanvasRef:E,canvasRef:T,offscreenCanvasRef:Y,cursorRef:A,lineWidth:k,translatePos:R,autoScale:H,baseScale:K,isLoadingMaskRef:V}),pe=he.handleOnWheel,ge=he.setActiveScale,ve=he.activeScale,we=(0,M.useMemo)((function(){return o||U||!(null==u||!u.length)}),[o,U,u]),Ce=(0,M.useCallback)((function(){var e=T.current,t=E.current,n=Y.current;t.width=e.width,t.height=e.height,n.width=e.width,n.height=e.height}),[]),be=(0,M.useCallback)((function(){var e=se(),t=document.createElement("a");t.download="mask_".concat(ie()().format("YYYYMMDDHHmmss"),".png"),t.href=e||"",t.click()}),[se]),je=(0,M.useCallback)((function(){de(),ce([]),G([]),ne(),F.current=[]}),[]),Me=function(e,t){try{var r,a;if(!(e.length||null!=t&&t.length))return;V.current=!0;var i=new OffscreenCanvas(E.current.width,E.current.height);v.current||(v.current=new Worker(new URL(n.p+n.u(5991),n.b),{type:void 0})),v.current.onmessage=function(e){"done"===e.data.type&&e.data.imageData&&(E.current.getContext("2d").putImageData(e.data.imageData,0,0),V.current=!1,ne())},null===(r=v.current)||void 0===r||r.postMessage({canvas:i,type:"init"},[i]),null===(a=v.current)||void 0===a||a.postMessage({type:"draw",maskStrokes:e,strokes:t||[]})}catch(e){}},Re=function(){var e=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length||B.current.length){e.next=3;break}return de(),e.abrupt("return");case 3:Me(B.current,t);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Se=(0,M.useCallback)((function(){if(0!==D.current.length||0!==B.current.length){var e=D.current.length,t=D.current.slice(0,-1);ce(t),!t.length&&0===e&&B.current.length&&G([]),clearTimeout(N.current),N.current=setTimeout((function(){Re(t)}),100)}else de()}),[]),Ze=(0,M.useCallback)(s()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x.current&&T.current){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise((function(e){var t=new Image;t.src=i,t.onload=function(){var n=T.current,r=n.getContext("2d"),a=x.current;K.current=Math.min(a.offsetWidth/t.width,a.offsetHeight/t.height,1),n.width=t.width,n.height=t.height,H.current=1,ae(),Ce(),fe(),r.drawImage(t,0,0,n.width,n.height),e()}})));case 3:case"end":return e.stop()}}),e)}))),[i]),Ie=function(e){var t=E.current.getContext("2d");if(t)if(e){var r,a,i=E.current.width,s=E.current.height;de();var o=new OffscreenCanvas(E.current.width,E.current.height);g.current||(g.current=new Worker(new URL(n.p+n.u(6323),n.b),{type:void 0})),g.current.onmessage=function(e){"done"===e.data.type&&e.data.imageData&&(E.current.getContext("2d").putImageData(e.data.imageData,0,0),V.current=!1,ne())},null===(r=g.current)||void 0===r||r.postMessage({canvas:o,type:"init"},[o]);var l=t.getImageData(0,0,i,s);null===(a=g.current)||void 0===a||a.postMessage({type:"draw",width:l.width,height:l.height,strokes:D.current,maskStrokes:B.current})}else Re(D.current)},Ue=function(){A.current.style.width="".concat(k*H.current,"px"),A.current.style.height="".concat(k*H.current,"px")},Pe=(0,M.useCallback)(s()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ze();case 2:null==m||m({width:T.current.width,height:T.current.height}),c.isResetNeeded?(je(),re()):(D.current.length||B.current.length)&&c.isOriginal&&!S.current?Re(D.current):(D.current.length||B.current.length)&&c.isOriginal&&S.current&&Ie(!0),Ue();case 6:case"end":return e.stop()}}),e)}))),[Ze,c.isOriginal,c.isResetNeeded]);(0,M.useEffect)((function(){Pe()}),[Pe]),(0,M.useEffect)((function(){var e=function(e){!e.ctrlKey&&!e.metaKey||"z"!==e.key||S.current||Se()};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[]),(0,M.useEffect)((function(){var e=function(e){W.current=!0},t=function(e){W.current=!1};return window.addEventListener("mousedown",e),window.addEventListener("mouseup",t),function(){clearTimeout(N.current),window.removeEventListener("mousedown",e),window.removeEventListener("mouseup",t)}}),[]);var Ne=function(){P(!1),Re(D.current),ne()};return(0,M.useImperativeHandle)(t,(function(){return{clearMask:Ne,loadMaskPixs:(e=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:G(t),ce([]),ue(),de(),Me(t);case 5:case"end":return e.stop()}}),e)}))),function(t){return e.apply(this,arguments)})};var e})),(0,M.useEffect)((function(){return g.current=new Worker(new URL(n.p+n.u(7254),n.b),{type:void 0}),v.current=new Worker(new URL(n.p+n.u(6603),n.b),{type:void 0}),function(){var e,t;null===(e=g.current)||void 0===e||e.terminate(),null===(t=v.current)||void 0===t||t.terminate()}}),[]),(0,M.useEffect)((function(){null!=u&&u.length&&de()}),[u]),(0,M.useEffect)((function(){we&&A.current&&(A.current.style.display="none")}),[we]),(0,J.jsxs)("div",{className:"editor-wrapper",children:[(0,J.jsxs)("div",{className:"flex-between",children:[(0,J.jsx)(xe,{handleBrushSizeChange:function(e){b(e),A.current.style.width="".concat(e,"px"),A.current.style.height="".concat(e,"px")},undo:Se,onClear:je,handleFitView:function(){me(),ge(H.current),Ue()},handleUpdateImageList:h,handleUpdateMaskList:p,disabled:we,lineWidth:k,invertMask:U,loading:r,accept:d}),(0,J.jsx)(ye,{handleOnChangeMask:function(e){S.current=e.target.checked,Ie(e.target.checked),P(e.target.checked)},invertMask:U,downloadMask:be,download:function(){var e,t;c.isOriginal?(e=T.current,(t=document.createElement("a")).download="image_".concat(ie()().format("YYYYMMDDHHmmss"),".png"),t.href=e.toDataURL("image/png"),t.click(),t.remove()):function(){if(i){var e=new Image;e.src=i,e.onload=function(){var t=document.createElement("canvas");t.width=c.width,t.height=c.height,t.getContext("2d").drawImage(e,0,0,t.width,t.height);var n=t.toDataURL("image/png"),r="".concat(t.width,"x").concat(t.height,"_").concat(ie()().format("YYYYMMDDHHmmss"),".png"),a=document.createElement("a");a.href=n,a.download=r,document.body.appendChild(a),a.click(),a.remove()}}}()},isOriginal:c.isOriginal,disabled:o||!(null==u||!u.length),maskUpload:u})]}),(0,J.jsxs)("div",{className:"editor-content",ref:x,style:{position:"relative",width:"100%",height:"100%",flex:1},children:[O.loading&&(0,J.jsx)(ke,{width:O.width,height:O.height}),(0,J.jsx)("canvas",{ref:T,style:{position:"absolute",zIndex:1}}),(0,J.jsx)("canvas",{ref:E,className:C()("overlay-canvas",{"overlay-canvas--disabled":we}),style:{position:"absolute",zIndex:10,cursor:"none"},onMouseDown:function(e){V.current||(W.current=!0,X(e))},onMouseUp:function(e){V.current||(W.current=!1,q(e))},onMouseEnter:te,onWheel:pe,onMouseMove:function(e){V.current||(Q(e),$(e))},onMouseLeave:function(e){V.current||(q(e),ee())}}),(0,J.jsx)("div",{ref:A,style:{display:"none",position:"fixed",width:k*ve,height:k*ve,backgroundColor:"rgba(0, 0, 255, 0.3)",borderRadius:"50%",pointerEvents:"none",cursor:"none",zIndex:5}})]})]})})),be=M.memo(Ce);function je(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,{canvas:n,ctx:n.getContext("2d")}}function Me(e,t,n,r){var a=4*(n*r+t);return 255===e[a]&&255===e[a+1]&&255===e[a+2]}function Re(e,t,n,r,a,i,s){for(var o=[[r,a]],c=[[1,0],[-1,0],[0,1],[0,-1],[1,1],[-1,-1],[1,-1],[-1,1]],u=function(){var r=o.pop(),a=l()(r,2),u=a[0],d=a[1];if(u<0||d<0||u>=t||d>=n||i[d][u]||!Me(e,u,d,t))return 1;i[d][u]=!0,s.push({x:u,y:d}),c.forEach((function(e){var t=l()(e,2),n=t[0],r=t[1];return o.push([u+n,d+r])}))};o.length;)u()}function Se(e){for(var t=e.data,n=e.width,r=e.height,a=Array.from({length:r},(function(){return new Array(n).fill(!1)})),i=[],s=0;s<r;s++)for(var o=0;o<n;o++)if(Me(t,o,s,n)&&!a[s][o]){var l=[];Re(t,n,r,o,s,a,l),i.push(l)}return i}function Ze(e){return new Promise((function(t,n){var r=new Image;r.src=e,r.onload=function(){return t(r)},r.onerror=function(){return n(new Error("Image loading failed"))}}))}function Ie(e){return Ue.apply(this,arguments)}function Ue(){return(Ue=s()(a()().mark((function e(t){var n,r,i,s,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ze(t);case 2:return n=e.sent,r=je(n.width,n.height),r.canvas,(i=r.ctx).drawImage(n,0,0),s=i.getImageData(0,0,n.width,n.height),o=Se(s),URL.revokeObjectURL(n.src),e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Pe=(0,M.forwardRef)((function(e,t){var n=e.modelList,r=(0,g.useIntl)(),i=(0,M.useState)(!1),o=l()(i,2),c=o[0],u=o[1],d=(0,M.useState)(!1),f=l()(d,2),m=f[0],h=f[1],p=(0,M.useRef)(null),v=(0,M.useRef)(null),x=(0,M.useRef)(null),w=(0,M.useState)(""),k=l()(w,2),b=k[0],R=k[1],S=(0,M.useState)(null),I=l()(S,2),O=I[0],T=I[1],F=(0,M.useState)([]),W=l()(F,2),H=W[0],q=W[1],Q=(0,M.useState)([]),te=l()(Q,2),ne=te[0],re=te[1],ae=(0,M.useState)({isOriginal:!1,isResetNeeded:!1,width:512,height:512}),ie=l()(ae,2),se=ie[0],oe=ie[1],le=(0,M.useRef)(!1),ce=(0,M.useState)(0),de=l()(ce,2),fe=de[0],me=de[1],he=(0,M.useRef)(null),pe=(0,D.M)(e,{type:"edit"}),ge=pe.handleOnValuesChange,ve=pe.handleToggleParamsStyle,xe=pe.setParams,ye=pe.updateCacheFormData,we=pe.setInitialValues,ke=pe.updateParamsConfig,Ce=pe.setParamsConfig,je=pe.form,Me=pe.modelMeta,Re=pe.formFields,Se=pe.paramsConfig,Ze=pe.initialValues,Ue=pe.parameters,Pe=pe.isOpenaiCompatible,Ne=B({scroller:p,paramsRef:v,chunkFields:["stream_options_chunk_result"],API:Z.d9}),ze=Ne.loading,Le=Ne.tokenResult,Oe=Ne.imageList,_e=Ne.currentPrompt,Te=Ne.setImageList,Ee=Ne.setCurrentPrompt,Ye=Ne.handleStopConversation,Ae=Ne.submitMessage;(0,M.useImperativeHandle)(t,(function(){return{viewCode:function(){u(!0)},setCollapse:function(){h(!m)},collapse:m}}));var De=(0,M.useMemo)((function(){return"custom"===Ue.size?U()(U()({},j().omit(Ue,["width","height","preview","random_seed"])),{},{image:null,mask:null,size:Ue.width&&Ue.height?"".concat(Ue.width,"x").concat(Ue.height):""}):U()({image:null,mask:null},j().omit(Ue,["width","height","random_seed","preview"]))}),[Ue]),Fe=(0,M.useMemo)((function(){return Pe?(0,V.jX)({api:Z.d9,edit:!0,isFormdata:!0,parameters:U()(U()({},De),{},{prompt:_e})}):(0,V.oJ)({api:Z.d9,isFormdata:!0,edit:!0,parameters:U()(U()({},De),{},{prompt:_e})})}),[De,_e,Pe]),We=function(){var e=s()(a()().mark((function e(){var t,n,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(t=je.current)||void 0===t||null===(t=t.form)||void 0===t?void 0:t.validateFields();case 3:if(Ue.model){e.next=5;break}return e.abrupt("return");case 5:return r=U()(U()({},j().omitBy(De,(function(e){return!e}))),{},{seed:Ue.random_seed?(0,_.Hq)():Ue.seed||null,stream:!1,prompt:_e}),xe(U()(U()({},Ue),{},{seed:r.seed})),null===(n=je.current)||void 0===n||null===(n=n.form)||void 0===n||n.setFieldValue("seed",r.seed),(0,P.gn)(L.Z["/playground/text-to-image"],!0),e.next=11,Ae(U()(U()({},r),{},{image:(0,_.Ll)(j().get(H,"0.dataUrl"),"image"),mask:O?(0,_.Ll)(O,"mask"):null}));case 11:e.next=15;break;case 13:e.prev=13,e.t0=e.catch(0);case 15:return e.prev=15,(0,P.gn)(L.Z["/playground/text-to-image"],!1),e.finish(15);case 19:case"end":return e.stop()}}),e,null,[[0,13,15,19]])})));return function(){return e.apply(this,arguments)}}(),He=(0,M.useCallback)((function(e){var t=(0,K.gk)({width:e.rawWidth,height:e.rawHeight}),n=t.width,r=t.height,a=Me.max_width,i=Me.max_height;a&&(n=Math.max(Math.min(n,a),512)),i&&(r=Math.max(Math.min(r,i),512));var s=ke({size:"custom",isOpenaiCompatible:Pe});Ce(s);var o=U()(U()({},Ue),{},{size:"custom",width:n||512,height:r||512});xe(o),ye({size:"custom",width:n||512,height:r||512}),we(o)}),[Ue,Me,Pe]),Ke=(0,M.useCallback)((function(e){var t=j().get(e,"[0]",{}),n=j().get(t,"dataUrl","");He(t),q(e),R(n),me(j().get(e,"[0].uid","")),oe({isOriginal:!0,isResetNeeded:!0,width:j().get(t,"width",512),height:j().get(t,"height",512)}),Te([])}),[He]),Be=(0,M.useCallback)(function(){var e=s()(a()().mark((function e(t){var n,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=j().get(t,"[0].dataUrl",""),e.next=3,Ie(r);case 3:i=e.sent,null===(n=he.current)||void 0===n||n.loadMaskPixs(i||[]);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),Ve=(0,M.useCallback)((function(){var e;re([]),T(null),null===(e=he.current)||void 0===e||e.clearMask()}),[]),Ge=(0,M.useCallback)((function(e){var t;oe((function(e){return U()(U()({},e),{},{isResetNeeded:!1})})),T(e.mask||(null===(t=ne[0])||void 0===t?void 0:t.dataUrl)||null),R(e.img)}),[]),$e=(0,M.useMemo)((function(){return b?(0,J.jsx)(be,{ref:he,imguid:fe,imageStatus:se,imageSrc:b,loading:ze,disabled:ze||!se.isOriginal,onSave:Ge,clearUploadMask:Ve,handleUpdateImageList:Ke,handleUpdateMaskList:Be,maskUpload:ne,accept:K.vm}):(0,J.jsx)(J.Fragment,{children:(0,J.jsx)(ue.Z,{accept:K.vm,drag:!0,multiple:!1,handleUpdateImgList:Ke,children:(0,J.jsxs)("div",{className:"flex-column flex-center gap-10 justify-center",style:{width:155,height:155},children:[(0,J.jsx)(z.Z,{type:"icon-upload_image",className:"font-size-24"}),(0,J.jsx)("span",{children:r.formatMessage({id:"playground.image.edit.tips"})})]})})})}),[r,b,ze,ne,se,Ge,Ke]),Xe=(0,M.useCallback)((function(e,t){e.progress<100&&!t||e.uid!==fe&&(me(e.uid),R(e.dataUrl),oe({isOriginal:t,isResetNeeded:!1,width:e.width,height:e.height}))}),[fe]);(0,M.useEffect)((function(){if(Oe.length>0){var e=Oe.find((function(e){return 100===e.progress}));e&&!le.current&&(le.current=!0,Xe(e,!1))}}),[Oe,Xe]);var Je=(0,M.useMemo)((function(){return H.length?(0,J.jsx)(J.Fragment,{children:(0,J.jsx)(ee.Z,U()(U()({},H[0]),{},{height:125,maxHeight:125,preview:!1,loading:!1,autoSize:!1,editable:!1,autoBgColor:!1,onClick:function(){return Xe(H[0],!0)},label:(0,J.jsx)("span",{children:r.formatMessage({id:"playground.image.origin"})})}))}):null}),[H,r,Xe]),qe=(0,M.useMemo)((function(){return ne.length?(0,J.jsx)(J.Fragment,{children:(0,J.jsx)(ee.Z,U()(U()({},ne[0]),{},{height:125,maxHeight:125,preview:!1,loading:!1,autoSize:!1,editable:!0,autoBgColor:!1,onDelete:function(){return Ve()},label:(0,J.jsx)("span",{children:r.formatMessage({id:"playground.image.mask"})})}))}):null}),[ne,r]);return(0,J.jsxs)("div",{className:"ground-left-wrapper",children:[(0,J.jsxs)("div",{className:"ground-left",children:[(0,J.jsx)("div",{className:"message-list-wrap",style:{paddingBottom:16},children:(0,J.jsx)(J.Fragment,{children:(0,J.jsx)("div",{className:"content",style:{height:"100%"},children:(0,J.jsx)("div",{className:"flex-column font-size-14 flex-center gap-20 justify-center hold-wrapper",children:$e})})})}),(0,J.jsxs)("div",{className:"ground-left-footer",style:{padding:10},children:[Le&&(0,J.jsx)("div",{style:{height:40},children:(0,J.jsx)(N.Z,{type:"danger",message:null==Le?void 0:Le.errorMessage})}),(0,J.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[(0,J.jsx)("div",{className:"m-r-10",children:qe}),Je,Oe.length>0&&(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(y.Z,{type:"vertical",style:{margin:"0 30px",height:80}}),(0,J.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:10},children:j().map(Oe,(function(e,t){return(0,J.jsx)("div",{style:{height:125,width:125,maxHeight:125},children:(0,J.jsx)(ee.Z,U()(U()({},e),{},{height:125,width:125,maxHeight:125,preview:e.preview,loading:e.loading,autoSize:!1,editable:!1,autoBgColor:!1,onClick:function(){return Xe(e,!1)}}))},e.uid)}))})]})]})]})]}),(0,J.jsxs)("div",{className:C()("params-wrapper",{collapsed:m}),style:{display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,J.jsx)("div",{style:{flex:1,overflow:"auto"},ref:v,"data-overlayscrollbars-initialize":!0,children:(0,J.jsx)("div",{className:"box",children:(0,J.jsx)(G.Z,{ref:je,formFields:Re,parametersTitle:(0,J.jsxs)("div",{className:"flex-between flex-center",children:[(0,J.jsx)("span",{children:r.formatMessage({id:"playground.parameters"})}),(0,J.jsx)(Y.Z,{title:r.formatMessage({id:"playground.image.params.custom.tips"}),children:(0,J.jsx)(A.ZP,{size:"small",type:"text",icon:(0,J.jsx)(E.Z,{}),onClick:ve,children:Pe?r.formatMessage({id:"playground.image.params.custom"}):r.formatMessage({id:"playground.image.params.openai"})})})]}),onValuesChange:ge,paramsConfig:Se,initialValues:Ze,modelList:n})})}),(0,J.jsx)("div",{style:{width:389},children:(0,J.jsx)($.Z,{actions:[],defaultSize:{minRows:5,maxRows:5},ref:x,placeholer:r.formatMessage({id:"playground.input.prompt.holder"}),title:(0,J.jsx)("span",{className:"font-600",children:r.formatMessage({id:"playground.image.prompt"})}),loading:ze,disabled:!Ue.model,isEmpty:!Oe.length,handleSubmit:We,handleAbortFetch:Ye,onInputChange:function(e){Ee(e.target.value)},shouldResetMessage:!1,clearAll:function(){Ee("")}})})]}),(0,J.jsx)(X.Z,{open:c,viewCodeContent:Fe,onCancel:function(){u(!1)},title:r.formatMessage({id:"playground.viewcode"})})]})})),Ne=Pe,ze=n(9629),Le=(n(48119),"generate"),Oe="edit",_e=function(){var e=(0,g.useIntl)(),t=(0,d.Z)().size,n=(0,M.useState)(Le),r=l()(n,2),i=r[0],o=r[1],k=(0,M.useRef)(null),b=(0,M.useRef)(null),I=(0,M.useState)([]),U=l()(I,2),P=U[0],N=U[1],z=(0,M.useMemo)((function(){return[{label:e.formatMessage({id:"playground.image.generate"}),value:Le,icon:(0,J.jsx)(h.Z,{})},{label:e.formatMessage({id:"playground.image.edit"}),value:Oe,icon:(0,J.jsx)(p.Z,{})}]}),[e]),L=(0,v.Z)((function(){var e,t;if(i===Le)null===(e=k.current)||void 0===e||null===(t=e.viewCode)||void 0===t||t.call(e);else if(i===Oe){var n,r;null===(n=b.current)||void 0===n||null===(r=n.viewCode)||void 0===r||r.call(n)}})),O=(0,v.Z)((function(){var e,t,n,r;i!==Le?null===(e=b.current)||void 0===e||null===(t=e.setCollapse)||void 0===t||t.call(e):null===(n=k.current)||void 0===n||null===(r=n.setCollapse)||void 0===r||r.call(n)})),_=(0,M.useMemo)((function(){return[{key:Le,label:"Generate",children:(0,J.jsx)(Q,{ref:k,modelList:P})},{key:Oe,label:"Edit",children:(0,J.jsx)(Ne,{modelList:P,ref:b})}]}),[P]);(0,M.useEffect)((function(){if(t.width<c.Z.lg){var e,n,r,a,i,s;if(null===(e=k.current)||void 0===e||!e.collapse)null===(r=k.current)||void 0===r||null===(a=r.setCollapse)||void 0===a||a.call(r);if(null===(n=b.current)||void 0===n||!n.collapse)null===(i=b.current)||void 0===i||null===(s=i.setCollapse)||void 0===s||s.call(i)}}),[t.width]),(0,M.useEffect)((function(){var e=function(){var e=s()(a()().mark((function e(){var t,n,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={categories:m.Us.image,with_meta:!0},e.next=4,(0,Z.nb)(t);case 4:return n=e.sent,r=j().map(n.data||[],(function(e){return{value:e.id,label:e.id,meta:e.meta}})),e.abrupt("return",r);case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),t=function(){var t=s()(a()().mark((function t(){var n;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e();case 3:n=t.sent,N(n),t.next=9;break;case 7:t.prev=7,t.t0=t.catch(0);case 9:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();t()}),[]);var T=(0,M.useMemo)((function(){return{title:(0,J.jsxs)("div",{className:"flex items-center",children:[(0,J.jsx)("span",{className:"font-600",children:e.formatMessage({id:"menu.playground.text2images"})}),(0,J.jsx)(x.Z,{options:z,size:"middle",className:"m-l-40 font-600",value:i,onChange:function(e){return o(e)}})]})}}),[i,z,e]);return(0,R.y1)(u.ZP.RIGHT.join(","),(function(){var e,t;null===(e=k.current)||void 0===e||null===(t=e.setCollapse)||void 0===t||t.call(e)}),{preventDefault:!0}),(0,J.jsx)(S.R,{header:T,extra:[(0,J.jsx)(ze.Z,{handleViewCode:L,handleToggleCollapse:O,activeKey:i},"view-code-buttons"),(0,J.jsx)(y.Z,{type:"vertical",style:{height:24,marginInline:16}},"divider"),(0,J.jsx)(f.k,{},"extra-content")],className:C()("playground-container chat"),children:(0,J.jsx)("div",{className:"play-ground",children:(0,J.jsx)("div",{className:"chat",children:(0,J.jsx)(w.Z,{items:_,activeKey:i})})})})}},51884:function(e,t,n){n.d(t,{jX:function(){return d},oJ:function(){return u},t5:function(){return c}});var r=n(26068),a=n.n(r),i=n(32699),s=n.n(i),o=n(13507),l=n(65548),c=function(e){var t=e.api,n=e.parameters,r=e.modelProxy,a=e.isFormdata,i=void 0!==a&&a,c=e.edit,u=void 0!==c&&c,d=window.location.origin,f=r?"".concat(o.kW,"/${YOUR_API_PATH}"):t,m="\ncurl ".concat(d).concat(f,' \\\n-H "Content-Type: application/json" \\\n-H "Authorization: Bearer ${YOUR_GPUSTACK_API_KEY}" \\').concat(r?'\n-H "X-GPUStack-Model: '.concat(n.model,'" \\'):"","\n").concat((0,l.Yy)(n,i)).trim();return u&&(m="\ncurl ".concat(d).concat(f,' \\\n-H "Content-Type: multipart/form-data" \\\n-H "Authorization: Bearer ${YOUR_GPUSTACK_API_KEY}" \\').concat(r?'\n-H "X-GPUStack-Model: '.concat(n.model,'" \\'):"",'\n-F image="@image.png" \\\n-F mask="@mask.png" \\\n').concat((0,l.Yy)(s().omit(n,["mask","image"]),i)).trim().replace(/\\$/,"")),m},u=function(e){var t=e.api,n=e.parameters,r=e.isFormdata,a=void 0!==r&&r,i=e.edit,s=void 0!==i&&i,u=window.location.origin,d=t;return{curlCode:c({api:t,parameters:n,isFormdata:a,edit:s}),pythonCode:'\nimport requests\n\nurl="'.concat(u).concat(d,'"\nheaders = {\n  "Content-type": "application/json",\n  "Authorization": "Bearer ${YOUR_GPUSTACK_API_KEY}"\n}\ndata = ').concat(JSON.stringify(n,null,2).replace(/null/g,"None"),"\n\nresponse = requests.post(url, headers=headers, json=data)\nprint(response.json()['data'][0]['b64_json'])").trim(),nodeJsCode:"\nconst axios = require('axios');\n\nconst url = \"".concat(u,"/").concat(o.Mo,'/images/generations";\nconst headers = {\n  "Content-type": "application/json",\n  "Authorization": "Bearer ${YOUR_GPUSTACK_API_KEY}"\n};\nconst data = ').concat((0,l.GT)(n),";\n\naxios.post(url, data, { headers }).then((response) => {\n  console.log(response.data.data[0].b64_json);\n});").trim()}},d=function(e){var t=e.api,n=e.parameters,r=e.isFormdata,i=void 0!==r&&r,c=e.edit,u=void 0!==c&&c,d=window.location.origin,f=t,m="\ncurl ".concat(d).concat(f,' \\\n-H "Content-Type: multipart/form-data" \\\n-H "Authorization: Bearer ${YOUR_GPUSTACK_API_KEY}" \\\n').concat((0,l.Yy)(n,i)).trim();u&&(m="\ncurl ".concat(d).concat(f,' \\\n-H "Content-Type: application/json" \\\n-H "Authorization: Bearer ${YOUR_GPUSTACK_API_KEY}" \\\n-F image="@image.png" \\\n-F mask="@mask.png" \\\n').concat((0,l.Yy)(s().omit(n,["mask","image"]),i)).trim().replace(/\\$/,""));var h='\nfrom openai import OpenAI\n\nclient = OpenAI(\n  base_url="'.concat(d,"/").concat(o.Mo,'", \n  api_key="YOUR_GPUSTACK_API_KEY"\n)\n\nresponse = client.images.generate(\n').concat((0,l.G4)(a()({},n)),")\n\nprint(response.data[0].b64_json)").trim(),p=(0,l.GT)(a()({},n));return{curlCode:m,pythonCode:h,nodeJsCode:'\nconst OpenAI = require("openai");\n\nconst openai = new OpenAI({\n  "apiKey": "YOUR_GPUSTACK_API_KEY",\n  "baseURL": "'.concat(d,"/").concat(o.Mo,'"\n});\n\nasync function main() {\n  const params = ').concat(p,"; \n  const response = await openai.images.generate(params);\n  console.log(response.data[0].b64_json);\n}\nmain();").trim()}}}}]);