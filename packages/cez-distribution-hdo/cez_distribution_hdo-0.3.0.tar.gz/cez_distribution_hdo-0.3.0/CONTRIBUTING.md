# Contributing

Thanks for your interest in contributing to **cez-distribution-hdo**.

This repository uses:
- **Pull Requests only** for changes to `main`
- **Required CI checks** before merging
- **Release Drafter** to generate release notes from merged PRs
- **Git tags (`vX.Y.Z`)** as the single source of truth for the release version

---

## Workflow

### 1) Create a branch
Create a new branch from `main`:

```bash
git checkout main
git pull --ff-only
git checkout -b <your-branch-name>
```

### 2) Make changes locally

Install dependencies with `uv`:

```bash
uv sync --locked --dev
```

Run checks locally (recommended):

```bash
uv run ruff check .
uv run ruff format --check .
uv run pyright
uv run pytest

# or all in one:
uv run pre-commit run --all-files
```

### 3) Open a Pull Request

Open a PR targeting `main`. The PR should:

* include a clear title (see “PR title style”)
* pass CI checks
* have the correct label(s) (see “Labels”)

### 4) Merge

This repository enforces a linear history. Prefer **Squash merge** for clean history.

Release notes are generated from **merged PRs**, not from individual commits.

---

## PR title style

PR titles should follow **Conventional Commits** (recommended):

* `feat: ...` — new functionality
* `fix: ...` — bug fix
* `docs: ...` — documentation changes
* `chore: ...` — maintenance/tooling
* `ci: ...` — CI/workflows

Examples:

* `feat: add TariffService snapshot outputs`
* `fix: handle whitespace-only identifiers in payload`
* `docs: update README and CHANGELOG`

---

## Labels

Release notes are generated by **Release Drafter** based on PR labels.

### Primary labels (choose one)

Use exactly **one** of the following labels on each PR:

* **feature** — New functionality or user-facing behavior.
* **fix** — Bug fix / behavior correction.
* **docs** — Documentation-only changes.
* **chore** — Maintenance work (refactors, tooling) with no user-facing change.
* **dependencies** — Dependency updates (runtime or dev), lockfiles, version bumps.

### Optional modifier labels

Use these in addition to the primary label when applicable:

* **breaking** — Backward-incompatible change to the public API or behavior.
* **bug** — Bug-related work (often used on issues; optional on PRs if you want it reflected in release notes).
* **skip-changelog** — Exclude the PR from release notes (internal/noise-only changes).

---

## Releases

### Versioning

Release version is driven **only by Git tags** in the form:

- `vMAJOR.MINOR.PATCH` (e.g., `v0.1.2`)

Release Drafter is used only as a **release notes generator**. It does not decide the version.

> Only maintainers should create release tags. Any tag without `rc/dev/a/b` is treated as a stable release and publishes to PyPI.


### Publishing target (PyPI vs TestPyPI)

The Release workflow automatically decides where to publish based on the tag name:

- **TestPyPI** (pre-releases): tags that contain any of: `rc`, `dev`, `a`, `b`
  - examples: `v0.1.2rc1`, `v0.1.2.dev1`, `v0.1.2a1`, `v0.1.2b1`
- **PyPI** (stable releases): tags without those markers
  - example: `v0.1.2`

This matches the GitHub Actions rule:

- if tag contains (`rc` OR `dev` OR `a` OR `b`) → environment `testpypi`
- otherwise → environment `pypi`

> Recommended: use PEP 440-style pre-release versions (`rc`, `dev`, `a`, `b`) to keep versions compatible with Python packaging tooling.

### Creating a release

After your PRs are merged into `main`, create an annotated tag on `main`:

```bash
git checkout main
git pull --ff-only

# Stable release (publishes to PyPI)
git tag -a vX.Y.Z -m "vX.Y.Z"
git push origin tag vX.Y.Z
```

Pre-release examples (publish to TestPyPI):

```bash
# Release candidate
git tag -a vX.Y.Zrc1 -m "vX.Y.Zrc1"
git push origin tag vX.Y.Zrc1

# Dev build
git tag -a vX.Y.Z.dev1 -m "vX.Y.Z.dev1"
git push origin tag vX.Y.Z.dev1
```

A GitHub Actions workflow will:

* build the distribution artifacts (`sdist` + `wheel`)
* publish to **TestPyPI** (pre-releases) or **PyPI** (stable) based on the tag name
* create a GitHub Release for the tag
* attach `dist/*.whl` and `dist/*.tar.gz`
* use Release Drafter output as the release body

---

## Notes for maintainers

* `main` is protected: changes must go through PRs and CI.
* Keep PRs focused and apply the correct labels to produce clean release notes.
* For changes that should not appear in release notes, apply **skip-changelog**.
