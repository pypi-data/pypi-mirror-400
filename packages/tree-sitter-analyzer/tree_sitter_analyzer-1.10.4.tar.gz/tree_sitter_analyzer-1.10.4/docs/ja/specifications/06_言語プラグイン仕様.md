# è¨€èªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä»•æ§˜

**æ–‡æ›¸ç•ªå·:** SPEC-006  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 1.0  
**ä½œæˆæ—¥:** 2025-11-03  
**æœ€çµ‚æ›´æ–°:** 2025-11-03

---

## 1. æ¦‚è¦

æœ¬æ–‡æ›¸ã¯ã€Tree-sitter Analyzerã®è¨€èªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã®ä»•æ§˜ã‚’è¨˜è¿°ã™ã‚‹ã€‚æ–°è¨€èªã®ã‚µãƒãƒ¼ãƒˆè¿½åŠ æ–¹æ³•ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³APIã€å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’æ˜ç¢ºåŒ–ã™ã‚‹ã€‚

---

## 2. ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 2.1 è¨­è¨ˆåŸå‰‡

- âœ… **ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ™ãƒ¼ã‚¹**: è¨€èªã”ã¨ã«ç‹¬ç«‹ã—ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³
- âœ… **çµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**: `LanguagePlugin`åŸºåº•ã‚¯ãƒ©ã‚¹
- âœ… **æ‹¡å¼µæ€§**: æ–°è¨€èªè¿½åŠ ãŒå®¹æ˜“
- âœ… **ç‹¬ç«‹æ€§**: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–“ã®ä¾å­˜ãªã—

---

### 2.2 ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ§‹é€ 

**å®Ÿéš›ã®æ§‹é€ ** (`tree_sitter_analyzer/`)

```
tree_sitter_analyzer/
â”œâ”€â”€ plugins/
â”‚   â”œâ”€â”€ base.py                  # åŸºåº•ã‚¯ãƒ©ã‚¹ (LanguagePlugin, ElementExtractor)
â”‚   â”œâ”€â”€ manager.py               # ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç®¡ç† (PluginManager)
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ languages/
â”‚   â”œâ”€â”€ python_plugin.py         # Pythonãƒ—ãƒ©ã‚°ã‚¤ãƒ³ + Extractor
â”‚   â”œâ”€â”€ java_plugin.py           # Javaãƒ—ãƒ©ã‚°ã‚¤ãƒ³ + Extractor
â”‚   â”œâ”€â”€ javascript_plugin.py     # JavaScriptãƒ—ãƒ©ã‚°ã‚¤ãƒ³ + Extractor
â”‚   â”œâ”€â”€ typescript_plugin.py     # TypeScriptãƒ—ãƒ©ã‚°ã‚¤ãƒ³ + Extractor
â”‚   â”œâ”€â”€ css_plugin.py            # CSSãƒ—ãƒ©ã‚°ã‚¤ãƒ³ + Extractor
â”‚   â”œâ”€â”€ html_plugin.py           # HTMLãƒ—ãƒ©ã‚°ã‚¤ãƒ³ + Extractor
â”‚   â”œâ”€â”€ markdown_plugin.py       # Markdownãƒ—ãƒ©ã‚°ã‚¤ãƒ³ + Extractor
â”‚   â””â”€â”€ __init__.py
â””â”€â”€ ...
```

**ç‰¹å¾´:**
- `plugins/`ã«åŸºåº•ã‚¯ãƒ©ã‚¹ã¨ç®¡ç†æ©Ÿèƒ½
- `languages/`ã«å„è¨€èªã®å®Ÿè£…
- å„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯`Plugin`ã‚¯ãƒ©ã‚¹ã¨`Extractor`ã‚¯ãƒ©ã‚¹ã®ä¸¡æ–¹ã‚’å«ã‚€

---

## 3. LanguagePluginåŸºåº•ã‚¯ãƒ©ã‚¹

### 3.1 ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©

**å®Ÿéš›ã®å®Ÿè£…** (`tree_sitter_analyzer/plugins/base.py`):

```python
from abc import ABC, abstractmethod
from typing import TYPE_CHECKING

if TYPE_CHECKING:
    from ..core.analysis_engine import AnalysisRequest
    from ..models import AnalysisResult

class LanguagePlugin(ABC):
    """
    Abstract base class for language-specific plugins.

    Language plugins provide language-specific functionality including
    element extraction, file extension mapping, and language identification.
    """

    @abstractmethod
    def get_language_name(self) -> str:
        """
        Return the name of the programming language this plugin supports.

        Returns:
            Language name (e.g., "java", "python", "javascript")
        """
        pass

    @abstractmethod
    def get_file_extensions(self) -> list[str]:
        """
        Return list of file extensions this plugin supports.

        Returns:
            List of file extensions (e.g., [".java", ".class"])
        """
        pass

    @abstractmethod
    def create_extractor(self) -> ElementExtractor:
        """
        Create and return an element extractor for this language.

        Returns:
            ElementExtractor instance for this language
        """
        pass

    @abstractmethod
    async def analyze_file(
        self, file_path: str, request: "AnalysisRequest"
    ) -> "AnalysisResult":
        """
        Analyze a file and return analysis results.

        Args:
            file_path: Path to the file to analyze
            request: Analysis request with configuration

        Returns:
            AnalysisResult containing extracted information
        """
        pass

    def get_supported_element_types(self) -> list[str]:
        """
        Return list of supported CodeElement types.

        Returns:
            List of element types (e.g., ["function", "class", "variable"])
        """
        return ["function", "class", "variable", "import"]

    def get_queries(self) -> dict[str, str]:
        """
        Return language-specific tree-sitter queries.

        Returns:
            Dictionary mapping query names to query strings
        """
        return {}

    def execute_query_strategy(
        self, query_key: str | None, language: str
    ) -> str | None:
        """
        Execute query strategy for this language plugin.

        Args:
            query_key: Query key to execute
            language: Programming language

        Returns:
            Query string or None if not supported
        """
        queries = self.get_queries()
        return queries.get(query_key) if query_key else None
```

**ä¸»è¦ãªé•ã„:**
- `@property`ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã®ä»£ã‚ã‚Šã«é€šå¸¸ã®ãƒ¡ã‚½ãƒƒãƒ‰
- `get_parser()`ã¯å‰Šé™¤ï¼ˆãƒ‘ãƒ¼ã‚µãƒ¼ã¯`Parser`ã‚¯ãƒ©ã‚¹ã§ç®¡ç†ï¼‰
- `extract_elements()`ã¯å‰Šé™¤ï¼ˆ`ElementExtractor`ã‚¯ãƒ©ã‚¹ã§å®Ÿè£…ï¼‰
- `calculate_complexity()`ã¯å‰Šé™¤ï¼ˆ`ElementExtractor`å†…ã§å®Ÿè£…ï¼‰
- `analyze_file()`ãŒéåŒæœŸãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦è¿½åŠ 
- `execute_query_strategy()`ãŒè¿½åŠ 

### 3.2 ElementExtractoråŸºåº•ã‚¯ãƒ©ã‚¹

**å®Ÿè£…** (`tree_sitter_analyzer/plugins/base.py`):

```python
class ElementExtractor(ABC):
    """
    Abstract base class for language-specific element extractors.

    Element extractors are responsible for parsing ASTs and extracting
    meaningful code elements like functions, classes, variables, etc.
    """

    def __init__(self) -> None:
        """Initialize the element extractor."""
        self.current_file: str = ""  # Current file being processed

    @abstractmethod
    def extract_functions(
        self, tree: "tree_sitter.Tree", source_code: str
    ) -> list[ModelFunction]:
        """
        Extract function definitions from the syntax tree.

        Args:
            tree: Tree-sitter AST
            source_code: Original source code

        Returns:
            List of extracted function objects
        """
        pass

    @abstractmethod
    def extract_classes(
        self, tree: "tree_sitter.Tree", source_code: str
    ) -> list[ModelClass]:
        """
        Extract class definitions from the syntax tree.

        Args:
            tree: Tree-sitter AST
            source_code: Original source code

        Returns:
            List of extracted class objects
        """
        pass

    @abstractmethod
    def extract_variables(
        self, tree: "tree_sitter.Tree", source_code: str
    ) -> list[ModelVariable]:
        """
        Extract variable declarations from the syntax tree.

        Args:
            tree: Tree-sitter AST
            source_code: Original source code

        Returns:
            List of extracted variable objects
        """
        pass

    @abstractmethod
    def extract_imports(
        self, tree: "tree_sitter.Tree", source_code: str
    ) -> list[ModelImport]:
        """
        Extract import statements from the syntax tree.

        Args:
            tree: Tree-sitter AST
            source_code: Original source code

        Returns:
            List of extracted import objects
        """
        pass

    def extract_all_elements(
        self, tree: "tree_sitter.Tree", source_code: str
    ) -> list[CodeElement]:
        """
        Extract all code elements from the syntax tree.

        Args:
            tree: Tree-sitter AST
            source_code: Original source code

        Returns:
            List of all extracted code elements
        """
        elements: list[CodeElement] = []
        elements.extend(self.extract_functions(tree, source_code))
        elements.extend(self.extract_classes(tree, source_code))
        elements.extend(self.extract_variables(tree, source_code))
        elements.extend(self.extract_imports(tree, source_code))
        return elements
```

**è²¬å‹™:**
- Tree-sitter ASTã‹ã‚‰è¨€èªå›ºæœ‰ã®è¦ç´ ã‚’æŠ½å‡º
- é–¢æ•°ã€ã‚¯ãƒ©ã‚¹ã€å¤‰æ•°ã€ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®æŠ½å‡º
- è¤‡é›‘åº¦è¨ˆç®—ï¼ˆå®Ÿè£…ã‚¯ãƒ©ã‚¹ã§è¡Œã†ï¼‰

---

## 4. ã‚µãƒãƒ¼ãƒˆè¨€èªã¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å®Ÿè£…

### 4.1 Python ãƒ—ãƒ©ã‚°ã‚¤ãƒ³

**å®Ÿéš›ã®å®Ÿè£…** (`tree_sitter_analyzer/languages/python_plugin.py`):

```python
import tree_sitter
import tree_sitter_python as tspython
from ..plugins.base import LanguagePlugin, ElementExtractor
from ..models import Function, Class, Variable, Import

class PythonElementExtractor(ElementExtractor):
    """Pythonç”¨ã®è¦ç´ æŠ½å‡ºå™¨"""
    # ... æŠ½å‡ºãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£… ...
    
    def extract_functions(
        self, tree: "tree_sitter.Tree", source_code: str
    ) -> list[Function]:
        """é–¢æ•°ã‚’æŠ½å‡º"""
        # å®Ÿè£…...
    
    def extract_classes(
        self, tree: "tree_sitter.Tree", source_code: str
    ) -> list[Class]:
        """ã‚¯ãƒ©ã‚¹ã‚’æŠ½å‡º"""
        # å®Ÿè£…...
    
    def _calculate_complexity_optimized(self, node: "tree_sitter.Node") -> int:
        """å¾ªç’°çš„è¤‡é›‘åº¦ã‚’åŠ¹ç‡çš„ã«è¨ˆç®—"""
        complexity = 1
        node_text = self._get_node_text_optimized(node).lower()
        keywords = [
            "if", "elif", "while", "for", "except",
            "and", "or", "with", "match", "case",
        ]
        for keyword in keywords:
            pattern = rf"\b{keyword}\b"
            matches = re.findall(pattern, node_text)
            complexity += len(matches)
        return complexity


class PythonPlugin(LanguagePlugin):
    """Python language plugin for the new architecture"""

    def __init__(self) -> None:
        """Initialize the Python plugin"""
        super().__init__()
        self._language_cache: tree_sitter.Language | None = None
        self._extractor: PythonElementExtractor | None = None
        self.language = "python"
        self.extractor = self.get_extractor()

    def get_language_name(self) -> str:
        """Return the name of the programming language this plugin supports"""
        return "python"

    def get_file_extensions(self) -> list[str]:
        """Return list of file extensions this plugin supports"""
        return [".py", ".pyw", ".pyi"]

    def create_extractor(self) -> ElementExtractor:
        """Create and return an element extractor for this language"""
        return PythonElementExtractor()

    def get_extractor(self) -> ElementExtractor:
        """Get the cached extractor instance, creating it if necessary"""
        if self._extractor is None:
            self._extractor = PythonElementExtractor()
        return self._extractor

    def get_tree_sitter_language(self) -> Optional["tree_sitter.Language"]:
        """Get the Tree-sitter language object for Python"""
        if self._language_cache is None:
            try:
                language_capsule = tspython.language()
                self._language_cache = tree_sitter.Language(language_capsule)
            except Exception as e:
                log_error(f"Failed to load Python language: {e}")
                return None
        return self._language_cache

    def get_supported_queries(self) -> list[str]:
        """Get list of supported query names for this language"""
        return [
            "function", "class", "variable", "import",
            "async_function", "method", "decorator", "exception",
            "comprehension", "lambda", "context_manager", "type_hint",
            "docstring", "django_model", "flask_route", "fastapi_endpoint",
        ]

    async def analyze_file(
        self, file_path: str, request: "AnalysisRequest"
    ) -> "AnalysisResult":
        """
        Analyze a Python file and return analysis results.
        
        Args:
            file_path: Path to the Python file
            request: Analysis request with configuration
            
        Returns:
            AnalysisResult containing extracted information
        """
        # å®Ÿè£…...
        pass
```

**ç‰¹å¾´:**
- `ElementExtractor`ã¨`Plugin`ãŒåˆ†é›¢
- `Extractor`ãŒå®Ÿéš›ã®æŠ½å‡ºãƒ­ã‚¸ãƒƒã‚¯ã‚’æ‹…å½“
- `Plugin`ãŒãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã‚’æä¾›
- è¤‡é›‘åº¦è¨ˆç®—ã¯`Extractor`å†…ã§å®Ÿè£…
            if child.type in decision_nodes:
                complexity += 1
            complexity += self.calculate_complexity(child)
        
        return complexity
```

---

### 4.2 Java ãƒ—ãƒ©ã‚°ã‚¤ãƒ³

```python
import tree_sitter_java

class JavaPlugin(LanguagePlugin):
    """Javaãƒ—ãƒ©ã‚°ã‚¤ãƒ³"""
    
    @property
    def name(self) -> str:
        return "Java"
    
    @property
    def file_extensions(self) -> List[str]:
        return [".java"]
    
    def get_parser(self) -> Parser:
        parser = Parser()
        parser.set_language(tree_sitter_java.language())
        return parser
    
    def extract_elements(self, tree: Tree) -> List[CodeElement]:
        """Javaã®è¦ç´ ã‚’æŠ½å‡º"""
        elements = []
        
        # ã‚¯ãƒ©ã‚¹ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹æŠ½å‡º
        class_query = """
        [
          (class_declaration
            name: (identifier) @name
          ) @class
          (interface_declaration
            name: (identifier) @name
          ) @interface
        ]
        """
        
        # ãƒ¡ã‚½ãƒƒãƒ‰æŠ½å‡º
        method_query = """
        (method_declaration
          name: (identifier) @method_name
        ) @method
        """
        
        # ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æŠ½å‡º
        field_query = """
        (field_declaration
          declarator: (variable_declarator
            name: (identifier) @field_name
          )
        ) @field
        """
        
        elements.extend(self._extract_with_query(tree, class_query))
        elements.extend(self._extract_with_query(tree, method_query))
        elements.extend(self._extract_with_query(tree, field_query))
        
        return elements
    
    def calculate_complexity(self, node: Node) -> int:
        """Javaã®å¾ªç’°çš„è¤‡é›‘åº¦ã‚’è¨ˆç®—"""
        complexity = 1
        
        decision_nodes = [
            'if_statement',
            'for_statement',
            'while_statement',
            'do_statement',
            'switch_statement',
            'catch_clause',
            'conditional_expression',
            'binary_expression'  # && ã‚„ ||
        ]
        
        for child in node.children:
            if child.type in decision_nodes:
                complexity += 1
            complexity += self.calculate_complexity(child)
        
        return complexity
```

---

### 4.3 JavaScript/TypeScript ãƒ—ãƒ©ã‚°ã‚¤ãƒ³

```python
import tree_sitter_javascript
import tree_sitter_typescript

class JavaScriptPlugin(LanguagePlugin):
    """JavaScriptãƒ—ãƒ©ã‚°ã‚¤ãƒ³"""
    
    @property
    def name(self) -> str:
        return "JavaScript"
    
    @property
    def file_extensions(self) -> List[str]:
        return [".js", ".jsx", ".mjs"]
    
    def get_parser(self) -> Parser:
        parser = Parser()
        parser.set_language(tree_sitter_javascript.language())
        return parser
    
    def extract_elements(self, tree: Tree) -> List[CodeElement]:
        """JavaScriptã®è¦ç´ ã‚’æŠ½å‡º"""
        elements = []
        
        # ã‚¯ãƒ©ã‚¹æŠ½å‡º
        class_query = """
        (class_declaration
          name: (identifier) @class_name
        ) @class
        """
        
        # é–¢æ•°æŠ½å‡ºï¼ˆé€šå¸¸ã®é–¢æ•°ã¨ã‚¢ãƒ­ãƒ¼é–¢æ•°ï¼‰
        function_query = """
        [
          (function_declaration
            name: (identifier) @func_name
          ) @function
          (arrow_function) @arrow_function
        ]
        """
        
        elements.extend(self._extract_with_query(tree, class_query))
        elements.extend(self._extract_with_query(tree, function_query))
        
        return elements

class TypeScriptPlugin(JavaScriptPlugin):
    """TypeScriptãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼ˆJavaScriptã‚’ç¶™æ‰¿ï¼‰"""
    
    @property
    def name(self) -> str:
        return "TypeScript"
    
    @property
    def file_extensions(self) -> List[str]:
        return [".ts", ".tsx"]
    
    def get_parser(self) -> Parser:
        parser = Parser()
        parser.set_language(tree_sitter_typescript.language_typescript())
        return parser
```

---

## 5. æ–°è¨€èªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ä½œæˆã‚¬ã‚¤ãƒ‰

### 5.1 ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

#### ã‚¹ãƒ†ãƒƒãƒ—1: tree-sitterãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ç¢ºèª

```bash
# PyPIã§åˆ©ç”¨å¯èƒ½ã‹ç¢ºèª
pip search tree-sitter-<language>

# ä¾‹: Ruby
pip search tree-sitter-ruby
```

#### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

```python
# tree_sitter_analyzer/plugins/ruby_plugin.py

import tree_sitter_ruby
from .base_plugin import LanguagePlugin

class RubyPlugin(LanguagePlugin):
    @property
    def name(self) -> str:
        return "Ruby"
    
    @property
    def file_extensions(self) -> List[str]:
        return [".rb"]
    
    def get_parser(self) -> Parser:
        parser = Parser()
        parser.set_language(tree_sitter_ruby.language())
        return parser
    
    def extract_elements(self, tree: Tree) -> List[CodeElement]:
        # Rubyå›ºæœ‰ã®æŠ½å‡ºãƒ­ã‚¸ãƒƒã‚¯
        pass
    
    def calculate_complexity(self, node: Node) -> int:
        # Rubyå›ºæœ‰ã®è¤‡é›‘åº¦è¨ˆç®—
        pass
```

#### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç™»éŒ²

```python
# tree_sitter_analyzer/plugin_manager.py

class PluginManager:
    def __init__(self):
        self.plugins = {
            'Python': PythonPlugin(),
            'Java': JavaPlugin(),
            'JavaScript': JavaScriptPlugin(),
            'Ruby': RubyPlugin(),  # è¿½åŠ 
        }
```

#### ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ†ã‚¹ãƒˆä½œæˆ

```python
# tests/test_ruby_plugin.py

def test_ruby_plugin():
    plugin = RubyPlugin()
    
    # ãƒ‘ãƒ¼ã‚µãƒ¼ãƒ†ã‚¹ãƒˆ
    parser = plugin.get_parser()
    assert parser is not None
    
    # è§£æãƒ†ã‚¹ãƒˆ
    source = """
    class MyClass
      def my_method
        puts "Hello"
      end
    end
    """
    
    tree = parser.parse(bytes(source, 'utf8'))
    elements = plugin.extract_elements(tree)
    
    assert len(elements) == 2  # 1ã‚¯ãƒ©ã‚¹ + 1ãƒ¡ã‚½ãƒƒãƒ‰
```

#### ã‚¹ãƒ†ãƒƒãƒ—5: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

- `README.md`: ã‚µãƒãƒ¼ãƒˆè¨€èªãƒªã‚¹ãƒˆã«è¿½åŠ 
- `docs/ja/specifications/06_è¨€èªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä»•æ§˜.md`: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æƒ…å ±è¿½åŠ 

---

## 6. ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™ºã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 6.1 ã‚¯ã‚¨ãƒªã®æœ€é©åŒ–

**åŠ¹ç‡çš„ãªã‚¯ã‚¨ãƒª:**
```scheme
; âŒ éåŠ¹ç‡ï¼ˆå…¨ãƒãƒ¼ãƒ‰èµ°æŸ»ï¼‰
(identifier) @all_identifiers

; âœ… åŠ¹ç‡çš„ï¼ˆç‰¹å®šãƒãƒ¼ãƒ‰ã®ã¿ï¼‰
(function_definition
  name: (identifier) @func_name
) @function
```

---

### 6.2 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```python
def extract_elements(self, tree: Tree) -> List[CodeElement]:
    """ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä»˜ãè¦ç´ æŠ½å‡º"""
    try:
        elements = []
        
        # ã‚¯ã‚¨ãƒªå®Ÿè¡Œ
        results = self._execute_query(tree, self.class_query)
        
        for result in results:
            try:
                element = self._create_element(result)
                elements.append(element)
            except Exception as e:
                logger.warning(f"Failed to create element: {e}")
                continue
        
        return elements
    
    except Exception as e:
        logger.error(f"Failed to extract elements: {e}")
        return []
```

---

### 6.3 è¨€èªå›ºæœ‰ã®æœ€é©åŒ–

**Python: Docstringå‡¦ç†**
```python
def extract_docstring(self, node: Node) -> str | None:
    """é–¢æ•°/ã‚¯ãƒ©ã‚¹ã®docstringã‚’æŠ½å‡º"""
    if node.children and node.children[0].type == 'expression_statement':
        expr = node.children[0]
        if expr.children and expr.children[0].type == 'string':
            return expr.children[0].text.decode('utf8')
    return None
```

**Java: ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†**
```python
def extract_annotations(self, node: Node) -> List[str]:
    """ãƒ¡ã‚½ãƒƒãƒ‰/ã‚¯ãƒ©ã‚¹ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŠ½å‡º"""
    annotations = []
    for child in node.children:
        if child.type == 'marker_annotation':
            name_node = child.child_by_field_name('name')
            if name_node:
                annotations.append(name_node.text.decode('utf8'))
    return annotations
```

---

## 7. ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼

### 7.1 è‡ªå‹•æ¤œå‡ºã¨ç™»éŒ²

```python
class PluginManager:
    """ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç®¡ç†ã‚¯ãƒ©ã‚¹"""
    
    def __init__(self):
        self.plugins: Dict[str, LanguagePlugin] = {}
        self._discover_plugins()
    
    def _discover_plugins(self):
        """ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’è‡ªå‹•æ¤œå‡º"""
        plugin_dir = Path(__file__).parent / 'plugins'
        
        for file in plugin_dir.glob('*_plugin.py'):
            module_name = file.stem
            try:
                module = importlib.import_module(
                    f'tree_sitter_analyzer.plugins.{module_name}'
                )
                
                # ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¯ãƒ©ã‚¹ã‚’æ¤œå‡º
                for name, obj in inspect.getmembers(module, inspect.isclass):
                    if issubclass(obj, LanguagePlugin) and obj != LanguagePlugin:
                        plugin = obj()
                        self.plugins[plugin.name] = plugin
                        logger.info(f"Loaded plugin: {plugin.name}")
            
            except Exception as e:
                logger.warning(f"Failed to load plugin {module_name}: {e}")
    
    def get_plugin(self, language: str) -> LanguagePlugin | None:
        """è¨€èªã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å–å¾—"""
        return self.plugins.get(language)
    
    def get_supported_languages(self) -> List[str]:
        """ã‚µãƒãƒ¼ãƒˆè¨€èªãƒªã‚¹ãƒˆã‚’å–å¾—"""
        return list(self.plugins.keys())
```

---

## 8. ã‚µãƒãƒ¼ãƒˆè¨€èªä¸€è¦§

| è¨€èª | ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¯ãƒ©ã‚¹ | æ‹¡å¼µå­ | tree-sitterãƒ©ã‚¤ãƒ–ãƒ©ãƒª | çŠ¶æ…‹ |
|------|----------------|--------|---------------------|------|
| Python | `PythonPlugin` | .py, .pyi | `tree-sitter-python` | âœ… å®Œå…¨å¯¾å¿œ |
| Java | `JavaPlugin` | .java | `tree-sitter-java` | âœ… å®Œå…¨å¯¾å¿œ |
| JavaScript | `JavaScriptPlugin` | .js, .jsx | `tree-sitter-javascript` | âœ… å®Œå…¨å¯¾å¿œ |
| TypeScript | `TypeScriptPlugin` | .ts, .tsx | `tree-sitter-typescript` | âœ… å®Œå…¨å¯¾å¿œ |
| C | `CPlugin` | .c, .h | `tree-sitter-c` | âœ… å®Œå…¨å¯¾å¿œ |
| C++ | `CppPlugin` | .cpp, .hpp | `tree-sitter-cpp` | âœ… å®Œå…¨å¯¾å¿œ |
| Go | `GoPlugin` | .go | `tree-sitter-go` | âœ… å®Œå…¨å¯¾å¿œ |
| Rust | `RustPlugin` | .rs | `tree-sitter-rust` | âœ… å®Œå…¨å¯¾å¿œ |
| C# | `CSharpPlugin` | .cs | `tree-sitter-c-sharp` | âœ… å®Œå…¨å¯¾å¿œ |
| PHP | `PhpPlugin` | .php | `tree-sitter-php` | âœ… å®Œå…¨å¯¾å¿œ |
| Ruby | `RubyPlugin` | .rb | `tree-sitter-ruby` | ğŸš§ è¨ˆç”»ä¸­ |

---

## 9. æ”¹è¨‚å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ | æ‰¿èªè€… |
|-----------|------|---------|--------|
| 1.0 | 2025-11-03 | åˆç‰ˆä½œæˆ | aisheng.yu |
| 1.1 | 2025-01-XX | å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã¨ã®ç…§åˆãƒ»ä¿®æ­£<br>- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ§‹é€ : plugins/ã¨languages/ã®åˆ†é›¢ã‚’åæ˜ <br>- LanguagePlugin: å®Ÿéš›ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©ã«ä¿®æ­£<br>- ElementExtractor: åŸºåº•ã‚¯ãƒ©ã‚¹ã®èª¬æ˜ã‚’è¿½åŠ <br>- Pythonãƒ—ãƒ©ã‚°ã‚¤ãƒ³å®Ÿè£…ä¾‹ã‚’å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã«ä¿®æ­£ | GitHub Copilot |

---

**æœ€çµ‚æ›´æ–°:** 2025-11-03  
**ç®¡ç†è€…:** aisheng.yu  
**é€£çµ¡å…ˆ:** aimasteracc@gmail.com
