# PyLog Project

**PyLog** æ˜¯ä¸€ä¸ªæ—¨åœ¨ä¸º Python ç”Ÿæ€ç³»ç»Ÿå¸¦æ¥ **Apache Log4j 2** çº§åˆ«æ€§èƒ½ä¸ç‰¹æ€§çš„ä¼ä¸šçº§æ—¥å¿—æ¡†æ¶ã€‚

æœ¬é¡¹ç›®åŸºäºæ·±å…¥çš„ [Log4j2 æŠ€æœ¯åˆ†æ](doc/LOG4J2_ANALYSIS.md)ï¼Œè‡´åŠ›äºè§£å†³ Python åŸç”Ÿ logging æ¨¡å—åœ¨é«˜å¹¶å‘ã€å¼‚æ­¥ I/O åŠç»“æ„åŒ–æ—¥å¿—æ–¹é¢çš„çŸ­æ¿ã€‚

**Status**: âœ… **V2.1 Production Ready** (2026-01-07)

## ğŸ“¦ å®‰è£… (Installation)

å¯ä»¥é€šè¿‡ pip å®‰è£…ï¼ˆå‡è®¾å·²å‘å¸ƒåˆ° PyPIï¼‰:

```bash
pip install pylog
```

æˆ–è€…ä»æºç å®‰è£…:

```bash
git clone https://github.com/your-repo/pylog.git
cd pylog
pip install .
```

## ğŸš€ å¿«é€Ÿå¼€å§‹ (Quick Start)

### 1. ç¼–å†™ä»£ç  (`main.py`)

```python
import pylog
from pylog import LogManager, ThreadContext, Marker

def main():
    # åŠ è½½é…ç½®
    LogManager.load_config("pylog_config.yaml")
    
    # è·å– Logger
    logger = pylog.get_logger("my.app")
    
    logger.info("Application started")
    
    # ä½¿ç”¨ ThreadContext (ç±»ä¼¼ MDC)
    with ThreadContext.scope(req_id="12345", user="admin"):
        logger.info("Processing request", action="login")
        
        # ä½¿ç”¨ Marker
        SECURITY = Marker("SECURITY")
        logger.info("Security check passed", marker=SECURITY)
        
        try:
            1 / 0
        except ZeroDivisionError:
            logger.exception("Calculation failed")

    # Lazy Evaluation (ä»…å½“æ—¥å¿—çº§åˆ«å¼€å¯æ—¶æ‰æ‰§è¡Œå‡½æ•°)
    def slow_compute():
        return "Computed Result"
    logger.debug("Lazy result: {}", slow_compute)

    LogManager.shutdown()

if __name__ == "__main__":
    main()
```

### 2. é…ç½®æ–‡ä»¶ (`pylog_config.yaml`)

```yaml
configuration:
  appenders:
    console:
      type: Console
      target: SYSTEM_OUT
      json_layout:
        compact: false
        
    rolling_file:
      type: RollingFileAppender
      file_name: "logs/app.log"
      file_pattern: "logs/app-%d{yyyy-MM-dd}.log.gz"
      policies:
        - type: TimeBasedTriggeringPolicy
          interval: 1
          modulus: 1
      strategy:
        type: DefaultRolloverStrategy
        max_files: 30

  loggers:
    root:
      level: INFO
      appender_refs:
        - ref: console
        - ref: rolling_file
        
    my.app:
      level: DEBUG
      additivity: false
      appender_refs:
        - ref: console
        - ref: rolling_file
```

## ğŸ“š æ–‡æ¡£ç´¢å¼• (Documentation Index)

ä»¥ä¸‹æ–‡æ¡£æ„æˆäº† PyLog é¡¹ç›®çš„ç†è®ºåŸºçŸ³ä¸å·¥ç¨‹è“å›¾ï¼š

| æ–‡æ¡£åç§° | æè¿° | å…³é”®å†…å®¹ |
| :--- | :--- | :--- |
| **[Log4j2 æ·±åº¦æŠ€æœ¯åˆ†ææŠ¥å‘Š](doc/LOG4J2_ANALYSIS.md)** | æŠ€æœ¯å¯¹æ ‡ä¸æ¶æ„å‚è€ƒ | å¼‚æ­¥å†…æ ¸ (Disruptor), æ’ä»¶æ¶æ„, åƒåœ¾å›æ”¶ä¼˜åŒ–, ä¸°å¯Œç”Ÿæ€ |
| **[PyLog V2 å¼€å‘è§„åˆ’ä¸æ”¹è¿›æŒ‡å—](doc/PYLOG_V2_DEVELOPMENT_GUIDE.md)** | ç‰ˆæœ¬è§„åˆ’ä¸çŠ¶æ€ | **V2.0 å·²å‘å¸ƒ**ï¼ŒåŒ…å«å¯é æ€§ä¿®å¤ä¸æ€§èƒ½åŸºå‡† |
| **[PyLog V2.1 æ€§èƒ½ä¼˜åŒ–æŒ‡å—](doc/PYLOG_V2.1_DEVELOPMENT_GUIDE.md)** | æ€§èƒ½ä¸“é¡¹è§„åˆ’ | Batching I/O, Kafka é›†æˆ, Zero-Copy ä¼˜åŒ– |
| **[PyLog API è®¾è®¡è§„æ ¼è¯´æ˜ä¹¦](doc/PYLOG_API_DESIGN.md)** | æ¥å£ä¸é…ç½®è®¾è®¡ | æ ¸å¿ƒ API ç­¾å, YAML é…ç½®ç»“æ„ç¤ºä¾‹, æ’ä»¶æ³¨å†Œæ–¹å¼ |

## âœ¨ æ ¸å¿ƒç‰¹æ€§ (Key Features)

1.  **é«˜æ€§èƒ½**: `AsyncQueueHandler` é…åˆå¯¹è±¡æ± æŠ€æœ¯ï¼Œæœ€å°åŒ–ä¸»çº¿ç¨‹é˜»å¡ã€‚
2.  **ç°ä»£åŒ–**: åŸç”Ÿæ”¯æŒ `asyncio` (`contextvars`) ä¸ JSON ç»“æ„åŒ–è¾“å‡ºï¼ˆæ”¯æŒè„±æ•ï¼‰ã€‚
3.  **é«˜å¯ç”¨**: æä¾›æ•…éšœè½¬ç§» (Failover) ä¸ æ™ºèƒ½èƒŒå‹ (Backpressure) ä¿æŠ¤ã€‚
4.  **æ˜“æ‰©å±•**: åŸºäºè£…é¥°å™¨çš„æ’ä»¶ç³»ç»Ÿï¼Œè½»æ¾æ‰©å±• Appender ä¸ Filterã€‚

## âš ï¸ å¤šè¿›ç¨‹ç¯å¢ƒæœ€ä½³å®è·µ (Multiprocess Safety)

åœ¨å¤šè¿›ç¨‹ç¯å¢ƒï¼ˆå¦‚ Gunicorn, uWSGIï¼‰ä¸­ï¼Œå¤šä¸ª Worker è¿›ç¨‹åŒæ—¶å†™å…¥åŒä¸€ä¸ªæ»šåŠ¨æ–‡ä»¶ï¼ˆ`RollingFileAppender`ï¼‰ææ˜“å¼•å‘æ–‡ä»¶é”ç«äº‰æˆ–æ—¥å¿—äº¤é”™ã€‚

**å¼ºçƒˆå»ºè®®**:
ä½¿ç”¨ `SocketAppender` å°†æ—¥å¿—å‘é€è‡³ä¸­å¿ƒèšåˆ Agentï¼ˆå¦‚ Fluentd, Logstash æˆ– ç‹¬ç«‹çš„ PyLog æ¥æ”¶è¿›ç¨‹ï¼‰ï¼Œé¿å… Worker ç›´æ¥å†™æ–‡ä»¶ã€‚

```yaml
appenders:
  socket:
    type: SocketAppender
    host: "localhost"
    port: 9000
```

## ğŸ“… ç‰ˆæœ¬è®¡åˆ’ (Roadmap)

- **V2.0 (Current)**: ç”Ÿäº§å°±ç»ªã€‚åŒ…å«å®Œæ•´çš„å¯é æ€§ä¿®å¤ï¼ˆæ–‡ä»¶æ¸…ç†ã€èƒŒå‹ä¿æŠ¤ã€é…ç½®å¥å£®æ€§ï¼‰ã€‚
- **V2.1 (Planned)**: æ€§èƒ½ä¸“é¡¹ã€‚
    - **I/O Batching**: å¼•å…¥ `BufferingAppender` å‡å°‘ç³»ç»Ÿè°ƒç”¨ã€‚
    - **Kafka Integration**: åŸºäº `confluent-kafka` çš„é«˜æ€§èƒ½æŠ•é€’ã€‚
    - **Zero-Copy**: ä¼˜åŒ– JSON åºåˆ—åŒ–ä¸å­—ç¬¦ä¸²æ‹¼æ¥ã€‚

---
*Generated by PyLog Team*
