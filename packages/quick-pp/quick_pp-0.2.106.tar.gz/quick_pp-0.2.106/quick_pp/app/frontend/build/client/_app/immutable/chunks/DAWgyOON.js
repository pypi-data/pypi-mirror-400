import{a5 as c,a6 as u,a7 as m}from"./tJ-1PvYF.js";const P="http://localhost:6312",l=c([]);async function b(){try{const t=await fetch(`${P}/quick_pp/database/projects`);if(!t.ok){l.set([]);return}const e=await t.json();l.set(Array.isArray(e)?e:[])}catch(t){console.error("loadProjects error",t),l.set([])}}function N(t){l.update(e=>{const n=e.findIndex(a=>String(a.project_id)===String(t.project_id));if(n===-1)return[t,...e];const r=[...e];return r[n]={...r[n],...t},r})}const S=c(new Map);function g(t,e){return`${t}-${e}`}function A(t,e){return m(S).get(g(t,e))}function F(t,e,n){S.update(r=>(r.set(g(t,e),{data:n,timestamp:Date.now()}),r))}const s=c(new Map);function k(t,e){return m(s).get(`${t}-${e}`)}function x(t,e,n){s.update(r=>(r.set(`${t}-${e}`,{data:n,timestamp:Date.now()}),r))}function z(t,e){t&&e?s.update(n=>(n.delete(`${t}-${e}`),n)):s.set(new Map)}const i=c({title:"QPP - Petrophysical Analysis",subtitle:void 0,project:null,depthFilter:{enabled:!1,minDepth:null,maxDepth:null},zoneFilter:{enabled:!1,zones:[]}}),$=u(i,t=>t.depthFilter),w=u(i,t=>t.zoneFilter);u(i,t=>t.project);u(i,t=>({title:t.title,subtitle:t.subtitle}));function C(t,e){i.update(n=>({...n,title:t,subtitle:e}))}function O(t,e){i.update(n=>{const r=n.subtitle??"",a=e??"";return n.title===t&&r===a?n:{...n,title:t,subtitle:e}})}function h(t){i.update(e=>{const n=e.project&&e.project.project_id!=null?String(e.project.project_id):null,r=t&&t.project_id!=null?String(t.project_id):null,a=e.project&&e.project.name?e.project.name:null;let o=null;if(t&&t.name)o=t.name;else if(t&&t.project_id)try{const d=(m(l)||[]).find(y=>String(y.project_id)===String(t.project_id));d&&d.name&&(o=d.name)}catch{}const f=o;if(n===r&&a===f)return e;const p=t?{...t,...f?{name:f}:{}}:null;return{...e,project:p,title:p?p.name??"QPP - Petrophysical Analysis":"QPP - Petrophysical Analysis"}})}async function I(t){if(!t||!t.project_id){h(null);return}h(t);const e="http://localhost:6312";try{const n=await fetch(`${e}/quick_pp/database/projects/${t.project_id}/wells`);if(n.ok){const a=(await n.json()).wells||[];i.update(o=>o.project&&String(o.project.project_id)===String(t.project_id)?{...o,project:{...o.project,wells:a}}:o)}}catch(n){console.error("Failed to load wells for project",t.project_id,n)}}function T(t){i.update(e=>({...e,selectedWell:t}))}function Z(t,e,n){i.update(r=>{const a={enabled:t,minDepth:e??null,maxDepth:n??null};return JSON.stringify(r.depthFilter)===JSON.stringify(a)?r:{...r,depthFilter:a}})}function v(){i.update(t=>({...t,depthFilter:{enabled:!1,minDepth:null,maxDepth:null}}))}function W(t,e){i.update(n=>{const r={enabled:t,zones:e&&Array.isArray(e)?e.map(a=>String(a)):[]};return JSON.stringify(n.zoneFilter)===JSON.stringify(r)?n:{...n,zoneFilter:r}})}function E(){i.update(t=>({...t,zoneFilter:{enabled:!1,zones:[]}}))}function J(t,e){return!e?.enabled||!e.minDepth&&!e.maxDepth?t:t.filter(n=>{const r=Number(n.depth??n.DEPTH??n.Depth??NaN);return!(isNaN(r)||e.minDepth!==null&&r<e.minDepth||e.maxDepth!==null&&r>e.maxDepth)})}function D(t){if(!t||typeof t!="object")return null;const e=["name","zone","Zone","ZONE","formation","formation_name","formationName","FORMATION","formation_top","formationTop"];for(const n of e)if(n in t&&t[n]!==null&&t[n]!==void 0&&String(t[n]).trim()!=="")return String(t[n]);for(const n of Object.keys(t))if(/zone|formation/i.test(n)&&t[n]!==null&&t[n]!==void 0&&String(t[n]).trim()!=="")return String(t[n]);return null}function M(t,e){if(!e?.enabled||!e.zones||e.zones.length===0)return t;const n=new Set(e.zones.map(r=>String(r)));return t.filter(r=>{const a=D(r);return a===null?!1:n.has(a)})}export{C as a,T as b,F as c,$ as d,O as e,M as f,A as g,J as h,k as i,x as j,z as k,b as l,Z as m,v as n,W as o,l as p,E as q,I as s,N as u,i as w,w as z};
