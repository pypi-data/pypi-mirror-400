{% load djadmin_tags %}

{% if object_details|is_lazy_fragment %}
  {% if object_details.is_disabled_warning %}
    {# LazyFragment instantiated but DJADMIN_LAZY_LOADING_ENABLED=False - show warning #}
    <div class="card mb-5">
      <div class="card-header">{{ object_details.panel_name }}</div>
      <div class="card-body">
        <div class="alert alert-warning mb-0">
          <strong>Lazy loading disabled:</strong> Panel "{{ object_details.panel_name }}" (key: {{ object_details.lazy_key }})
          was set up for lazy loading but DJADMIN_LAZY_LOADING_ENABLED=False.
          The code is directly instantiating LazyFragment instead of using table_for()/details_table_for().
        </div>
      </div>
    </div>
  {% else %}
    {# Render lazy loading placeholder with persistent outer wrapper #}
    {% get_lazy_url object object_details as lazy_url %}
    <div data-controller="lazy-panel"
         data-lazy-panel-url-value="{{ lazy_url }}">
      <div data-lazy-panel-target="content">
        <div class="card mb-5">
          <div class="card-header">{{ object_details.panel_name }}</div>
          <div class="card-body text-center py-5" data-lazy-panel-target="body">
            <div data-lazy-panel-target="spinner">
              <div class="spinner-border text-secondary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <p class="mt-2 text-muted mb-0">{{ object_details.placeholder }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
{% else %}
  <div class="card mb-5">
    <div class="card-header">
      {% if object_details.panel_name %}
        {{ object_details.panel_name }}
      {% elif object_details.obj and not object_details.is_empty %}
        {% get_obj_classname object_details.obj %}: {{ object_details.obj|try_auto_link:"detail" }}
      {% endif %}
    </div>
    {% if object_details.is_empty %}
      <div class="card-body text-center text-muted py-4">
        <p class="mb-0">{{ object_details.empty_message|default:"No data available" }}</p>
      </div>
    {% elif object_details.obj %}
      <table class="table table-borderless mb-0 table-striped">
        {% for obj_detail in object_details.obj_details %}
          <tr>
            <th>
              {{ obj_detail.display_name }}
              {% if obj_detail.help_text %}<div class="ms-2 mt-1 text-muted fst-italic">{{ obj_detail.help_text }}</div>{% endif %}
            </th>
            <td>
              {% is_file_field obj_detail.value_out as field_is_file %}
              {% is_model_field obj_detail.value_out as field_is_obj_model %}
              {% if field_is_file %}
                {% if obj_detail.value_out %}
                  <a href="{{ obj_detail.value_out.url }}">{{ obj_detail.value_out }}</a>
                {% else %}
                  -
                {% endif %}
              {% elif field_is_obj_model %}
                <a href="{% get_obj_detail_url obj_detail.value_out %}">{{ obj_detail.value_out }}</a>
              {% elif obj_detail.value_out|is_dict %}
                <pre><code>{{ obj_detail.value_out|jsonify|safe }}</code></pre>
              {% else %}
                {{ obj_detail.value_out }}
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </table>
    {% else %}
      <div class="card-body text-center text-muted py-4">
        <p class="mb-0">{{ object_details.empty_message|default:"No data available" }}</p>
      </div>
    {% endif %}
  </div>
{% endif %}
