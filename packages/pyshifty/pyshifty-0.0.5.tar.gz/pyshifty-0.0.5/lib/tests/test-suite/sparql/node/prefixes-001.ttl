@prefix ex: <http://datashapes.org/sh/tests/sparql/node/prefixes-001.test#> .
@prefix mf: <http://www.w3.org/2001/sw/DataAccess/tests/test-manifest#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix sht: <http://www.w3.org/ns/shacl-test#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

<http://datashapes.org/sh/tests/sparql/node/prefixes-001.test> sh:declare [ a sh:PrefixDeclaration ;
            sh:namespace "http://datashapes.org/sh/tests/sparql/node/prefixes-001.test#"^^xsd:anyURI ;
            sh:prefix "ex" ] .

ex:TestPrefixes owl:imports <http://datashapes.org/sh/tests/sparql/node/prefixes-001.test> ;
    sh:declare [ sh:namespace "http://test.com/ns#"^^xsd:anyURI ;
            sh:prefix "test" ] .

ex:TestShape a sh:NodeShape ;
    sh:sparql ex:TestSPARQL ;
    sh:targetNode ex:InvalidResource1,
        ex:ValidResource1 .

<urn:prefixes-001> a sht:Validate ;
    rdfs:label "Test of sh:prefixes 001" ;
    mf:action [ sht:dataGraph <urn:prefixes-001.ttl> ;
            sht:shapesGraph <urn:prefixes-001.ttl> ] ;
    mf:result [ a sh:ValidationReport ;
            sh:conforms false ;
            sh:result [ a sh:ValidationResult ;
                    sh:focusNode ex:InvalidResource1 ;
                    sh:resultSeverity sh:Violation ;
                    sh:sourceConstraint ex:TestSPARQL ;
                    sh:sourceConstraintComponent sh:SPARQLConstraintComponent ;
                    sh:sourceShape ex:TestShape ;
                    sh:value <http://test.com/ns#Value> ] ] ;
    mf:status sht:approved .

ex:InvalidResource1 ex:property <http://test.com/ns#Value> .

ex:TestSPARQL sh:prefixes ex:TestPrefixes ;
    sh:select """
		SELECT $this ?value
		WHERE {
			$this ex:property ?value .
            FILTER (?value = test:Value) .
		} """ .

<urn:prefixes-001.ttl> a mf:Manifest ;
    mf:entries ( <urn:prefixes-001> ) .

