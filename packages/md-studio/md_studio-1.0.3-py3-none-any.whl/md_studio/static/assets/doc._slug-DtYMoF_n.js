import{r as a,j as e}from"./jsx-runtime-BiXka7E7.js";import{u as b,w as N}from"./index-BwWm0JV9.js";import{M as y}from"./MarkdownPreview-CMAtWhhj.js";import{T as v,A as P}from"./AttachmentGallery-rQjnqjTm.js";import{B as E}from"./Breadcrumb-UgS0yS-w.js";import{c as A,a as B,f as m}from"./date-utils-CPa5qVN4.js";import{N as S}from"./not-found-page-FnOw7Rim.js";import{v as D}from"./components-CZmywKMH.js";import"./loader-circle-BRNhzI2j.js";import"./index-CkllyZqd.js";function F(o,i){const t=new Set;let r;for(;(r=i.exec(o))!==null;)t.add(r[1]);return Array.from(t)}const G=()=>[{title:"Document | md-studio"}];function H(){const{slug:o}=D(),{dashboardPath:i}=b(),[t,r]=a.useState(null),[p,n]=a.useState(!0),[l,d]=a.useState(null),[f,c]=a.useState(!1),u=typeof window<"u"?window.location.origin:"";if(a.useEffect(()=>{if(!o)return;n(!0),c(!1);const w=typeof window<"u"?window.ENV?.BASE_PATH??"":"";fetch(N(`/api/get?slug=${encodeURIComponent(o)}`,w)).then(async s=>{if(s.status===404)return c(!0),n(!1),null;if(!s.ok)throw new Error(`Failed to load document (${s.status})`);return s.json()}).then(s=>{s&&(s?.doc?r(s.doc):d("Document not found"),n(!1))}).catch(s=>{console.error("Failed to load document:",s),d("Failed to load document"),n(!1)})},[o]),p)return e.jsx("div",{className:"p-8",children:"Loading..."});if(f)return e.jsx(S,{});if(l||!t)return e.jsx("div",{className:"p-8 text-red-500",children:l||"Document not found"});const x=/!\[([^\]]*)\]\((uploads\/[^)]+)\)/g,h=F(t.bodyMd||"",x),g=A(t.bodyMd||""),j=B(t.bodyMd||"");return e.jsxs("main",{className:"flex flex-col gap-6",children:[e.jsx(E,{items:[{label:t.title}],dashboardPath:i}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("h1",{className:"text-4xl font-bold tracking-tight",children:t.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Created ",m(t.createdAt)]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Updated ",m(t.updatedAt)]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[g.toLocaleString()," words"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[j," min read"]})]})]}),e.jsx("div",{children:e.jsx(v,{doc:t,shareBaseUrl:u,allowEdit:!0,showVisibilityToggle:!0})}),e.jsx("div",{className:"max-w-4xl",children:e.jsx("article",{className:"prose prose-neutral dark:prose-invert prose-headings:scroll-mt-20 prose-p:leading-7 prose-pre:bg-transparent prose-pre:p-0",children:e.jsx(y,{content:t.bodyMd||""})})}),e.jsx(P,{images:h,shareBaseUrl:u})]})}export{H as default,G as meta};
