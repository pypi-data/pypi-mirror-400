Metadata-Version: 2.3
Name: objectstore-client
Version: 0.0.15
Summary: Client SDK for Objectstore, the Sentry object storage platform
Author: Sentry
Author-email: Sentry <oss@sentry.io>
License: # Functional Source License, Version 1.1, Apache 2.0 Future License
         
         ## Abbreviation
         
         FSL-1.1-Apache-2.0
         
         ## Notice
         
         Copyright 2018-2024 Functional Software, Inc. dba Sentry
         
         ## Terms and Conditions
         
         ### Licensor ("We")
         
         The party offering the Software under these Terms and Conditions.
         
         ### The Software
         
         The "Software" is each version of the software that we make available under
         these Terms and Conditions, as indicated by our inclusion of these Terms and
         Conditions with the Software.
         
         ### License Grant
         
         Subject to your compliance with this License Grant and the Patents,
         Redistribution and Trademark clauses below, we hereby grant you the right to
         use, copy, modify, create derivative works, publicly perform, publicly display
         and redistribute the Software for any Permitted Purpose identified below.
         
         ### Permitted Purpose
         
         A Permitted Purpose is any purpose other than a Competing Use. A Competing Use
         means making the Software available to others in a commercial product or
         service that:
         
         1. substitutes for the Software;
         
         2. substitutes for any other product or service we offer using the Software
            that exists as of the date we make the Software available; or
         
         3. offers the same or substantially similar functionality as the Software.
         
         Permitted Purposes specifically include using the Software:
         
         1. for your internal use and access;
         
         2. for non-commercial education;
         
         3. for non-commercial research; and
         
         4. in connection with professional services that you provide to a licensee
            using the Software in accordance with these Terms and Conditions.
         
         ### Patents
         
         To the extent your use for a Permitted Purpose would necessarily infringe our
         patents, the license grant above includes a license under our patents. If you
         make a claim against any party that the Software infringes or contributes to
         the infringement of any patent, then your patent license to the Software ends
         immediately.
         
         ### Redistribution
         
         The Terms and Conditions apply to all copies, modifications and derivatives of
         the Software.
         
         If you redistribute any copies, modifications or derivatives of the Software,
         you must include a copy of or a link to these Terms and Conditions and not
         remove any copyright notices provided in or with the Software.
         
         ### Disclaimer
         
         THE SOFTWARE IS PROVIDED "AS IS" AND WITHOUT WARRANTIES OF ANY KIND, EXPRESS OR
         IMPLIED, INCLUDING WITHOUT LIMITATION WARRANTIES OF FITNESS FOR A PARTICULAR
         PURPOSE, MERCHANTABILITY, TITLE OR NON-INFRINGEMENT.
         
         IN NO EVENT WILL WE HAVE ANY LIABILITY TO YOU ARISING OUT OF OR RELATED TO THE
         SOFTWARE, INCLUDING INDIRECT, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES,
         EVEN IF WE HAVE BEEN INFORMED OF THEIR POSSIBILITY IN ADVANCE.
         
         ### Trademarks
         
         Except for displaying the License Details and identifying us as the origin of
         the Software, you have no right under these Terms and Conditions to use our
         trademarks, trade names, service marks or product names.
         
         ## Grant of Future License
         
         We hereby irrevocably grant you an additional license to use the Software under
         the Apache License, Version 2.0 that is effective on the second anniversary of
         the date we make the Software available. On or after that date, you may use the
         Software under the Apache License, Version 2.0, in which case the following
         will apply:
         
         Licensed under the Apache License, Version 2.0 (the "License"); you may not use
         this file except in compliance with the License.
         
         You may obtain a copy of the License at
         
         http://www.apache.org/licenses/LICENSE-2.0
         
         Unless required by applicable law or agreed to in writing, software distributed
         under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
         CONDITIONS OF ANY KIND, either express or implied. See the License for the
         specific language governing permissions and limitations under the License.
Requires-Dist: sentry-sdk>=2.42.1
Requires-Dist: urllib3>=2.2.2
Requires-Dist: zstandard>=0.18.0
Requires-Dist: filetype>=1.2.0
Requires-Dist: pyjwt[crypto]>=2.10.1
Requires-Python: >=3.11
Description-Content-Type: text/markdown

# Objectstore Client

The client is used to interface with the objectstore backend. It handles
responsibilities like transparent compression, and making sure that uploads and
downloads are done as efficiently as possible.

## Usage

```python
import datetime

import urllib3

from objectstore_client import (
    Client,
    NoOpMetricsBackend,
    Permission,
    TimeToIdle,
    TimeToLive,
    TokenGenerator,
    Usecase,
)

# Necessary when using Objectstore instances that enforce authorization checks.
token_generator = TokenGenerator(
    "my-key-id",
    "<securely inject EdDSA private key>",
    expiry_seconds=60,
    permissions=Permission.max(),
)

# This should be stored in a global variable and reused, in order to reuse the connection
client = Client(
    "http://localhost:8888",
    # Optionally, bring your own metrics backend to record things like latency, throughput, and payload sizes
    metrics_backend=NoOpMetricsBackend(),
    # Optionally, enable distributed traces in Sentry
    propagate_traces=True,
    # Optionally, set timeout and retries
    timeout_ms=500, # 500ms timeout for requests
    retries=3,      # Number of connection retries
    # For further customization, provide additional kwargs for urllib3.HTTPConnectionPool
    connection_kwargs={"maxsize": 10},
    # Optionally, provide a token generator for Objectstore instances with authorization enforced
    token_generator=token_generator,
)

# This could also be stored in a global/shared variable, as you will deal with a fixed number of usecases with statically defined defaults
my_usecase = Usecase(
    "my-usecase",
    # Optionally, define defaults for all operations within this Usecase
    expiration_policy=TimeToLive(datetime.timedelta(days=1)),
)

# Start a Session, tied to your Usecase and a Scope.
# A Scope is a (possibly nested) namespace within Objectstore that provides isolation within a Usecase.
# The Scope is given as a sequence of key-value pairs through kwargs.
# Note that order matters!
# The admitted characters for keys and values are: `A-Za-z0-9_-()$!+*'`.
# You're encouraged to use the organization and project ID as the first components of the scope, as follows:
session = client.session(
    my_usecase, org=42, project=1337, app_slug="email_app"
)

# The following operations will raise an exception on failure

# Write an object and metadata
object_key = session.put(
    b"Hello, world!",
    # You can pass in your own key for the object to decide where to store the file.
    # Otherwise, Objectstore will pick a key and return it.
    # A put request to an existing key overwrites the contents and metadata.
    # key="hello",
    metadata={"key": "value"},
    # Overrides the default defined at the Usecase level
    expiration_policy=TimeToIdle(datetime.timedelta(days=30)),
)

# Read an object and its metadata
result = session.get(object_key)

content = result.payload.read()
assert content == b"Hello, world!"
assert result.metadata.custom["key"] == "value"

# Delete an object
session.delete(object_key)
```

## Development

### Environment Setup

The considerations for setting up the development environment that can be found in the main [README](../README.md) apply for this package as well.

### Pre-commit hook

A configuration to set up a git pre-commit hook using [pre-commit](https://github.com/pre-commit/pre-commit) is available at the root of the repository.

To install it, run
```sh
pre-commit install
```

The hook will automatically run some checks before every commit, including the linters and formatters we run in CI.
