[project]
name = "celery-redis-plus"
version = "0.2.2"
description = "Enhanced Kombu Redis transport for Celery"
readme = "README.md"
license = "MIT"
requires-python = ">=3.13"
keywords = ["celery", "redis", "message-queue", "priority-queue", "kombu"]
classifiers = [
  "Development Status :: 3 - Alpha",
  "License :: OSI Approved :: MIT License",
  "Operating System :: OS Independent",
  "Programming Language :: Python :: 3",
  "Programming Language :: Python :: 3.13",
  "Topic :: System :: Distributed Computing",
]
dependencies = ["celery>=5.5.0", "kombu>=5.5.0", "redis>=7.1.0"]

[project.entry-points."kombu.transport"]
"redis+celery-redis-plus" = "celery_redis_plus.transport:Transport"

[dependency-groups]
dev = [
  "celery-types==0.24.0",
  "pre-commit==4.5.1",
  "pytest==9.0.2",
  "pytest-cov==7.0.0",
  "pytest-xdist>=3.8.0",
  "ruff==0.14.10",
  "testcontainers[redis]==4.13.3",
  "ty==0.0.8",
]

[build-system]
requires = ["hatchling>=1.27.0"]
build-backend = "hatchling.build"

[tool.ruff]
line-length = 120
target-version = "py313"

[tool.ruff.lint]
dummy-variable-rgx = "^(_+|(_+[a-zA-Z0-9_]*[a-zA-Z0-9]+?))$"
explicit-preview-rules = true
fixable = ["ALL"]
ignore = [
  "ANN401",  # Any needed for untyped Celery/Kombu APIs
  "ARG001",  # Signal handlers and overrides have required signatures
  "ARG002",
  "C901",    # Some functions are inherently complex
  "COM812",  # Conflicts with ruff-format
  "D",       # Docstring rules are too extensive
  "E5",      # 120 char limit is sufficient
  "EM101",   # Extracting exception messages to variables hurts readability
  "EM102",
  "FBT001",  # Boolean traps - too many violations, breaks compatibility
  "FBT002",
  "N802",    # Naming follows kombu conventions
  "N806",
  "PLC0415", # Lazy imports for optional dependencies
  "PLR1704", # Redefining argument in context manager
  "PYI024",  # namedtuple usage follows kombu patterns
  "RUF005",  # Tuple concatenation is clearer
  "RUF015",  # Readability over micro-optimization
  "RUF059",  # Keep unused variables explicit
  "SLF001",  # Private member access needed for kombu/redis-py internals
  "TRY003",  # Long exception messages are fine
]
preview = true
select = ["ALL"]
unfixable = []

[tool.ruff.lint.per-file-ignores]
"tests/**" = [
  "PLR0913", # Too many arguments in test fixtures
  "PLR2004", # Magic values in tests are fine
  "S101",    # assert in tests
]

[tool.pytest.ini_options]
testpaths = ["tests"]
markers = [
  "unit: marks tests as unit tests",
  "integration: marks tests as integration tests",
]

[tool.coverage.run]
concurrency = ["thread"]
branch = true
source = ["celery_redis_plus"]
omit = ["*/__init__.py"]

[tool.coverage.report]
exclude_lines = [
  "pragma: no cover",
  "if TYPE_CHECKING:",
  "raise NotImplementedError",
]
