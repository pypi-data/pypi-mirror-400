import{r as l,j as s,t as M,L as Ee,C as Be,e as ot,D as rt}from"./vendor-tanstack-BVzzyDEt.js";import{Q as Ye,R as lt,T as it,U as De,V as ct,X as ut,Y as dt,Z as mt,_ as ft,$ as gt,a0 as ht,a1 as Me,a2 as re,a3 as q,a4 as pt,w as te,O as Ge,q as le,I as U,r as xt,s as wt,t as St,v as se,a5 as vt,a6 as kt,a7 as yt,a8 as Ct,a9 as Ft,aa as jt,ab as Rt,ac as Dt,ad as Tt,ae as bt,af as _t,ag as Nt,ah as Et,ai as Mt,aj as At,ak as Pt,al as It,am as Lt,an as zt,ao as Ot,ap as Ut,aq as Ht,ar as Vt,j as O,as as Wt,at as Qt,au as $t,av as Ae,aw as Pe,G as Bt,K as Yt,A as Gt,P as Ie,E as Xt,m as qt,n as Kt,o as Zt,p as Jt,D as es,ax as Xe,ay as F,az as Le,aA as ze,aB as ts,aC as Oe,aD as ss,aE as as,aF as ns,aG as os,aH as rs,aI as ls}from"./index-BJkJ93Lr.js";import{D as is,W as cs}from"./work-pool-filter-Bskacgmh.js";import{S as us}from"./sort-filter-DGicLGS-.js";import{S as ds,F as ms,a as fs}from"./flow-runs-pagination-b0pvBxt9.js";import{u as gs,F as hs}from"./use-flow-runs-selected-rows-DLxgsii4.js";import{D as qe}from"./delete-confirmation-dialog-Baib9xiM.js";import{R as ps,S as xs,X as ws,Y as Ss,T as vs,d as ks}from"./vendor-recharts-Mwm2qLZp.js";import{c as ys}from"./vendor-date-2jFo9aCm.js";import{T as Cs,a as Fs,b as js}from"./task-runs-pagination-CnInzUKN.js";import{u as Rs}from"./use-delete-confirmation-dialog-DDTCxOIv.js";import{d as Ds,b as Ke,c as _,f as ae,n as ne,g as Ts}from"./vendor-forms-BN3tpxM2.js";import{u as ie}from"./use-local-storage-BIDUVcfc.js";import"./vendor-react-Bce9NwRC.js";import"./vendor-radix-CTAic6HB.js";const bs=({value:e,onValueChange:t,className:n})=>{const a=l.useMemo(()=>Ye(e),[e]),o=i=>{t(it(i))};return s.jsx(lt,{value:a,onValueChange:o,placeholder:"All time",clearable:!0,className:n})},Ue=2,_s=({selectedFlows:e,onSelectFlows:t})=>{const[n,a]=l.useState(""),o=l.useDeferredValue(n),{data:i=[]}=M(De({flows:o?{operator:"and_",name:{like_:o}}:void 0,limit:100,offset:0,sort:"NAME_ASC"})),{data:r=[]}=M(De({flows:e.size>0?{operator:"and_",id:{any_:Array.from(e)}}:void 0,limit:e.size||1,offset:0,sort:"NAME_ASC"},{enabled:e.size>0})),u=m=>{const h=new Set(e);e.has(m)?h.delete(m):h.add(m),t(h)},c=()=>{t(new Set)},d=()=>{if(e.size===0)return"All flows";const m=r.filter(S=>e.has(S.id)).map(S=>S.name),h=m.slice(0,Ue),x=m.length-Ue;return s.jsxs("div",{className:"flex flex-1 min-w-0 items-center gap-2",children:[s.jsx("div",{className:"flex flex-1 min-w-0 items-center gap-2 overflow-hidden",children:s.jsx("span",{className:"truncate",children:h.join(", ")})}),x>0&&s.jsxs(q,{variant:"bodySmall",className:"shrink-0",children:["+ ",x]})]})},f=l.useMemo(()=>i.filter(m=>!o||m.name.toLowerCase().includes(o.toLowerCase())),[i,o]);return s.jsxs(ct,{children:[s.jsx(ut,{"aria-label":"Filter by flow",selected:e.size===0,children:d()}),s.jsxs(dt,{children:[s.jsx(mt,{value:n,onValueChange:a,placeholder:"Search flows..."}),s.jsxs(ft,{children:[s.jsx(gt,{children:"No flows found"}),s.jsxs(ht,{children:[s.jsxs(Me,{"aria-label":"All flows",onSelect:c,closeOnSelect:!1,value:"__all__",children:[s.jsx(re,{checked:e.size===0}),"All flows"]}),f.map(m=>s.jsxs(Me,{"aria-label":m.name,onSelect:()=>u(m.id),closeOnSelect:!1,value:m.id,children:[s.jsx(re,{checked:e.has(m.id)}),m.name]},m.id))]})]})]})]})},Ns=()=>{const[e,t]=Rs(),{mutateAsync:n}=pt(),a=async(i,r=()=>{})=>{try{const u=await Promise.allSettled(i.map(f=>n({id:f}))),{numFails:c,numSuccess:d}=u.reduce((f,m)=>(m.status==="rejected"?f.numFails+=1:f.numSuccess+=1,f),{numFails:0,numSuccess:0});c>1?te.error(`${c} task runs failed to delete`):c===1?te.error("Task run failed to delete"):d>1?te.success(`${d} task runs deleted`):te.success("Task run deleted")}catch(u){console.error("Unknown error while deleting task run.",u)}finally{r()}};return[e,(i,r=()=>{})=>t({title:"Delete Task Runs",description:"Are you sure you want to delete selected task runs?",onConfirm:()=>{a(i,r)}})]},Es=({count:e=0,...t})=>"results"in t&&"setSelectedRows"in t&&"selectedRows"in t?s.jsx(Ms,{count:e,...t}):s.jsxs(q,{variant:"bodySmall",className:"text-muted-foreground",children:[e," ",Ge(e,"Task run")]});function Ms({count:e=0,results:t=[],setSelectedRows:n,selectedRows:a}){const[o,i]=Ns(),r=l.useMemo(()=>t.map(({id:d})=>d),[t]),u=Array.from(a),c=()=>{const d=r.every(h=>a.has(h)),f=r.some(h=>a.has(h));let m=!1;return d?m=!0:f&&(m="indeterminate"),s.jsx(re,{className:"block",checked:m,onCheckedChange:h=>{n(h?new Set(r):new Set)},"aria-label":"Toggle all"})};return a.size>0?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(c,{}),s.jsxs(q,{variant:"bodySmall",className:"text-muted-foreground",children:[u.length," selected"]}),s.jsx(le,{"aria-label":"Delete rows",size:"icon",variant:"secondary",onClick:()=>{i(u,()=>n(new Set))},children:s.jsx(U,{id:"Trash2",className:"size-4"})})]}),s.jsx(qe,{...o})]}):s.jsxs("div",{className:"flex items-center gap-2",children:[t&&n&&a&&s.jsx(re,{className:"block",checked:!1,onCheckedChange:d=>{n(new Set(d?r:void 0))},"aria-label":"Toggle all"}),s.jsxs(q,{variant:"bodySmall",className:"text-muted-foreground",children:[e," ",Ge(e,"Task run")]})]})}const As=e=>{const[t,n]=l.useState(new Set(e)),a=c=>n(d=>new Set(d).add(c)),o=c=>n(d=>{const f=new Set(d);return f.delete(c),f});return[t,n,{addRow:a,removeRow:o,onSelectRow:(c,d)=>{d?a(c):o(c)},clearSet:()=>n(new Set)}]},Ze="Custom",Ps="Unsaved";function Is(e){return e?e.name===Ze||e.name===Ps:!0}const Ls=({currentFilter:e,savedFilters:t,onSelect:n,onSave:a,onDelete:o,onSetDefault:i,onRemoveDefault:r,permissions:u={canSave:!0,canDelete:!0}})=>{const[c,d]=l.useState(!1),f=e?.name??Ze,m=Is(e),h=m&&u.canSave,x=e?.id&&u.canDelete,S=!m,y=()=>{e?.id&&(o(e.id),d(!1))},g=()=>{e?.id&&(e.isDefault?r(e.id):i(e.id))};return s.jsxs(s.Fragment,{children:[s.jsxs(xt,{children:[s.jsx(wt,{asChild:!0,children:s.jsxs(le,{variant:"outline",className:"gap-2",children:[s.jsx(U,{id:"SlidersVertical",className:"size-4"}),s.jsx("span",{children:f}),s.jsx(U,{id:"ChevronDown",className:"size-4"})]})}),s.jsxs(St,{align:"start",className:"min-w-[200px]",children:[t.map(p=>s.jsxs(se,{onClick:()=>n(p),className:"flex items-center justify-between",children:[s.jsx("span",{children:p.name}),p.isDefault&&s.jsx(U,{id:"CircleCheck",className:"size-4 text-green-500"})]},p.id??p.name)),(h||x||S)&&s.jsx(vt,{}),h&&s.jsxs(se,{onClick:a,children:[s.jsx(U,{id:"Plus",className:"mr-2 size-4"}),"Save current filters"]}),x&&s.jsxs(se,{variant:"destructive",onClick:()=>d(!0),children:[s.jsx(U,{id:"Trash2",className:"mr-2 size-4"}),"Delete"]}),S&&s.jsxs(se,{onClick:g,children:[s.jsx(U,{id:"CircleCheck",className:"mr-2 size-4"}),e?.isDefault?"Remove as default":"Set as default"]})]})]}),s.jsx(qe,{isOpen:c,title:"Delete saved filter",description:`Are you sure you want to delete "${e?.name}"? This action cannot be undone.`,onConfirm:y,onClose:()=>d(!1)})]})},zs={COMPLETED:"#16a34a",FAILED:"#dc2626",RUNNING:"#1d4ed8",CANCELLED:"#6b7280",CANCELLING:"#4b5563",CRASHED:"#ea580c",PAUSED:"#6b7280",PENDING:"#9ca3af",SCHEDULED:"#facc15"},Os=({cx:e,cy:t,payload:n})=>{if(e===void 0||t===void 0||!n)return null;const a=zs[n.stateType]||"#6b7280";return s.jsx("circle",{cx:e,cy:t,r:6,fill:a,stroke:a,strokeWidth:1,opacity:.7,className:"hover:opacity-100 transition-opacity cursor-pointer"})},Us=({active:e,payload:t})=>{const a=t?.[0]?.payload,o=a?.id,{data:i}=M({...kt(o??""),enabled:e&&!!o,staleTime:300*1e3}),{data:r}=M({...yt(i?.flow_id??""),enabled:!!i?.flow_id,staleTime:300*1e3});if(!e||!t||t.length===0||!a)return null;const u=new Date(a.timestamp);return s.jsxs("div",{className:"bg-background border rounded-lg p-3 shadow-lg flex flex-col gap-2 min-w-48",children:[s.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[i?.flow_id&&s.jsxs(s.Fragment,{children:[s.jsx(Ee,{to:"/flows/flow/$id",params:{id:i.flow_id},className:"font-semibold hover:underline truncate max-w-32",children:r?.name??"..."}),s.jsx(Ct,{className:"size-3 flex-shrink-0"})]}),s.jsx(Ee,{to:"/runs/flow-run/$id",params:{id:a.id},className:"hover:underline truncate max-w-32",children:i?.name??a.id.slice(0,8)})]}),s.jsx("div",{children:s.jsx(Ft,{type:a.stateType})}),s.jsx("hr",{className:"border-border"}),s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsxs("span",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[s.jsx(Rt,{className:"size-4"}),jt(Math.ceil(a.duration*1e3),{largest:2,round:!0})]}),s.jsxs("span",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[s.jsx(Dt,{className:"size-4"}),u.toLocaleString()]})]})]})},Hs=e=>t=>t===0?"0s":e<1?`${Math.round(t*1e3)}ms`:e<10?`${t.toFixed(1)}s`:e<60?`${Math.round(t)}s`:ys(0,t*1e3,{addSuffix:!1}),Vs=(e,t)=>i=>{const r=new Date(i);if(t<1e3||e<1e4){const u=r.getSeconds(),c=r.getMilliseconds();return`${r.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})}:${u.toString().padStart(2,"0")}.${Math.floor(c/100)}`}return t<6e4||e<10*6e4?r.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit"}):e>=864e5?r.getHours()===0&&r.getMinutes()===0&&r.getSeconds()===0&&r.getMilliseconds()===0?r.toLocaleDateString(void 0,{weekday:"short",day:"numeric"}):r.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}):r.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})},Ws=({history:e,startDate:t,endDate:n})=>{const a=l.useRef(null),[o,i]=l.useState(0);l.useEffect(()=>{const g=a.current;if(!g)return;const p=new ResizeObserver(w=>{for(const k of w)i(k.contentRect.width)});return p.observe(g),i(g.getBoundingClientRect().width),()=>p.disconnect()},[]);const r=l.useMemo(()=>e.map(g=>({x:new Date(g.timestamp).getTime(),y:g.duration,stateType:g.state_type,id:g.id,duration:g.duration,lateness:g.lateness,timestamp:g.timestamp})),[e]),{xDomain:u,xDomainMin:c,xDomainMax:d}=l.useMemo(()=>{if(t&&n)return{xDomain:[t.getTime(),n.getTime()],xDomainMin:t.getTime(),xDomainMax:n.getTime()};if(r.length===0){const k=Date.now(),D=k-1440*60*1e3;return{xDomain:[D,k],xDomainMin:D,xDomainMax:k}}const g=r.map(k=>k.x),p=Math.min(...g),w=Math.max(...g);return{xDomain:[p,w],xDomainMin:p,xDomainMax:w}},[t,n,r]),f=l.useMemo(()=>r.length===0?60:Math.max(...r.map(g=>g.y)),[r]),m=l.useMemo(()=>{if(r.length<2)return Number.POSITIVE_INFINITY;const g=r.map(w=>w.x).sort((w,k)=>w-k);let p=Number.POSITIVE_INFINITY;for(let w=1;w<g.length;w++){const k=g[w]-g[w-1];k>0&&k<p&&(p=k)}return p},[r]),h=d-c,x=l.useMemo(()=>Vs(h,m),[h,m]),S=l.useMemo(()=>Hs(f),[f]),y=l.useMemo(()=>{const w=o-60,k=Math.max(2,Math.ceil(w/100)),D=1440*60*1e3,C=d-c;if(C>=D){const v=[],V=new Date(c),H=new Date(V);H.setHours(24,0,0,0),v.push(c);let P=H.getTime();for(;P<d;)v.push(P),P+=D;const W=v[v.length-1];if(d-W>C/k/2&&v.push(d),v.length<k){const E=[];for(let T=0;T<v.length-1;T++){E.push(v[T]);const I=v[T+1]-v[T],L=Math.max(1,Math.floor(I/(C/k)));if(L>1){const Q=I/L;for(let z=1;z<L;z++)E.push(v[T]+Q*z)}}return E.push(v[v.length-1]),E}return v}const N=[],A=(d-c)/(k-1);for(let v=0;v<k;v++)N.push(c+A*v);return N},[o,c,d]);return e.length===0?null:s.jsx("div",{ref:a,className:"hidden md:block w-full h-64","data-testid":"scatter-plot",children:s.jsx(ps,{width:"100%",height:"100%",children:s.jsxs(xs,{children:[s.jsx(ws,{type:"number",dataKey:"x",scale:"time",domain:u,ticks:y,tickFormatter:x,tick:{fontSize:12},tickLine:!1,axisLine:{stroke:"#e5e7eb"}}),s.jsx(Ss,{type:"number",dataKey:"y",tickFormatter:S,tick:{fontSize:12},tickLine:!1,axisLine:{stroke:"#e5e7eb"},width:60}),s.jsx(vs,{content:s.jsx(Us,{}),cursor:{strokeDasharray:"3 3"},animationDuration:0}),s.jsx(ks,{data:r,shape:s.jsx(Os,{}),isAnimationActive:!1})]})})})},Qs=Ke({name:_().min(1,{message:"Name is required"}).max(100,{message:"Name must be 100 characters or less"})}),$s=({open:e,onOpenChange:t,onSave:n})=>{const a=Ds({resolver:Tt(Qs),defaultValues:{name:""}});l.useEffect(()=>{e&&a.reset({name:""})},[e,a]);const o=i=>{n(i.name),t(!1)};return s.jsx(bt,{open:e,onOpenChange:t,children:s.jsxs(_t,{children:[s.jsx(Nt,{children:s.jsx(Et,{children:"Save Filter"})}),s.jsx(Mt,{children:"Save your current filter configuration for quick access later."}),s.jsx(At,{...a,children:s.jsxs("form",{onSubmit:i=>{a.handleSubmit(o)(i)},className:"space-y-4",children:[s.jsx(Pt,{control:a.control,name:"name",render:({field:i})=>s.jsxs(It,{children:[s.jsx(Lt,{children:"Filter Name"}),s.jsx(zt,{children:s.jsx(Ot,{autoComplete:"off",placeholder:"e.g., Failed runs this week",...i})}),s.jsx(Ut,{})]})}),s.jsxs(Ht,{children:[s.jsx(le,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),s.jsx(le,{type:"submit",children:"Save"})]})]})})]})})},Bs="prefect-ui-v2-saved-filters",Ys="prefect-ui-v2-default-filter-id",Je="system-past-week",et="system-hide-scheduled";function Gs(e){return e===Je||e===et}const tt=[{id:Je,name:"Past week",filters:{range:"past-7-days"}},{id:et,name:"Hide scheduled runs",filters:{range:"past-7-days",state:[...Vt]}}],Xs=tt[0];function qs(){return`${Date.now()}-${Math.random().toString(36).substring(2,9)}`}function Ks(e,t){const n=(a,o)=>{if(a===void 0&&o===void 0)return!0;if(a===void 0||o===void 0||a.length!==o.length)return!1;const i=[...a].sort(),r=[...o].sort();return i.every((u,c)=>u===r[c])};return n(e.state,t.state)&&n(e.flows,t.flows)&&n(e.deployments,t.deployments)&&n(e.workPools,t.workPools)&&n(e.tags,t.tags)&&e.range===t.range&&e.start===t.start&&e.end===t.end}function st(){const[e,t]=ie(Bs,[]),[n,a]=ie(Ys,null),o=l.useMemo(()=>[...tt,...e],[e]),i=l.useCallback(h=>{const x={id:qs(),name:h.name,filters:h.filters};return t(S=>[...S,x]),x},[t]),r=l.useCallback(h=>{t(x=>x.filter(S=>S.id!==h)),a(x=>x===h?null:x)},[t,a]),u=l.useCallback((h,x)=>{t(S=>S.map(y=>y.id===h?{...y,...x.name!==void 0&&{name:x.name},...x.filters!==void 0&&{filters:x.filters}}:y))},[t]),c=l.useCallback(h=>{a(h)},[a]),d=l.useCallback(h=>o.find(x=>x.id===h),[o]),f=l.useCallback(h=>o.find(x=>Ks(x.filters,h)),[o]),m=l.useMemo(()=>h=>n===h,[n]);return{savedFilters:o,defaultFilterId:n,saveFilter:i,deleteFilter:r,updateFilter:u,setDefaultFilter:c,getFilterById:d,findMatchingFilter:f,isDefaultFilter:m}}const Zs=({tab:e,onTabChange:t,flowRunsCount:n,taskRunsCount:a,hasAnyFlowRuns:o,hasAnyTaskRuns:i,flowRuns:r,flowRunsPages:u,pagination:c,onPaginationChange:d,onPrefetchPage:f,sort:m,onSortChange:h,hideSubflows:x,onHideSubflowsChange:S,flowRunSearch:y,onFlowRunSearchChange:g,selectedStates:p,onStateFilterChange:w,selectedFlows:k,onFlowFilterChange:D,selectedDeployments:C,onDeploymentFilterChange:N,selectedTags:A,onTagsFilterChange:v,selectedWorkPools:V,onWorkPoolFilterChange:H,dateRange:P,onDateRangeChange:W,flowRunHistory:E,scatterPlotDateRange:T,taskRuns:I,taskRunsPages:L,taskRunsPagination:Q,onTaskRunsPaginationChange:z,onTaskRunsPrefetchPage:$,taskRunsSort:de,onTaskRunsSortChange:me,taskRunSearch:fe,onTaskRunSearchChange:ge,onClearTaskRunFilters:he,currentFilter:K,savedFilters:pe,onSelectFilter:xe,onSaveFilter:we,onDeleteFilter:Se,onSetDefault:ve,onRemoveDefault:ke,isSaveDialogOpen:B,onCloseSaveDialog:Y,onConfirmSave:ye})=>{const G=!o&&!i,[Z,Ce,{onSelectRow:Fe}]=gs(),[J,je,{onSelectRow:j}]=As(),b=[...new Set(r.map(R=>R.flow_id))],{data:ee}=M(De({flows:{operator:"and_",id:{any_:b}},offset:0,sort:"NAME_ASC"},{enabled:b.length>0})),X=r.map(R=>({...R,flow:ee?.find(Re=>Re.id===R.flow_id)}));return G?s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx(He,{}),s.jsx(Js,{})]}):s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(He,{}),s.jsx(Ls,{currentFilter:K,savedFilters:pe,onSelect:xe,onSave:we,onDelete:Se,onSetDefault:ve,onRemoveDefault:ke,permissions:{canSave:!0,canDelete:!Gs(K?.id??null)}})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("div",{className:"flex flex-wrap gap-2 lg:grid lg:grid-flow-col lg:auto-cols-fr",children:[s.jsxs("div",{className:"flex flex-col gap-1 w-full lg:w-auto",children:[s.jsx(O,{className:"text-xs text-muted-foreground",children:"Date Range"}),s.jsx(bs,{value:P,onValueChange:W})]}),s.jsxs("div",{className:"flex flex-col gap-1 w-full lg:w-auto",children:[s.jsx(O,{className:"text-xs text-muted-foreground",children:"States"}),s.jsx(ds,{selectedFilters:p,onSelectFilter:w})]})]}),s.jsxs("div",{className:"flex flex-wrap gap-2 lg:grid lg:grid-flow-col lg:auto-cols-fr",children:[s.jsxs("div",{className:"flex flex-col gap-1 w-full lg:w-auto",children:[s.jsx(O,{className:"text-xs text-muted-foreground",children:"Flows"}),s.jsx(_s,{selectedFlows:k,onSelectFlows:D})]}),s.jsxs("div",{className:"flex flex-col gap-1 w-full lg:w-auto",children:[s.jsx(O,{className:"text-xs text-muted-foreground",children:"Deployments"}),s.jsx(is,{selectedDeployments:C,onSelectDeployments:N})]}),s.jsxs("div",{className:"flex flex-col gap-1 w-full lg:w-auto",children:[s.jsx(O,{className:"text-xs text-muted-foreground",children:"Work Pools"}),s.jsx(cs,{selectedWorkPools:V,onSelectWorkPools:H})]}),s.jsxs("div",{className:"flex flex-col gap-1 w-full lg:w-auto",children:[s.jsx(O,{className:"text-xs text-muted-foreground",children:"Tags"}),s.jsx(Wt,{value:Array.from(A),onChange:R=>{const Re=Array.isArray(R)?R:[];v(new Set(Re))},placeholder:"All tags"})]})]})]}),s.jsx($s,{open:B,onOpenChange:Y,onSave:ye}),s.jsxs(Qt,{value:e,onValueChange:t,children:[s.jsxs($t,{children:[s.jsx(Ae,{value:"flow-runs",children:"Flow Runs"}),s.jsx(Ae,{value:"task-runs",children:"Task Runs"})]}),s.jsx(Pe,{value:"flow-runs",children:s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx(Bt,{children:s.jsx(Yt,{children:s.jsx(Ws,{history:E,startDate:T.startDate,endDate:T.endDate})})}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(hs,{count:n,results:X,selectedRows:Z,setSelectedRows:Ce}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[s.jsx(Gt,{id:"hide-subflows",checked:x,onCheckedChange:S}),s.jsx(O,{htmlFor:"hide-subflows",children:"Hide subflows"})]}),s.jsx(Ie,{value:y,onChange:R=>g(R.target.value),placeholder:"Search by flow run name","aria-label":"Search by flow run name",className:"w-64",debounceMs:1200}),s.jsx(us,{value:m,onSelect:h})]})]}),s.jsx(ms,{count:n,pages:u,pagination:c,onChangePagination:d,onPrefetchPage:f}),s.jsx(fs,{flowRuns:X,selectedRows:Z,onSelect:Fe})]})}),s.jsx(Pe,{value:"task-runs",children:s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(Es,{count:a,results:I,selectedRows:J,setSelectedRows:je}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(Ie,{value:fe,onChange:R=>ge(R.target.value),placeholder:"Search by task run name","aria-label":"Search by task run name",className:"w-64",debounceMs:1200}),s.jsx(Cs,{value:de,onSelect:me})]})]}),s.jsx(Fs,{count:a,pages:L,pagination:Q,onChangePagination:z,onPrefetchPage:$}),s.jsx(js,{taskRuns:I,selectedRows:J,onSelect:j,onClearFilters:he})]})})]})]})},He=()=>s.jsx("header",{children:s.jsx("nav",{children:s.jsx(q,{variant:"h2",children:"Runs"})})}),Js=()=>s.jsxs(Xt,{children:[s.jsx(qt,{id:"Workflow"}),s.jsx(Kt,{children:"Run a task or flow to get started"}),s.jsx(Zt,{children:"Runs store the state history for each execution of a task or flow."}),s.jsx(Jt,{children:s.jsx(es,{id:"getting-started"})})]}),ce=Be("/runs/");function ea(e){const t=u=>u?u.split(",").filter(c=>c.trim().length>0):[],n=t(e.state),a=t(e.flows),o=t(e.deployments),i=t(e["work-pools"]),r=t(e.tags);return{...n.length>0&&{state:n},...a.length>0&&{flows:a},...o.length>0&&{deployments:o},...i.length>0&&{workPools:i},...r.length>0&&{tags:r},...e.range&&{range:e.range},...e.start&&{start:e.start},...e.end&&{end:e.end}}}function at(e){return{state:e.state?.join(",")??"",flows:e.flows?.join(",")??"",deployments:e.deployments?.join(",")??"","work-pools":e.workPools?.join(",")??"",tags:e.tags?.join(",")??"",range:e.range,start:e.start,end:e.end}}function Ve(e,t){return{id:e.id,name:e.name,isDefault:e.id===t}}function ta(){const e=ce.useSearch(),t=ce.useNavigate(),{savedFilters:n,defaultFilterId:a,saveFilter:o,deleteFilter:i,setDefaultFilter:r,findMatchingFilter:u}=st(),[c,d]=l.useState(!1),f=l.useMemo(()=>ea(e),[e]),m=l.useMemo(()=>u(f),[u,f]),h=l.useMemo(()=>n.map(C=>Ve(C,a)),[n,a]),x=l.useMemo(()=>m?Ve(m,a):f.state?.length||f.flows?.length||f.deployments?.length||f.workPools?.length||f.tags?.length||f.range||f.start||f.end?{id:null,name:"Unsaved",isDefault:!1}:{id:null,name:"Custom",isDefault:!1},[m,a,f]),S=l.useCallback(C=>{const N=n.find(v=>v.id===C.id);if(!N)return;const A=at(N.filters);t({to:".",search:v=>({...v,...A,page:1}),replace:!0})},[t,n]),y=l.useCallback(()=>{d(!0)},[]),g=l.useCallback(C=>{o({name:C,filters:f}),d(!1)},[o,f]),p=l.useCallback(()=>{d(!1)},[]),w=l.useCallback(C=>{i(C)},[i]),k=l.useCallback(C=>{r(C)},[r]),D=l.useCallback(()=>{r(null)},[r]);return{currentFilter:x,savedFiltersForMenu:h,onSelectFilter:S,onSaveFilter:y,onDeleteFilter:w,onSetDefault:k,onRemoveDefault:D,isSaveDialogOpen:c,closeSaveDialog:p,confirmSave:g}}function sa(){const e=ce.useNavigate(),t=ce.useSearch(),{defaultFilterId:n,getFilterById:a}=st(),o=l.useRef(!1),i=l.useMemo(()=>!!(t.state||t.flows||t.deployments||t["work-pools"]||t.tags||t.range||t.start||t.end),[t]);l.useEffect(()=>{if(o.current||i)return;let r;n&&(r=a(n)),r||(r=Xs),o.current=!0;const u=at(r.filters);e({to:".",search:c=>({...c,...u,page:1}),replace:!0})},[n,i,a,e])}const We=Be("/runs/"),aa=e=>e?e.split(",").filter(t=>Xe.includes(t)):[],oe=e=>e?e.split(",").filter(t=>t.trim().length>0):[];function na(){const e=We.useSearch(),t=We.useNavigate(),n=l.useMemo(()=>new Set(aa(e.state??"")),[e.state]),a=l.useMemo(()=>new Set(oe(e.flows??"")),[e.flows]),o=l.useMemo(()=>new Set(oe(e.deployments??"")),[e.deployments]),i=l.useMemo(()=>new Set(oe(e["work-pools"]??"")),[e["work-pools"]]),r=l.useMemo(()=>new Set(oe(e.tags??"")),[e.tags]),u=l.useMemo(()=>({range:e.range,start:e.start,end:e.end}),[e.range,e.start,e.end]),c=l.useCallback(g=>{const p=Array.from(g);t({to:".",search:w=>({...w,state:p.length>0?p.join(","):"",page:1}),replace:!0})},[t]),d=l.useCallback(g=>{const p=Array.from(g);t({to:".",search:w=>({...w,flows:p.length>0?p.join(","):"",page:1}),replace:!0})},[t]),f=l.useCallback(g=>{const p=Array.from(g);t({to:".",search:w=>({...w,deployments:p.length>0?p.join(","):"",page:1}),replace:!0})},[t]),m=l.useCallback(g=>{const p=Array.from(g);t({to:".",search:w=>({...w,"work-pools":p.length>0?p.join(","):"",page:1}),replace:!0})},[t]),h=l.useCallback(g=>{const p=Array.from(g);t({to:".",search:w=>({...w,tags:p.length>0?p.join(","):"",page:1}),replace:!0})},[t]),x=l.useCallback(g=>{t({to:".",search:p=>({...p,range:g.range,start:g.start,end:g.end,page:1}),replace:!0})},[t]),S=l.useMemo(()=>n.size>0||a.size>0||o.size>0||i.size>0||r.size>0||u.range!==void 0||u.start!==void 0||u.end!==void 0,[n,a,o,i,r,u]),y=l.useCallback(()=>{t({to:".",search:g=>({...g,state:"",flows:"",deployments:"","work-pools":"",tags:"",range:void 0,start:void 0,end:void 0,page:1}),replace:!0})},[t]);return{states:n,flows:a,deployments:o,workPools:i,tags:r,dateRange:u,onStatesChange:c,onFlowsChange:d,onDeploymentsChange:f,onWorkPoolsChange:m,onTagsChange:h,onDateRangeChange:x,clearAllFilters:y,hasActiveFilters:S}}Ke({tab:ae(["flow-runs","task-runs"]).optional().default("flow-runs"),page:ne().int().positive().optional().default(1).catch(1),limit:ne().int().positive().optional().catch(void 0),sort:ae(ls).optional().default("START_TIME_DESC"),"hide-subflows":Ts().optional().default(!1),"flow-run-search":_().optional().default(""),state:_().optional().default(""),flows:_().optional().default(""),deployments:_().optional().default(""),"work-pools":_().optional().default(""),tags:_().optional().default(""),range:ae(rs).optional(),start:_().optional(),end:_().optional(),"task-runs-page":ne().int().positive().optional().default(1).catch(1),"task-runs-limit":ne().int().positive().optional().catch(void 0),"task-runs-sort":ae(os).optional().default("EXPECTED_START_TIME_DESC"),"task-run-search":_().optional().default("")});const Te=e=>e?e.split(",").filter(t=>Xe.includes(t)):[],ue=e=>{if(!e)return;const t={range:e.range,start:e.start,end:e.end},n=Ye(t);if(!n)return;const a=ns(n);if(a)return{after_:a.startDate.toISOString(),before_:a.endDate.toISOString()}},be=e=>e?e.split(",").filter(t=>t.trim().length>0):[],_e=e=>e?e.split(",").filter(t=>t.trim().length>0):[],nt=e=>e?e.split(",").filter(t=>t.trim().length>0):[],Ne=e=>e?e.split(",").filter(t=>t.trim().length>0):[],Qe=e=>{const t=e?.["hide-subflows"],n=e?.["flow-run-search"],a=Te(e?.state??""),o=be(e?.flows??""),i=_e(e?.deployments??""),r=nt(e?.["work-pools"]??""),u=Ne(e?.tags??""),c=ue(e),d=a.length>0?a:void 0,f=o.length>0?o:void 0,m=i.length>0?i:void 0,h=r.length>0?r:void 0,S=t||n||d||f||m||u.length>0||c?{operator:"and_",...t&&{parent_task_run_id:{operator:"and_",is_null_:!0}},...n&&{name:{like_:n}},...d&&{state:{operator:"and_",name:{any_:d}}},...u.length>0&&{tags:{operator:"and_",any_:u}},...c&&{expected_start_time:c}}:void 0,y=f?{operator:"and_",id:{any_:f}}:void 0,g=m?{operator:"and_",id:{any_:m}}:void 0,p=h?{operator:"and_",name:{any_:h}}:void 0;return{page:e?.page??1,limit:e?.limit??100,sort:e?.sort??"START_TIME_DESC",flow_runs:S,flows:y,deployments:g,work_pools:p}},$e=e=>{const t=e?.["task-run-search"],n=Te(e?.state??""),a=be(e?.flows??""),o=_e(e?.deployments??""),i=Ne(e?.tags??""),r=ue(e),u=t?{operator:"and_",name:{like_:t}}:void 0,c=n.length>0?n:void 0,f=c||i.length>0||r?{operator:"and_",...c&&{state:{operator:"and_",name:{any_:c}}},...i.length>0&&{tags:{operator:"and_",any_:i}},...r&&{expected_start_time:r}}:void 0,m=a.length>0?a:void 0,h=m?{operator:"and_",id:{any_:m}}:void 0,x=o.length>0?o:void 0,S=x?{operator:"and_",id:{any_:x}}:void 0;return{page:e?.["task-runs-page"]??1,limit:e?.["task-runs-limit"]??100,sort:e?.["task-runs-sort"]??"EXPECTED_START_TIME_DESC",task_runs:u,flow_runs:f,flows:h,deployments:S}},oa=e=>{const t=e?.["hide-subflows"],n=Te(e?.state??""),a=be(e?.flows??""),o=_e(e?.deployments??""),i=nt(e?.["work-pools"]??""),r=Ne(e?.tags??""),u=ue(e),c=n.length>0?n:void 0,d=a.length>0?a:void 0,f=o.length>0?o:void 0,m=i.length>0?i:void 0;return{sort:"EXPECTED_START_TIME_DESC",limit:1e3,offset:0,flow_runs:t||c||r.length>0||u?{operator:"and_",...t&&{parent_task_run_id:{operator:"and_",is_null_:!0}},...c&&{state:{operator:"and_",name:{any_:c}}},...r.length>0&&{tags:{operator:"and_",any_:r}},...u&&{expected_start_time:u}}:void 0,flows:d?{operator:"and_",id:{any_:d}}:void 0,deployments:f?{operator:"and_",id:{any_:f}}:void 0,work_pools:m?{operator:"and_",name:{any_:m}}:void 0}},ra=()=>{const e=F.useSearch(),t=F.useNavigate(),n=l.useMemo(()=>({page:e.page??1,limit:e.limit??100}),[e.page,e.limit]),a=l.useCallback(o=>{t({to:".",search:i=>({...i,page:o.page,limit:o.limit}),replace:!0})},[t]);return[n,a]},la=()=>{const e=F.useSearch(),t=F.useNavigate(),n=l.useCallback(a=>{t({to:".",search:o=>({...o,sort:a,page:1}),replace:!0})},[t]);return[e.sort,n]},ia=()=>{const e=F.useSearch(),t=F.useNavigate(),n=l.useCallback(a=>{t({to:".",search:o=>({...o,"hide-subflows":a,page:1}),replace:!0})},[t]);return[e["hide-subflows"],n]},ca=()=>{const e=F.useSearch(),t=F.useNavigate(),n=l.useCallback(a=>{t({to:".",search:o=>({...o,tab:a,page:1}),replace:!0})},[t]);return[e.tab,n]},ua=()=>{const e=F.useSearch(),t=F.useNavigate(),n=l.useCallback(a=>{t({to:".",search:o=>({...o,"flow-run-search":a,page:1}),replace:!0})},[t]);return[e["flow-run-search"],n]},da=()=>{const e=F.useSearch(),t=F.useNavigate(),n=l.useMemo(()=>({page:e["task-runs-page"]??1,limit:e["task-runs-limit"]??100}),[e["task-runs-page"],e["task-runs-limit"]]),a=l.useCallback(o=>{t({to:".",search:i=>({...i,"task-runs-page":o.page,"task-runs-limit":o.limit}),replace:!0})},[t]);return[n,a]},ma=()=>{const e=F.useSearch(),t=F.useNavigate(),n=l.useCallback(a=>{t({to:".",search:o=>({...o,"task-runs-sort":a,"task-runs-page":1}),replace:!0})},[t]);return[e["task-runs-sort"],n]},fa=()=>{const e=F.useSearch(),t=F.useNavigate(),n=l.useCallback(a=>{t({to:".",search:o=>({...o,"task-run-search":a,"task-runs-page":1}),replace:!0})},[t]);return[e["task-run-search"],n]};function ba(){const e=ot(),t=F.useSearch(),n=F.useNavigate(),[a,o]=ie("workspace-flow-runs-list-limit",100),[i,r]=ie("workspace-task-runs-list-limit",100),u=l.useRef(!1);l.useEffect(()=>{if(u.current)return;u.current=!0;const j=t.limit===void 0,b=t["task-runs-limit"]===void 0;(j||b)&&n({to:".",search:ee=>({...ee,...j&&{limit:a},...b&&{"task-runs-limit":i}}),replace:!0})},[n,t.limit,t["task-runs-limit"],a,i]),l.useEffect(()=>{t.limit!==void 0&&t.limit!==a&&o(t.limit)},[t.limit,a,o]),l.useEffect(()=>{t["task-runs-limit"]!==void 0&&t["task-runs-limit"]!==i&&r(t["task-runs-limit"])},[t["task-runs-limit"],i,r]);const[c,d]=ra(),[f,m]=la(),[h,x]=ia(),[S,y]=ca(),[g,p]=ua(),{states:w,flows:k,deployments:D,workPools:C,tags:N,dateRange:A,onStatesChange:v,onFlowsChange:V,onDeploymentsChange:H,onWorkPoolsChange:P,onTagsChange:W,onDateRangeChange:E}=na(),[T,I]=da(),[L,Q]=ma(),[z,$]=fa(),{currentFilter:de,savedFiltersForMenu:me,onSelectFilter:fe,onSaveFilter:ge,onDeleteFilter:he,onSetDefault:K,onRemoveDefault:pe,isSaveDialogOpen:xe,closeSaveDialog:we,confirmSave:Se}=ta();sa();const[{data:ve},{data:ke}]=rt({queries:[ss(),as()]}),{data:B}=M(Le(Qe(t),3e4)),{data:Y}=M(ze($e(t),3e4)),{data:ye}=M(ts(oa(t),3e4)),G=B?.results??[],Z=Y?.results??[],Ce=l.useMemo(()=>{const j=ue(t);return{startDate:j?.after_?new Date(j.after_):void 0,endDate:j?.before_?new Date(j.before_):void 0}},[t]);l.useEffect(()=>{const j=G.map(b=>b.id);j.length>0&&e.prefetchQuery(Oe(j))},[e,G]);const Fe=l.useCallback(j=>{const b=Qe({...t,page:j});(async()=>{const X=(await e.ensureQueryData(Le(b,3e4)))?.results?.map(R=>R.id)??[];X.length>0&&e.prefetchQuery(Oe(X))})()},[e,t]),J=l.useCallback(j=>{const b=$e({...t,"task-runs-page":j});e.prefetchQuery(ze(b,3e4))},[e,t]),je=l.useCallback(()=>{$("")},[$]);return s.jsx(Zs,{tab:S,onTabChange:y,flowRunsCount:B?.count??0,taskRunsCount:Y?.count??0,hasAnyFlowRuns:(ve??0)>0,hasAnyTaskRuns:(ke??0)>0,flowRuns:G,flowRunsPages:B?.pages??0,pagination:c,onPaginationChange:d,onPrefetchPage:Fe,sort:f,onSortChange:m,hideSubflows:h,onHideSubflowsChange:x,flowRunSearch:g,onFlowRunSearchChange:p,selectedStates:w,onStateFilterChange:v,selectedFlows:k,onFlowFilterChange:V,selectedDeployments:D,onDeploymentFilterChange:H,selectedTags:N,onTagsFilterChange:W,selectedWorkPools:C,onWorkPoolFilterChange:P,dateRange:A,onDateRangeChange:E,flowRunHistory:ye??[],scatterPlotDateRange:Ce,taskRuns:Z,taskRunsPages:Y?.pages??0,taskRunsPagination:T,onTaskRunsPaginationChange:I,onTaskRunsPrefetchPage:J,taskRunsSort:L,onTaskRunsSortChange:Q,taskRunSearch:z,onTaskRunSearchChange:$,onClearTaskRunFilters:je,currentFilter:de,savedFilters:me,onSelectFilter:fe,onSaveFilter:ge,onDeleteFilter:he,onSetDefault:K,onRemoveDefault:pe,isSaveDialogOpen:xe,onCloseSaveDialog:we,onConfirmSave:Se})}export{ba as component};
//# sourceMappingURL=index-CsJ3o2pO.js.map
