orchestrator:
  id: orka-ui
  strategy: decision-tree
  queue: orka:generated
  memory_preset: "working"  # Use working memory for active processing
  agents:
    - answer_9
    - test_failover
    - need_answer
    - router_answer
    - final_summary
agents:
  - id: answer_9
    type: local_llm
    model: openai/gpt-oss-20b
    model_url: http://localhost:1234
    provider: lm_studio
    temperature: 0.5
    queue: orka:answer_9
    prompt: >
      Rephrase this input in a more understandable way: "{{ get_input() }}". Make it clearer and more concise.
    params:
      structured_output:
        enabled: true
        mode: prompt
        schema:
          required: [response]
          optional:
            confidence: number
            internal_reasoning: string
  - id: test_failover
    type: failover
    input: answer_9
    children:
      - id: failing_test_agent1
        type: failing
        queue: orka:failing_test_agent1
      - id: actual_working_agent
        type: duckduckgo
        queue: orka:actual_working_agent
        prompt: "{{ get_input() }}"
    depends_on:
      - failing_test_agent1
      - actual_working_agent
      - answer_9
  - id: need_answer
    type: local_llm
    model: openai/gpt-oss-20b
    model_url: http://localhost:1234
    provider: lm_studio
    temperature: 0.1
    queue: orka:is_fact
    prompt: "Does '{{ get_input() }}' ask a question that requires an answer, or is it an assertion that requires fact validation? Return true if it is a question, false if it is an assertion. Answer with exactly 'true' or 'false' only."
    params:
      structured_output:
        enabled: true
        mode: prompt
        schema:
          required: [response]
          optional:
            confidence: number
    depends_on:
      - test_failover
  - id: router_answer
    type: router
    params:
      decision_key: need_answer
      routing_map:
        "true":
          - test_failover2
        "false":
          - validate_fact
    depends_on:
      - need_answer
  - id: test_failover2
    type: failover
    input: router_answer
    children:
      - id: failing_test_agent2
        type: failing
        queue: orka:failing_test_agent2
      - id: build_answer
        type: local_llm
        model: openai/gpt-oss-20b
        model_url: http://localhost:1234
        provider: lm_studio
        temperature: 0.7
        queue: orka:validation_queue
        prompt: |
          Given this question "{{ get_input() }}", and the search results below, return a compelling answer. Be comprehensive and helpful.
          
          Search Results:
          {% set search_results = get_agent_response('test_failover') %}
          {% if search_results %}
          {{ search_results }}
          {% else %}
          No search results available
          {% endif %}
        params:
          structured_output:
            enabled: true
            mode: prompt
            schema:
              required: [response]
              optional:
                confidence: number
    depends_on:
      - router_answer
      - failing_test_agent2
      - build_answer
  - id: validate_fact
    type: local_llm
    model: openai/gpt-oss-20b
    model_url: http://localhost:1234
    provider: lm_studio
    temperature: 0.3
    queue: orka:validation_queue
    prompt: |
      Validate the following assertion based on the search results. 
      
      Assertion: {{ get_input() }}
      
      Search Results:
      {% set search_results = get_agent_response('test_failover') %}
      {% if search_results %}
      {{ search_results }}
      {% else %}
      No search results available
      {% endif %}
      
      Return a thorough fact-checking analysis based on the available information.
    depends_on:
      - router_answer
      
  - id: final_summary
    type: local_llm
    model: openai/gpt-oss-20b
    model_url: http://localhost:1234
    provider: lm_studio
    temperature: 0.7
    prompt: |
      Provide a final summary based on the workflow results:
      
      Original Input: {{ get_input() }}
      
      {# NOTE: build_answer is a child inside test_failover2, so it will NOT exist as a top-level agent output #}
      {% set answer_result = get_agent_response('test_failover2') %}
      {% if answer_result %}
      Answer Result: {{ answer_result }}
      {% endif %}
      
      {% set validation_result = get_agent_response('validate_fact') %}
      {% if validation_result %}
      Validation Result: {{ validation_result }}
      {% endif %}
      
      Provide a clear, comprehensive final response that addresses the user's input appropriately.
    params:
      structured_output:
        enabled: true
        mode: prompt
        schema:
          required: [response]
          optional:
            confidence: number
