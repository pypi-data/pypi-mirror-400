var z=Object.defineProperty;var a=(p,h)=>z(p,"name",{value:h,configurable:!0});import{ref as A,watch as N,defineComponent as M,computed as P,resolveDirective as G,openBlock as m,createElementBlock as $,createVNode as i,unref as t,withCtx as b,createTextVNode as B,toDisplayString as l,createBlock as D,createElementVNode as d,createCommentVNode as U,withDirectives as J,normalizeClass as K}from"vue";import w from"primevue/button";import T from"primevue/column";import q from"primevue/datatable";import R from"primevue/divider";import F from"primevue/skeleton";import Q from"primevue/tabpanel";import{aQ as O,b$ as V,aR as W,x as X,P as Y,F as Z,R as ee,p as te,w as oe,S as se,cP as re}from"./index-6STX4Oia.js";import ae from"primevue/badge";import ie from"primevue/message";import ne from"primevue/progressspinner";import{aE as H}from"./vendor-other-_sromytg.js";import{useI18n as le}from"vue-i18n";import"./vendor-xterm-DV1MVhAx.js";import"primevue/usetoast";import"primevue/card";import"primevue/select";import"primevue/slider";import"primevue/checkbox";import"primevue/galleria";import"primevue/popover";import"primevue/iconfield";import"primevue/inputicon";import"primevue/inputtext";import"primevue/chip";import"primevue/tabview";import"primevue/dropdown";import"primevue/scrollpanel";import"primevue/contextmenu";import"primevue/tree";import"primevue/toolbar";import"primevue/progressbar";import"primevue";import"primevue/selectbutton";import"primevue/tag";import"primevue/dialog";import"primevue/colorpicker";import"primevue/confirmpopup";import"primevue/useconfirm";import"primevue/confirmdialog";import"@primevue/themes";import"@primevue/themes/aura";import"./vendor-vue-CrN17A9b.js";import"primevue/config";import"primevue/confirmationservice";import"primevue/toastservice";import"primevue/tooltip";import"primevue/multiselect";import"primevue/listbox";import"primevue/floatlabel";import"@primevue/forms";import"@primevue/forms/resolvers/zod";import"primevue/password";import"primevue/inputnumber";import"primevue/tabpanels";import"primevue/tabs";import"primevue/toggleswitch";import"primevue/radiobutton";import"primevue/knob";import"primevue/panel";import"primevue/tabmenu";import"primevue/tab";import"primevue/tablist";import"primevue/autocomplete";import"./vendor-three-zdhtZbSm.js";import"./vendor-tiptap-D1RRboMA.js";import"primevue/blockui";var I=(p=>(p.CREDIT_ADDED="credit_added",p.ACCOUNT_CREATED="account_created",p.API_USAGE_STARTED="api_usage_started",p.API_USAGE_COMPLETED="api_usage_completed",p))(I||{});const j=H.create({baseURL:O(),headers:{"Content-Type":"application/json"}}),ce=a(()=>{const p=A(!1),h=A(null),{d:E}=le();N(()=>O(),e=>{j.defaults.baseURL=e});const g=a((e,s,v)=>{if(W(e))return;let r;if(!H.isAxiosError(e))r=`${s} failed: ${e instanceof Error?e.message:String(e)}`;else{const n=e,u=n.response?.status;u&&v?.[u]?r=v[u]:r=n.response?.data?.message??`${s} failed with status ${u}`}h.value=r},"handleRequestError"),y=a(async(e,s)=>{const{errorContext:v,routeSpecificErrors:r}=s;p.value=!0,h.value=null;try{return(await e()).data}catch(n){return g(n,v,r),null}finally{p.value=!1}},"executeRequest");function f(e){switch(e){case"credit_added":return"Credits Added";case"account_created":return"Account Created";case"api_usage_completed":return"API Usage";default:return e}}a(f,"formatEventType");function c(e){const s=new Date(e);return E(s,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}a(c,"formatDate");function C(e){return e.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" ")}a(C,"formatJsonKey");function k(e){return typeof e=="number"?e.toLocaleString():typeof e=="string"&&e.match(/^\d{4}-\d{2}-\d{2}/)?new Date(e).toLocaleString():e}a(k,"formatJsonValue");function x(e){switch(e){case"credit_added":return"success";case"account_created":return"info";case"api_usage_completed":return"warning";default:return"info"}}a(x,"getEventSeverity");function S(e){const{amount:s,api_name:v,model:r,...n}=e.params||{};return Object.keys(n).length>0}a(S,"hasAdditionalInfo");function L(e){const{...s}=e.params||{};return Object.entries(s).map(([v,r])=>{const n=C(v),u=k(r);return`<strong>${n}:</strong> ${u}`}).join("<br>")}a(L,"getTooltipContent");function o(e){return e?(e/100).toFixed(2):"0.00"}a(o,"formatAmount");async function _({page:e=1,limit:s=10}={}){const v="Fetching customer events",r={400:"Invalid input, object invalid",404:"Not found"},n=await V().getAuthHeader();return n?await y(()=>j.get("/customers/events",{params:{page:e,limit:s},headers:n}),{errorContext:v,routeSpecificErrors:r}):(h.value="Authentication header is missing",null)}return a(_,"getMyEvents"),{isLoading:p,error:h,getMyEvents:_,formatEventType:f,getEventSeverity:x,formatAmount:o,hasAdditionalInfo:S,formatDate:c,formatJsonKey:C,formatJsonValue:k,getTooltipContent:L}},"useCustomerEventsService"),de={key:0,class:"flex items-center justify-center p-8"},ue={key:1,class:"p-4"},me={class:"event-details"},pe={key:0,class:"font-semibold text-green-500"},fe={key:1},ve={key:2,class:"flex flex-col gap-1"},he={class:"font-semibold"},ge={class:"text-sm text-smoke-400"},_e=M({__name:"UsageLogsTable",setup(p,{expose:h}){const E=A([]),g=A(!0),y=A(null),f=ce(),c=A({page:1,limit:7,total:0,totalPages:0}),C=P(()=>(c.value.page-1)*c.value.limit),k=P(()=>{const o=new Map;return E.value.forEach(_=>{f.hasAdditionalInfo(_)&&_.event_id&&o.set(_.event_id,f.getTooltipContent(_))}),o}),x=a(async()=>{g.value=!0,y.value=null;try{const o=await f.getMyEvents({page:c.value.page,limit:c.value.limit});o?(o.events&&(E.value=o.events),o.page&&(c.value.page=o.page),o.limit&&(c.value.limit=o.limit),o.total&&(c.value.total=o.total),o.totalPages&&(c.value.totalPages=o.totalPages),X()?.checkForCompletedTopup(o.events)):y.value=f.error.value||"Failed to load events"}catch(o){y.value=o instanceof Error?o.message:"Unknown error",console.error("Error loading events:",o)}finally{g.value=!1}},"loadEvents"),S=a(o=>{c.value.page=o.page+1,x().catch(_=>{console.error("Error loading events:",_)})},"onPageChange");return h({refresh:a(async()=>{c.value.page=1,await x()},"refresh")}),(o,_)=>{const e=G("tooltip");return m(),$("div",null,[g.value?(m(),$("div",de,[i(t(ne))])):y.value?(m(),$("div",ue,[i(t(ie),{severity:"error",closable:!1},{default:b(()=>[B(l(y.value),1)]),_:1})])):(m(),D(t(q),{key:2,value:E.value,paginator:!0,rows:c.value.limit,"total-records":c.value.total,first:C.value,lazy:!0,class:"p-datatable-sm custom-datatable",onPage:S},{default:b(()=>[i(t(T),{field:"event_type",header:o.$t("credits.eventType")},{body:b(({data:s})=>[i(t(ae),{value:t(f).formatEventType(s.event_type),severity:t(f).getEventSeverity(s.event_type)},null,8,["value","severity"])]),_:1},8,["header"]),i(t(T),{field:"details",header:o.$t("credits.details")},{body:b(({data:s})=>[d("div",me,[s.event_type===t(I).CREDIT_ADDED?(m(),$("div",pe,l(o.$t("credits.added"))+" $"+l(t(f).formatAmount(s.params?.amount)),1)):s.event_type===t(I).ACCOUNT_CREATED?(m(),$("div",fe,l(o.$t("credits.accountInitialized")),1)):s.event_type===t(I).API_USAGE_COMPLETED?(m(),$("div",ve,[d("div",he,l(s.params?.api_name||"API"),1),d("div",ge,l(o.$t("credits.model"))+": "+l(s.params?.model||"-"),1)])):U("",!0)])]),_:1},8,["header"]),i(t(T),{field:"createdAt",header:o.$t("credits.time")},{body:b(({data:s})=>[B(l(t(f).formatDate(s.createdAt)),1)]),_:1},8,["header"]),i(t(T),{field:"params",header:o.$t("credits.additionalInfo")},{body:b(({data:s})=>[t(f).hasAdditionalInfo(s)?J((m(),D(t(w),{key:0,icon:"pi pi-info-circle",class:"p-button-text p-button-sm"},null,512)),[[e,{escape:!1,value:k.value.get(s.event_id)||"",pt:{text:{style:{width:"max-content !important"}}}},void 0,{top:!0}]]):U("",!0)]),_:1},8,["header"])]),_:1},8,["value","rows","total-records","first"]))])}}}),ye={class:"flex h-full flex-col"},be={class:"mb-2 text-2xl font-bold"},Ce={class:"flex flex-col gap-2"},xe={class:"text-sm font-medium text-muted"},$e={class:"flex items-center justify-between"},Ae={class:"flex flex-row items-center"},Ee={key:1,class:"text-xs text-muted"},we={class:"flex items-center justify-between"},ke={key:0,class:"grow"},Se={class:"text-sm font-medium"},De={class:"text-xs text-muted"},Te={class:"flex flex-row gap-2"},zt=M({__name:"CreditsPanel",setup(p){const{buildDocsUrl:h}=Y(),E=Z(),g=V(),y=ee(),f=te(),{isActiveSubscription:c}=oe(),C=P(()=>g.loading),k=P(()=>g.isFetchingBalance),x=A(null),S=P(()=>g.lastBalanceUpdateTime?g.lastBalanceUpdateTime.toLocaleString():"");N(()=>g.lastBalanceUpdateTime,(r,n)=>{r&&r!==n&&x.value&&x.value.refresh()});const L=a(()=>{E.showTopUpCreditsDialog()},"handlePurchaseCreditsClick"),o=a(async()=>{await y.accessBillingPortal()},"handleCreditsHistoryClick"),_=a(async()=>{await f.execute("Comfy.ContactSupport")},"handleMessageSupport"),e=a(()=>{window.open(h("/tutorials/api-nodes/faq",{includeLocale:!0}),"_blank")},"handleFaqClick"),s=a(()=>{window.open(h("/tutorials/api-nodes/overview#api-nodes",{includeLocale:!0}),"_blank")},"handleOpenPartnerNodesInfo"),v=A([]);return(r,n)=>(m(),D(t(Q),{value:"Credits",class:"credits-container h-full"},{default:b(()=>[d("div",ye,[d("h2",be,l(r.$t("credits.credits")),1),i(t(R)),d("div",Ce,[d("h3",xe,l(r.$t("credits.yourCreditBalance")),1),d("div",$e,[i(se,{"text-class":"text-3xl font-bold"}),C.value?(m(),D(t(F),{key:0,width:"2rem",height:"2rem"})):t(c)?(m(),D(t(w),{key:1,label:r.$t("credits.purchaseCredits"),loading:C.value,onClick:L},null,8,["label","loading"])):U("",!0)]),d("div",Ae,[k.value?(m(),D(t(F),{key:0,width:"12rem",height:"1rem",class:"text-xs"})):S.value?(m(),$("div",Ee,l(r.$t("credits.lastUpdated"))+": "+l(S.value),1)):U("",!0),i(t(w),{icon:"pi pi-refresh",text:"",size:"small",severity:"secondary",onClick:n[0]||(n[0]=()=>t(y).fetchBalance())})])]),d("div",we,[d("h3",null,l(r.$t("credits.activity")),1),i(t(w),{label:r.$t("credits.invoiceHistory"),text:"",severity:"secondary",icon:"pi pi-arrow-up-right",loading:C.value,onClick:o},null,8,["label","loading"])]),v.value.length>0?(m(),$("div",ke,[i(t(q),{value:v.value,"show-headers":!1},{default:b(()=>[i(t(T),{field:"title",header:r.$t("g.name")},{body:b(({data:u})=>[d("div",Se,l(u.title),1),d("div",De,l(u.timestamp),1)]),_:1},8,["header"]),i(t(T),{field:"amount",header:r.$t("g.amount")},{body:b(({data:u})=>[d("div",{class:K(["text-center text-base font-medium",u.isPositive?"text-sky-500":"text-red-400"])},l(u.isPositive?"+":"-")+"$"+l(t(re)(u.amount,"usd")),3)]),_:1},8,["header"])]),_:1},8,["value"])])):U("",!0),i(t(R)),i(_e,{ref_key:"usageLogsTableRef",ref:x},null,512),d("div",Te,[i(t(w),{label:r.$t("credits.faqs"),text:"",severity:"secondary",icon:"pi pi-question-circle",onClick:e},null,8,["label"]),i(t(w),{label:r.$t("subscription.partnerNodesCredits"),text:"",severity:"secondary",icon:"pi pi-question-circle",onClick:s},null,8,["label"]),i(t(w),{label:r.$t("credits.messageSupport"),text:"",severity:"secondary",icon:"pi pi-comments",onClick:_},null,8,["label"])])])]),_:1}))}});export{zt as default};
//# sourceMappingURL=CreditsPanel-z1qsDiqJ.js.map
