---
description: Assert each pytest test function contains exactly one assert
inputs:
  exclude:
    description: Glob patterns to exclude files (comma-separated)
    required: false
  fail-fast:
    default: "false"
    description: Exit on first finding
    required: false
  files:
    description: Target files to check (space-separated)
    required: true
  quiet:
    default: "false"
    description: Suppress output, exit code only
    required: false
  verbose:
    default: "false"
    description: Show files scanned/skipped, findings, and summary
    required: false
  warn-only:
    default: "false"
    description: Always exit 0, report only
    required: false
name: Assert One Assert Per Pytest
runs:
  steps:
    - run: python3 -m pip install assert-one-assert-per-pytest
      shell: bash
    - run: |
        ARGS=""
        [ "${{ inputs.quiet }}" = "true" ] && ARGS="$ARGS --quiet"
        [ "${{ inputs.verbose }}" = "true" ] && ARGS="$ARGS --verbose"
        [ "${{ inputs.fail-fast }}" = "true" ] && ARGS="$ARGS --fail-fast"
        [ "${{ inputs.warn-only }}" = "true" ] && ARGS="$ARGS --warn-only"
        if [ -n "${{ inputs.exclude }}" ]; then
          ARGS="$ARGS --exclude '${{ inputs.exclude }}'"
        fi
        set -f
        FILES=""
        for pattern in ${{ inputs.files }}; do
          FILES="$FILES '$pattern'"
        done
        set +f
        eval "assert-one-assert-per-pytest $ARGS $FILES"
      shell: bash
  using: composite
