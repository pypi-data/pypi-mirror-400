## 2.2.0 (2026-01-09)

### New features

- Comprehensive refactor of internal metadata handling with [Pint Quantities](https://pint.readthedocs.io/en/stable/) for representation of physical units and [EM Glossary v2.0.0](https://emglossary.helmholtz-metadaten.de/) standardized field names. All extractor plugins now create Pint Quantity objects for fields with units, providing type safety and machine-readable XML with separate value/unit attributes. Added type-specific validation schemas ({py:class}`~nexusLIMS.schemas.metadata.ImageMetadata`, {py:class}`~nexusLIMS.schemas.metadata.SpectrumMetadata`, {py:class}`~nexusLIMS.schemas.metadata.SpectrumImageMetadata`, {py:class}`~nexusLIMS.schemas.metadata.DiffractionMetadata`) and infrastructure modules for unit handling, EM Glossary integration via [RDFLib](https://rdflib.readthedocs.io/en/stable/index.html), and XML serialization. See the [internal schema docs](../dev_guide/nexuslims_internal_schema.md) for detail.

  > **Note:** Correct display of units in CDCS requires updated stylesheet ([NexusLIMS-CDCS commit 30faa97](https://github.com/datasophos/NexusLIMS-CDCS/commit/30faa97aa380fecc6eb94e6a6abf1631c71a4a5a)). ([#13](https://github.com/datasophos/NexusLIMS/issues/13))
- Added Pydantic-based schema validation for the `nx_meta` data structure returned by extractor plugins. This provides early error detection with clear error messages when plugins return malformed/unexpected metadata. The base `NexusMetadata` schema validates required fields and common optional fields. This is not a user-facing feature, but should provide a base from which to extend more formalized metadata schema verification. ([#13](https://github.com/datasophos/NexusLIMS/issues/13))
- Added multi-signal file support to automatically expand files containing multiple signals or datasets (such as DM3/DM4 files with multiple images or spectra) into separate dataset entries in experimental records. Each signal receives its own metadata extraction, preview image, and XML dataset element with signal indices in the name (e.g., "filename.dm3 (1 of 4)").

  > **Note:** Proper display and download of multi-signal records in the CDCS frontend requires an updated XSLT stylesheet, available in [NexusLIMS-CDCS commit 240a7f9](https://github.com/datasophos/NexusLIMS-CDCS/commit/240a7f9a87c799950b5bbf94ca30eedaef7a1adc). ([#14](https://github.com/datasophos/NexusLIMS/issues/14))
- Enhanced Digital Micrograph extractor to capture additional metadata from JEOL NEOARM TEM images including signal name (e.g., ADF, BF), aperture settings (condenser, objective, and selected area), and pixel dwell time (sample time in microseconds). (*Sponsored by UPenn/[Singh Center for Nanotechnology](https://www.nano.upenn.edu/resources/nanoscale-characterization/), thank you!*) ([#14](https://github.com/datasophos/NexusLIMS/issues/14))
- Added support for Tescan PFIB (Plasma FIB) TIFF files. The new extractor automatically detects and parses metadata from Tescan microscopy TIFF files, including imaging parameters, stage position, detector settings, and FIB-specific information. (*Sponsored by UPenn/[Singh Center for Nanotechnology](https://www.nano.upenn.edu/resources/nanoscale-characterization/), thank you!*) ([#15](https://github.com/datasophos/NexusLIMS/issues/15))
- Added support for Zeiss Orion and Fibics helium ion microscope TIFF files. The new extractor automatically detects the variant and parses metadata including beam parameters, stage position, and detector settings. (*Sponsored by UPenn/[Singh Center for Nanotechnology](https://www.nano.upenn.edu/resources/nanoscale-characterization/), thank you!*) ([#16](https://github.com/datasophos/NexusLIMS/issues/16))

### Documentation improvements

- Comprehensive documentation overhaul: restructured sections for clearer layout, added [internal schema docs](../dev_guide/nexuslims_internal_schema.md), expanded [extractor plugin documentation](../user_guide/extractors.md) with schema validation examples, updated [integration tests guide](../dev_guide/testing/integration-tests.md), enhanced [EM Glossary reference](../dev_guide/em_glossary_reference.md) with RDF/SKOS concepts, reorganized [taxonomy documentation](../user_guide/taxonomy.md) with complete metadata field reference, improved [developer guides](../dev_guide/development.md) with unit handling patterns and schema extension examples, updated long-outdated [record building](../user_guide/record_building.md) documentation, and fixed fomatting in [API docs](api.md). ([#13](https://github.com/datasophos/NexusLIMS/issues/13))
- Fixed changelog build issues with towncrier integration and Sphinx documentation generation, along with warnings.

### Miscellaneous/Development changes

- Replaced custom nested dictionary utility functions with the well-maintained [python-benedict](https://github.com/fabiocaccamo/python-benedict) library. This improves code reliability and maintainability by using battle-tested implementations for nested dictionary operations ({func}`~nexusLIMS.utils.set_nested_dict_value`, {func}`~nexusLIMS.utils.get_nested_dict_value_by_path`, {func}`~nexusLIMS.extractors.flatten_dict`). Removed vestigial functions `get_nested_dict_key` and `get_nested_dict_value` that had minimal or no production usage. ([#18](https://github.com/datasophos/NexusLIMS/issues/18))
- Refactored TIFF-based extractors ({class}`~nexusLIMS.extractors.plugins.quanta_tif.QuantaTiffExtractor`, {class}`~nexusLIMS.extractors.plugins.tescan_tif.TescanTiffExtractor`, {class}`~nexusLIMS.extractors.plugins.orion_HIM_tif.OrionTiffExtractor`) to use a standardized {class}`~nexusLIMS.extractors.base.FieldDefinition` configuration approach. This reduces code duplication and improves maintainability while preserving extraction functionality and accuracy. ([#21](https://github.com/datasophos/NexusLIMS/issues/21))
- Added Alembic for database schema version control and migrations. Existing installations should run `uv run alembic stamp head` to mark the database as migrated. New schema changes can be tracked with `uv run alembic revision --autogenerate` and applied with `uv run alembic upgrade head`. Configuration lives in `pyproject.toml` under `[tool.alembic]`. ([#24](https://github.com/datasophos/NexusLIMS/issues/24))
- Migrated database layer from raw SQLite to SQLModel ORM with type-safe enums ({class}`~nexusLIMS.db.enums.EventType`, {class}`~nexusLIMS.db.enums.RecordStatus`). This provides type-safe database operations with compile-time checks, automatic datetime handling, and relationship navigation. Notable changes: manual `db_query()` function removed (use SQLModel queries instead), `EventType` and `RecordStatus` are now enums instead of strings, and {class}`~nexusLIMS.db.models.SessionLog` and {class}`~nexusLIMS.db.models.Instrument` are now SQLModel classes. See the [database documentation](../dev_guide/database.md) for migration details and more info. ([#24](https://github.com/datasophos/NexusLIMS/issues/24))
- Refactored test suite to use marker-based infrastructure with opt-in database/file resources via `@pytest.mark.needs_db` and `@pytest.mark.needs_files` markers. Replaced autouse fixtures with on-demand `DatabaseFactory` and `FileFactory` for resource allocation. This delivers large performance improvement for tests that don't need database access, while maintaining 100% backward compatibility with existing tests and preventing cross-test pollution issues. ([#24](https://github.com/datasophos/NexusLIMS/issues/24))
- Refactored {func}`~nexusLIMS.utils.try_getting_dict_value` to return `None` instead of the magic string `"not found"` as a sentinel value. This improves type safety, follows Python best practices, and prevents potential collisions with legitimate metadata values. All 58 call sites throughout the codebase were updated to use `is None` and `is not None` checks.
