"""State schema for the research workflow.

This defines the shared state that flows through all nodes in the graph.
"""

from typing import Annotated
from operator import add

from pydantic import BaseModel, Field
from langgraph.graph.message import add_messages


class ResearchState(BaseModel):
    """State for the research workflow.

    Attributes:
        query: The original research query
        plan: Research plan generated by the planner
        findings: List of research findings (accumulates)
        analysis: Analysis of the findings
        summary: Final summary
        messages: Conversation history
        iteration: Current research iteration
    """

    query: str = Field(default="", description="Original research query")
    plan: str = Field(default="", description="Research plan")
    findings: Annotated[list[str], add] = Field(
        default_factory=list,
        description="Research findings (accumulated)",
    )
    analysis: str = Field(default="", description="Analysis of findings")
    summary: str = Field(default="", description="Final summary")
    messages: Annotated[list, add_messages] = Field(
        default_factory=list,
        description="Conversation messages",
    )
    iteration: int = Field(default=0, description="Research iteration count")
    max_iterations: int = Field(default=3, description="Max research iterations")
