# This file was auto-generated by Fern from our API Definition.

from __future__ import annotations

import typing

from ..core.client_wrapper import AsyncClientWrapper, SyncClientWrapper
from ..core.request_options import RequestOptions
from ..types.cascade_context_request import CascadeContextRequest
from ..types.cascade_context_response import CascadeContextResponse
from ..types.context_instance_history import ContextInstanceHistory
from ..types.context_instance_pending_response import ContextInstancePendingResponse
from ..types.context_instance_state import ContextInstanceState
from ..types.delete_context_instance_response import DeleteContextInstanceResponse
from ..types.solve_context_flow_request import SolveContextFlowRequest
from ..types.solve_context_flow_response import SolveContextFlowResponse
from ..types.solve_context_rule_request import SolveContextRuleRequest
from ..types.solve_context_rule_response import SolveContextRuleResponse
from ..types.submit_context_data_request import SubmitContextDataRequest
from ..types.submit_context_data_response import SubmitContextDataResponse
from .raw_client import AsyncRawContextsClient, RawContextsClient

if typing.TYPE_CHECKING:
    from .objects.client import AsyncObjectsClient, ObjectsClient
    from .relationships.client import AsyncRelationshipsClient, RelationshipsClient
# this is used as the default value for optional parameters
OMIT = typing.cast(typing.Any, ...)


class ContextsClient:
    def __init__(self, *, client_wrapper: SyncClientWrapper):
        self._raw_client = RawContextsClient(client_wrapper=client_wrapper)
        self._client_wrapper = client_wrapper
        self._objects: typing.Optional[ObjectsClient] = None
        self._relationships: typing.Optional[RelationshipsClient] = None

    @property
    def with_raw_response(self) -> RawContextsClient:
        """
        Retrieves a raw implementation of this client that returns raw responses.

        Returns
        -------
        RawContextsClient
        """
        return self._raw_client

    def get(
        self, slug: str, instance: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> ContextInstanceState:
        """
        Retrieve the current state of a context instance.

        Parameters
        ----------
        slug : str
            The unique slug for the context.

        instance : str
            The unique identifier for the context instance.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        ContextInstanceState
            Success

        Examples
        --------
        from rulebricks import Rulebricks

        client = Rulebricks(
            api_key="YOUR_API_KEY",
        )
        client.contexts.get(
            slug="customer",
            instance="cust-12345",
        )
        """
        _response = self._raw_client.get(slug, instance, request_options=request_options)
        return _response.data

    def submit(
        self,
        slug: str,
        instance: str,
        *,
        request: SubmitContextDataRequest,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> SubmitContextDataResponse:
        """
        Submit data to a context instance, creating it if it doesn't exist. May trigger bound rule/flow evaluations.

        Parameters
        ----------
        slug : str
            The unique slug for the context.

        instance : str
            The unique identifier for the context instance.

        request : SubmitContextDataRequest

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        SubmitContextDataResponse
            Data submitted successfully

        Examples
        --------
        from rulebricks import Rulebricks

        client = Rulebricks(
            api_key="YOUR_API_KEY",
        )
        client.contexts.submit(
            slug="customer",
            instance="cust-12345",
            request={"email": "customer@example.com", "age": 30},
        )
        """
        _response = self._raw_client.submit(slug, instance, request=request, request_options=request_options)
        return _response.data

    def delete(
        self, slug: str, instance: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> DeleteContextInstanceResponse:
        """
        Delete a specific context instance and its history.

        Parameters
        ----------
        slug : str
            The unique slug for the context.

        instance : str
            The unique identifier for the context instance.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        DeleteContextInstanceResponse
            Instance deleted successfully

        Examples
        --------
        from rulebricks import Rulebricks

        client = Rulebricks(
            api_key="YOUR_API_KEY",
        )
        client.contexts.delete(
            slug="customer",
            instance="cust-12345",
        )
        """
        _response = self._raw_client.delete(slug, instance, request_options=request_options)
        return _response.data

    def get_history(
        self,
        slug: str,
        instance: str,
        *,
        field: typing.Optional[str] = None,
        limit: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> ContextInstanceHistory:
        """
        Retrieve the change history for a context instance.

        Parameters
        ----------
        slug : str
            The unique slug for the context.

        instance : str
            The unique identifier for the context instance.

        field : typing.Optional[str]
            Filter history to a specific field.

        limit : typing.Optional[int]
            Maximum number of history entries to return.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        ContextInstanceHistory
            Success

        Examples
        --------
        from rulebricks import Rulebricks

        client = Rulebricks(
            api_key="YOUR_API_KEY",
        )
        client.contexts.get_history(
            slug="customer",
            instance="cust-12345",
        )
        """
        _response = self._raw_client.get_history(
            slug, instance, field=field, limit=limit, request_options=request_options
        )
        return _response.data

    def get_pending(
        self, slug: str, instance: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> ContextInstancePendingResponse:
        """
        Get list of rules/flows that need to be evaluated for this instance.

        Parameters
        ----------
        slug : str
            The unique slug for the context.

        instance : str
            The unique identifier for the context instance.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        ContextInstancePendingResponse
            Success

        Examples
        --------
        from rulebricks import Rulebricks

        client = Rulebricks(
            api_key="YOUR_API_KEY",
        )
        client.contexts.get_pending(
            slug="customer",
            instance="cust-12345",
        )
        """
        _response = self._raw_client.get_pending(slug, instance, request_options=request_options)
        return _response.data

    def solve(
        self,
        slug: str,
        instance: str,
        rule_slug: str,
        *,
        request: SolveContextRuleRequest,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> SolveContextRuleResponse:
        """
        Execute a specific rule using the context instance's state as input.

        Parameters
        ----------
        slug : str
            The unique slug for the context.

        instance : str
            The unique identifier for the context instance.

        rule_slug : str
            The unique slug for the rule.

        request : SolveContextRuleRequest

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        SolveContextRuleResponse
            Rule executed successfully

        Examples
        --------
        from rulebricks import Rulebricks

        client = Rulebricks(
            api_key="YOUR_API_KEY",
        )
        client.contexts.solve(
            slug="customer",
            instance="cust-12345",
            rule_slug="eligibility-check",
            request={},
        )
        """
        _response = self._raw_client.solve(slug, instance, rule_slug, request=request, request_options=request_options)
        return _response.data

    def cascade(
        self,
        slug: str,
        instance: str,
        *,
        request: CascadeContextRequest,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> CascadeContextResponse:
        """
        Trigger re-evaluation of all bound rules and flows for the instance.

        Parameters
        ----------
        slug : str
            The unique slug for the context.

        instance : str
            The unique identifier for the context instance.

        request : CascadeContextRequest

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        CascadeContextResponse
            Cascade completed successfully

        Examples
        --------
        from rulebricks import Rulebricks

        client = Rulebricks(
            api_key="YOUR_API_KEY",
        )
        client.contexts.cascade(
            slug="customer",
            instance="cust-12345",
            request={},
        )
        """
        _response = self._raw_client.cascade(slug, instance, request=request, request_options=request_options)
        return _response.data

    def execute(
        self,
        slug: str,
        instance: str,
        flow_slug: str,
        *,
        request: SolveContextFlowRequest,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> SolveContextFlowResponse:
        """
        Execute a specific flow using the context instance's state as input.

        Parameters
        ----------
        slug : str
            The unique slug for the context.

        instance : str
            The unique identifier for the context instance.

        flow_slug : str
            The unique slug for the flow.

        request : SolveContextFlowRequest

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        SolveContextFlowResponse
            Flow executed successfully

        Examples
        --------
        from rulebricks import Rulebricks

        client = Rulebricks(
            api_key="YOUR_API_KEY",
        )
        client.contexts.execute(
            slug="customer",
            instance="cust-12345",
            flow_slug="onboarding-flow",
            request={},
        )
        """
        _response = self._raw_client.execute(
            slug, instance, flow_slug, request=request, request_options=request_options
        )
        return _response.data

    @property
    def objects(self):
        if self._objects is None:
            from .objects.client import ObjectsClient  # noqa: E402

            self._objects = ObjectsClient(client_wrapper=self._client_wrapper)
        return self._objects

    @property
    def relationships(self):
        if self._relationships is None:
            from .relationships.client import RelationshipsClient  # noqa: E402

            self._relationships = RelationshipsClient(client_wrapper=self._client_wrapper)
        return self._relationships


class AsyncContextsClient:
    def __init__(self, *, client_wrapper: AsyncClientWrapper):
        self._raw_client = AsyncRawContextsClient(client_wrapper=client_wrapper)
        self._client_wrapper = client_wrapper
        self._objects: typing.Optional[AsyncObjectsClient] = None
        self._relationships: typing.Optional[AsyncRelationshipsClient] = None

    @property
    def with_raw_response(self) -> AsyncRawContextsClient:
        """
        Retrieves a raw implementation of this client that returns raw responses.

        Returns
        -------
        AsyncRawContextsClient
        """
        return self._raw_client

    async def get(
        self, slug: str, instance: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> ContextInstanceState:
        """
        Retrieve the current state of a context instance.

        Parameters
        ----------
        slug : str
            The unique slug for the context.

        instance : str
            The unique identifier for the context instance.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        ContextInstanceState
            Success

        Examples
        --------
        import asyncio

        from rulebricks import AsyncRulebricks

        client = AsyncRulebricks(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.contexts.get(
                slug="customer",
                instance="cust-12345",
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.get(slug, instance, request_options=request_options)
        return _response.data

    async def submit(
        self,
        slug: str,
        instance: str,
        *,
        request: SubmitContextDataRequest,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> SubmitContextDataResponse:
        """
        Submit data to a context instance, creating it if it doesn't exist. May trigger bound rule/flow evaluations.

        Parameters
        ----------
        slug : str
            The unique slug for the context.

        instance : str
            The unique identifier for the context instance.

        request : SubmitContextDataRequest

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        SubmitContextDataResponse
            Data submitted successfully

        Examples
        --------
        import asyncio

        from rulebricks import AsyncRulebricks

        client = AsyncRulebricks(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.contexts.submit(
                slug="customer",
                instance="cust-12345",
                request={"email": "customer@example.com", "age": 30},
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.submit(slug, instance, request=request, request_options=request_options)
        return _response.data

    async def delete(
        self, slug: str, instance: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> DeleteContextInstanceResponse:
        """
        Delete a specific context instance and its history.

        Parameters
        ----------
        slug : str
            The unique slug for the context.

        instance : str
            The unique identifier for the context instance.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        DeleteContextInstanceResponse
            Instance deleted successfully

        Examples
        --------
        import asyncio

        from rulebricks import AsyncRulebricks

        client = AsyncRulebricks(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.contexts.delete(
                slug="customer",
                instance="cust-12345",
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.delete(slug, instance, request_options=request_options)
        return _response.data

    async def get_history(
        self,
        slug: str,
        instance: str,
        *,
        field: typing.Optional[str] = None,
        limit: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> ContextInstanceHistory:
        """
        Retrieve the change history for a context instance.

        Parameters
        ----------
        slug : str
            The unique slug for the context.

        instance : str
            The unique identifier for the context instance.

        field : typing.Optional[str]
            Filter history to a specific field.

        limit : typing.Optional[int]
            Maximum number of history entries to return.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        ContextInstanceHistory
            Success

        Examples
        --------
        import asyncio

        from rulebricks import AsyncRulebricks

        client = AsyncRulebricks(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.contexts.get_history(
                slug="customer",
                instance="cust-12345",
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.get_history(
            slug, instance, field=field, limit=limit, request_options=request_options
        )
        return _response.data

    async def get_pending(
        self, slug: str, instance: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> ContextInstancePendingResponse:
        """
        Get list of rules/flows that need to be evaluated for this instance.

        Parameters
        ----------
        slug : str
            The unique slug for the context.

        instance : str
            The unique identifier for the context instance.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        ContextInstancePendingResponse
            Success

        Examples
        --------
        import asyncio

        from rulebricks import AsyncRulebricks

        client = AsyncRulebricks(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.contexts.get_pending(
                slug="customer",
                instance="cust-12345",
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.get_pending(slug, instance, request_options=request_options)
        return _response.data

    async def solve(
        self,
        slug: str,
        instance: str,
        rule_slug: str,
        *,
        request: SolveContextRuleRequest,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> SolveContextRuleResponse:
        """
        Execute a specific rule using the context instance's state as input.

        Parameters
        ----------
        slug : str
            The unique slug for the context.

        instance : str
            The unique identifier for the context instance.

        rule_slug : str
            The unique slug for the rule.

        request : SolveContextRuleRequest

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        SolveContextRuleResponse
            Rule executed successfully

        Examples
        --------
        import asyncio

        from rulebricks import AsyncRulebricks

        client = AsyncRulebricks(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.contexts.solve(
                slug="customer",
                instance="cust-12345",
                rule_slug="eligibility-check",
                request={},
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.solve(
            slug, instance, rule_slug, request=request, request_options=request_options
        )
        return _response.data

    async def cascade(
        self,
        slug: str,
        instance: str,
        *,
        request: CascadeContextRequest,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> CascadeContextResponse:
        """
        Trigger re-evaluation of all bound rules and flows for the instance.

        Parameters
        ----------
        slug : str
            The unique slug for the context.

        instance : str
            The unique identifier for the context instance.

        request : CascadeContextRequest

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        CascadeContextResponse
            Cascade completed successfully

        Examples
        --------
        import asyncio

        from rulebricks import AsyncRulebricks

        client = AsyncRulebricks(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.contexts.cascade(
                slug="customer",
                instance="cust-12345",
                request={},
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.cascade(slug, instance, request=request, request_options=request_options)
        return _response.data

    async def execute(
        self,
        slug: str,
        instance: str,
        flow_slug: str,
        *,
        request: SolveContextFlowRequest,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> SolveContextFlowResponse:
        """
        Execute a specific flow using the context instance's state as input.

        Parameters
        ----------
        slug : str
            The unique slug for the context.

        instance : str
            The unique identifier for the context instance.

        flow_slug : str
            The unique slug for the flow.

        request : SolveContextFlowRequest

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        SolveContextFlowResponse
            Flow executed successfully

        Examples
        --------
        import asyncio

        from rulebricks import AsyncRulebricks

        client = AsyncRulebricks(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.contexts.execute(
                slug="customer",
                instance="cust-12345",
                flow_slug="onboarding-flow",
                request={},
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.execute(
            slug, instance, flow_slug, request=request, request_options=request_options
        )
        return _response.data

    @property
    def objects(self):
        if self._objects is None:
            from .objects.client import AsyncObjectsClient  # noqa: E402

            self._objects = AsyncObjectsClient(client_wrapper=self._client_wrapper)
        return self._objects

    @property
    def relationships(self):
        if self._relationships is None:
            from .relationships.client import AsyncRelationshipsClient  # noqa: E402

            self._relationships = AsyncRelationshipsClient(client_wrapper=self._client_wrapper)
        return self._relationships
