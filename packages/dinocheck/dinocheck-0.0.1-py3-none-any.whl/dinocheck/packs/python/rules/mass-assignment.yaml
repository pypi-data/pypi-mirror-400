id: python/mass-assignment
name: Mass Assignment Vulnerability
level: blocker
category: security
description: |
  Detects patterns where user input is passed directly to object
  creation or update without field whitelisting. This allows
  attackers to modify fields they shouldn't have access to.

triggers:
  file_patterns:
    - "**/*.py"
  code_patterns:
    - "\\*\\*request\\.(data|json|POST|GET)"
    - "\\*\\*data"
    - "\\*\\*kwargs"
    - "\\.create\\(\\*\\*"
    - "\\.update\\(\\*\\*"
    - "setattr.*request"

checklist:
  - Is user input spread directly into model creation?
  - Could an attacker set is_admin, is_staff, or similar?
  - Are there sensitive fields that shouldn't be user-settable?
  - Is there a whitelist of allowed fields?
  - Could nested data modify related objects?

fix: |
  Use explicit field assignment or whitelists. Use serializers
  with explicit fields. Never pass request data directly to
  model methods. Validate and extract only expected fields.

tags:
  - security
  - mass-assignment
  - injection

examples:
  bad: |
    def create_user(request):
        user = User.objects.create(**request.data)
        # Attacker can send {"is_admin": true}!
        return user
  good: |
    def create_user(request):
        user = User.objects.create(
            email=request.data['email'],
            name=request.data['name'],
            # is_admin NOT settable from request
        )
        return user
