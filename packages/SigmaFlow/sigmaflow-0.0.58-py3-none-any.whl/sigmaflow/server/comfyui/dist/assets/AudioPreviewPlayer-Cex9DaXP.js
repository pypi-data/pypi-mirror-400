var X=Object.defineProperty;var t=(_,u)=>X(_,"name",{value:u,configurable:!0});import{defineComponent as Y,ref as s,computed as n,watch as Z,nextTick as ee,onUnmounted as oe,openBlock as r,createElementBlock as i,normalizeClass as te,unref as m,createElementVNode as a,toDisplayString as k,normalizeStyle as ae,createCommentVNode as C,createVNode as O,withCtx as le}from"vue";import re from"primevue/slider";import ie from"primevue/tieredmenu";import{useI18n as se}from"vue-i18n";import{r as B,bx as ne,m as ue,a as ce,c as z,L as de,d as pe}from"./index-6STX4Oia.js";import{i as me}from"./nodeFilterUtil-D49mCu4H.js";import{g as ve,f as R}from"./audioUtils-j6qvA_Je.js";import"@primevue/themes";import"@primevue/themes/aura";import"./vendor-other-_sromytg.js";import"./vendor-vue-CrN17A9b.js";import"primevue/config";import"primevue/confirmationservice";import"primevue/toastservice";import"primevue/tooltip";import"primevue/button";import"primevue/message";import"primevue/skeleton";import"primevue/multiselect";import"primevue/inputtext";import"primevue/select";import"primevue/checkbox";import"primevue/divider";import"primevue/scrollpanel";import"primevue/usetoast";import"primevue/card";import"primevue/listbox";import"primevue/progressbar";import"primevue/floatlabel";import"@primevue/forms";import"@primevue/forms/resolvers/zod";import"primevue/password";import"primevue/progressspinner";import"primevue/tag";import"primevue/inputnumber";import"primevue/tabpanels";import"primevue/tabs";import"primevue/iconfield";import"primevue/inputicon";import"primevue/badge";import"primevue/chip";import"primevue/tabpanel";import"primevue/toggleswitch";import"primevue/colorpicker";import"primevue/radiobutton";import"primevue/knob";import"primevue/panel";import"primevue/tabmenu";import"primevue/popover";import"primevue/tab";import"primevue/tablist";import"primevue";import"primevue/autocomplete";import"primevue/dropdown";import"./vendor-xterm-DV1MVhAx.js";import"./vendor-three-zdhtZbSm.js";import"primevue/galleria";import"primevue/tabview";import"primevue/contextmenu";import"primevue/tree";import"primevue/toolbar";import"primevue/selectbutton";import"primevue/dialog";import"primevue/confirmpopup";import"primevue/useconfirm";import"primevue/confirmdialog";import"./vendor-tiptap-D1RRboMA.js";import"primevue/blockui";const fe={class:"relative"},ye={class:"relative flex shrink-0 items-center justify-start gap-2"},he={key:0,class:"text-secondary icon-[lucide--play] size-4"},be={key:1,class:"text-secondary icon-[lucide--pause] size-4"},ge={class:"text-sm font-normal text-nowrap text-base-foreground"},ke={class:"relative h-0.5 flex-1 rounded-full bg-interface-stroke"},_e=["value","aria-label"],xe={class:"relative flex shrink-0 items-center justify-start gap-2"},we={key:0,class:"text-secondary icon-[lucide--volume-2] size-4"},Ce={key:1,class:"text-secondary icon-[lucide--volume-1] size-4"},Oe={key:2,class:"text-secondary icon-[lucide--volume-x] size-4"},ze={key:0,class:"w-48 px-4 py-2"},Pe={class:"mb-2 block text-xs text-base-foreground"},Ie=["onClick"],Le={class:"text-base-foreground"},Ae={key:0,class:"ml-auto icon-[lucide--check] size-4 text-base-foreground"},Be=Y({__name:"AudioPreviewPlayer",props:{readonly:{type:Boolean},hideWhenEmpty:{type:Boolean,default:!0},showOptionsButton:{type:Boolean},modelValue:{},nodeId:{},audioUrl:{}},setup(_){const{t:u}=se(),h=_,o=s(),P=s(),T=s(),v=s(!1),c=s(!1),f=s(1),y=s(0),d=s(0),I=s(!1),b=s(1),L=n(()=>!d.value||d.value===0?0:y.value/d.value*100),V=n(()=>!c.value&&f.value>.5),N=n(()=>c.value&&f.value>0),g=n(()=>!h.nodeId||!B.rootGraph?null:B.rootGraph.getNodeById(h.nodeId)),S=n(()=>g.value?g.value.constructor?.comfyClass==="LoadAudio"&&!!h.nodeId:!1),U=n(()=>{const e=g.value;return!!e&&me(e)}),A=n(()=>{const e=g.value;return e?ne(e):null}),M=ue(),j=n(()=>{if(!U.value||!A.value)return"";const e=M.nodeOutputs[A.value];if(!e?.audio||e.audio.length===0)return"";const l=e.audio[0];return l.filename?ce.apiURL(ve(l.subfolder||"",l.filename,l.type||"output")):""}),E=n(()=>j.value||h.audioUrl||""),F=t(()=>{!o.value||!o.value.src||(v.value?o.value.pause():o.value.play(),v.value=!v.value)},"togglePlayPause"),D=t(()=>{o.value&&(c.value=!c.value,o.value.muted=c.value)},"toggleMute"),$=t(e=>{const l=e.target,p=parseFloat(l.value);if(o.value&&d.value>0){const w=p/100*d.value;o.value.currentTime=w,y.value=w}},"handleSeek"),G=t(()=>{o.value&&(d.value=o.value.duration)},"handleLoadedMetadata"),W=t(()=>{o.value&&(y.value=o.value.currentTime)},"handleTimeUpdate"),q=t(()=>{v.value=!1,y.value=0},"handleEnded"),H=t(e=>{P.value?.toggle(e)},"toggleOptionsMenu"),x=t(e=>{b.value=e,o.value&&(o.value.playbackRate=e)},"setPlaybackSpeed"),J=t(e=>{const l=Array.isArray(e)?e[0]:e;f.value=l/10,o.value&&(o.value.volume=f.value,f.value>0&&c.value&&(c.value=!1,o.value.muted=!1))},"handleVolumeChange"),K=n(()=>[{label:u("g.playbackSpeed"),items:[{label:u("g.halfSpeed"),onClick:t(()=>x(.5),"onClick"),selected:b.value===.5},{label:u("g.1x"),onClick:t(()=>x(1),"onClick"),selected:b.value===1},{label:u("g.2x"),onClick:t(()=>x(2),"onClick"),selected:b.value===2}]},{label:u("g.volume"),key:"volume"}]),Q=t(e=>{o.value&&(v.value=!1,o.value.pause(),o.value.src=e,o.value.load(),I.value=!!e)},"loadAudioFromUrl");return Z(E,e=>{e&&ee(()=>{Q(e)})},{immediate:!0}),oe(()=>{o.value&&(o.value.pause(),o.value.src="")}),(e,l)=>(r(),i("div",fe,[S.value?C("",!0):(r(),i("div",{key:0,class:te(m(z)("bg-component-node-widget-background box-border flex gap-4 items-center justify-start relative rounded-lg w-full h-16 px-4 py-0",{hidden:e.hideWhenEmpty&&!I.value}))},[a("audio",{ref_key:"audioRef",ref:o,onLoadedmetadata:G,onTimeupdate:W,onEnded:q},null,544),a("div",ye,[a("div",{role:"button",tabindex:0,"aria-label":"Play/Pause",class:"flex size-6 cursor-pointer items-center justify-center rounded hover:bg-interface-menu-component-surface-hovered",onClick:F},[v.value?(r(),i("i",be)):(r(),i("i",he))]),a("div",ge,k(m(R)(y.value))+" / "+k(m(R)(d.value)),1)]),a("div",ke,[a("div",{class:"absolute top-0 left-0 h-full rounded-full bg-button-icon transition-all",style:ae({width:`${L.value}%`})},null,4),a("input",{type:"range",value:L.value,min:"0",max:"100",step:"0.1","aria-label":e.$t("g.audioProgress"),class:"absolute inset-0 w-full cursor-pointer opacity-0",onInput:$},null,40,_e)]),a("div",xe,[a("div",{role:"button",tabindex:0,"aria-label":"Volume",class:"flex size-6 cursor-pointer items-center justify-center rounded hover:bg-interface-menu-component-surface-hovered",onClick:D},[V.value?(r(),i("i",we)):N.value?(r(),i("i",Ce)):(r(),i("i",Oe))]),e.showOptionsButton?(r(),i("div",{key:0,ref_key:"optionsButtonRef",ref:T,role:"button",tabindex:0,"aria-label":"More Options",class:"flex size-6 cursor-pointer items-center justify-center rounded hover:bg-interface-menu-component-surface-hovered",onClick:H},l[0]||(l[0]=[a("i",{class:"text-secondary icon-[lucide--more-vertical] size-4"},null,-1)]),512)):C("",!0)]),O(m(ie),{ref_key:"optionsMenu",ref:P,model:K.value,popup:"",class:"audio-player-menu","pt:root:class":m(z)("bg-component-node-widget-background border-component-node-border"),"pt:submenu:class":m(z)("bg-component-node-widget-background")},{item:le(({item:p})=>[p.key==="volume"?(r(),i("div",ze,[a("label",Pe,k(p.label),1),O(m(re),{"model-value":f.value*10,min:0,max:10,step:1,class:"w-full","onUpdate:modelValue":J},null,8,["model-value"])])):(r(),i("div",{key:1,class:"flex cursor-pointer items-center px-4 py-2 text-xs hover:bg-white/10",onClick:t(w=>p.onClick?.(),"onClick")},[a("span",Le,k(p.label),1),p.selected?(r(),i("i",Ae)):C("",!0)],8,Ie))]),_:1},8,["model","pt:root:class","pt:submenu:class"])],2)),O(de)]))}}),Jo=pe(Be,[["__scopeId","data-v-efd79935"]]);export{Jo as default};
//# sourceMappingURL=AudioPreviewPlayer-Cex9DaXP.js.map
