import{p as ut,F as Rt,e as i,v as ft,l as it,g as a,H as qt,b as zt,i as mt,f as N,w as W,C as ct,h as pt,t as I,k as T,Q as dt,X as Lt,c as ht,m as _,n as w,G as vt,U as Mt,r as x,J as Y,N as K,I as At,Y as Dt}from"../chunks/tJ-1PvYF.js";import{_ as St}from"../chunks/PPVm8Dsz.js";import{B as Ct}from"../chunks/DZ5Aek4G.js";import{D as Ot}from"../chunks/BRt1D930.js";import{w as gt,f as Vt}from"../chunks/DAWgyOON.js";import{P as Wt}from"../chunks/Ba3EtZVA.js";var Gt=N('<div class="text-sm text-blue-600"> </div>'),Bt=N('<div class="text-sm text-red-600 mb-3"> </div>'),Qt=N("<span>Saving...</span>"),Ut=N("<span>Save Rock Types</span>"),Jt=N("<div> </div>"),Ht=N('<div class="ws-rock-typing"><div class="mb-2"><div class="font-semibold">Rock Typing (Multi-Well)</div> <div class="text-sm text-muted-foreground">Cluster wells into rock types across the project.</div></div> <!> <div class="bg-panel rounded p-3 mb-3"><!> <div class="flex-1"><label for="cutoffs" class="block text-sm font-medium mb-1">FZI Cutoffs (comma-separated)</label> <div class="flex gap-2 items-end"><input id="cutoffs" type="text" class="flex-1 px-3 py-2 border border-border rounded-md bg-background text-foreground" placeholder="e.g., 0.5,1.0,2.0"/> <!></div></div> <!> <div class="font-semibold mb-2">FZI Log-Log Plot</div> <div class="text-sm text-muted-foreground mb-3">Plot Flow Zone Indicator (FZI) from porosity and permeability data across all wells.</div> <div class="bg-surface rounded p-3 min-h-[400px]"><div class="w-full max-w-[600px] h-[500px] mx-auto"></div></div> <div class="font-semibold mb-2">Pore-Perm Crossplot</div> <div class="text-sm text-muted-foreground mb-3">Plot porosity vs permeability with FZI cutoff lines and rock type coloring.</div> <div class="bg-surface rounded p-3 min-h-[400px]"><div class="w-full max-w-[600px] h-[500px] mx-auto"></div></div></div></div>');function Xt(G,A){ut(A,!1);let g=Rt(A,"projectId",8,null),j=_(!1),y=_(null),D=_(!1),F=_(null),u=_(null),R=_({enabled:!1,zones:[]}),B=_(null),q=null,z=0,_t=120,Z=_(null);const yt=1e3,bt=gt.subscribe(e=>{e?.zoneFilter&&i(R,{...e.zoneFilter})});ft(()=>{bt(),q&&clearInterval(q)});function L(){q&&(clearInterval(q),q=null),i(Z,null)}function tt(){if(!a(u))return null;const e=a(u).phit.map((o,n)=>({phit:o,perm:a(u).perm[n],zone:a(u).zones[n],well_name:a(u).well_names[n],depth:a(u).depths[n]})),r=Vt(e,a(R));return{phit:r.map(o=>o.phit),perm:r.map(o=>o.perm),zones:r.map(o=>o.zone),well_names:r.map(o=>o.well_name),depths:r.map(o=>o.depth)}}let $=_("0.1, 1.0, 3.0, 6.0"),S=null,C=_(null),O=_(null);const Q="http://localhost:6312";async function et(){if(S)return S;const e=await St(()=>import("../chunks/BJMC0GYJ.js").then(r=>r.p),[],import.meta.url);return S=e.default||e,S}async function wt(){if(g()){i(D,!0),i(F,null),L();try{i(Z,"Initiating FZI data generation...");const e=await xt(),{task_id:r,result:o}=e;let n;if(o?n=o:(i(Z,"Waiting for FZI data..."),n=await kt(r)),!n||typeof n!="object")throw new Error("Unexpected data format from backend");i(u,n)}catch(e){i(F,e.message||"Failed to load FZI data"),i(u,null)}finally{i(D,!1),i(Z,null),L()}}}async function xt(){const e=await fetch(`${Q}/quick_pp/database/projects/${g()}/fzi_data/generate`,{method:"POST"});if(!e.ok)throw new Error(await e.text());const r=await e.json();if(!r.task_id)throw new Error("No task_id returned from server");return{task_id:r.task_id,result:r.result}}async function kt(e){const r=`${Q}/quick_pp/database/projects/${g()}/fzi_data/result/${e}`;return new Promise((o,n)=>{z=0;const f=async()=>{if(z>=_t){const p="FZI generation timed out after 2 minutes";console.error(p),L(),n(new Error(p));return}try{const p=await fetch(r);if(!p.ok)throw new Error(`Poll failed with status ${p.status}`);const l=await p.json();l.status==="success"?(L(),o(l.result)):l.status==="error"?(L(),n(new Error(l.error||"Task failed with unknown error"))):l.status==="pending"?(i(Z,`Loading FZI data... (${z}s)`),z++):(L(),n(new Error(`Unknown task status: ${l.status}`)))}catch(p){console.error("Poll request failed:",p),i(Z,`Retrying... (attempt ${z})`),z++}};f(),q=window.setInterval(f,yt)})}function Pt(){const e=tt();if(!e||!a(C))return;const{phit:r,perm:o}=e,n=r.map((t,s)=>.0314*Math.sqrt(o[s]/t)),f=r.map(t=>t<=0||!isFinite(t)?NaN:t/(1-t)),p=n.map((t,s)=>t/f[s]),l=a($).split(",").map(t=>parseFloat(t.trim())).filter(t=>!isNaN(t)&&t>0),m=p.map(t=>{if(isNaN(t)||!isFinite(t))return null;let s=l.length+1;for(let c=l.length-1;c>=0;c--)if(t>=l[c]){s=l.length-1-c+1;break}return s}),v=new Array,h={};m.forEach((t,s)=>{t!==null&&(h[t]||(h[t]={phiZ:[],rqi:[]}),h[t].phiZ.push(f[s]),h[t].rqi.push(n[s]))});const k=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];Object.keys(h).sort((t,s)=>parseInt(t)-parseInt(s)).forEach(t=>{const s=h[parseInt(t)];v.push({x:s.phiZ,y:s.rqi,mode:"markers",type:"scatter",name:`Rock Type ${t}`,marker:{color:k[(parseInt(t)-1)%k.length],size:4,symbol:"circle"}})});const b=f.filter(t=>t>0&&isFinite(t));if(b.length>0){const t=Math.min(...b),s=Math.max(...b),c=[];for(let P=0;P<20;P++)c.push(t*Math.pow(s/t,P/19));l.forEach(P=>{const V=c.map(E=>P*E);v.push({x:c,y:V,mode:"lines",type:"scatter",name:`FZI=${P.toFixed(1)}`,line:{dash:"dash",color:"red"}})})}const d={title:"FZI Log-Log Plot",xaxis:{title:"Pore to Solid Volume Ratio (phi_z)",type:"log",autorange:!0},yaxis:{title:"Rock Quality Index (RQI)",type:"log",autorange:!0},showlegend:!0,margin:{l:60,r:60,t:60,b:60}};et().then(t=>{t.newPlot(a(C),v,d,{responsive:!0})})}function It(){const e=tt();if(!e||!a(O))return;const{phit:r,perm:o}=e,n=r.map((t,s)=>.0314*Math.sqrt(o[s]/t)),f=r.map(t=>t/(1-t)),p=n.map((t,s)=>t/f[s]),l=a($).split(",").map(t=>parseFloat(t.trim())).filter(t=>!isNaN(t)&&t>0),m=p.map(t=>{if(isNaN(t)||!isFinite(t))return null;let s=l.length+1;for(let c=l.length-1;c>=0;c--)if(t>=l[c]){s=l.length-1-c+1;break}return s}),v=new Array,h={};m.forEach((t,s)=>{t!==null&&(h[t]||(h[t]={phit:[],perm:[]}),h[t].phit.push(r[s]),h[t].perm.push(o[s]))});const k=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];Object.keys(h).sort((t,s)=>parseInt(t)-parseInt(s)).forEach(t=>{const s=h[parseInt(t)];v.push({x:s.phit,y:s.perm,mode:"markers",type:"scatter",name:`Rock Type ${t}`,marker:{color:k[(parseInt(t)-1)%k.length],size:4,symbol:"circle"}})});const b=new Array;for(let t=0;t<=50;t++)b.push(t*.01);l.forEach((t,s)=>{const c=b.map(M=>M<=0||M>=1?null:M*Math.pow(M*t/(.0314*(1-M)),2));v.push({x:b,y:c,mode:"lines",type:"scatter",name:`FZI=${t.toFixed(1)}`,line:{dash:"dash",color:"red"}});const P=l.length-s,V=Math.floor(b.length*.7);let E=c[V];E!==null&&E>0?E=E*2.5:E=1,v.push({x:[b[V]],y:[E],mode:"text",type:"scatter",name:`PRT ${P}`,text:[`PRT ${P}`],textposition:"middle right",showlegend:!1,textfont:{size:10,color:"red"}})});const d={title:"Pore-Perm Crossplot",xaxis:{title:"Porosity (fraction)",range:[-.05,.5],autorange:!1},yaxis:{title:"Permeability (mD)",type:"log",autorange:!0},showlegend:!0,margin:{l:60,r:60,t:60,b:60}};et().then(t=>{t.newPlot(a(O),v,d,{responsive:!0})})}async function Ft(){if(!(!a(u)||!g())){i(j,!0),i(y,null);try{const e=a(u).phit,r=a(u).perm,o=a(u).well_names,n=a(u).depths,f=e.map((d,t)=>.0314*Math.sqrt(r[t]/d)),p=e.map(d=>d/(1-d)),l=f.map((d,t)=>d/p[t]),m=a($).split(",").map(d=>parseFloat(d.trim())).filter(d=>!isNaN(d)&&d>0),v=l.map((d,t)=>{let s=null;if(!isNaN(d)&&isFinite(d)){s=m.length+1;for(let c=m.length-1;c>=0;c--)if(d>=m[c]){s=m.length-1-c+1;break}}return{well_name:o[t],depth:n[t],rock_flag:s}}),h=`${Q}/quick_pp/database/projects/${g()}/save_rock_flags`,k=await fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rock_flag_pairs:v,cutoffs:a($)})});if(!k.ok)throw new Error(await k.text());const b=await k.json();i(y,`Success: ${b.message}`)}catch(e){i(y,`Error: ${e.message}`)}finally{i(j,!1)}}}it(()=>(qt(g()),a(B)),()=>{g()&&g()!==a(B)&&(i(B,g()),wt())}),it(()=>(a(u),a($),a(R)),()=>{a(u)&&a($)&&a(R)&&(Pt(),It())}),zt(),mt();var U=Ht(),at=T(w(U),2);Ot(at,{});var rt=T(at,2),st=w(rt);{var Zt=e=>{var r=Gt(),o=w(r,!0);x(r),Y(()=>K(o,a(Z)?a(Z):"Loading FZI data...")),I(e,r)},$t=e=>{var r=ct(),o=pt(r);{var n=f=>{var p=Bt(),l=w(p,!0);x(p),Y(()=>K(l,a(F))),I(f,p)};W(o,f=>{a(F)&&f(n)},!0)}I(e,r)};W(st,e=>{a(D)?e(Zt):e($t,!1)})}var J=T(st,2),ot=T(w(J),2),H=w(ot);Mt(H);var Et=T(H,2);{let e=vt(()=>a(j)||!a(u));Ct(Et,{onclick:Ft,get disabled(){return a(e)},children:(r,o)=>{var n=ct(),f=pt(n);{var p=m=>{var v=Qt();I(m,v)},l=m=>{var v=Ut();I(m,v)};W(f,m=>{a(j)?m(p):m(l,!1)})}I(r,n)},$$slots:{default:!0}})}x(ot),x(J);var nt=T(J,2);{var Tt=e=>{var r=Jt(),o=w(r,!0);x(r),Y(n=>{Dt(r,1,`text-sm ${n??""}`),K(o,a(y))},[()=>(a(y),At(()=>a(y).startsWith("Error")?"text-red-600":"text-green-600"))]),I(e,r)};W(nt,e=>{a(y)&&e(Tt)})}var X=T(nt,6),Nt=w(X);dt(Nt,e=>i(C,e),()=>a(C)),x(X);var lt=T(X,6),jt=w(lt);dt(jt,e=>i(O,e),()=>a(O)),x(lt),x(rt),x(U),Lt(H,()=>a($),e=>i($,e)),I(G,U),ht()}var Yt=N('<div slot="left"><!></div>');function oe(G,A){ut(A,!1);let g=_(null);const j=gt.subscribe(y=>{i(g,y?.project??null)});ft(()=>j()),mt(),Wt(G,{get project(){return a(g)},$$slots:{left:(y,D)=>{var F=Yt(),u=w(F);{let R=vt(()=>a(g)?.project_id??null);Xt(u,{get projectId(){return a(R)}})}x(F),I(y,F)}}}),ht()}export{oe as component};
