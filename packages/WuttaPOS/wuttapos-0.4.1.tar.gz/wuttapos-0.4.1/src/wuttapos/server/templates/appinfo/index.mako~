## -*- coding: utf-8; -*-
<%inherit file="wuttaweb:templates/appinfo/index.mako" />

<%def name="middle_buttons()">
  ${parent.middle_buttons()}

  % if request.is_root:
      <b-button type="is-warning"
                icon-pack="fas"
                icon-left="table"
                @click="installSampleData()"
                :disabled="installingSampleData">
        {{ installingSampleData ? "Working, please wait..." : "Install Sample Data" }}
      </b-button>
      ${h.form(request.route_url(f"{route_prefix}.install_sample_data"), ref="installSampleDataForm")}
      ${h.csrf_token(request)}
      ${h.end_form()}
  % endif
</%def>

## <%def name="page_content()">
## 
##   <nav class="panel">
##     <p class="panel-heading">Application</p>
##     <div class="panel-block">
##       <div style="width: 100%;">
##         <b-field horizontal label="Distribution">
##           <span>${app.get_distribution() or f'?? - set config for `{app.appname}.app_dist`'}</span>
##         </b-field>
##         <b-field horizontal label="Version">
##           <span>${app.get_version() or f'?? - set config for `{app.appname}.app_dist`'}</span>
##         </b-field>
##         <b-field horizontal label="App Title">
##           <span>${app.get_title()}</span>
##         </b-field>
##         <b-field horizontal label="Node Title">
##           <span>${app.get_node_title()}</span>
##         </b-field>
##         <b-field horizontal label="DB Backend">
##           <span>${config.appdb_engine.dialect.name}</span>
##         </b-field>
##         <b-field horizontal label="Time Zone">
##           <span>${app.get_timezone_name()}</span>
##         </b-field>
##         <b-field horizontal label="Production Mode">
##           <span>${"Yes" if config.production() else "No"}</span>
##         </b-field>
##         <b-field horizontal label="Email Enabled">
##           <span>${"Yes" if app.get_email_handler().sending_is_enabled() else "No"}</span>
##         </b-field>
##       </div>
##     </div>
##   </nav>
## 
##   <div class="buttons">
## 
##     % if request.has_perm("master_views.list"):
##         <wutta-button type="is-primary"
##                       tag="a" href="${url('master_views')}"
##                       icon-left="eye"
##                       label="Master Views"
##                       once />
##     % endif
## 
##     % if request.has_perm("app_tables.list"):
##         <wutta-button type="is-primary"
##                       tag="a" href="${url('app_tables')}"
##                       icon-left="table"
##                       label="App Tables"
##                       once />
##     % endif
## 
##     % if request.has_perm("alembic.dashboard"):
##         <wutta-button type="is-primary"
##                       tag="a" href="${url('alembic.dashboard')}"
##                       icon-left="forward"
##                       label="Alembic Dashboard"
##                       once />
##     % endif
## 
##   </div>
## 
##   <nav class="panel">
##     <p class="panel-heading">Configuration Files</p>
##     <div class="panel-block">
##       <div style="width: 100%;">
##         <${b}-table :data="configFiles">
## 
##           <${b}-table-column field="priority"
##                           label="Priority"
##                           v-slot="props">
##             {{ props.row.priority }}
##           </${b}-table-column>
## 
##           <${b}-table-column field="path"
##                           label="File Path"
##                           v-slot="props">
##             {{ props.row.path }}
##           </${b}-table-column>
## 
##         </${b}-table>
##       </div>
##     </div>
##   </nav>
## 
##   <${b}-collapse class="panel"
##                  :open="false"
##                  @open="openInstalledPackages">
## 
##     <template #trigger="props">
##       <div class="panel-heading"
##            style="cursor: pointer;"
##            role="button">
## 
##         ## TODO: for some reason buefy will "reuse" the icon
##         ## element in such a way that its display does not
##         ## refresh.  so to work around that, we use different
##         ## structure for the two icons, so buefy is forced to
##         ## re-draw
## 
##         <b-icon v-if="props.open"
##                 pack="fas"
##                 icon="angle-down" />
## 
##         <span v-if="!props.open">
##           <b-icon pack="fas"
##                   icon="angle-right" />
##         </span>
## 
##         <strong>Installed Packages</strong>
##       </div>
##     </template>
## 
##     <div class="panel-block">
##       <div style="width: 100%;">
##         ${grid.render_vue_tag(ref='packagesGrid')}
##       </div>
##     </div>
##   </${b}-collapse>
## 
## </%def>
## 
## <%def name="modify_vue_vars()">
##   ${parent.modify_vue_vars()}
##   <script>
## 
##     ThisPageData.configFiles = ${json.dumps([dict(path=p, priority=i) for i, p in enumerate(config.get_prioritized_files(), 1)])|n}
## 
##     ThisPage.methods.openInstalledPackages = function() {
##         this.$refs.packagesGrid.fetchFirstData()
##     }
## 
##   </script>
## </%def>
## 
## 
## ${parent.body()}

<%def name="modify_vue_vars()">
  ${parent.modify_vue_vars()}

  % if request.is_root:
      <script>

        ThisPageData.installingSampleData = false

        ThisPage.methods.installSampleData = function() {
            if (confirm("Really install sample data?")) {
                this.installingSampleData = true
                this.$refs.installSampleDataForm.submit()
            }
        }

      </script>
  % endif
</%def>
