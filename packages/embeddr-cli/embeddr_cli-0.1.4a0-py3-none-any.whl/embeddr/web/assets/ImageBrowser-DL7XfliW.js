import{c as te,a5 as ne,F as re,B as ie,j as e,Q as ce,T as oe,b as i,X as U,r as l,e as de,au as L,u as z,I as he,S as _,f as D,h as F,i as Q,k as v,am as S,an as C,ao as k,ap as r,p as me,a7 as xe,av as ue,E as pe}from"./index-D87ilqMg.js";import{E as je,a as E,b as ge,S as fe,V as B,F as K,A as P,c as M,P as ve,s as Ne,d as ye,f as we}from"./useLocalStorage-DEoeC3Vt.js";import{a as be}from"./library-CemcgxM6.js";import{L as V,F as T,I as O}from"./library-Cqp4m2hh.js";const Ie=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],Se=te("sliders-horizontal",Ie);function Ce({image:a,onClose:c}){const{selectImage:N}=ne(),p=re();if(!a)return null;const n=`${ie}/images/${a.id}/file`,o=()=>{N(a),p({to:"/create"}),c()};return e.jsx(ce,{open:!!a,onOpenChange:d=>!d&&c(),children:e.jsxs(oe,{className:"max-w-7xl w-full h-[90vh] flex flex-col p-0 gap-0 bg-background/95 backdrop-blur-sm border-none",children:[e.jsxs("div",{className:"absolute right-4 top-4 z-50 flex gap-2",children:[e.jsxs(i,{variant:"secondary",size:"sm",onClick:o,className:"gap-2 shadow-sm",children:[e.jsx(je,{className:"h-4 w-4"}),"Use in Create"]}),e.jsx(i,{variant:"ghost",size:"icon",onClick:c,className:"h-9 w-9 rounded-full bg-background/50 hover:bg-background/80",children:e.jsx(U,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex-1 w-full h-full flex items-center justify-center p-4 overflow-hidden",children:a.media_type==="video"?e.jsx("video",{src:n,controls:!0,autoPlay:!0,loop:!0,className:"max-w-full max-h-full object-contain shadow-lg rounded-sm"}):e.jsx("img",{src:n,alt:a.prompt||"Image",className:"max-w-full max-h-full object-contain shadow-lg rounded-sm"})}),e.jsx("div",{className:"p-4 bg-background/80 backdrop-blur-md border-t shrink-0",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h3",{className:"font-medium text-sm truncate pr-12",children:a.prompt||"No prompt"}),e.jsxs("div",{className:"flex gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["ID: ",a.id]}),e.jsxs("span",{children:[a.width,"x",a.height]}),a.sampler_name&&e.jsx("span",{children:a.sampler_name}),a.steps&&e.jsxs("span",{children:[a.steps," steps"]}),a.cfg_scale&&e.jsxs("span",{children:["CFG ",a.cfg_scale]})]})]})})]})})}function ze({onSelect:a,defaultGridCols:c=5,storageKey:N="explore-grid-cols"}){const[p,n]=l.useState(""),[o,d]=l.useState(""),[h,j]=l.useState(null),[m,g]=l.useState(null),[x,A]=l.useState(null),[y,G]=E(N,c),[H]=E("explore-image-fit","cover"),[R,q]=l.useState(null),[u,w]=l.useState(!1),[t,b]=l.useState("all"),f=de();l.useEffect(()=>{const s=()=>{console.log("[ImageBrowser] Refreshing images query"),f.invalidateQueries({queryKey:["images"]}),f.refetchQueries({queryKey:["images"]})},I=L.on("generation:complete",s),le=L.on("image:uploaded",s);return()=>{I(),le()}},[f]);const{data:$}=z({queryKey:["collections"],queryFn:pe}),{data:X}=z({queryKey:["libraries"],queryFn:be}),{data:J,fetchNextPage:W,hasNextPage:Y,isFetchingNextPage:Z,isLoading:ke}=ge({queryKey:["images",o,h,m,x,u,t],queryFn:({pageParam:s=0})=>h?Ne(h,50,s,x):o?ye(o,50,s,x,void 0,m,u,t==="all"?void 0:t):m?ue(m,s,50):we({offset:s,limit:50,libraryId:x,isArchived:u,mediaType:t==="all"?void 0:t}),initialPageParam:0,getNextPageParam:(s,I)=>s.length===50?I.length*50:void 0}),ee=J?.pages.flatMap(s=>s)||[],se=s=>{s.preventDefault(),d(p),j(null),g(null)},ae=s=>{j(s.id),n(""),d(""),g(null)};return e.jsxs("div",{className:"flex h-full flex-col relative overflow-hidden",children:[e.jsxs("div",{className:"shrink-0 flex items-center gap-2 p-2 border-b bg-background z-30",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(fe,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(he,{placeholder:"Search...",value:p,onChange:s=>n(s.target.value),onKeyDown:s=>s.key==="Enter"&&se(s),className:"pl-8 h-9"})]}),e.jsxs(_,{value:x?.toString()||"all",onValueChange:s=>{A(s==="all"?null:parseInt(s))},children:[e.jsx(D,{className:"w-[140px] h-9",children:e.jsx(F,{placeholder:"Library"})}),e.jsxs(Q,{children:[e.jsx(v,{value:"all",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),"All Libraries"]})}),X?.map(s=>e.jsx(v,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center w-full",children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"truncate",children:s.name||s.path}),s.image_count!==void 0&&e.jsx("span",{className:"ml-auto text-xs text-muted-foreground pl-2",children:s.image_count})]})},s.id))]})]}),e.jsxs(_,{value:m?.toString()||"all",onValueChange:s=>{s==="all"?g(null):(g(parseInt(s)),j(null),d(""),n(""))},children:[e.jsx(D,{className:"w-[140px] h-9",children:e.jsx(F,{placeholder:"Collection"})}),e.jsxs(Q,{children:[e.jsx(v,{value:"all",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"All Images"]})}),$?.map(s=>e.jsx(v,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center w-full",children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"truncate",children:s.name}),s.item_count!==void 0&&e.jsx("span",{className:"ml-auto text-xs text-muted-foreground pl-2",children:s.item_count})]})},s.id))]})]}),e.jsx("div",{className:"h-6 w-px bg-border mx-1"}),e.jsxs(S,{children:[e.jsx(C,{asChild:!0,children:e.jsx(i,{variant:t!=="all"?"secondary":"ghost",size:"icon",className:"h-9 w-9",title:"Media Type",children:t==="video"?e.jsx(B,{className:"h-4 w-4"}):e.jsx(O,{className:"h-4 w-4"})})}),e.jsxs(k,{align:"end",children:[e.jsxs(r,{onClick:()=>b("all"),children:[e.jsx(K,{className:"mr-2 h-4 w-4"})," All Media"]}),e.jsxs(r,{onClick:()=>b("image"),children:[e.jsx(O,{className:"mr-2 h-4 w-4"})," Images Only"]}),e.jsxs(r,{onClick:()=>b("video"),children:[e.jsx(B,{className:"mr-2 h-4 w-4"})," Videos Only"]})]})]}),e.jsxs(S,{children:[e.jsx(C,{asChild:!0,children:e.jsx(i,{variant:u!==null?"secondary":"ghost",size:"icon",className:"h-9 w-9",title:"Archive Status",children:u===!0?e.jsx(P,{className:"h-4 w-4"}):e.jsx(M,{className:"h-4 w-4"})})}),e.jsxs(k,{align:"end",children:[e.jsxs(r,{onClick:()=>w(!1),children:[e.jsx(M,{className:"mr-2 h-4 w-4"})," Active Only"]}),e.jsxs(r,{onClick:()=>w(!0),children:[e.jsx(P,{className:"mr-2 h-4 w-4"})," Archived Only"]}),e.jsxs(r,{onClick:()=>w(null),children:[e.jsx(K,{className:"mr-2 h-4 w-4"})," All Items"]})]})]}),e.jsxs(S,{children:[e.jsx(C,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"h-9 w-9",title:"View Settings",children:e.jsx(Se,{className:"h-4 w-4"})})}),e.jsx(k,{align:"end",className:"w-56 p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(me,{children:["Columns: ",y]})}),e.jsx(xe,{value:[Number(y)],min:2,max:10,step:1,onValueChange:s=>G(s[0])})]})})]})]}),h&&e.jsx("div",{className:"flex items-center gap-2 p-2 border-b bg-muted/20",children:e.jsxs("div",{className:"flex items-center gap-1 bg-primary/10 text-primary px-2 py-1 rounded-md text-xs font-medium border border-primary/20",children:[e.jsx(M,{className:"h-3 w-3"}),e.jsxs("span",{children:["Similar to #",h]}),e.jsx(i,{variant:"ghost",size:"icon-sm",className:"h-4 w-4 ml-1 hover:bg-primary/20",onClick:()=>j(null),children:e.jsx(U,{className:"h-3 w-3"})})]})}),e.jsx("div",{className:"flex-1 relative min-h-0",children:e.jsx(ve,{posts:ee,fetchNextPage:W,hasNextPage:Y,isFetchingNextPage:Z,onSelect:a,onSearchByImage:ae,onOpenDetails:s=>q(s),gridCols:y,imageFit:H,onArchive:()=>{f.invalidateQueries({queryKey:["images"]})}})}),e.jsx(Ce,{image:R,onClose:()=>q(null)})]})}export{ze as I};
