"""Tests for functions in the optimize submodule."""

from ferrmion.optimize.rett import reduced_entanglement_ternary_tree
import numpy as np
import numpy as np
from pytest import fixture


@fixture
def n2mi():
    return np.array(
        [
            [
                8.95411720e-05,
                8.00313442e-07,
                3.57202788e-05,
                5.64570141e-06,
                3.39388829e-06,
                3.67820340e-06,
                3.71248133e-06,
                8.39012020e-06,
                7.60808045e-06,
                4.00424690e-07,
            ],
            [
                8.00313442e-07,
                1.88782428e-04,
                4.61021178e-06,
                1.43974455e-04,
                3.97230035e-06,
                4.34316525e-06,
                4.25262029e-06,
                1.40315431e-05,
                1.31042878e-05,
                4.73322942e-07,
            ],
            [
                3.57202788e-05,
                4.61021178e-06,
                5.97013599e-02,
                1.53473952e-03,
                1.14739409e-03,
                1.67868542e-02,
                2.03055787e-03,
                1.57647091e-02,
                2.20614397e-03,
                2.26381776e-02,
            ],
            [
                5.64570141e-06,
                1.43974455e-04,
                1.53473952e-03,
                9.22768981e-02,
                8.06189477e-03,
                8.02634734e-03,
                3.59937207e-03,
                3.44315829e-02,
                3.39878461e-02,
                1.58240762e-03,
            ],
            [
                3.39388829e-06,
                3.97230035e-06,
                1.14739409e-03,
                8.06189477e-03,
                4.94601967e-01,
                1.27072663e-01,
                2.87313949e-03,
                9.00062433e-02,
                2.49380494e-01,
                2.23093410e-03,
            ],
            [
                3.67820340e-06,
                4.34316525e-06,
                1.67868542e-02,
                8.02634734e-03,
                1.27072663e-01,
                5.27514044e-01,
                8.66763070e-03,
                2.58110275e-01,
                8.95621909e-02,
                2.18442824e-02,
            ],
            [
                3.71248133e-06,
                4.25262029e-06,
                2.03055787e-03,
                3.59937207e-03,
                2.87313949e-03,
                8.66763070e-03,
                5.41448119e-02,
                1.25017005e-02,
                8.08334819e-03,
                1.85391136e-02,
            ],
            [
                8.39012020e-06,
                1.40315431e-05,
                1.57647091e-02,
                3.44315829e-02,
                9.00062433e-02,
                2.58110275e-01,
                1.25017005e-02,
                5.62235070e-01,
                1.28998497e-01,
                2.20469210e-02,
            ],
            [
                7.60808045e-06,
                1.31042878e-05,
                2.20614397e-03,
                3.39878461e-02,
                2.49380494e-01,
                8.95621909e-02,
                8.08334819e-03,
                1.28998497e-01,
                5.30526412e-01,
                2.39364166e-03,
            ],
            [
                4.00424690e-07,
                4.73322942e-07,
                2.26381776e-02,
                1.58240762e-03,
                2.23093410e-03,
                2.18442824e-02,
                1.85391136e-02,
                2.20469210e-02,
                2.39364166e-03,
                9.04878107e-02,
            ],
        ]
    )


def test_rett(n2mi):
    np.random.seed(1017)
    rett = reduced_entanglement_ternary_tree(n2mi, squash=True)
    assert rett.branch_pauli_map == {
        "zzzzx": "ZZZZXIIIII",
        "zzzx": "ZZZXIIIIII",
        "zzzzzzx": "ZZZZZZXIII",
        "zzx": "ZZXIIIIIII",
        "zzy": "ZZYIIIIIII",
        "zzzzzzzzx": "ZZZZZZZZXI",
        "zzzzy": "ZZZZYIIIII",
        "zzzzzzzzzy": "ZZZZZZZZZY",
        "y": "YIIIIIIIII",
        "zzzzzzzx": "ZZZZZZZXII",
        "zx": "ZXIIIIIIII",
        "zzzzzzy": "ZZZZZZYIII",
        "zy": "ZYIIIIIIII",
        "zzzy": "ZZZYIIIIII",
        "zzzzzzzzzz": "ZZZZZZZZZZ",
        "zzzzzzzy": "ZZZZZZZYII",
        "zzzzzy": "ZZZZZYIIII",
        "zzzzzzzzzx": "ZZZZZZZZZX",
        "zzzzzx": "ZZZZZXIIII",
        "zzzzzzzzy": "ZZZZZZZZYI",
        "x": "XIIIIIIIII",
    }
