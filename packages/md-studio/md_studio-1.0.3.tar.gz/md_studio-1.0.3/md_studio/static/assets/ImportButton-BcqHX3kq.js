import{c as N,a as J,u as K,B as o,w as _,t as d}from"./index-BwWm0JV9.js";import{r as c,j as e}from"./jsx-runtime-BiXka7E7.js";import{D as M,a as Q,b as P,c as R,d as z,e as T,f as E,s as U}from"./slug-DE7USKAG.js";import{y as A,x as W}from"./components-CZmywKMH.js";/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Y=N("circle-alert",X);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],re=N("file-text",Z);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m8 11 4 4 4-4",key:"1dohi6"}],["path",{d:"M8 5H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-4",key:"1ywtjm"}]],se=N("import",ee),w=c.forwardRef(({className:g,type:j,...u},v)=>e.jsx("input",{type:j,"data-slot":"input",className:J("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",g),ref:v,...u}));w.displayName="Input";function oe({variant:g="outline",size:j="default",iconOnly:u=!1,className:v}){const{basePath:k}=K(),B=A();A();const{revalidate:H}=W(),[q,y]=c.useState(!1),[r,S]=c.useState(null),[f,p]=c.useState([]),[O,m]=c.useState(!1),[I,h]=c.useState(!1),b=c.useRef(null),x=B.state!=="idle"||I,C=()=>{S(null),p([]),m(!1),b.current&&(b.current.value="")},V=async s=>{const t=s.target.files;if(S(t),!(!t||t.length===0)){h(!0);try{const n=Array.from(t),l=[];for(const a of n){const i=a.name.replace(/\.md$/,"").replace(/[-_]/g," "),F=U(i),G=await(await fetch(_(`/api/import?slug=${encodeURIComponent(F)}`,k))).json();l.push({file:a,title:i,slug:F,hasConflict:G.exists})}p(l),l.some(a=>a.hasConflict)&&m(!0)}finally{h(!1)}}},D=async()=>{if(!r||r.length===0){d.error("Choose at least one markdown file to import.");return}if(f.some(t=>t.hasConflict&&t.action!=="replace"&&!t.customSlug)){d.error("Please resolve all conflicts by choosing Replace or providing a custom slug.");return}h(!0);try{const t=new FormData;for(let a=0;a<f.length;a++){const i=f[a];t.append(`file_${a}`,i.file),t.append(`filename_${a}`,i.file.name),t.append(`slug_${a}`,i.action==="replace"?i.slug:i.customSlug||i.slug),t.append(`replace_${a}`,i.action==="replace"?"true":"false")}const l=await(await fetch(_("/api/import",k),{method:"POST",body:t})).json();l.success?(l.successful&&l.successful.length>0&&d.success(`Successfully imported ${l.successful.length} document${l.successful.length>1?"s":""}.`),l.failed&&l.failed.length>0&&d.error(`Failed to import ${l.failed.length} file${l.failed.length>1?"s":""}: ${l.failed.map(a=>a.filename).join(", ")}`),y(!1),C(),H()):d.error(l.error||"Unable to import markdown.")}catch(t){console.error("Import error:",t);const n=t instanceof Error?t.message:"Unable to import markdown.";d.error(n)}finally{h(!1)}},L=(s,t)=>{p(n=>{const l=[...n];return l[s]={...l[s],customSlug:U(t),action:"rename"},l})},$=(s,t)=>{p(n=>{const l=[...n];return l[s]={...l[s],action:t},l})};return e.jsxs(e.Fragment,{children:[e.jsxs(M,{open:q,onOpenChange:s=>{y(s),s||C()},children:[e.jsx(Q,{asChild:!0,children:e.jsxs(o,{variant:g,size:j,className:v,children:[e.jsx(se,{className:u?"size-4":"mr-2 size-4"}),!u&&"Import",u&&e.jsx("span",{className:"sr-only",children:"Import markdown files"})]})}),e.jsxs(P,{children:[e.jsxs(R,{children:[e.jsx(z,{children:"Import markdown files"}),e.jsx(T,{children:"Upload one or more markdown files. Titles will be extracted from front matter or filenames."})]}),e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Markdown files"}),e.jsx(w,{ref:b,type:"file",accept:".md",multiple:!0,onChange:V,disabled:x}),r&&r.length>0&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.length," file",r.length>1?"s":""," selected"]})]})}),e.jsxs(E,{children:[e.jsx(o,{variant:"outline",onClick:()=>y(!1),disabled:x,children:"Cancel"}),e.jsx(o,{onClick:D,disabled:x||!r||r.length===0,children:x?"Importing...":I?"Processing...":"Import"})]})]})]}),e.jsx(M,{open:O,onOpenChange:m,children:e.jsxs(P,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(R,{children:[e.jsx(z,{children:"Resolve Slug Conflicts"}),e.jsx(T,{children:"Some files have slugs that already exist. Please provide unique slugs for these files."})]}),e.jsx("div",{className:"flex flex-col gap-4",children:f.map((s,t)=>e.jsx("div",{className:"flex flex-col gap-2 rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[s.hasConflict&&e.jsx(Y,{className:"size-5 text-destructive mt-0.5 shrink-0"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.file.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Title: ",s.title]})]}),s.hasConflict?e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("p",{className:"text-sm font-medium text-destructive",children:["Slug “",s.slug,"” already exists"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{type:"button",variant:s.action==="replace"?"default":"outline",size:"sm",onClick:()=>$(t,"replace"),className:"flex-1",children:"Replace Existing"}),e.jsx(o,{type:"button",variant:s.action==="rename"?"default":"outline",size:"sm",onClick:()=>$(t,"rename"),className:"flex-1",children:"Rename Slug"})]}),s.action==="rename"&&e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"Enter a unique slug:"}),e.jsx(w,{placeholder:"Enter unique slug",value:s.customSlug||"",onChange:n=>L(t,n.target.value)})]}),s.action==="replace"&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"The existing document will be overwritten with this file."})]}):e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Slug: ",e.jsx("code",{className:"text-xs bg-muted px-1 py-0.5 rounded",children:s.slug})]})]})]})},t))}),e.jsxs(E,{children:[e.jsx(o,{variant:"outline",onClick:()=>{m(!1),C()},children:"Cancel"}),e.jsx(o,{onClick:()=>{m(!1),D()},disabled:f.some(s=>s.hasConflict&&s.action!=="replace"&&!s.customSlug),children:"Continue Import"})]})]})})]})}export{re as F,oe as I,w as a};
