import{y as Qa,p as Ft,F as jt,e as a,v as Ut,l as Q,g as e,m as h,H as T,b as Ka,i as zt,f as C,k as d,w as k,t as _,c as qt,n as u,r as p,U as O,z as wt,I as P,J as z,V as Re,Y as $t,X as K,R as Pt,aa as Bt,N as oe,C as Xa,h as eo,Z as Se,Q as Ct,K as to,_ as ao,P as oo,G as X}from"../chunks/tJ-1PvYF.js";import{_ as ro}from"../chunks/PPVm8Dsz.js";import{w as Yt,h as io,f as lo}from"../chunks/DAWgyOON.js";import{D as so}from"../chunks/BRt1D930.js";import{P as no}from"../chunks/Ba3EtZVA.js";const co=()=>({title:"Lithology & Porosity",subtitle:"Lithology and porosity estimations for the selected well"}),Vo=Object.freeze(Object.defineProperty({__proto__:null,load:co},Symbol.toStringTag,{value:"Module"}));var uo=C('<div class="text-sm text-blue-600"> </div>'),po=C('<div class="text-sm text-red-500 mb-2"> </div>'),vo=C('<div class="text-xs text-green-600 mt-2"> </div>'),mo=C('<div class="text-xs text-muted-foreground mt-2"> </div>'),ho=C('<div class="mt-3"><div class="text-xs font-medium mb-2">SSC Endpoint Parameters:</div> <div class="grid grid-cols-2 gap-2"><div><label class="text-xs" for="dry-sand-nphi-lith">Dry sand (NPHI)</label> <input id="dry-sand-nphi-lith" class="input" type="number" step="any"/></div> <div><label class="text-xs" for="dry-sand-rhob-lith">Dry sand (RHOB)</label> <input id="dry-sand-rhob-lith" class="input" type="number" step="any"/></div> <div><label class="text-xs" for="dry-clay-nphi-lith">Dry clay (NPHI)</label> <input id="dry-clay-nphi-lith" class="input" type="number" step="any"/></div> <div><label class="text-xs" for="dry-clay-rhob-lith">Dry clay (RHOB)</label> <input id="dry-clay-rhob-lith" class="input" type="number" step="any"/></div> <div><label class="text-xs" for="fluid-nphi-lith">Fluid (NPHI)</label> <input id="fluid-nphi-lith" class="input" type="number" step="any"/></div> <div><label class="text-xs" for="fluid-rhob-lith">Fluid (RHOB)</label> <input id="fluid-rhob-lith" class="input" type="number" step="any"/></div> <div class="col-span-2"><label class="text-xs" for="silt-line-angle-lith">Silt line angle</label> <input id="silt-line-angle-lith" class="input" type="number" step="1"/></div></div> <div class="mt-3"><div class="font-medium text-sm mb-1">NPHI - RHOB Crossplot</div> <div class="bg-surface rounded p-2"><div class="w-full max-w-[600px] h-[500px] mx-auto"></div></div></div></div>'),fo=C('<div class="mt-3"><div class="text-xs font-medium mb-2">Multi-Mineral Configuration:</div> <div class="space-y-2"><div><label class="text-xs" for="minerals-input">Minerals (comma-separated):</label> <input id="minerals-input" class="input" type="text" placeholder="e.g., QUARTZ, CALCITE, DOLOMITE, SHALE"/> <div class="text-xs text-muted-foreground mt-1"> </div></div> <div><label class="text-xs" for="porosity-method">Porosity Method:</label> <select id="porosity-method" class="input"><option>Density</option><option>Neutron-Density</option><option>Sonic</option></select></div> <div class="flex items-center"><input type="checkbox" id="auto-scale" class="mr-2"/> <label for="auto-scale" class="text-xs cursor-pointer">Auto-scale (recommended for robustness)</label></div></div></div>'),bo=C('<div class="w-full h-[220px]"></div>'),yo=C('<div class="flex items-center justify-center h-full text-sm text-gray-500">No lithology data available. Click "Estimate Lithology" first.</div>'),go=C('<div class="text-xs text-green-600 mt-2"> </div>'),_o=C('<div class="w-full h-[220px]"></div>'),xo=C('<div class="flex items-center justify-center h-full text-sm text-gray-500">No porosity data available. Click "Estimate Porosity" first.</div>'),No=C('<div class="text-xs text-green-600 mt-2"> </div>'),wo=C("<div><strong>Calculated PHIT:</strong> </div>"),Po=C("<div><strong>Calculated PHIT:</strong> No data</div>"),Co=C('<div><strong>Core Porosity (CPORE):</strong> <span class="inline-block w-2 h-2 bg-red-600 rounded-full"></span> </div>'),Ho=C('<div class="text-gray-500">No core porosity data (CPORE) found</div>'),Ro=C('<div class="bg-panel rounded p-3"><!> <div class="space-y-3"><div><div class="px-2 py-2 border-t border-border/50 mt-2"><div class="font-medium text-sm mb-3 mt-4">Hydrocarbon Correction</div> <div class="bg-surface rounded p-2"><div class="grid grid-cols-2 gap-2 mb-3"><div><label class="text-xs" for="hc-corr-angle">HC Correction Angle (°)</label> <input id="hc-corr-angle" class="input" type="number" step="0.1"/></div> <div><label class="text-xs" for="hc-buffer">HC Buffer</label> <input id="hc-buffer" class="input" type="number" step="0.001"/></div></div> <div class="flex gap-2 mb-3"><button class="btn px-3 py-1 text-sm font-medium rounded-md bg-blue-600 text-white hover:bg-blue-700 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-blue-500" aria-label="Apply HC correction" title="Apply hydrocarbon correction to NPHI/RHOB data">Apply HC Correction</button> <button class="btn px-3 py-1 text-sm font-medium rounded-md bg-emerald-700 text-white hover:bg-emerald-600 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-emerald-600" aria-label="Save HC corrected data" title="Save corrected NPHI_HC and RHOB_HC to database"><!></button></div> <div class="flex items-center"><input type="checkbox" id="use-hc-corrected" class="mr-2"/> <label for="use-hc-corrected">Use HC corrected NPHI/RHOB for lithology and porosity estimation</label></div> <!> <!></div></div> <div class="px-2 py-2 border-t border-border/50 mt-2"><div class="font-medium text-sm mb-3">Lithology Estimation</div> <div class="bg-surface rounded p-2"><div class="mb-3 p-2 border border-border/50 rounded"><div class="text-xs font-medium mb-2">Select Model:</div> <div class="flex gap-4"><label class="flex items-center text-sm cursor-pointer"><input type="radio" name="litho-model" class="mr-2"/> Sand / Silt / Clay (SSC)</label> <label class="flex items-center text-sm cursor-pointer"><input type="radio" name="litho-model" class="mr-2"/> Multi-Mineral Model</label></div> <!> <!></div> <div class="flex gap-2 mb-3"><button class="btn px-3 py-1 text-sm font-semibold rounded-md bg-gray-900 text-white hover:bg-gray-800 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-gray-700" aria-label="Run lithology classification" title="Run lithology estimation">Estimate Lithology</button> <button class="btn px-3 py-1 text-sm font-medium rounded-md bg-emerald-700 text-white hover:bg-emerald-600 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-emerald-600" aria-label="Save lithology" title="Save lithology results to database"><!></button></div> <div class="h-[220px] w-full overflow-hidden"><!></div> <!></div></div> <div class="px-2 py-2 border-t border-border/50 mt-2"><div class="font-medium text-sm mb-1">Porosity (PHIT)</div> <div class="bg-surface rounded p-2"><button class="btn px-3 py-1 text-sm font-medium rounded-md bg-gray-800 text-gray-100 hover:bg-gray-700 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-gray-600" aria-label="Estimate porosity" title="Estimate porosity">Estimate Porosity</button> <button class="btn px-3 py-1 text-sm font-medium rounded-md bg-emerald-700 text-white hover:bg-emerald-600 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-emerald-600" aria-label="Save porosity" title="Save porosity results to database"><!></button> <div class="flex items-center ml-2"><input type="checkbox" id="depth-matching-poro" class="mr-2"/> <label for="depth-matching-poro">Depth Matching</label></div> <div class="h-[220px] w-full overflow-hidden"><!></div> <!></div> <div class="text-xs text-muted-foreground space-y-1 mt-2"><!> <!></div></div></div></div></div>'),So=C('<div class="text-sm">Select a well.</div>'),Eo=C('<div class="ws-lithology"><div class="mb-2"><div class="text-sm mb-2">Tools for lithology and porosity estimations.</div></div> <!> <!></div>');function Io(ot,Ee){Ft(Ee,!1);const re=h(),j=h(),ee=h(),q=h(),ie=h(),_e=[];let E=jt(Ee,"projectId",8),R=jt(Ee,"wellName",8);const B="http://localhost:6312";let te=h({enabled:!1,minDepth:null,maxDepth:null}),Ie=h({enabled:!1,zones:[]}),Y=h([]),g=h(!1),x=h(null),We=h(null),Ge=h(null),Je=h(null),Ze=null,xe=0,Wt=120,ae=h(null);const Gt=1e3;let Te=h(!1),ke=h(!1),De=h(null),Le=h(null),le=h(-.02),se=h(2.65),ne=h(.35),de=h(2.71),ce=h(1),ue=h(1),pe=h(117),Ne=h(!1),rt=h(50),it=h(.01),W=h(!1),D=h([]),lt=h(!1),Me=h(!1),Oe=h(null),G=h("ssc"),Ve=h(["QUARTZ","CALCITE","DOLOMITE","SHALE"]),Qe=h("density"),st=h(!0),nt=h("QUARTZ, CALCITE, DOLOMITE, SHALE"),Ae=h([]),je=[],$e=[],ve=h([]),$=h([]),F=h([]),be=h(null),dt=null,me=h(null),he=h(null);async function ct(){if(!dt){const t=await ro(()=>import("../chunks/BJMC0GYJ.js").then(r=>r.p),[],import.meta.url);dt=t?.default??t}return dt}function Jt(t,r){const[[n,l],[m,i]]=t,[[v,f],[b,c]]=r,w=(n-m)*(f-c)-(l-i)*(v-b);if(Math.abs(w)<1e-10)return null;const N=((n-v)*(f-c)-(l-f)*(v-b))/w,V=-((n-m)*(l-f)-(l-i)*(n-v))/w;return N>=0&&N<=1&&V>=0&&V<=1?[n+N*(m-n),l+N*(i-l)]:[n+N*(m-n),l+N*(i-l)]}async function Ht(){if(!e(be))return;const t=await ct(),r=[Number(e(le)),Number(e(se))],n=[Number(e(ne)),Number(e(de))],l=[Number(e(ce)),Number(e(ue))],m=[Number(e(re)),2.68],i=[];let v=[],f=[];if(e(Ae)&&e(Ae).length>0&&(v=Ke(),v.length>0))for(let c=0;c<v.length;c++){const w=[v[c].nphi,v[c].rhob],N=Jt([r,n],[l,w]);N&&f.push(N)}v.length>0&&i.push({x:v.map(c=>c.nphi),y:v.map(c=>c.rhob),mode:"markers",type:"scatter",name:"Data",marker:{color:Array.from({length:v.length},(c,w)=>w),colorscale:"Rainbow",showscale:!1,size:6},hovertemplate:"NPHI: %{x}<br>RHOB: %{y}<extra></extra>"}),e(W)&&e(D)&&e(D).length>0&&i.push({x:e(D).map(c=>c.nphi),y:e(D).map(c=>c.rhob),mode:"markers",type:"scatter",name:"HC Corrected Data",marker:{color:"red",size:6,symbol:"diamond",opacity:.7},hovertemplate:"NPHI (HC): %{x}<br>RHOB (HC): %{y}<extra></extra>"}),i.push({x:[l[0],r[0]],y:[l[1],r[1]],mode:"lines",type:"scatter",name:"Mineral 1 Line",line:{color:"blue",width:2},showlegend:!0}),i.push({x:[l[0],n[0]],y:[l[1],n[1]],mode:"lines",type:"scatter",name:"Clay Line",line:{color:"gray",width:2},showlegend:!0}),i.push({x:[r[0],n[0]],y:[r[1],n[1]],mode:"lines",type:"scatter",name:"Rock Line",line:{color:"black",width:2},showlegend:!0}),i.push({x:[l[0],m[0]],y:[l[1],m[1]],mode:"lines",type:"scatter",name:"Silt Line",line:{color:"green",width:2},showlegend:!0}),f.length>0&&i.push({x:f.map(c=>c[0]),y:f.map(c=>c[1]),mode:"markers",type:"scatter",name:"Projected Point",marker:{color:"purple",size:4},showlegend:!0}),i.push({x:[r[0]],y:[r[1]],mode:"markers",type:"scatter",name:`Mineral Point (${r[0]}, ${r[1]})`,marker:{color:"yellow",size:9,line:{color:"black",width:1}},showlegend:!0}),i.push({x:[n[0]],y:[n[1]],mode:"markers",type:"scatter",name:`Dry Clay (${n[0]}, ${n[1]})`,marker:{color:"black",size:9},showlegend:!0}),i.push({x:[m[0]],y:[m[1]],mode:"markers",type:"scatter",name:"Dry Silt Point",marker:{color:"orange",size:8},showlegend:!0}),i.push({x:[l[0]],y:[l[1]],mode:"markers",type:"scatter",name:`Fluid (${l[0]}, ${l[1]})`,marker:{color:"blue",size:9},showlegend:!0});const b={title:"NPHI-RHOB Crossplot",xaxis:{title:"NPHI",range:[-.1,1],tickformat:".2f"},yaxis:{title:"RHOB",autorange:!1,range:[3,0],tickformat:".2f"},legend:{orientation:"v",yanchor:"top",y:.99,xanchor:"left",x:.01,bgcolor:"rgba(255,255,255,0.8)"},template:"plotly_white",margin:{l:40,r:10,t:40,b:40},height:500,autosize:!0,hovermode:"closest"};try{t.react(e(be),i,b,{responsive:!0})}catch{t.newPlot(e(be),i,b,{responsive:!0})}}async function Zt(){if(!e(me))return;const t=await ct();if(!e(j)||e(j).length===0){t.purge(e(me));return}const r=e(j).map(c=>c.x),n=e(j).map(c=>c.vclay),l=e(j).map(c=>c.vsilt),m=e(j).map(c=>c.vdolo),i=e(j).map(c=>c.vcalc),v=e(j).map(c=>c.vsand),f=[{x:r,y:n,name:"VCLAY",mode:"lines",line:{color:"#949494",width:1},fill:"tozeroy"},{x:r,y:l,name:"VSILT",mode:"lines",line:{color:"#FE9800",width:1},fill:"tonexty"},{x:r,y:m,name:"VDOLO",mode:"lines",line:{color:"#BA55D3",width:1},fill:"tonexty"},{x:r,y:i,name:"VCALC",mode:"lines",line:{color:"#B0E0E6",width:1},fill:"tonexty"},{x:r,y:v,name:"VSAND",mode:"lines",line:{color:"#F6F674",width:1},fill:"tonexty"}],b={height:220,margin:{l:60,r:20,t:20,b:40},dragmode:"zoom",xaxis:{title:"Depth",tickformat:",.0f",fixedrange:!1},yaxis:{title:"Volume Fraction",range:[0,1],tickformat:".1f",fixedrange:!0},showlegend:!1};try{await t.react(e(me),f,b,{responsive:!0})}catch{await t.newPlot(e(me),f,b,{responsive:!0})}}async function Qt(){if(!e(he))return;const t=await ct();if((!e(ee)||e(ee).length===0)&&(!e(ie)||e(ie).length===0)){t.purge(e(he));return}const r=[];if(e(ee)&&e(ee).length>0){const l=e(ee).map(i=>i.x),m=e(ee).map(i=>i.y);r.push({x:l,y:m,name:"PHIT",mode:"lines",line:{color:"#000000",width:2},xaxis:"x",yaxis:"y"})}if(e(q)&&e(q).length>0){const l=e(q).map(i=>i.x),m=e(q).map(i=>i.y);r.push({x:l,y:m,name:"PHIE",mode:"lines",line:{color:"#2563eb",width:1,dash:"dot"},fill:"tozeroy",fillcolor:"rgba(37,99,235,0.3)",xaxis:"x",yaxis:"y"})}e(ie)&&e(ie).length>0&&r.push({x:e(ie).map(l=>l.x),y:e(ie).map(l=>l.y),name:"CPORE",mode:"markers",marker:{color:"#dc2626",size:8,line:{color:"white",width:1}},xaxis:e(Ne)?"x2":"x",yaxis:"y"});const n={height:220,margin:{l:60,r:20,t:50,b:40},dragmode:"zoom",xaxis:{title:"Log Depth",titlefont:{color:"#2563eb"},tickfont:{color:"#2563eb"},tickformat:",.0f",side:"bottom"},xaxis2:{title:"Core Depth",titlefont:{color:"#dc2626"},tickfont:{color:"#dc2626"},tickformat:",.0f",overlaying:"x",side:"top",fixedrange:e(Ne)},yaxis:{title:"Porosity (fraction)",range:[0,.5],tickformat:".2f",fixedrange:!0},showlegend:!0,legend:{x:0,y:1,bgcolor:"rgba(255,255,255,0.8)",bordercolor:"rgba(0,0,0,0.2)",borderwidth:1}};try{t.react(e(he),r,n,{responsive:!0})}catch{t.newPlot(e(he),r,n,{responsive:!0})}}async function Kt(){if(!(!E()||!R())){a(g,!0),a(x,null),a(ae,null);try{a(ae,"Initiating well data loading...");const t=await Xt(),{task_id:r,result:n}=t;let l;if(n?l=n:(a(ae,"Waiting for well data..."),l=await ea(r)),!Array.isArray(l))throw new Error("Unexpected data format from backend");a(Ae,l)}catch(t){console.warn("Failed to load well data",t),a(x,String(t?.message??t))}finally{a(g,!1),a(ae,null)}}}async function Xt(){const t=await fetch(`${B}/quick_pp/database/projects/${E()}/wells/${encodeURIComponent(String(R()))}/merged/generate`,{method:"POST"});if(!t.ok)throw new Error(await t.text());const r=await t.json();if(!r.task_id)throw new Error("No task_id returned from server");return{task_id:r.task_id,result:r.result}}function Be(){Ze&&(clearInterval(Ze),Ze=null),a(ae,null)}async function ea(t){const r=`${B}/quick_pp/database/projects/${E()}/wells/${encodeURIComponent(String(R()))}/merged/result/${t}`;return new Promise((n,l)=>{xe=0;const m=async()=>{if(xe>=Wt){const i="Well data loading timed out after 2 minutes";console.error(i),Be(),l(new Error(i));return}try{const i=await fetch(r);if(!i.ok)throw new Error(`Poll failed with status ${i.status}`);const v=await i.json();v.status==="success"?(Be(),n(v.result)):v.status==="error"?(Be(),l(new Error(v.error||"Task failed with unknown error"))):v.status==="pending"?(a(ae,`Loading well data... (${xe}s)`),xe++):(Be(),l(new Error(`Unknown task status: ${v.status}`)))}catch(i){console.error("Poll request failed:",i),a(ae,`Retrying... (attempt ${xe})`),xe++}};m(),Ze=window.setInterval(m,Gt)})}function Ke(){const t=e(Y),r=[];if(e(lt)&&e(D)&&e(D).length>0)return e(D);for(const n of t){const l=Number(n.nphi??n.NPHI??n.Nphi??NaN),m=Number(n.rhob??n.RHOB??n.Rhob??NaN);!isNaN(l)&&!isNaN(m)&&r.push({nphi:l,rhob:m})}return r}function ta(){const t=e(Y),r=[];for(const n of t){const l=Number(n.depth??n.DEPTH??NaN),m=Number(n.cpore??n.CPORE??n.Cpore??n.KPORE??n.kpore??NaN);!isNaN(l)&&!isNaN(m)&&m>0&&r.push({depth:l,CPORE:m})}return r.sort((n,l)=>n.depth-l.depth)}async function aa(){const t=Ke();if(!t.length){a(x,"No NPHI/RHOB data available in well rows");return}a(g,!0),a(x,null);try{const r={dry_sand_point:[Number(e(le)),Number(e(se))],dry_clay_point:[Number(e(ne)),Number(e(de))],water_point:[Number(e(ce)),Number(e(ue))],corr_angle:Number(e(rt)),buffer:Number(e(it)),data:t},n=await fetch(`${B}/quick_pp/qaqc/hc_correction`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok)throw new Error(await n.text());a(D,await n.json()),a(W,!0),a(x,null),Ht()}catch(r){console.warn("HC correction error",r),a(x,String(r?.message??r)),a(W,!1)}finally{a(g,!1)}}async function oa(){if(!E()||!R()){a(x,"Project and well must be selected before saving");return}if(!e(D)||e(D).length===0){a(x,"No HC corrected data to save");return}a(Me,!0),a(Oe,null),a(x,null);try{const t=e(Y),r=[];let n=0;for(const f of t){const b=Number(f.nphi??f.NPHI??f.Nphi??NaN),c=Number(f.rhob??f.RHOB??f.Rhob??NaN);if(!(!isNaN(b)&&!isNaN(c)))continue;const N=e(D)[n++]??{nphi:b,rhob:c},V={DEPTH:Number(f.depth??f.DEPTH??NaN),NPHI_HC:Number(N.nphi??b),RHOB_HC:Number(N.rhob??c)};r.push(V)}if(!r.length)throw new Error("No rows prepared for save");const l={data:r},m=`${B}/quick_pp/database/projects/${E()}/wells/${encodeURIComponent(String(R()))}/data`,i=await fetch(m,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!i.ok)throw new Error(await i.text());const v=await i.json().catch(()=>null);a(Oe,v&&v.message?String(v.message):"HC corrected data saved");try{window.dispatchEvent(new CustomEvent("qpp:data-updated",{detail:{projectId:E(),wellName:R(),kind:"hc-correction"}}))}catch{}}catch(t){console.warn("Save HC correction error",t),a(Oe,null),a(x,String(t?.message??t))}finally{a(Me,!1)}}async function ra(){const t=Ke();if(!t.length){a(x,"No NPHI/RHOB data available in well rows");return}a(g,!0),a(x,null);try{e(G)==="ssc"?await ia(t):e(G)==="multi_mineral"&&await la(t),ua()}catch(r){console.warn("Lithology estimation error",r),a(x,String(r?.message??r))}finally{a(g,!1)}}async function ia(t){const r={dry_sand_point:[Number(e(le)),Number(e(se))],fluid_point:[Number(e(ce)),Number(e(ue))],dry_clay_point:[Number(e(ne)),Number(e(de))],method:"default",silt_line_angle:Number(e(pe)),data:t},n=await fetch(`${B}/quick_pp/lithology/ssc`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok)throw new Error(await n.text());je=await n.json()}async function la(t){const r=[],n=e(Y);for(const i of n){const v=Number(i.nphi??i.NPHI??i.Nphi??NaN),f=Number(i.rhob??i.RHOB??i.Rhob??NaN);if(!isNaN(v)&&!isNaN(f)){const b=Number(i.gr??i.GR??i.Gr??NaN),c=Number(i.pef??i.PEF??i.Pef??NaN),w=Number(i.dtc??i.DTC??i.Dtc??NaN);r.push({gr:isNaN(b)?null:b,nphi:v,rhob:f,pef:isNaN(c)?null:c,dtc:isNaN(w)?null:w})}}if(!r.length)throw new Error("No valid GR/NPHI/RHOB data available");const l={minerals:e(Ve),porosity_method:e(Qe),auto_scale:e(st),data:r},m=await fetch(`${B}/quick_pp/lithology/multi_mineral`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!m.ok)throw new Error(await m.text());je=await m.json()}function sa(){const t=e(nt).split(",").map(r=>r.trim().toUpperCase()).filter(r=>r.length>0);t.length>0&&a(Ve,t)}async function na(){if(!E()||!R()){a(x,"Project and well must be selected before saving");return}if(!je||je.length===0){a(x,"No lithology results to save");return}a(Te,!0),a(De,null),a(x,null);try{const t=e(ve).map(i=>{const v={DEPTH:i.depth};if(e(G)==="ssc")v.VSAND=Math.min(Math.max(Number(i.VSAND??0),0),1),v.VSILT=Math.min(Math.max(Number(i.VSILT??0),0),1),v.VCLAY=Math.min(Math.max(Number(i.VCLAY??0),0),1);else if(e(G)==="multi_mineral"&&i.fullResult){for(const f of e(Ve)){const b=pa(f),c=i.fullResult[b];c!=null&&(v[b]=Math.min(Math.max(Number(c),0),1))}i.fullResult.VOIL!==void 0&&(v.VOIL=Math.min(Math.max(Number(i.fullResult.VOIL??0),0),1)),i.fullResult.VGAS!==void 0&&(v.VGAS=Math.min(Math.max(Number(i.fullResult.VGAS??0),0),1)),i.fullResult.VWATER!==void 0&&(v.VWATER=Math.min(Math.max(Number(i.fullResult.VWATER??0),0),1)),i.fullResult.PHIT_CONSTRUCTED!==void 0&&(v.PHIT_CONSTRUCTED=Math.min(Math.max(Number(i.fullResult.PHIT_CONSTRUCTED??0),0),1))}return v});if(!t.length)throw new Error("No rows prepared for save");const r={data:t},n=`${B}/quick_pp/database/projects/${E()}/wells/${encodeURIComponent(String(R()))}/data`,l=await fetch(n,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!l.ok)throw new Error(await l.text());const m=await l.json().catch(()=>null);a(De,m&&m.message?String(m.message):"Lithology saved");try{window.dispatchEvent(new CustomEvent("qpp:data-updated",{detail:{projectId:E(),wellName:R(),kind:"lithology"}}))}catch{}}catch(t){console.warn("Save lithology error",t),a(De,null),a(x,String(t?.message??t))}finally{a(Te,!1)}}async function da(){const t=Ke();if(!t.length){a(x,"No NPHI/RHOB data available in well rows");return}a(g,!0),a(x,null);try{const r={dry_sand_point:[Number(e(le)),Number(e(se))],fluid_point:[Number(e(ce)),Number(e(ue))],dry_clay_point:[Number(e(ne)),Number(e(de))],silt_line_angle:Number(e(pe)),method:"ssc",data:t},n=await fetch(`${B}/quick_pp/porosity/neu_den`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok)throw new Error(await n.text());$e=await n.json(),va()}catch(r){console.warn("Poro error",r),a(x,String(r?.message??r))}finally{a(g,!1)}}async function ca(){if(!E()||!R()){a(x,"Project and well must be selected before saving");return}if(!$e||$e.length===0){a(x,"No porosity results to save");return}a(ke,!0),a(Le,null),a(x,null);try{const t=e(Y),r=[];let n=0;for(const f of t){const b=Number(f.nphi??f.NPHI??f.Nphi??NaN),c=Number(f.rhob??f.RHOB??f.Rhob??NaN);if(!(!isNaN(b)&&!isNaN(c)))continue;const N=$e[n++]??{},V=Math.min(Math.max(Number(N.PHIT??0),0),1),fe=N.PHIE!==void 0?Number(N.PHIE):N.PHIE??null,ye=fe!==null&&!isNaN(Number(fe))?Math.min(Math.max(Number(fe),0),1):null,ge={DEPTH:Number(f.depth??f.DEPTH??NaN),PHIT:V,PHIE:ye};ye!==null&&(ge.PHIE=ye),r.push(ge)}if(!r.length)throw new Error("No rows prepared for save");const l={data:r},m=`${B}/quick_pp/database/projects/${E()}/wells/${encodeURIComponent(String(R()))}/data`,i=await fetch(m,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!i.ok)throw new Error(await i.text());const v=await i.json().catch(()=>null);a(Le,v&&v.message?String(v.message):"Porosity saved");try{window.dispatchEvent(new CustomEvent("qpp:data-updated",{detail:{projectId:E(),wellName:R(),kind:"porosity"}}))}catch{}}catch(t){console.warn("Save porosity error",t),a(Le,null),a(x,String(t?.message??t))}finally{a(ke,!1)}}function ua(){const t=e(Y),r=[];let n=0;for(const l of t){const m=Number(l.depth??l.DEPTH??NaN);if(isNaN(m))continue;const i=Number(l.nphi??l.NPHI??l.Nphi??NaN),v=Number(l.rhob??l.RHOB??l.Rhob??NaN);if(!isNaN(i)&&!isNaN(v)){const b=je[n++]??{},c=Math.min(Math.max(Number(b.VSAND??0),0),1),w=Math.min(Math.max(Number(b.VSILT??0),0),1),N=Math.min(Math.max(Number(b.VCLAY??0),0),1),V=Math.min(Math.max(Number(b.VCALC??0),0),1),fe=Math.min(Math.max(Number(b.VDOLO??0),0),1);r.push({depth:m,VSAND:c,VSILT:w,VCALC:V,VDOLO:fe,VCLAY:N,fullResult:b})}}r.sort((l,m)=>l.depth-m.depth),a(ve,r)}function pa(t){return{QUARTZ:"VSAND",CALCITE:"VCALC",DOLOMITE:"VDOLO",SHALE:"VCLAY",FELDSPAR:"VFSP",PYRITE:"VPYR"}[t]??`V${t.substring(0,3).toUpperCase()}`}function va(){const t=e(Y),r=[];let n=0;for(const l of t){const m=Number(l.depth??l.DEPTH??NaN);if(isNaN(m))continue;const i=Number(l.nphi??l.NPHI??l.Nphi??NaN),v=Number(l.rhob??l.RHOB??l.Rhob??NaN);if(!isNaN(i)&&!isNaN(v)){const b=$e[n++]??{PHIT:null,PHIE:null},c=Math.min(Math.max(Number(b.PHIT??0),0),1),w=b.PHIE!==void 0?Number(b.PHIE):b.PHIE??null,N=w!==null&&!isNaN(Number(w))?Math.min(Math.max(Number(w),0),1):null,V={depth:m,PHIT:c};N!==null&&(V.PHIE=N),r.push(V)}}r.sort((l,m)=>l.depth-m.depth),a($,r),a(F,ta())}const ma=Yt.subscribe(t=>{t?.depthFilter&&a(te,{...t.depthFilter}),t?.zoneFilter&&a(Ie,{...t.zoneFilter})});Ut(()=>{ma(),Be()});let ut=h("");Q(()=>e(pe),()=>{a(re,1-1.68*Math.tan((e(pe)-90)*Math.PI/180))}),Q(()=>e(ve),()=>{a(j,e(ve).map(t=>({x:t.depth,vclay:t.VCLAY,vsilt:t.VCLAY+t.VSILT,vdolo:t.VCLAY+t.VSILT+t.VDOLO,vcalc:t.VCLAY+t.VSILT+t.VDOLO+t.VCALC,vsand:t.VCLAY+t.VSILT+t.VDOLO+t.VCALC+t.VSAND})))}),Q(()=>e($),()=>{a(ee,e($).map(t=>({x:t.depth,y:t.PHIT})))}),Q(()=>e($),()=>{a(q,e($).map(t=>({x:t.depth,y:t.PHIE})).filter(t=>t.y!==void 0&&t.y!==null&&!isNaN(Number(t.y))))}),Q(()=>e(F),()=>{a(ie,e(F).map(t=>({x:t.depth,y:t.CPORE})))}),Q(()=>(e(Ae),e(te),e(Ie)),()=>{a(Y,(()=>{let t=e(Ae)||[];return t=io(t,e(te)),t=lo(t,e(Ie)),t})())}),Q(()=>(T(E()),T(R()),e(ut)),()=>{const t=`${E()}_${R()}`;E()&&R()&&t!==e(ut)&&(a(ut,t),Kt())}),Q(()=>(e(be),e(Y),e(le),e(se),e(ne),e(de),e(re),e(ce),e(ue),e(pe),e(te),e(Ie),e(W),e(D),e(We)),()=>{e(be)&&(e(Y)||e(le)!==void 0||e(se)!==void 0||e(ne)!==void 0||e(de)!==void 0||e(re)!==void 0||e(ce)!==void 0||e(ue)!==void 0||e(pe)!==void 0||e(te)||e(Ie)||e(W)||e(D))&&(e(We)&&clearTimeout(e(We)),a(We,setTimeout(()=>Ht(),150)))}),Q(()=>(e(me),e(ve),e(te),e(Ge)),()=>{e(me)&&(e(ve)||e(te))&&(e(Ge)&&clearTimeout(e(Ge)),a(Ge,setTimeout(()=>Zt(),150)))}),Q(()=>(e(he),e($),e(F),e(te),e(Ne),e(Je)),()=>{e(he)&&(e($)||e(F)||e(te)||e(Ne)!==void 0)&&(e(Je)&&clearTimeout(e(Je)),a(Je,setTimeout(()=>Qt(),150)))}),Ka(),zt();var pt=Eo(),Rt=d(u(pt),2);so(Rt,{});var ha=d(Rt,2);{var fa=t=>{var r=Ro(),n=u(r);{var l=o=>{var s=uo(),y=u(s,!0);p(s),z(()=>oe(y,e(ae)?e(ae):"Loading well log…")),_(o,s)},m=o=>{var s=Xa(),y=eo(s);{var L=I=>{var S=po(),J=u(S);p(S),z(()=>oe(J,`Error: ${e(x)??""}`)),_(I,S)};k(y,I=>{e(x)&&I(L)},!0)}_(o,s)};k(n,o=>{e(g)?o(l):o(m,!1)})}var i=d(n,2),v=u(i),f=u(v),b=d(u(f),2),c=u(b),w=u(c),N=d(u(w),2);O(N),p(w);var V=d(w,2),fe=d(u(V),2);O(fe),p(V),p(c);var ye=d(c,2),ge=u(ye);ge.__click=aa;var Fe=d(ge,2);Fe.__click=oa;var ya=u(Fe);{var ga=o=>{var s=Se("Saving...");_(o,s)},_a=o=>{var s=Se("Save HC Data");_(o,s)};k(ya,o=>{e(Me)?o(ga):o(_a,!1)})}p(Fe),p(ye);var vt=d(ye,2),Xe=u(vt);O(Xe);var xa=d(Xe,2);p(vt);var St=d(vt,2);{var Na=o=>{var s=vo(),y=u(s,!0);p(s),z(()=>oe(y,e(Oe))),_(o,s)};k(St,o=>{e(Oe)&&o(Na)})}var wa=d(St,2);{var Pa=o=>{var s=mo(),y=u(s);p(s),z(()=>oe(y,`HC correction applied. ${e(D),P(()=>e(D).length)??""} points corrected. Red diamond markers show corrected data in plot above.`)),_(o,s)};k(wa,o=>{e(W)&&o(Pa)})}p(b),p(f);var mt=d(f,2),Et=d(u(mt),2),ht=u(Et),ft=d(u(ht),2),bt=u(ft),Ue=u(bt);O(Ue),Ue.value=Ue.__value="ssc",wt(),p(bt);var It=d(bt,2),ze=u(It);O(ze),ze.value=ze.__value="multi_mineral",wt(),p(It),p(ft);var Tt=d(ft,2);{var Ca=o=>{var s=ho(),y=d(u(s),2),L=u(y),I=d(u(L),2);O(I),p(L);var S=d(L,2),J=d(u(S),2);O(J),p(S);var H=d(S,2),A=d(u(H),2);O(A),p(H);var U=d(H,2),Pe=d(u(U),2);O(Pe),p(U);var Ce=d(U,2),Ye=d(u(Ce),2);O(Ye),p(Ce);var He=d(Ce,2),Z=d(u(He),2);O(Z),p(He);var Mt=d(He,2),Ot=d(u(Mt),2);O(Ot),p(Mt),p(y);var Vt=d(y,2),At=d(u(Vt),2),Za=u(At);Ct(Za,M=>a(be,M),()=>e(be)),p(At),p(Vt),p(s),K(I,()=>e(le),M=>a(le,M)),K(J,()=>e(se),M=>a(se,M)),K(A,()=>e(ne),M=>a(ne,M)),K(Pe,()=>e(de),M=>a(de,M)),K(Ye,()=>e(ce),M=>a(ce,M)),K(Z,()=>e(ue),M=>a(ue,M)),K(Ot,()=>e(pe),M=>a(pe,M)),_(o,s)};k(Tt,o=>{e(G)==="ssc"&&o(Ca)})}var Ha=d(Tt,2);{var Ra=o=>{var s=fo(),y=d(u(s),2),L=u(y),I=d(u(L),2);O(I);var S=d(I,2),J=u(S);p(S),p(L);var H=d(L,2),A=d(u(H),2);z(()=>{e(Qe),to(()=>{})});var U=u(A);U.value=U.__value="density";var Pe=d(U);Pe.value=Pe.__value="neutron_density";var Ce=d(Pe);Ce.value=Ce.__value="sonic",p(A),p(H);var Ye=d(H,2),He=u(Ye);O(He),wt(2),p(Ye),p(y),p(s),z(Z=>oe(J,`Current: ${Z??""}`),[()=>(e(Ve),P(()=>e(Ve).join(", ")))]),ao("blur",I,sa),K(I,()=>e(nt),Z=>a(nt,Z)),oo(A,()=>e(Qe),Z=>a(Qe,Z)),Pt(He,()=>e(st),Z=>a(st,Z)),_(o,s)};k(Ha,o=>{e(G)==="multi_mineral"&&o(Ra)})}p(ht);var yt=d(ht,2),et=u(yt);et.__click=ra;var qe=d(et,2);qe.__click=na;var Sa=u(qe);{var Ea=o=>{var s=Se("Saving...");_(o,s)},Ia=o=>{var s=Se("Save Lithology");_(o,s)};k(Sa,o=>{e(Te)?o(Ea):o(Ia,!1)})}p(qe),p(yt);var gt=d(yt,2),Ta=u(gt);{var ka=o=>{var s=bo();Ct(s,y=>a(me,y),()=>e(me)),_(o,s)},Da=o=>{var s=yo();_(o,s)};k(Ta,o=>{e(ve),P(()=>e(ve).length>0)?o(ka):o(Da,!1)})}p(gt);var La=d(gt,2);{var Ma=o=>{var s=go(),y=u(s,!0);p(s),z(()=>oe(y,e(De))),_(o,s)};k(La,o=>{e(De)&&o(Ma)})}p(Et),p(mt);var kt=d(mt,2),_t=d(u(kt),2),tt=u(_t);tt.__click=da;var we=d(tt,2);we.__click=ca;var Oa=u(we);{var Va=o=>{var s=Se("Saving...");_(o,s)},Aa=o=>{var s=Se("Save Porosity");_(o,s)};k(Oa,o=>{e(ke)?o(Va):o(Aa,!1)})}p(we);var xt=d(we,2),at=u(xt);O(at);var ja=d(at,2);p(xt);var Nt=d(xt,2),$a=u(Nt);{var Ba=o=>{var s=_o();Ct(s,y=>a(he,y),()=>e(he)),_(o,s)},Fa=o=>{var s=xo();_(o,s)};k($a,o=>{e($),e(F),P(()=>e($).length>0||e(F).length>0)?o(Ba):o(Fa,!1)})}p(Nt);var Ua=d(Nt,2);{var za=o=>{var s=No(),y=u(s,!0);p(s),z(()=>oe(y,e(Le))),_(o,s)};k(Ua,o=>{e(Le)&&o(za)})}p(_t);var Dt=d(_t,2),Lt=u(Dt);{var qa=o=>{const s=X(()=>(e($),P(()=>e($).map(H=>H.PHIT)))),y=X(()=>(T(e(s)),P(()=>e(s).reduce((H,A)=>H+A,0)/e(s).length))),L=X(()=>(T(e(s)),P(()=>Math.min(...e(s))))),I=X(()=>(T(e(s)),P(()=>Math.max(...e(s)))));var S=wo(),J=d(u(S));p(S),z((H,A,U)=>oe(J,` Avg: ${H??""} | Min: ${A??""} | Max: ${U??""} | Count: ${T(e(s)),P(()=>e(s).length)??""}`),[()=>(T(e(y)),P(()=>e(y).toFixed(3))),()=>(T(e(L)),P(()=>e(L).toFixed(3))),()=>(T(e(I)),P(()=>e(I).toFixed(3)))]),_(o,S)},Ya=o=>{var s=Po();_(o,s)};k(Lt,o=>{e($),P(()=>e($).length>0)?o(qa):o(Ya,!1)})}var Wa=d(Lt,2);{var Ga=o=>{const s=X(()=>(e(F),P(()=>e(F).map(H=>H.CPORE)))),y=X(()=>(T(e(s)),P(()=>e(s).reduce((H,A)=>H+A,0)/e(s).length))),L=X(()=>(T(e(s)),P(()=>Math.min(...e(s))))),I=X(()=>(T(e(s)),P(()=>Math.max(...e(s)))));var S=Co(),J=d(u(S),3);p(S),z((H,A,U)=>oe(J,` Avg: ${H??""} | Min: ${A??""} | Max: ${U??""} | Count: ${T(e(s)),P(()=>e(s).length)??""}`),[()=>(T(e(y)),P(()=>e(y).toFixed(3))),()=>(T(e(L)),P(()=>e(L).toFixed(3))),()=>(T(e(I)),P(()=>e(I).toFixed(3)))]),_(o,S)},Ja=o=>{var s=Ho();_(o,s)};k(Wa,o=>{e(F),P(()=>e(F).length>0)?o(Ga):o(Ja,!1)})}p(Dt),p(kt),p(v),p(i),p(r),z(()=>{ge.disabled=e(g),Re(ge,e(g)?"opacity:0.5; pointer-events:none;":""),Fe.disabled=e(g)||e(Me)||!e(W),Re(Fe,e(g)||e(Me)||!e(W)?"opacity:0.5; pointer-events:none;":""),Xe.disabled=e(g)||!e(W),$t(xa,1,`text-sm cursor-pointer ${e(g)||!e(W)?"opacity-50":""}`),Ue.disabled=e(g),ze.disabled=e(g),et.disabled=e(g),Re(et,e(g)?"opacity:0.5; pointer-events:none;":""),qe.disabled=e(g)||e(Te),Re(qe,e(g)||e(Te)?"opacity:0.5; pointer-events:none;":""),tt.disabled=e(g),Re(tt,e(g)?"opacity:0.5; pointer-events:none;":""),we.disabled=e(g)||e(ke),Re(we,e(g)||e(ke)?"opacity:0.5; pointer-events:none;":""),at.disabled=e(g),$t(ja,1,`text-sm cursor-pointer ${e(g)?"opacity-50":""}`)}),K(N,()=>e(rt),o=>a(rt,o)),K(fe,()=>e(it),o=>a(it,o)),Pt(Xe,()=>e(lt),o=>a(lt,o)),Bt(_e,[],Ue,()=>e(G),o=>a(G,o)),Bt(_e,[],ze,()=>e(G),o=>a(G,o)),Pt(at,()=>e(Ne),o=>a(Ne,o)),_(t,r)},ba=t=>{var r=So();_(t,r)};k(ha,t=>{R()?t(fa):t(ba,!1)})}p(pt),_(ot,pt),qt()}Qa(["click"]);var To=C('<div slot="left"><!></div>');function Ao(ot,Ee){Ft(Ee,!1);let re=h(null),j=h(null);const ee=Yt.subscribe(q=>{a(re,q?.project??null),a(j,q?.selectedWell??null)});Ut(()=>ee()),zt(),no(ot,{get selectedWell(){return e(j)},get project(){return e(re)},$$slots:{left:(q,ie)=>{var _e=To(),E=u(_e);{let R=X(()=>e(re)?.project_id??""),B=X(()=>e(j)?.name??"");Io(E,{get projectId(){return e(R)},get wellName(){return e(B)}})}p(_e),_(q,_e)}}}),qt()}export{Ao as component,Vo as universal};
