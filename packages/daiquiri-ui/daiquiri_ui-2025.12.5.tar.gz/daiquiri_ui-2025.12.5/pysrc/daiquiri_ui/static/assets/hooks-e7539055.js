var M=Object.defineProperty;var V=(e,r,t)=>r in e?M(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t;var b=(e,r,t)=>(V(e,typeof r!="symbol"?r+"":r,t),t);import{an as D,r as p,bW as O,b8 as R,j as F,a7 as P,l as N,ac as T,ax as E}from"./index-4cf586ed.js";import{b as I,a as A}from"./index-19c84627.js";function j(e){const r=(e&31744)>>10,t=e&1023;return(e>>15?-1:1)*(r?r===31?t?Number.NaN:1/0:2**(r-15)*(1+t/1024):6103515625e-14*(t/1024))}class U{constructor(r,t){b(this,"shape");b(this,"dimension");b(this,"data");b(this,"dtype");if(t.length!==2)throw new Error(`Unsupported dimension ${t.length} with NdFloat16Array`);this.data=r,this.shape=t,this.dimension=t.length,this.dtype="float16"}index(...r){if(r.length!==this.dimension)throw new Error(`Expected ${this.dimension} for indexing`);return r[1]+r[0]*this.shape[1]}getRaw(...r){const t=this.index(...r);return this.data[t]}get(...r){const t=this.getRaw(...r);return j(t)}}function se(e){const r=`<${e.slice(1)}`;return{"<f1":"<f4","<f2":"<f4","<i8":"<i4","<u8":"<u4"}[r]??r}function oe(e,r){const n={"<f4":Float32Array,"<f8":Float64Array,"<i1":Int8Array,"|i1":Int8Array,i1:Int8Array,"<i2":Int16Array,"<i4":Int32Array,"<u1":Uint8Array,"|u1":Uint8Array,u1:Uint8Array,"<u2":Uint16Array,"<u4":Uint32Array}[r];if(!n)throw new TypeError(`Unsupported dtype: ${r}`);if(e instanceof Uint8Array){const a=n.BYTES_PER_ELEMENT;try{return new n(e.buffer,e.byteOffset,e.byteLength/a)}catch{return console.warn(`toTypedArray is using a memory copy for a '${n}'. Probably because the buffer is not properly aligned.`),new n(e)}}return new n(e)}function ue(e,r,t){const n=r.reduce((i,s)=>i*s);let a;switch(t){case"<f2":a=n*2===e.byteLength?Uint16Array:Float32Array;break;case"<f4":a=Float32Array;break;case"<f8":a=Float64Array;break;case"<i1":case"|i1":case"i1":a=Int8Array;break;case"<i2":a=Int16Array;break;case"<i4":case"<i8":a=Int32Array;break;case"<u1":case"|u1":case"u1":a=Uint8Array;break;case"<u2":a=Uint16Array;break;case"<u4":case"<u8":a=Uint32Array;break;default:throw new TypeError(`Unsupported dtype: ${t}`)}return D(new a(e),r)}function ce(e){if(!(e.data.buffer instanceof ArrayBuffer))throw new TypeError("A buffer as ArrayBuffer is expected");return e.dtype==="float32"?e:D(Float32Array.from(e.data),e.shape)}function z(e){return e instanceof Object&&"data"in e&&"stride"in e&&"shape"in e}function $(e){return e instanceof Object&&"data"in e&&"stride"in e&&"shape"in e&&"buffer"in e?e.buffer instanceof ArrayBuffer:!1}function fe(e,r="Expected NdArray<TypedArray<ArrayBuffer>>"){if(!$(e))throw new TypeError(r)}function de(e,r="Expected NdArray<TypedArray> or NdFloat16Array"){if(!z(e)&&!(e instanceof U))throw new TypeError(r)}function _(e,r,t){if(e.dimension!==1)throw new TypeError("Slicing only supported for 1dim array");const n=e.data.subarray(r,t);return D(n,[t-r])}function pe(e){if(e.length!==3)throw new TypeError(`Unsupported dtype format ${e}`);return{byteorder:e[0],type:e[1],itemsize:Number.parseInt(e[2]),numpy:e}}function le(e,r,t){return p.useMemo(()=>_(e,r,t),[e,r,t])}function B(e){if(!Array.isArray(e))return!1;for(const r of e)if(typeof r!="number")return!1;return!0}function ye(e,r="Expected number[]"){if(!B(e))throw new TypeError(r)}const G={sx:0,sy:0,centerX:0,centerY:0,matrix:new O().identity()},L=p.createContext(null);function he(){const e=p.useContext(L);if(!e)throw new Error("No LinearVisGroup context are avaialble");return e.current}function ve(e){const r=p.useRef(G),{children:t}=e,{abscissaConfig:n,ordinateConfig:a,visSize:i}=I(),{width:s,height:u}=i,{scaleType:h=A.Linear}=n,{scaleType:m=A.Linear}=a;if(h!==A.Linear||m!==A.Linear)throw new Error("VisGroup supports only linear axes");R(({camera:c})=>{const o=(n.flip?-1:1)*s/(n.visDomain[1]-n.visDomain[0]),w=(a.flip?-1:1)*u/(a.visDomain[1]-a.visDomain[0]),v=.5*(n.visDomain[0]+n.visDomain[1]),g=.5*(a.visDomain[0]+a.visDomain[1]);r.current.sx=o,r.current.sy=w,r.current.centerX=v,r.current.centerY=g,r.current.matrix=r.current.matrix.makeScale(o,w,0)},-100);const d=(n.flip?-1:1)*s/(n.visDomain[1]-n.visDomain[0]),l=(a.flip?-1:1)*u/(a.visDomain[1]-a.visDomain[0]),f=.5*(n.visDomain[0]+n.visDomain[1]),y=.5*(a.visDomain[0]+a.visDomain[1]);return r.current.sx=d,r.current.sy=l,r.current.centerX=f,r.current.centerY=y,r.current.matrix=r.current.matrix.makeScale(d,l,0),F.jsx(L.Provider,{value:r,children:F.jsx("group",{position:[-f*d,-y*l,0],scale:[d,l,1],children:t})})}class Y{constructor(r,t,n){b(this,"shape");b(this,"dimension");b(this,"data");b(this,"dtype");b(this,"transfer");if(t.length!==2)throw new Error(`Unsupported dimension ${t.length} with NdNormalizedUint8Array`);this.data=r,this.transfer=n,this.shape=t,this.dimension=t.length,this.dtype="uint8"}index(...r){if(r.length!==this.dimension)throw new Error(`Expected ${this.dimension} for indexing`);return r[1]+r[0]*this.shape[1]}getRaw(...r){const t=this.index(...r);return this.data[t]}get(...r){const t=this.getRaw(...r),{min:n,max:a,normalization:i}=this.transfer,s=t*(a-n)/255+n;switch(i){case A.Linear:return s;case A.Log:return Math.exp(s);case A.Sqrt:return s**2;default:return Number.NaN}}}function X(e){return typeof e=="string"&&Object.values(A).includes(e)}function me(e){return X(e)?e:e[0]}function q(e){const{values:r,bins:t}=e,n=r.findIndex(i=>i!==0);if(n===-1)return{...e,values:new Float64Array,bins:new Float64Array};const a=N.findLastIndex(r,i=>i!==0)+1;return n===0&&a===r.length?e:{...e,values:r.slice(n,a),bins:t.slice(n,a+1)}}function H(e){return e instanceof Object&&"y"in e}function we(e){return H(e)?e:new P(e[0],e[1])}function S(e,r,t=1e-5,n=1e-8){return Math.abs(e-r)<=n+t*Math.abs(r)}function be(e,r,t=1e-5,n=1e-8){return S(e.x,r.x,t,n)&&S(e.y,r.y,t,n)&&S(e.z,r.z,t,n)}function J(e){if(e.constructore===Float32Array)throw new Error("A Float32Array is expected")}function Ae(e){if(e!==void 0){if(e.dimension!==2)throw new TypeError("A 2d array is expected");if(!(e.data.buffer instanceof ArrayBuffer))throw new TypeError("A buffer as ArrayBuffer is expected");e instanceof Y||e instanceof U||J(e.data)}}function x(){return x=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},x.apply(this,arguments)}var C=function(r){return new Error("NoPayloadError: "+r+" requires a payload.")},W=function(r){return new Error("Mutation behavior must be one of: mergePastReversed, mergePast, keepFuture, or destroyFuture. Not: "+r)},K=function(r,t){if(!r)return t;var n=[].concat(t);if(n.length<=r)return t;var a=n.length-r;return a===1?n.shift():n.splice(0,a),n},Q=function(r,t){var n=r.past,a=r.present,i=r.future,s=t.payload,u=t.behavior,h=t.historyLimit,m=t.ignoreIdenticalMutations,d=t.cloneState,l=t.ignoreAction;if(!s||s===void 0)throw C("mutate");if(l)return{past:n,present:s,future:i};var f=[].concat(n);h!=="infinium"&&h!=="infinity"&&(f=K(h,n));var y=JSON.stringify(s)===JSON.stringify(a);if(m&&y)return d?x({},r):r;var c=[].concat(i),o={mergePastReversed:{past:[].concat(f,c.reverse(),[a]),present:s,future:[]},mergePast:{past:[].concat(f,i,[a]),present:s,future:[]},destroyFuture:{past:[].concat(f,[a]),present:s,future:[]},keepFuture:{past:[].concat(f,[a]),present:s,future:i}};if(typeof u>"u")return o.mergePastReversed;if(!o.hasOwnProperty(u))throw W(u);return o[u]},Z=function(r,t){var n=r.past,a=r.present,i=r.future,s=function(){if(n.length===0)return r;var c=n[n.length-1],o=n.slice(0,n.length-1);return{past:o,present:c,future:[a].concat(i)}},u=function(){if(i.length===0)return r;var c=i[0],o=i.slice(1);return{past:[].concat(n,[a]),present:c,future:o}},h=function(c){return c.payload=typeof c.payload=="function"?c.payload(a):c.payload,c},m=function(){return Q(r,h(t))},d=function(){var c=t.payload;return{past:[],present:c||r.present,future:[]}},l=function(){var c=t.payload;if(!c)throw C("resetInitialState");var o=[].concat(n);return o[0]=c,{past:[].concat(o),present:a,future:[].concat(i)}},f={undo:s,redo:u,update:m,reset:d,resetInitialState:l};return f[t.type]()},ee={past:[],present:null,future:[]},k={behavior:"mergePastReversed",historyLimit:100,ignoreIdenticalMutations:!0,cloneState:!1},re=function(r){return x({},k,r)},te=function(r,t){t===void 0&&(t=k);var n=p.useReducer(Z,x({},ee,{present:r})),a=n[0],i=n[1],s=a.past.length!==0,u=a.future.length!==0,h=p.useCallback(function(){s&&i({type:"undo"})},[s]),m=p.useCallback(function(){u&&i({type:"redo"})},[u]),d=p.useCallback(function(o){return o===void 0&&(o=r),i({type:"reset",payload:o})},[]),l=p.useCallback(function(o){return i({type:"resetInitialState",payload:o})},[]),f=p.useCallback(function(o,w,v){return i(x({type:"update",payload:o,behavior:w,ignoreAction:v},re(t)))},[]),y=p.useCallback(function(o,w,v){return w===void 0&&(w=t.behavior),v===void 0&&(v=!1),f(o,w,v)},[a]),c=function(w,v,g){v===void 0&&(v=t.behavior),g===void 0&&(g=!1),f(w,v,g)};return[a.present,y,{past:a.past,future:a.future,undo:h,canUndo:s,redo:m,canRedo:u,reset:d,resetInitialState:l,static_setState:c}]};function xe(e){return p.useMemo(()=>q(e),[e])}function ge(){const e=T(u=>u.camera),{dataToWorld:r,abscissaConfig:t,ordinateConfig:n,visSize:a}=I(),{width:i,height:s}=a;return p.useCallback(u=>{const{center:h,scale:m}=u,d=r(h),l=m.x*i/Math.abs(t.visDomain[1]-t.visDomain[0]),f=m.y*s/Math.abs(n.visDomain[1]-n.visDomain[0]);return{position:new E(d.x,d.y,e.position.z),scale:new E(l,f,e.scale.z)}},[e,r,t,n,i,s])}function Ee(){const{width:e,height:r}=T(a=>a.size),t=T(a=>a.camera),{getVisibleDomains:n}=I();return()=>{const{xVisibleDomain:a,yVisibleDomain:i}=n(t),s=new E(N.sum(a),N.sum(i)).multiplyScalar(.5),u=new E(Math.abs(a[1]-a[0])/e,Math.abs(i[1]-i[0])/r,1);return{center:s,scale:u}}}function Se(){return te(void 0,{behavior:"destroyFuture",historyLimit:50,ignoreIdenticalMutations:!0})}export{ve as L,Y as N,Se as a,Ae as b,ce as c,xe as d,oe as e,U as f,se as g,ue as h,de as i,fe as j,he as k,le as l,ye as m,j as n,Ee as o,pe as p,ge as q,we as r,q as s,me as t,te as u,be as v};
