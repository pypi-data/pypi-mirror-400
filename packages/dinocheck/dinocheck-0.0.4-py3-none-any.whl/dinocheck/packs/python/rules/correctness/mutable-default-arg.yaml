id: python/mutable-default-arg
name: Mutable Default Argument
level: major
category: correctness
description: |
  Detects mutable default arguments in function definitions (lists, dicts, sets).

  This is a classic Python gotcha: default arguments are evaluated once at
  function definition time, not at call time. A mutable default is shared
  across all calls, causing unexpected behavior.

triggers:
  file_patterns:
    - "**/*.py"
  code_patterns:
    - "def .+\\[\\]"
    - "def .+\\{\\}"
    - "def .+\\[\\s*\\]"
    - "def .+\\{\\s*\\}"

checklist:
  - Does any function parameter have a default value of [] or {}?
  - Is the default a mutable object (list, dict, set)?
  - Could the function mutate this default argument?
  - Should the default be None with a check inside the function?

fix: |
  Use None as default and create the mutable object inside the function:
  def foo(items=None):
      if items is None:
          items = []

tags:
  - correctness
  - python
  - gotcha

examples:
  bad: |
    def add_item(item, items=[]):
        items.append(item)
        return items
    # add_item(1) returns [1]
    # add_item(2) returns [1, 2]  # Unexpected!
  good: |
    def add_item(item, items=None):
        if items is None:
            items = []
        items.append(item)
        return items
