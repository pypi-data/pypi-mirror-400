import{bg as I,r as g,bh as v,bi as k,j as t,bj as m,bk as h,au as E,bl as N,aL as R,bm as D,l as C,q}from"./index-4cf586ed.js";import{g as L}from"./TomoScans-82e1e23b.js";function w(e,n){const r=I(e);g.useEffect(()=>{if(!n&&n!==0)return;const o=setInterval(()=>r.current(),n);return()=>clearInterval(o)},[n])}const T=R("daiquiri.components.tomo.TomoScanInfo");function b(e){return e==="tomo:dark"?["Dark","Acquire dark projection"]:e==="tomo:flat"?["Flat","Acquire flat projection"]:e==="tomo:return_ref"?["Return","Return to origin and acquiring few projection as reference"]:e==="tomo:step"?["Step scan","Tomo scan using rotation as step motor"]:e==="tomo:continuous"?["Continuous scan","Tomo scan using rotation as continuous motor"]:[e,"No description"]}function F(){const e=v();if(!e)return T("Skipped: lastgroup missing."),t.jsx(t.Fragment,{});const{subscans:n}=e;if(!n)return T("Skipped: subscans missing."),t.jsx(t.Fragment,{});const{activesubscan:r}=e;function o(s){return e?s<r?"DONE":s===r?e.state:"IDLE":""}const f=n.reduce((s,i)=>{const[a]=b(i);return s+a.length},0);function l(s,i,a){function j(S){return S.charAt(0).toUpperCase()+S.slice(1).toLowerCase()}const[c,d]=L(i),[u,x]=b(a),p=c==="RUNNING";return t.jsx(D,{animated:p,variant:d,label:`${j(u)}`,title:x,now:u.length,max:f},s)}return t.jsx(D,{children:C.map(n,(s,i)=>{const a=o(i);return l(i,a,s)})})}function P(e){const[n,r]=g.useState(0);w(()=>{r(Date.now())},5e3);const o=g.useMemo(()=>{if(n<=0)return 0;const f=h(e.starttime),l=(n-f.getTime())/1e3;return l<0?0:l},[e.starttime,n]);return t.jsxs(t.Fragment,{children:[N(o)," ",t.jsx("i",{className:"fa-solid fa-spinner fa-spin-pulse"})]})}function Y(e){const n=v(),r=k(c=>{if(n)return c.metadata.ns_datacollections.default.results[n.datacollectionid]});if(!n)return t.jsx(m,{children:t.jsx(m.Contents,{children:"No scan"})});const[o,f]=L(n.state);function l(c){const{subscans:d}=c;if(!d)return"";const{activesubscan:u}=c;if(u<0)return"Not yet started";if(u+1===d.length&&c.state!=="STARTING")return"Done";const x=d[u],[,p]=b(x);return`${u+1}/${d.length}: ${p}`}const{starttime:s,endtime:i,duration:a}=r??{},j=l(n);return t.jsx(m,{children:t.jsx(m.Contents,{children:t.jsxs("ul",{children:[n.datacollectionid&&t.jsxs("li",{children:[t.jsx("b",{children:"Data collection"}),": ",n.datacollectionid]}),t.jsxs("li",{children:[t.jsx("b",{children:"Scan"}),": ",n.scanid]}),t.jsxs("li",{children:[t.jsx("b",{children:"Start"}),":"," ",s?h(s).toLocaleTimeString():""]}),t.jsxs("li",{children:[t.jsx("b",{children:"Status"}),":"," ",t.jsx(E,{bg:f,title:`BLISS state: ${n.state}`,children:o})]}),t.jsxs("li",{children:[t.jsx("b",{children:"Progress"}),": ",t.jsx(F,{})]}),t.jsxs("li",{children:[t.jsx("b",{children:"Description"}),": ",j]}),i&&t.jsxs("li",{children:[t.jsx("b",{children:"End"}),": ",h(i).toLocaleTimeString()]}),s&&t.jsxs("li",{children:[t.jsx("b",{children:"Duration"}),":"," ",a?N(a):t.jsx(P,{starttime:s})]})]})})})}function B(e){const{providers:n,yamlNode:r,...o}=e;return q(r,o),t.jsx(Y,{})}export{B as default};
