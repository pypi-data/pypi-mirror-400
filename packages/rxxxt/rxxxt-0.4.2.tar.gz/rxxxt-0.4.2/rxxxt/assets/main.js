(()=>{var ke=Object.defineProperty;var ue=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable;var Z=(e,n,t)=>n in e?ke(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,Q=(e,n)=>{for(var t in n||(n={}))Ce.call(n,t)&&Z(e,t,n[t]);if(ue)for(var t of ue(n))Oe.call(n,t)&&Z(e,t,n[t]);return e};var b=(e,n,t)=>Z(e,typeof n!="symbol"?n+"":n,t);var Ne="contents";var W=class extends HTMLElement{constructor(){super(...arguments);b(this,"listener",t=>this.dispatchEvent(t));b(this,"attributeValues",new Map)}static get observedAttributes(){return[]}get allPresent(){return this.constructor.observedAttributes.every(t=>this.attributeValues.has(t))}connectedCallback(){this.style.display=Ne,this.allPresent&&this.doRegister()}attributeChangedCallback(t,r,i){this.allPresent&&(this.doUnregister(),this.attributeValues.set(t,i),this.doRegister())}disconnectedCallback(){this.allPresent&&this.doUnregister()}},ee=class extends W{static get observedAttributes(){return["name"]}doRegister(){window.addEventListener(this.attributeValues.get("name"),this.listener)}doUnregister(){window.removeEventListener(this.attributeValues.get("name"),this.listener)}},te=class extends W{constructor(){super(...arguments);b(this,"registeredElements")}static get observedAttributes(){return["name","selector"]}doRegister(){this.registeredElements=document.querySelectorAll(this.attributeValues.get("selector")),this.registeredElements.forEach(t=>{t.addEventListener(this.attributeValues.get("name"),this.listener)})}doUnregister(){this.registeredElements!=null&&this.registeredElements.forEach(t=>{t.removeEventListener(this.attributeValues.get("name"),this.listener)})}};customElements.define("rxxxt-window-event",ee);customElements.define("rxxxt-query-selector-event",te);var pe="rxxxt-on-",ce=()=>new Date().getTime(),$=class ${constructor(n,t,r){b(this,"descriptorRaw");b(this,"handler");b(this,"submitId");b(this,"triggerCallback");b(this,"submitMap");b(this,"timeoutHandle");b(this,"lastCall");this.triggerCallback=n,this.descriptorRaw=r,this.handler=this.handle.bind(this),this.submitMap=t,this.submitId=++$.submitIdCounter}get descriptor(){return JSON.parse(atob(this.descriptorRaw))}handle(n){var r,i,o,l;let t=Q(Q({},(r=this.descriptor.options.default_params)!=null?r:{}),Object.fromEntries(Object.entries(this.descriptor.options.param_map).map(p=>[p[0],Me(n,p[1])])));if(this.submitMap.set(this.submitId,{context_id:this.descriptor.context_id,data:t}),this.timeoutHandle&&(clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0),this.descriptor.options.prevent_default&&n.preventDefault(),!this.descriptor.options.no_trigger){let p=Math.max(0,(i=this.descriptor.options.debounce)!=null?i:0,((o=this.lastCall)!=null?o:0)+((l=this.descriptor.options.throttle)!=null?l:0)-ce());this.timeoutHandle=setTimeout(()=>{this.submitMap.has(this.submitId)&&(this.lastCall=ce(),this.triggerCallback())},p)}}};b($,"submitIdCounter",0);var ne=$;function Re(e){let n=new Map;for(let t of e.getAttributeNames())if(t.startsWith(pe)){let r=t.substring(pe.length),i=e.getAttribute(t);i!==null&&n.set(r,i)}return n}function Me(e,n){let t=e;try{for(let r of n.split("."))t=t[r];return typeof t=="string"||typeof t=="number"||typeof t=="boolean"?t:void 0}catch(r){return}}function fe(e){let n=new WeakMap,t=new Map;return{onElementUpdated:o=>{var E;let l=Re(o),p=(E=n.get(o))!=null?E:new Map;n.set(o,p);for(let f of p==null?void 0:p.keys())l.has(f)||(o.removeEventListener(f,p.get(f).handler),p.delete(f));for(let f of l.entries()){let T=p.get(f[0]);if(T===void 0){let k=new ne(e,t,f[1]);o.addEventListener(f[0],k.handler),p.set(f[0],k)}else T.descriptorRaw=f[1]}},popPendingEvents:()=>{let o=new Map(t);return t.clear(),o}}}function ve(e){let n,t=!1,r=!1,i=!1,o,l=new Map,p=()=>{let m=e.popPendingEvents();for(let h of m)l.set(h[0],h[1]);return m.size},E=()=>{if(t){r=!0;return}t=!0,r=!1,p(),o(Array.from(l.values()))},f=(m,h)=>{l.clear(),e.onUpdate(m,h),t=!1,r&&E()},T=()=>{n==null||n.close(),n=void 0,o=async m=>{var w;let h=await fetch(location.href,{method:"POST",body:JSON.stringify({state_token:e.stateToken,events:m}),headers:{"Content-Type":"application/json"},credentials:"include"});if(h.ok){let y=await h.json();p()>0&&!e.disableHTTPRetry?(console.info("retry http update"),t=!1,E()):(f(y.html_parts,y.events),e.stateToken=(w=y.state_token)!=null?w:e.stateToken)}else throw f([],[]),new Error("Update failed! Server responded with ".concat(h.statusText," (").concat(h.status,")."))}},k=()=>{if(n!==void 0){console.warn("tried to switch to websocket again, despite using it already");return}let m=async w=>n==null?void 0:n.send(JSON.stringify({type:"update",events:w,location:location.href.substring(location.origin.length)})),h=new URL(location.href);h.protocol=location.protocol=="https:"?"wss":"ws",n=new WebSocket(h),n.addEventListener("close",T),n.addEventListener("open",()=>{var w;o=m,n==null||n.send(JSON.stringify({type:"init",state_token:e.stateToken,enable_state_updates:(w=e.enableWebSocketStateUpdates)!=null?w:!1}))}),n.addEventListener("message",w=>{var C;if(typeof w.data!="string")return;let y=JSON.parse(w.data);e.stateToken=(C=y.state_token)!=null?C:e.stateToken,f(y.html_parts,y.events)})};return T(),{useHTTP:T,useWebSocket:k,update:()=>{i||(i=!0,setTimeout(()=>{i=!1,E()},0))}}}var he=11;function Pe(e,n){var t=n.attributes,r,i,o,l,p;if(!(n.nodeType===he||e.nodeType===he)){for(var E=t.length-1;E>=0;E--)r=t[E],i=r.name,o=r.namespaceURI,l=r.value,o?(i=r.localName||i,p=e.getAttributeNS(o,i),p!==l&&(r.prefix==="xmlns"&&(i=r.name),e.setAttributeNS(o,i,l))):(p=e.getAttribute(i),p!==l&&e.setAttribute(i,l));for(var f=e.attributes,T=f.length-1;T>=0;T--)r=f[T],i=r.name,o=r.namespaceURI,o?(i=r.localName||i,n.hasAttributeNS(o,i)||e.removeAttributeNS(o,i)):n.hasAttribute(i)||e.removeAttribute(i)}}var F,_e="http://www.w3.org/1999/xhtml",g=typeof document>"u"?void 0:document,He=!!g&&"content"in g.createElement("template"),Le=!!g&&g.createRange&&"createContextualFragment"in g.createRange();function Ie(e){var n=g.createElement("template");return n.innerHTML=e,n.content.childNodes[0]}function De(e){F||(F=g.createRange(),F.selectNode(g.body));var n=F.createContextualFragment(e);return n.childNodes[0]}function Ve(e){var n=g.createElement("body");return n.innerHTML=e,n.childNodes[0]}function Be(e){return e=e.trim(),He?Ie(e):Le?De(e):Ve(e)}function K(e,n){var t=e.nodeName,r=n.nodeName,i,o;return t===r?!0:(i=t.charCodeAt(0),o=r.charCodeAt(0),i<=90&&o>=97?t===r.toUpperCase():o<=90&&i>=97?r===t.toUpperCase():!1)}function We(e,n){return!n||n===_e?g.createElement(e):g.createElementNS(n,e)}function $e(e,n){for(var t=e.firstChild;t;){var r=t.nextSibling;n.appendChild(t),t=r}return n}function re(e,n,t){e[t]!==n[t]&&(e[t]=n[t],e[t]?e.setAttribute(t,""):e.removeAttribute(t))}var ge={OPTION:function(e,n){var t=e.parentNode;if(t){var r=t.nodeName.toUpperCase();r==="OPTGROUP"&&(t=t.parentNode,r=t&&t.nodeName.toUpperCase()),r==="SELECT"&&!t.hasAttribute("multiple")&&(e.hasAttribute("selected")&&!n.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),t.selectedIndex=-1)}re(e,n,"selected")},INPUT:function(e,n){re(e,n,"checked"),re(e,n,"disabled"),e.value!==n.value&&(e.value=n.value),n.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,n){var t=n.value;e.value!==t&&(e.value=t);var r=e.firstChild;if(r){var i=r.nodeValue;if(i==t||!t&&i==e.placeholder)return;r.nodeValue=t}},SELECT:function(e,n){if(!n.hasAttribute("multiple")){for(var t=-1,r=0,i=e.firstChild,o,l;i;)if(l=i.nodeName&&i.nodeName.toUpperCase(),l==="OPTGROUP")o=i,i=o.firstChild;else{if(l==="OPTION"){if(i.hasAttribute("selected")){t=r;break}r++}i=i.nextSibling,!i&&o&&(i=o.nextSibling,o=null)}e.selectedIndex=t}}},M=1,me=11,be=3,Ee=8;function U(){}function Fe(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}function Ke(e){return function(t,r,i){if(i||(i={}),typeof r=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var o=r;r=g.createElement("html"),r.innerHTML=o}else r=Be(r);else r.nodeType===me&&(r=r.firstElementChild);var l=i.getNodeKey||Fe,p=i.onBeforeNodeAdded||U,E=i.onNodeAdded||U,f=i.onBeforeElUpdated||U,T=i.onElUpdated||U,k=i.onBeforeNodeDiscarded||U,m=i.onNodeDiscarded||U,h=i.onBeforeElChildrenUpdated||U,w=i.skipFromChildren||U,y=i.addChild||function(a,s){return a.appendChild(s)},C=i.childrenOnly===!0,O=Object.create(null),_=[];function H(a){_.push(a)}function oe(a,s){if(a.nodeType===M)for(var c=a.firstChild;c;){var d=void 0;s&&(d=l(c))?H(d):(m(c),c.firstChild&&oe(c,s)),c=c.nextSibling}}function L(a,s,c){k(a)!==!1&&(s&&s.removeChild(a),m(a),oe(a,c))}function z(a){if(a.nodeType===M||a.nodeType===me)for(var s=a.firstChild;s;){var c=l(s);c&&(O[c]=s),z(s),s=s.nextSibling}}z(t);function G(a){E(a);for(var s=a.firstChild;s;){var c=s.nextSibling,d=l(s);if(d){var u=O[d];u&&K(s,u)?(s.parentNode.replaceChild(u,s),I(u,s)):G(s)}else G(s);s=c}}function Se(a,s,c){for(;s;){var d=s.nextSibling;(c=l(s))?H(c):L(s,a,!0),s=d}}function I(a,s,c){var d=l(s);if(d&&delete O[d],!c){var u=f(a,s);if(u===!1||(u instanceof HTMLElement&&(a=u,z(a)),e(a,s),T(a),h(a,s)===!1))return}a.nodeName!=="TEXTAREA"?Ae(a,s):ge.TEXTAREA(a,s)}function Ae(a,s){var c=w(a,s),d=s.firstChild,u=a.firstChild,N,x,R,V,S;e:for(;d;){for(V=d.nextSibling,N=l(d);!c&&u;){if(R=u.nextSibling,d.isSameNode&&d.isSameNode(u)){d=V,u=R;continue e}x=l(u);var B=u.nodeType,A=void 0;if(B===d.nodeType&&(B===M?(N?N!==x&&((S=O[N])?R===S?A=!1:(a.insertBefore(S,u),x?H(x):L(u,a,!0),u=S,x=l(u)):A=!1):x&&(A=!1),A=A!==!1&&K(u,d),A&&I(u,d)):(B===be||B==Ee)&&(A=!0,u.nodeValue!==d.nodeValue&&(u.nodeValue=d.nodeValue))),A){d=V,u=R;continue e}x?H(x):L(u,a,!0),u=R}if(N&&(S=O[N])&&K(S,d))c||y(a,S),I(S,d);else{var Y=p(d);Y!==!1&&(Y&&(d=Y),d.actualize&&(d=d.actualize(a.ownerDocument||g)),y(a,d),G(d))}d=V,u=R}Se(a,u,x);var le=ge[a.nodeName];le&&le(a,s)}var v=t,D=v.nodeType,de=r.nodeType;if(!C){if(D===M)de===M?K(t,r)||(m(t),v=$e(t,We(r.nodeName,r.namespaceURI))):v=r;else if(D===be||D===Ee){if(de===D)return v.nodeValue!==r.nodeValue&&(v.nodeValue=r.nodeValue),v;v=r}}if(v===r)m(t);else{if(r.isSameNode&&r.isSameNode(v))return;if(I(v,r,C),_)for(var J=0,Ue=_.length;J<Ue;J++){var X=O[_[J]];X&&L(X,X.parentNode,!1)}}return!C&&v!==t&&t.parentNode&&(v.actualize&&(v=v.actualize(t.ownerDocument||g)),t.parentNode.replaceChild(v,t)),v}}var je=Ke(Pe),Te=je;var qe="root",j=new Map,ae,q={stateToken:"",onUpdate:(e,n)=>{for(let t of e)ye(t);se(n)},popPendingEvents:()=>we.popPendingEvents()},P=ve(q),we=fe(P.update),ye=e=>{let n;if(e===void 0){let t=document.getElementById(qe);if(t===null)throw new Error("Update target not found!");n=t}else{let t=document.createElement("div");t.innerHTML=e;let r=t.children.item(0);if(r===null||r.tagName!=="rxxxt-meta".toUpperCase())throw new Error("Invalid update root!");let i=document.getElementById(r.id);if(i===null)throw new Error("Update target not found!");n=i,Te(n,r)}for(let t of n.getElementsByTagName("*"))we.onElementUpdated(t)},ze={custom:e=>{var n;for(let t of(n=j.get(e.name))!=null?n:[])try{t(e.data)}catch(r){console.error(r)}},navigate:e=>{let n=new URL(e.location,location.href);ae===void 0||ae!==n.origin?location.assign(n):(window.history.pushState({},"",e.location),e.requires_refresh&&P.update())},"use-websocket":e=>{e.websocket?P.useWebSocket():P.useHTTP()},"set-cookie":e=>{var t;let n=["".concat(e.name,"=").concat((t=e.value)!=null?t:"")];typeof e.path=="string"&&n.push("path=".concat(e.path)),typeof e.expires=="string"&&n.push("expires=".concat(new Date(e.expires).toUTCString())),typeof e.max_age=="number"&&n.push("max-age=".concat(e.max_age)),typeof e.domain=="string"&&n.push("domain=".concat(e.domain)),e.secure&&n.push("secure"),e.http_only&&n.push("httponly"),document.cookie=n.join(";")}},se=e=>e.forEach(n=>ze[n.event](n)),xe={on:(e,n)=>{var r;let t=(r=j.get(e))!=null?r:new Set;j.set(e,t),t.add(n)},off:(e,n)=>{var r;return((r=j.get(e))!=null?r:new Set).delete(n)},navigate:e=>{se([{event:"navigate",location:new URL(e,location.href).href,requires_refresh:!0}])},init:e=>{ae=new URL(location.href).origin,window.addEventListener("popstate",P.update),q.stateToken=e.state_token,q.enableWebSocketStateUpdates=e.enable_web_socket_state_updates,q.disableHTTPRetry=e.disable_http_update_retry,se(e.events),ye()}};window.rxxxt=xe;var ie=document.getElementById("rxxxt-init-data");ie!=null&&ie.textContent!==null?xe.init(JSON.parse(ie.textContent)):console.warn("failed to initialize rxxxt. init data not found.");})();
