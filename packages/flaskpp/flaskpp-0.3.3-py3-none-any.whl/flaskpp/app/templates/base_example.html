<!DOCTYPE html>
<html lang="{{ LANG }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="icon" href="{{ url_for('fpp_default.static', filename='img/favicon.png') }}" type="image/png">

    {{ fpp_tailwind }}

    <title>{% block title %}Flask++ App{% endblock %}</title>

    {% if enabled("EXT_SOCKET") %}
        <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"
                integrity="sha384-mkQ3/7FUtcGyoppY6bz/PORYoGqOl7/aSUMn2ymDOJcapfS6PHqxhRTMh1RR0Q6+"
                crossorigin="anonymous">
        </script>
        <script id="fppSocketScript"
                src="{{ url_for('fpp_default.static', filename='js/socket.js') }}" type="module"
                data-socket-domain="{{ request.scheme.replace('http', 'ws') }}://{{ request.host }}">
        </script>
        <meta name="sio:namespace" content="{{ namespace if namespace else '' }}">

        <script src="{{ url_for('fpp_default.static', filename='js/base.js') }}" type="module"></script>
    {% endif %}

    {% if enabled("EXT_BABEL") and DOMAIN %}
        <meta name="i18n:domain" content="{{ DOMAIN }}">
    {% endif %}

    {% if enabled("FRONTEND_ENGINE") and enabled("DEBUG_MODE") %}
        <meta name="vite:main" content="{{ vite_main_prefix }}">
        <meta name="vite:current" content="{{ vite_prefix }}">
    {% endif %}

    {% block head %}{% endblock %}
</head>

<body>
    <header>
        <nav>
            <div class="nav-inner-div">
                <a class="nav-brand" href="/">{{ _('NAV_BRAND') }}</a>

                <button class="nav-collapse-btn" type="button" data-collapse-toggle="navbarCollapse"
                        aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="mb-1 nav-collapse-btn-stripe"></span>
                    <span class="mb-1 nav-collapse-btn-stripe"></span>
                    <span class="nav-collapse-btn-stripe"></span>
                </button>

                <div id="navbarCollapse" class="nav-collapse max-md:hidden">
                    {% for label, href in NAV.items() %}
                        {% include "nav_link.html" with context %}
                    {% endfor %}

                    {% block nav %}{% endblock %}

                    <div class="relative ml-auto pl-3">
                        <details class="group">
                            <summary class="nav-lang-summary">
                                {% with data = get_locale_data(LANG) %}
                                    <span class="ml-1">{{ data[0] }}</span>
                                {% endwith %}
                                <svg viewBox="0 0 20 20"
                                     fill="currentColor">
                                    <path fill-rule="evenodd" d="M7 5l6 5-6 5V5z" clip-rule="evenodd"></path>
                                </svg>
                            </summary>

                            <div class="nav-lang-dropdown">
                                {% for locale in config["SUPPORTED_LOCALES"].split(";") %}
                                    {% with data = get_locale_data(locale) %}
                                        <a href="/lang/{{ locale }}?path={{ request.path }}" class="nav-lang-link">{{ data[0] }} {{ data[1] }}</a>
                                    {% endwith %}
                                {% endfor %}
                            </div>
                        </details>
                    </div>
                </div>
            </div>
        </nav>

        {% include "flashing.html" %}
    </header>

    <main id="main">
        {% block content %}{% endblock %}
    </main>

    <footer>
        <div class="footer-inner-div">
            Flask++ {{ current_year|default(2025) }} â€“ MIT License
        </div>
    </footer>

    {% if enabled("EXT_SOCKET") %}
        {% include "modals/confirm_modal.html" %}
        {% include "modals/info_modal.html" %}
    {% endif %}

    {% block modals %}{% endblock %}

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const toggle = document.querySelector('[data-collapse-toggle="navbarCollapse"]');
            const menu = document.getElementById("navbarCollapse");

            if (!toggle || !menu) return;

            const isMobile = () => window.innerWidth < 768;

            const openMenu = () => {
                menu.classList.remove("max-md:hidden");
                toggle.setAttribute("aria-expanded", "true");
            };

            const closeMenu = () => {
                menu.classList.add("max-md:hidden");
                toggle.setAttribute("aria-expanded", "false");
            };

            toggle.addEventListener("click", () => {
                const expanded = toggle.getAttribute("aria-expanded") === "true";
                expanded ? closeMenu() : openMenu();
            });

            window.addEventListener("resize", () => {
                if (!isMobile()) {
                    menu.classList.remove("max-md:hidden");
                    toggle.setAttribute("aria-expanded", "false");
                } else {
                    closeMenu();
                }
            });

            if (isMobile()) {
                closeMenu();
            }
        });
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>
