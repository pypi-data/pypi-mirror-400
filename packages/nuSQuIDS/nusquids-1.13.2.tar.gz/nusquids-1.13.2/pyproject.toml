[build-system]
requires = ["scikit-build-core>=0.10", "pybind11[global]>=2.12", "numpy", "wheel"]
build-backend = "scikit_build_core.build"

[project]
name = "nuSQuIDS"
version = "1.13.2"          # keep in sync with configure
description = "Neutrino propagation library with pybind11 bindings for reference see"
authors = [{name = "Carlos A. ArgÃ¼elles Delgado", email = "carguelles@fas.harvard.edu"}]
readme = "README.md"
requires-python = ">=3.8"
license = {file = "LICENSE"}
classifiers = [
  "Programming Language :: Python :: 3",
  "Programming Language :: C++",
  "License :: OSI Approved :: MIT License",
]

[project.optional-dependencies]
plot = ["matplotlib"]

[tool.scikit-build]
minimum-version = "0.11"
wheel.expand-macos-universal-tags = true
# Exclude large data files from sdist to stay under PyPI's 100MB limit
# Users can download cross-section data separately from the repository
sdist.exclude = [
    "data/xsections/*.h5",      # Cross-section splines (~270MB)
    "examples/",                 # Examples not needed for building (~26MB)
    "test/",                     # Test files not needed for building
    ".git/",                     # Git history
    "*.hdf5",                    # Any stray HDF5 files in root
    ".DS_Store",                 # macOS metadata
    ".claude/",                  # Claude Code settings
    "Report.txt",                # Temporary files
    "RELEASE_NOTES*.md",         # Release notes not needed for building
    "benchmarks/",               # Benchmarks not needed for building
    "binder/",                   # Binder config not needed for building
]

# cibuildwheel configuration for building wheels in CI
[tool.cibuildwheel]
before-all = "bash {project}/tools/wheels/cibw_before_all.sh {project}"
skip = "pp*"  # Skip PyPy builds

[tool.cibuildwheel.linux]
environment = { RUNNER_OS="Linux" }
repair-wheel-command = "bash ./tools/wheels/repair_wheel_linux.sh {wheel} {dest_dir}"

[tool.cibuildwheel.macos]
# Set MACOSX_DEPLOYMENT_TARGET to 14.0 to match Homebrew libraries on macOS 14 (Sonoma)
environment = { RUNNER_OS="macOS", MACOSX_DEPLOYMENT_TARGET="14.0" }
repair-wheel-command = "bash ./tools/wheels/repair_wheel_macos.sh {wheel} {dest_dir} {delocate_archs}"
