import"../chunks/DsnmJJEf.js";import{o as tt}from"../chunks/CXB-c7mV.js";import{p as at,e as g,g as B,u as oe,h as e,l,j as rt,i as r,k as we,c as ot,f as Q,a as S,s as L,b as d,m as U,n as ne,o as he,B as nt}from"../chunks/DqiEsuqZ.js";import{i as y}from"../chunks/Bn_fozzu.js";import{b as lt}from"../chunks/KivD7ms6.js";import{S as $e,M as st,r as it,g as ct,n as ut,c as gt,p as dt,o as pt,a as ft}from"../chunks/DP9vVMdq.js";import{M as ve}from"../chunks/Cw9LdTcD.js";import{R as Pe}from"../chunks/bC1EYS3z.js";import{C as ht,a as vt}from"../chunks/COrL_aJw.js";import{D as mt,e as yt,g as _t,F as ue,b as me,c as bt,W as Ne,E as ge,r as Tt,h as xt,n as St,i as ke}from"../chunks/B5aYIa2h.js";import{T as Ct}from"../chunks/DBiFLRHa.js";import{u as wt,g as de}from"../chunks/P-s3qVBC.js";var $t=Q(`<div>Select the variable which to shown on the plot: <ul class="list-disc list-outside ml-4"><li>The variable "capacity" shows the total capacity in a given year and consists of
										the sum of existing capacities, previously installed capacities, and new
										capacity additions.</li> <li>The variable "capacity_addition" shows only the capacity which is newly
										installed in the system in the given year.</li></ul></div>`),Pt=Q("<!> <!> <!>",1),Nt=Q(`Aggregate capacities belonging to the same node or technology. <ul class="list-disc list-outside ml-4"><li>Choosing "Node" will show the capacity allocations per technology for each node
									(selected in the "Nodes" filter below).</li> <li>Choosing "Technology" will show the capacity allocations per node for each
									technology (selected in the "Technologies" filter below).</li></ul>`,1),kt=Q("<!> <!> <!> <!>",1),At=Q("<!> <!> <!>",1),Dt=Q("<!> <!>",1);function It(Ae,De){at(De,!0);let R=g(B([]));const Ee=["capacity","capacity_addition"],Le={capacity:"Capacity",capacity_addition:"Capacity Addition"},Me=["conversion","storage","transport"],Oe=["energy","power"],Be=[{label:"Node",value:"node"},{label:"Technology",value:"technology"}];let X=g(B([])),_=g(B([null])),b=g("capacity"),p=g("conversion"),k=g("energy"),s=g(null),F=g("technology"),A=g(!1),V=g(B([])),j=g(B([])),z=g(B([])),le=null,$=g(!1),D=g(!1),M=l(()=>e(_).some(t=>t===null)),ye=g(B({})),_e=l(()=>{const t=e(p)=="storage"?e(k):"power";return e(ye)[e(O)[0]+"_"+t]||""}),pe=g(void 0),Ue=l(()=>e(z).map(t=>t.toString())),Re=l(()=>({maintainAspectRatio:!1,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`${Le[e(b)]}`+(e(A)?"":` [${e(_e)}]`)},min:e(A)?0:void 0,max:e(A)?1:void 0}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}));const Fe={tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue}`+(e(A)?"":` ${e(_e)}`),title:t=>{if(t.length>0)return`${t[0].label} - ${t[0].dataset.stack}`}}}};let Ve=l(()=>e(_)[0]==null?"":[e(_)[0].solution_name.split(".").pop(),e(_)[0].scenario_name,e(b),e(p),e(s)].join("_")),je=l(()=>{if(e(M)||e(p)===null)return[];const t={conversion:"set_conversion_technologies",storage:"set_storage_technologies",transport:"set_transport_technologies"}[e(p)];return e(_).map(v=>v.detail.system[t]||[])}),Z=l(()=>e(M)?[]:yt(e(_).flatMap(t=>Object.values(t.detail.reference_carrier))).sort()),O=l(()=>{if(e(p)===null||e(s)===null||e(M))return[];const t=new $e;return e(_).forEach((v,i)=>{(e(je)[i]??[]).forEach(a=>{v.detail.reference_carrier[a]===e(s)&&t.add(a)})}),Array.from(t).sort()}),ee=l(()=>{if(e(M))return[];const t=new $e;return e(R).forEach(v=>{v.forEach(i=>{e(O).includes(i.technology)&&t.add(i.location)})}),Array.from(t).sort()});oe(()=>{e(Z),rt(()=>{(e(s)==null||!e(Z).includes(e(s)))&&le!=null&&e(Z).includes(le)&&r(s,le,!0)})}),oe(()=>{e(s)!=null&&(le=e(s))}),oe(()=>{r(j,e(O),!0)}),oe(()=>{r(V,e(ee),!0)}),tt(()=>{r(b,de("var")||e(b),!0),r(p,de("tech")||e(p),!0),r(k,de("stor")||e(k),!0),r(s,de("car")||e(s),!0),ie()}),oe(()=>{e(b),e(p),e(k),e(s),we().then(()=>{wt({var:e(b),tech:e(p),stor:e(k),car:e(s)})})});function se(){r(F,"node"),r(A,!1),r(V,e(ee),!0),r(j,e(O),!0),r(z,e(X).map(t=>t.toString()),!0)}async function ze(){await we(),se(),ie()}function Ye(){se(),ie()}function Ie(){se(),ie()}function be(){se()}async function ie(){if(e(b)===null||e(s)===null||e(M)){r(R,[],!0);return}r(D,!0);const t=e(_),v=e(b),i=await Promise.all(t.map(a=>_t(a.solution_name,[v],a.scenario_name,e(s))));r(R,i.map(a=>a[v]?.data).filter(a=>a!==void 0),!0),i[0]?.unit?.data&&r(ye,Object.fromEntries(i[0].unit.data.map(a=>[a.technology+"_"+a.capacity_type,a[0]||a.units])),!0),r(D,!1)}function We(t,v,i){const a={},f=["capacity_type"];e(F)=="technology"?(a.technology=e(j),a.location=e(ee),f.push("location")):(a.location=e(V),a.technology=e(O),f.push("technology")),e(p)=="storage"&&(a.capacity_type=[e(k)]);let T=xt.fromRows(t).filterByCriteria(a).filterDataByIndex(e(z).map(P=>e(X).indexOf(Number(P)))).groupBy(f);return e(A)&&(T=T.normalize()),T.toArray().map(P=>{const Y=e(F)==="technology"?P.index.location:P.index.technology,c=St(Y);return{label:Y,data:P.data,borderColor:c,backgroundColor:i!==void 0?dt.draw(i,ke(c)):ke(c),stack:v}})}let qe=l(()=>{if(e(b)==null||e(p)==null||e(V).length==0||e(z).length==0||e(j).length==0||e(R).length===0)return[[],[]];Tt(),it();const t=[];return[e(_).flatMap((i,a)=>{if(i===null||!e(R)[a])return[];const f=ct(i.solution_name,i.scenario_name),T=a>0?ut():void 0;return t.push(gt(f,T)),We(e(R)[a],f,T)}),t]}),Te=l(()=>nt(e(qe),2)),xe=l(()=>e(Te)[0]),Ge=l(()=>e(Te)[1]);mt(Ae,{parentTitle:"The Transition Pathway",pageTitle:"Capacity",subtitle:"Annual capacity and capacity addition",filters:a=>{var f=Dt(),T=S(f);ue(T,{title:"Solution Selection",children:(c,I)=>{{let W=l(()=>e(D)||e($));st(c,{onSelected:ze,get disabled(){return e(W)},get solutions(){return e(_)},set solutions(C){r(_,C,!0)},get years(){return e(X)},set years(C){r(X,C,!0)},get loading(){return e($)},set loading(C){r($,C,!0)}})}}});var P=L(T,2);{var Y=c=>{var I=At(),W=S(I);ue(W,{title:"Carrier Selection",children:(x,q)=>{{const te=m=>{ne();var N=he(`Select the energy carrier for which to view results. Only capacities of technologies
						which have the selected carrier as the reference carrier are shown.`);d(m,N)};let h=l(()=>e(D)||e($));me(x,{label:"Carrier",get options(){return e(Z)},get disabled(){return e(h)},onUpdate:Ye,get value(){return e(s)},set value(m){r(s,m,!0)},helpText:te,$$slots:{helpText:!0}})}}});var C=L(W,2);{var fe=x=>{ue(x,{title:"Variable Selection",children:(q,te)=>{var h=Pt(),m=S(h);{const u=o=>{var n=$t();d(o,n)};let w=l(()=>e(D)||e($));me(m,{label:"Variable",get options(){return Ee},get disabled(){return e(w)},onUpdate:Ie,get value(){return e(b)},set value(o){r(b,o,!0)},helpText:u,$$slots:{helpText:!0}})}var N=L(m,2);{const u=o=>{ne();var n=he("Select whether to show capacities for conversion, storage, or transport technologies.");d(o,n)};let w=l(()=>e(D)||e($));me(N,{label:"Technology Type",get options(){return Me},get disabled(){return e(w)},onUpdate:be,get value(){return e(p)},set value(o){r(p,o,!0)},helpText:u,$$slots:{helpText:!0}})}var G=L(N,2);{var ae=u=>{{let w=l(()=>e(D)||e($));Pe(u,{label:"Storage Type",get options(){return Oe},onUpdate:be,get disabled(){return e(w)},get value(){return e(k)},set value(o){r(k,o,!0)}})}};y(G,u=>{e(p)=="storage"&&u(ae)})}d(q,h)}})};y(C,x=>{e(s)!==null&&x(fe)})}var E=L(C,2);{var ce=x=>{ue(x,{title:"Data Selection",children:(q,te)=>{var h=kt(),m=S(h);Pe(m,{label:"Aggregation",get options(){return Be},get value(){return e(F)},set value(n){r(F,n,!0)},helpText:n=>{ne();var re=Nt();ne(),d(n,re)},$$slots:{helpText:!0}});var N=L(m,2);Ct(N,{label:"Normalization",get value(){return e(A)},set value(n){r(A,n,!0)},helpText:n=>{ne();var re=he("Normalize the bars to have a height of one.");d(n,re)},$$slots:{helpText:!0}});var G=L(N,2);{var ae=o=>{ve(o,{label:"Technologies",get options(){return e(O)},get value(){return e(j)},set value(n){r(j,n,!0)}})},u=o=>{ve(o,{label:"Nodes",get options(){return e(ee)},get value(){return e(V)},set value(n){r(V,n,!0)}})};y(G,o=>{e(F)=="technology"?o(ae):o(u,!1)})}var w=L(G,2);{let o=l(()=>e(X).map(n=>n.toString()));ve(w,{label:"Years",get options(){return e(o)},get value(){return e(z)},set value(n){r(z,n,!0)}})}d(q,h)}})};y(E,x=>{e(s)!==null&&x(ce)})}d(c,I)};y(P,c=>{!e($)&&!e(M)&&c(Y)})}d(a,f)},buttons:a=>{{let f=l(()=>[e(pe)]);ht(a,{get charts(){return e(f)},downloadable:!0})}},mainContent:a=>{var f=U(),T=S(f);{var P=c=>{bt(c)},Y=c=>{var I=U(),W=S(I);{var C=E=>{Ne(E,{message:"Please select a solution"})},fe=E=>{var ce=U(),x=S(ce);{var q=h=>{ge(h,{message:"No carriers for this solution found"})},te=h=>{var m=U(),N=S(m);{var G=u=>{Ne(u,{message:"Please select a carrier"})},ae=u=>{var w=U(),o=S(w);{var n=H=>{ge(H,{message:"No technologies for this selection found"})},re=H=>{var Se=U(),He=S(Se);{var Je=J=>{ge(J,{message:"No locations for this selection found"})},Ke=J=>{var Ce=U(),Qe=S(Ce);{var Xe=K=>{ge(K,{message:"No data for this selection found"})},Ze=K=>{lt(vt(K,{type:"bar",get datasets(){return e(xe)},get labels(){return e(Ue)},get options(){return e(Re)},get pluginOptions(){return Fe},get plotName(){return e(Ve)},get patterns(){return e(Ge)},get generateLabels(){return ft},get onClickLegend(){return pt}}),et=>r(pe,et,!0),()=>e(pe))};y(Qe,K=>{e(xe).length==0?K(Xe):K(Ze,!1)},!0)}d(J,Ce)};y(He,J=>{e(ee).length==0?J(Je):J(Ke,!1)},!0)}d(H,Se)};y(o,H=>{e(O).length==0?H(n):H(re,!1)},!0)}d(u,w)};y(N,u=>{e(s)===null?u(G):u(ae,!1)},!0)}d(h,m)};y(x,h=>{e(Z).length==0?h(q):h(te,!1)},!0)}d(E,ce)};y(W,E=>{e(M)?E(C):E(fe,!1)},!0)}d(c,I)};y(T,c=>{e($)||e(D)?c(P):c(Y,!1)})}d(a,f)}}),ot()}export{It as component};
