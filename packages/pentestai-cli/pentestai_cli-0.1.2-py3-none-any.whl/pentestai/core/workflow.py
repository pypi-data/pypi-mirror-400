from __future__ import annotations
from dataclasses import dataclass
from pathlib import Path
from typing import Dict, Any, Callable

@dataclass
class Context:
    workspace: Path
    target: str
    scope: list[str]
    safe_mode: bool
    vars: Dict[str, Any]

StageFn = Callable[[Context], Dict[str, Any]]

class Workflow:
    def __init__(self) -> None:
        self.stages: Dict[str, StageFn] = {}

    def register(self, name: str, fn: StageFn) -> None:
        self.stages[name] = fn

    def run(self, name: str, ctx: Context) -> Dict[str, Any]:
        if name not in self.stages:
            raise RuntimeError(f"Unknown stage: {name}")
        return self.stages[name](ctx)
