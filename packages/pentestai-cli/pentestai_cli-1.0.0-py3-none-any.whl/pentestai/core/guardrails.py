from __future__ import annotations
from typing import List

def in_scope(host: str, scope: List[str]) -> bool:
    host = host.strip().lower()
    for s in scope:
        s = s.strip().lower()
        if not s:
            continue
        if s.startswith("*."):
            base = s[2:]
            if host == base or host.endswith("." + base):
                return True
        elif host == s:
            return True
    return False

def filter_in_scope(hosts: List[str], scope: List[str]) -> List[str]:
    return [h for h in hosts if in_scope(h, scope)]

def require_scope_or_fail(target: str, scope: List[str]) -> None:
    if scope and not in_scope(target, scope):
        raise RuntimeError(f"Target '{target}' is out of scope. Update scope allowlist.")
