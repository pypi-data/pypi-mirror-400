import"../chunks/DsnmJJEf.js";import{o as gt,s as pt}from"../chunks/CXB-c7mV.js";import{p as ft,e as d,g as f,u as ve,i as s,h as e,l as i,k as ht,c as mt,f as ne,a as F,s as D,b as T,m as ue,d as Ae,r as Le,n as vt,o as bt,t as _t,B as xt}from"../chunks/DqiEsuqZ.js";import{i as x}from"../chunks/Bn_fozzu.js";import{u as Ct,a as Ve,b as de,e as yt}from"../chunks/P-s3qVBC.js";import{b as St}from"../chunks/KivD7ms6.js";import{S as oe,M as Tt,g as wt,c as $t,p as We,n as Ot,r as Et,o as At,a as Lt}from"../chunks/DP9vVMdq.js";import{M as J}from"../chunks/Cw9LdTcD.js";import{R as Dt}from"../chunks/bC1EYS3z.js";import{T as qe}from"../chunks/DBiFLRHa.js";import{C as Pt,a as jt}from"../chunks/COrL_aJw.js";import{D as kt,F as be,g as Mt,c as Bt,W as Ge,r as Rt,h as se,n as He,i as _e,E as zt}from"../chunks/B5aYIa2h.js";import{g as Ft}from"../chunks/D_ns0G0z.js";import{u as K}from"../chunks/BusSaQ9E.js";import{d as Nt}from"../chunks/CgsLtv0Y.js";var Ut=ne("<div><!></div>"),Yt=ne('<div class="grid grid-cols-2"><div><!></div> <!></div>'),It=ne("<!> <!> <!> <!> <!>",1),Vt=ne("<!> <!> <!>",1),Wt=ne("<!> <!> <!>",1),qt=ne("<!> <!>",1);function ir(Je,Ke){ft(Ke,!0);const w="Technology / Carrier",De=" (Capex)",Pe=" (Opex)",Qe="Capex",Xe="Opex",Ze="Carrier",et="Shed Demand";let Y=d(f([]));const je=["Location",w];let Q=d(f([])),X=d(f([])),xe=d(f([])),ge=d(f([])),pe=d(f([])),fe=d(f({})),c=d(f([null])),I=d(f([])),V=d(f([])),W=d(f([])),N=d(f([])),U=d(f([])),le=d("Location"),ie=d(f([])),P=d(f([])),Ce=null,ye=null,Se=null,Te=null,we=null,ke="",Me="",Be="",Re="",ze="",Fe="",Ne="",_=d(!1),C=d(!1),$e=d(void 0),j=i(()=>e(c).some(t=>t===null)),k=f({capex:{title:"Capex",show:!0,subdivision:!1,showSubdivision:!0,label:Qe,helpText:"Annualized investment cost to expand technology capacity."},opex:{title:"Opex",show:!0,subdivision:!1,showSubdivision:!0,label:Xe,helpText:"Annual (fixed and variable) operational cost of technologies."},carrier:{title:"Carrier",show:!0,subdivision:!1,showSubdivision:!0,label:Ze,helpText:"Annual cost of importing and exporting carriers."},shed_demand:{title:"Shed Demand",show:!0,subdivision:!1,showSubdivision:!0,label:et,helpText:"Annual cost of shed demand of carriers."},carbon_emission:{title:"Carbon Emissions",show:!0,subdivision:!1,showSubdivision:!1,helpText:"Annual cost associated with carbon dioxide emissions."}}),tt=i(()=>{if(!e(c)[0])return"";let t=e(c)[0].solution_name.split(".");return[t[t.length-1],e(c)[0].scenario_name,"costs"].join("_")}),Ue=i(()=>e(te).length>0?e(fe)[e(te)[0]]||"":e(ee).length>0?e(fe)[e(ee)[0]]||"":e(re).length>0&&e(fe)[e(re)[0]]||""),rt=i(()=>({maintainAspectRatio:!1,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`Costs [${e(Ue)}]`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}})),at={tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue} ${e(Ue)}`,title:t=>{if(t.length>0)return`${t[0].label} - ${t[0].dataset.stack}`}}}},ot=i(()=>e(P)),Z=i(()=>e(j)?new Set:new Set([...e(Q).flatMap(t=>t.map(r=>r.technology))||[],...e(X).flatMap(t=>t.map(r=>r.technology))||[]])),ee=i(()=>{if(e(j)||e(Z).size==0)return[];const t=e(c),r=new oe;return t.forEach(a=>{a.detail.system.set_transport_technologies.forEach(n=>{e(Z).has(n)&&r.add(n)})}),Array.from(r).sort()}),te=i(()=>{if(e(j)||e(Z).size==0)return[];const t=e(c),r=new oe;return t.forEach(a=>{a.detail.system.set_conversion_technologies.forEach(n=>{e(Z).has(n)&&r.add(n)})}),Array.from(r).sort()}),re=i(()=>{if(e(j)||e(Z).size==0)return[];const t=e(c),r=new oe;return t.forEach(a=>{a.detail.system.set_storage_technologies.forEach(n=>{e(Z).has(n)&&r.add(n)})}),Array.from(r).sort()}),he=i(()=>{if(e(j))return[];const t=new oe;return e(ge).forEach(r=>{r.forEach(a=>{t.add(a.carrier)})}),Array.from(t).sort()}),me=i(()=>{if(e(j))return[];const t=new oe;return e(pe).forEach(r=>{r.forEach(a=>{t.add(a.carrier)})}),Array.from(t).sort()}),Oe=i(()=>{if(e(j))return[];const t=e(c),r=new oe;return t.forEach(a=>{Object.keys(a.detail.edges).forEach(n=>{r.add(n)}),a.detail.system.set_nodes.forEach(n=>{r.add(n)})}),Array.from(r).sort()});ve(()=>{s(ie,e(Oe),!0)}),ve(()=>{s(P,e(Y).map(t=>t.toString()),!0)}),K(()=>e(ee),()=>!!e(c)[0]&&!!e(Q)&&!!e(X),()=>Be,()=>Se,t=>s(W,t,!0),t=>Be=t,t=>Se=t),K(()=>e(te),()=>!!e(c)[0]&&e(Q).length>0&&e(X).length>0,()=>ke,()=>Ce,t=>s(I,t,!0),t=>ke=t,t=>Ce=t),K(()=>e(re),()=>!!e(c)[0]&&e(Q).length>0&&e(X).length>0,()=>Me,()=>ye,t=>s(V,t,!0),t=>Me=t,t=>ye=t),K(()=>e(he),()=>!!e(c)[0]&&e(ge).length>0,()=>Re,()=>Te,t=>s(N,t,!0),t=>Re=t,t=>Te=t),K(()=>e(me),()=>!!e(c)[0]&&e(pe).length>0,()=>ze,()=>we,t=>s(U,t,!0),t=>ze=t,t=>we=t),K(()=>e(Oe),()=>!!e(c)[0],()=>Fe,()=>null,t=>s(ie,t,!0),t=>Fe=t,()=>{}),K(()=>e(Y).map(t=>t.toString()),()=>!!e(c)[0],()=>Ne,()=>null,t=>s(P,t,!0),t=>Ne=t,()=>{}),gt(()=>{Object.entries(k).forEach(([t,r])=>{r.show=Ve(t,r.show),r.subdivision=Ve(t+"_sub",r.subdivision)}),Se=de("tran"),Ce=de("conv"),ye=de("stor"),Te=de("cost"),we=de("demand")}),ve(()=>{e(W),e(I),e(V),e(N),e(U),Object.values(k).forEach(t=>{t.show,t.subdivision}),ht().then(()=>{let t={tran:e(W).map(r=>e(ee).indexOf(r)).join("~"),conv:e(I).map(r=>e(te).indexOf(r)).join("~"),stor:e(V).map(r=>e(re).indexOf(r)).join("~"),cost:e(N).map(r=>e(he).indexOf(r)).join("~"),demand:e(U).map(r=>e(me).indexOf(r)).join("~")};Object.entries(k).forEach(([r,a])=>{t[r]=a.show?"1":"0",t[r+"_sub"]=a.subdivision?"1":"0"}),Ct(t)})});function st(){nt()}async function nt(){if(e(c).some(a=>a===null))return;s(C,!0);const t=e(c),r=await Promise.all(t.map(a=>Mt(a.solution_name,["cost_capex_yearly","cost_opex_yearly","cost_carbon_emissions_total","cost_carrier","cost_shed_demand"].map(n=>Ft(n,a?.version)),a.scenario_name)));s(Q,r.map(a=>a.cost_capex_yearly?.data||[]),!0),s(X,r.map(a=>a.cost_opex_yearly?.data||[]),!0),s(xe,r.map(a=>a.cost_carbon_emissions_total?.data||[]),!0),s(ge,r.map(a=>a.cost_carrier?.data||[]),!0),s(pe,r.map(a=>a.cost_shed_demand?.data||[]),!0),r[0].unit?.data&&s(fe,Object.fromEntries(r[0].unit.data.map(a=>[a.technology,a[0]||a.units])),!0),s(C,!1)}let Ee=d(f([]));function lt(){s(Ee,[...e(I).concat(e(V)).concat(e(W)).flatMap(t=>[t+De,t+Pe]),...e(N),...e(U)],!0)}const it=Object.values(k).filter(t=>t.label).map(t=>t.label);let ct=Nt(lt,100);ve(()=>{e(I),e(V),e(W),e(N),e(U),ct()});let ut=i(()=>{if(e(Ee).length==0)return[[],[]];Rt(),Et();const t=[];return[e(c).flatMap((a,n)=>{if(a===null)return[];const M={capex:se.fromRows(e(Q)[n]).mapIndex(o=>({location:o.location,[w]:o.technology+De})),opex:se.fromRows(e(X)[n]).mapIndex(o=>({location:o.location,[w]:o.technology+Pe})),carrier:se.fromRows(e(ge)[n]).filter(o=>e(N).includes(o.index.carrier)).mapIndex(o=>({location:o.node,[w]:o.carrier})),shed_demand:se.fromRows(e(pe)[n]).filter(o=>e(U).includes(o.index.carrier)).mapIndex(o=>({location:o.node,[w]:o.carrier}))};let O=se.concatenate(Object.entries(M).map(([o,m])=>{if(!k[o].show)return null;const g=m.filterByCriteria({location:e(ie),[w]:e(Ee).concat(it)}).filterDataByIndex(e(P).map(G=>e(Y).indexOf(Number(G))));return k[o].subdivision?g:g.groupBy(["location"]).mapIndex(G=>({location:G.location,[w]:k[o].label||""}))}));e(le)==w?O=O.groupBy(["location"]):O=O.groupBy([w]);const B=n>0?Ot():void 0,q=wt(a.solution_name,a.scenario_name);t.push($t(q,B));const h=O.toArray().map(o=>{const m=e(le)==w?o.index.location:o.index[w],g=He(m);return{label:m,data:o.data,borderColor:g,backgroundColor:B!==void 0?We.draw(B,_e(g)):_e(g),stack:q}});if(e(xe)[n].length===1&&k.carbon_emission.show){const o=se.fromRows(e(xe)[n]).filterDataByIndex(e(P).map(g=>e(Y).indexOf(Number(g)))),m=He("Total Carbon Costs");h.push({data:o.get(0).data,label:"Total Carbon Costs",borderColor:m,backgroundColor:B!==void 0?We.draw(B,_e(m)):_e(m),stack:q})}return h}),t]}),Ye=i(()=>xt(e(ut),2)),Ie=i(()=>e(Ye)[0]),dt=i(()=>e(Ye)[1]);kt(Je,{parentTitle:"The Transition Pathway",pageTitle:"Costs",subtitle:"Total annualized system costs by capex, opex, carrier cost, and carbon cost",filters:n=>{var M=qt(),O=F(M);be(O,{title:"Solution Selection",children:(h,o)=>{{let m=i(()=>e(C)||e(_));Tt(h,{onSelected:st,get disabled(){return e(m)},get solutions(){return e(c)},set solutions(g){s(c,g,!0)},get years(){return e(Y)},set years(g){s(Y,g,!0)},get loading(){return e(_)},set loading(g){s(_,g,!0)}})}}});var B=D(O,2);{var q=h=>{var o=Wt(),m=F(o);be(m,{title:"Cost Selection",children:(y,ce)=>{var E=ue(),R=F(E);yt(R,17,()=>Object.values(k),A=>A.title,(A,u,H)=>{var L=Yt(),p=Ae(L),S=Ae(p);qe(S,{get label(){return e(u).title},get value(){return e(u).show},set value(l){e(u).show=l},helpText:l=>{vt();var b=bt();_t(()=>pt(b,e(u).helpText)),T(l,b)},$$slots:{helpText:!0}}),Le(p);var v=D(p,2);{var z=ae=>{var l=Ut(),b=Ae(l);qe(b,{label:"with Subdivision",get value(){return e(u).subdivision},set value($){e(u).subdivision=$}}),Le(l),T(ae,l)};x(v,ae=>{e(u).show&&e(u).showSubdivision&&ae(z)})}Le(L),T(A,L)}),T(y,E)}});var g=D(m,2);be(g,{title:"Technology Selection",children:(y,ce)=>{var E=It(),R=F(E);{var A=l=>{{let b=i(()=>e(C)||e(_));J(l,{get options(){return e(ee)},label:"Transport",get disabled(){return e(b)},get value(){return e(W)},set value($){s(W,$,!0)}})}};x(R,l=>{e(ee).length>0&&l(A)})}var u=D(R,2);{var H=l=>{{let b=i(()=>e(C)||e(_));J(l,{get options(){return e(re)},label:"Storage",get disabled(){return e(b)},get value(){return e(V)},set value($){s(V,$,!0)}})}};x(u,l=>{e(re).length>0&&l(H)})}var L=D(u,2);{var p=l=>{{let b=i(()=>e(C)||e(_));J(l,{get options(){return e(te)},label:"Conversion",get disabled(){return e(b)},get value(){return e(I)},set value($){s(I,$,!0)}})}};x(L,l=>{e(te).length>0&&l(p)})}var S=D(L,2);{var v=l=>{{let b=i(()=>e(C)||e(_));J(l,{get options(){return e(he)},label:"Cost of Carrier",get disabled(){return e(b)},get value(){return e(N)},set value($){s(N,$,!0)}})}};x(S,l=>{e(he).length>0&&l(v)})}var z=D(S,2);{var ae=l=>{{let b=i(()=>e(C)||e(_));J(l,{get options(){return e(me)},label:"Shed Demand",get disabled(){return e(b)},get value(){return e(U)},set value($){s(U,$,!0)}})}};x(z,l=>{e(me).length>0&&l(ae)})}T(y,E)}});var G=D(g,2);be(G,{title:"Data Selection",children:(y,ce)=>{var E=Vt(),R=F(E);{let p=i(()=>e(C)||e(_));Dt(R,{get options(){return je},label:"Aggregation",get disabled(){return e(p)},get value(){return e(le)},set value(S){s(le,S,!0)}})}var A=D(R,2);{var u=p=>{{let S=i(()=>e(C)||e(_));J(p,{get options(){return e(Oe)},label:"Locations",get disabled(){return e(S)},get value(){return e(ie)},set value(v){s(ie,v,!0)}})}};x(A,p=>{e(le)==je[1]&&p(u)})}var H=D(A,2);{var L=p=>{{let S=i(()=>e(Y).map(z=>z.toString())),v=i(()=>e(C)||e(_));J(p,{get options(){return e(S)},label:"Years",get disabled(){return e(v)},get value(){return e(P)},set value(z){s(P,z,!0)}})}};x(H,p=>{e(P)&&p(L)})}T(y,E)}}),T(h,o)};x(B,h=>{!e(_)&&!e(j)&&h(q)})}T(n,M)},buttons:n=>{{let M=i(()=>[e($e)]);Pt(n,{get charts(){return e(M)},downloadable:!0})}},mainContent:n=>{var M=ue(),O=F(M);{var B=h=>{Bt(h)},q=h=>{var o=ue(),m=F(o);{var g=y=>{Ge(y,{message:"Please select a solution"})},G=y=>{var ce=ue(),E=F(ce);{var R=u=>{Ge(u,{message:"Please select at least one year"})},A=u=>{var H=ue(),L=F(H);{var p=v=>{zt(v,{message:"No data available for the selected filters"})},S=v=>{St(jt(v,{type:"bar",get labels(){return e(ot)},get datasets(){return e(Ie)},get options(){return e(rt)},get pluginOptions(){return at},get plotName(){return e(tt)},get patterns(){return e(dt)},get generateLabels(){return Lt},get onClickLegend(){return At}}),z=>s($e,z,!0),()=>e($e))};x(L,v=>{e(Ie).length==0?v(p):v(S,!1)},!0)}T(u,H)};x(E,u=>{e(P).length==0?u(R):u(A,!1)},!0)}T(y,ce)};x(m,y=>{e(j)?y(g):y(G,!1)},!0)}T(h,o)};x(O,h=>{e(_)||e(C)?h(B):h(q,!1)})}T(n,M)}}),mt()}export{ir as component};
