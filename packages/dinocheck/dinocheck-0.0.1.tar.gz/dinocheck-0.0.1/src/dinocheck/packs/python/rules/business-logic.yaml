id: python/business-logic
name: Business Logic Review
level: major
category: correctness
description: |
  Reviews business logic for correctness, edge cases, and potential
  bugs. This is where LLM analysis shines - understanding intent
  and spotting logical errors that pass all syntax checks.

triggers:
  file_patterns:
    - "**/*.py"
  code_patterns:
    - "def (process|handle|execute|run|perform|calculate|compute)"
    - "def (create|update|delete|save|submit)"
    - "def (validate|check|verify|ensure)"
    - "class .*(Service|Handler|Processor|Manager)"

checklist:
  - Are all edge cases handled (empty, null, zero, negative)?
  - Is the algorithm correct for boundary conditions?
  - Are there off-by-one errors in loops or slicing?
  - Could floating-point precision cause issues in financial code?
  - Are state transitions valid and complete?

fix: |
  Add explicit handling for edge cases. Use Decimal for financial
  calculations. Add assertions or validation for preconditions.
  Consider property-based testing for complex logic.

tags:
  - correctness
  - logic
  - edge-cases

examples:
  bad: |
    def calculate_discount(price, quantity):
        return price * quantity * 0.1  # What if quantity is 0?
  good: |
    def calculate_discount(price, quantity):
        if quantity <= 0:
            return Decimal("0")
        if quantity >= 100:
            return price * quantity * Decimal("0.2")
        return price * quantity * Decimal("0.1")
