---
id: i-396o
title: >-
  Implement Learning protocols (TrajectoryAnalyzer, AbstractionExtractor,
  HindsightLearner)
priority: 1
created_at: '2025-12-18 03:33:25'
tags:
  - learning
  - phase-1
  - pillar-3
  - protocols
relationships:
  - from_id: i-396o
    from_uuid: 86f0185a-35ae-4544-8a17-00fb14cd000b
    from_type: issue
    to_id: i-4zj6
    to_uuid: f7fdaab5-ec46-410d-a60d-5350250ac750
    to_type: issue
    relationship_type: depends-on
    created_at: '2025-12-18 04:33:19'
    metadata: null
  - from_id: i-396o
    from_uuid: 86f0185a-35ae-4544-8a17-00fb14cd000b
    from_type: issue
    to_id: s-w56w
    to_uuid: ce205fa1-4233-4fbc-b56f-d1455e27962c
    to_type: spec
    relationship_type: implements
    created_at: '2025-12-18 04:33:19'
    metadata: null
status: closed
closed_at: '2025-12-18 04:33:19'
---
Define the protocols for the learning engine (Pillar 3).

## Files to Create
- `atlas/protocols/learning.py` (~60 lines)

## TrajectoryAnalyzer Protocol
Extract learning signals from trajectories:

```python
class TrajectoryAnalyzer(Protocol):
    def analyze(self, trajectory: Trajectory) -> AnalysisResult:
        """Full analysis of a trajectory"""
        ...
    
    def attribute_outcome(
        self,
        trajectory: Trajectory,
    ) -> List[Tuple[int, float]]:
        """Credit assignment: (step_index, contribution_score)"""
        ...
```

## AbstractionExtractor Protocol
Extract reusable patterns:

```python
class AbstractionExtractor(Protocol):
    def extract_code_patterns(
        self,
        trajectories: List[Trajectory],
    ) -> List[CodeConcept]:
        """Stitch-style compression"""
        ...
    
    def extract_strategies(
        self,
        trajectories: List[Trajectory],
    ) -> List[Strategy]:
        """ArcMemo-style abstraction"""
        ...
    
    def auto_document(self, concept: CodeConcept) -> CodeConcept:
        """LILO-style documentation generation"""
        ...
```

## HindsightLearner Protocol
Learn from trajectories to improve model:

```python
class HindsightLearner(Protocol):
    def prepare_training_data(
        self,
        trajectories: List[Trajectory],
    ) -> Dict[str, Any]:
        """Convert trajectories to training format"""
        ...
    
    def should_finetune(self) -> bool:
        """Check if enough data for fine-tuning"""
        ...
    
    def finetune(self, training_data: Dict) -> FinetuneResult:
        """Execute fine-tuning"""
        ...
```

## Supporting Types
```python
@dataclass
class AnalysisResult:
    success: bool
    key_steps: List[int]
    step_attribution: List[float]
    error_patterns: List[Dict]
    abstractable: bool
    training_examples: List[Dict]

@dataclass
class FinetuneResult:
    success: bool
    model_path: Optional[str]
    metrics: Dict[str, float]
```

## Acceptance Criteria
- [ ] All protocols defined
- [ ] Supporting dataclasses implemented
- [ ] Type hints complete

Implements [[s-w56w]]
