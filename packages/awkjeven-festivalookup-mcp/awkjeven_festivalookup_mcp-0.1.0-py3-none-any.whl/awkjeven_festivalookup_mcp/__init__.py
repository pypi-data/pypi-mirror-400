from mcp.server.fastmcp import FastMCP

# 创建 MCP 服务器实例
mcp = FastMCP("FestivalQuery", json_response=True)

# ==============================
# 中国传统节日（含详细描述）
# ==============================
chinese_festivals = {
    "春节": "农历正月初一，中国最重要的传统节日，象征辞旧迎新，有贴春联、放鞭炮、吃年夜饭、拜年等习俗。",
    "元宵节": "农历正月十五，赏花灯、吃元宵/汤圆、猜灯谜，又称‘上元节’。",
    "龙抬头": "农历二月初二，象征春耕开始，有剃头（‘剃龙头’）、吃龙食等习俗。",
    "寒食节": "清明节前1-2天，禁火冷食，纪念介子推（今多与清明合并）。",
    "清明节": "公历4月4日或5日，祭祖扫墓、踏青郊游，兼具自然与人文内涵。",
    "端午节": "农历五月初五，纪念屈原，有赛龙舟、吃粽子、挂艾草、佩香囊等习俗。",
    "七夕节": "农历七月初七，源于牛郎织女传说，被视为中国情人节，古时女子乞巧祈福。",
    "中元节": "农历七月十五，俗称‘鬼节’，祭祖祀亡魂；佛教称‘盂兰盆节’。",
    "中秋节": "农历八月十五，团圆赏月、吃月饼、饮桂花酒，象征家庭团聚。",
    "重阳节": "农历九月初九，登高望远、赏菊、敬老，2013年起为中国法定‘老年节’。",
    "腊八节": "农历腊月初八，喝腊八粥，祭祀祖先和神灵，祈求丰收吉祥。",
    "小年": "北方为腊月二十三，南方为腊月二十四，祭灶神，打扫房屋，准备过年。",
    "除夕": "农历腊月最后一天，守岁、吃年夜饭、贴福字，辞旧迎新。"
}

# ==============================
# 国际主流节日（覆盖多国通用节日）
# ==============================
international_festivals = {
    "元旦": "公历1月1日，全球通用的新年第一天，常有跨年庆祝活动。",
    "情人节": "公历2月14日，西方表达爱意的节日，流行送玫瑰、巧克力和贺卡。",
    "国际妇女节": "公历3月8日，庆祝女性成就，倡导性别平等，多国放假或举办活动。",
    "愚人节": "公历4月1日，以恶作剧和玩笑为特色，需注意玩笑尺度。",
    "复活节": "春分月圆后第一个星期日（通常3月底至4月底），基督教纪念耶稣复活，象征新生，有彩蛋和兔子习俗。",
    "劳动节": "公历5月1日，国际劳动节，纪念劳动者权益（美国在9月第一个星期一）。",
    "母亲节": "多数国家为5月第二个星期日，感恩母亲的养育之恩。",
    "父亲节": "多数国家为6月第三个星期日，表达对父亲的敬爱与感谢。",
    "儿童节": "公历6月1日（中国、俄罗斯等采用），关爱儿童成长；部分国家日期不同。",
    "万圣节": "公历10月31日，西方传统节日，人们装扮成鬼怪，进行‘不给糖就捣蛋’活动。",
    "感恩节": "美国为11月第四个星期四，加拿大为10月第二个星期一，家人团聚、吃火鸡、表达感恩。",
    "圣诞节": "公历12月25日，基督教纪念耶稣诞生，现为全球性文化节日，有圣诞树、礼物、颂歌等习俗。",
    "平安夜": "公历12月24日，圣诞节前夕，家人团聚、共进晚餐、交换礼物。",
    "黑色星期五": "感恩节次日（11月第四个星期五），美国大型购物促销日，标志假日购物季开始。",
    "跨年夜": "公历12月31日，迎接新年的前夜，全球多地举行倒计时与烟花表演。"
}

# ==============================
# 节日别名映射（支持模糊/简称查询）
# ==============================
chinese_aliases = {
    "过年": "春节",
    "新春": "春节",
    "元宵": "元宵节",
    "龙抬头节": "龙抬头",
    "清明": "清明节",
    "端午": "端午节",
    "七夕": "七夕节",
    "鬼节": "中元节",
    "中秋": "中秋节",
    "重阳": "重阳节",
    "腊八": "腊八节",
    "小年夜": "小年",
    "大年三十": "除夕",
    "除夕夜": "除夕"
}

international_aliases = {
    "新年": "元旦",
    "元旦节": "元旦",
    "情人": "情人节",
    "妇女节": "国际妇女节",
    "愚人": "愚人节",
    "复活": "复活节",
    "五一": "劳动节",
    "母亲": "母亲节",
    "父亲": "父亲节",
    "六一": "儿童节",
    "万圣": "万圣节",
    "感恩": "感恩节",
    "圣诞": "圣诞节",
    "平安夜": "平安夜",
    "黑五": "黑色星期五",
    "跨年": "跨年夜"
}

def normalize_name(name: str, aliases: dict, valid_names: set) -> str:
    """标准化节日名称：先查正式名，再查别名"""
    if name in valid_names:
        return name
    return aliases.get(name, name)

# ==============================
# 工具函数定义
# ==============================

@mcp.tool()
def query_chinese_festival(name: str) -> str:
    """查询中国传统节日的简介（支持别名，如‘中秋’）"""
    normalized = normalize_name(name, chinese_aliases, set(chinese_festivals.keys()))
    result = chinese_festivals.get(normalized)
    return result if result is not None else f"未找到中国传统节日：{name}"

@mcp.tool()
def query_international_festival(name: str) -> str:
    """查询国际主流节日的简介（支持别名，如‘圣诞’）"""
    normalized = normalize_name(name, international_aliases, set(international_festivals.keys()))
    result = international_festivals.get(normalized)
    return result if result is not None else f"未找到国际节日：{name}"

@mcp.tool()
def list_all_festivals() -> dict:
    """列出所有支持查询的节日名称（中英文分类）"""
    return {
        "chinese_festivals": list(chinese_festivals.keys()),
        "international_festivals": list(international_festivals.keys())
    }

# ==============================
# 启动服务器
# ==============================




def main() -> None:
    mcp.run(transport='stdio')
