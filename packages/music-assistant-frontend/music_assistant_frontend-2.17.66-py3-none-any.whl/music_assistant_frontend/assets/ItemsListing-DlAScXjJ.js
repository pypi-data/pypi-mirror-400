import{C as ot}from"./Container-DCgapsRo.js";import{c as nt}from"./utils-CDN07tui.js";import{d as j,b as p,e as l,ad as R,u as m,H as v,f as x,D as d,A as ke,O as N,c as X,E as u,I as f,$ as g,a1 as y,aR as ut,g as rt,n as ct,r as F,m as mt,a0 as ye,w as q,o as dt,j as Pe,h as ft,F as Q,M as _}from"./lucide-C2DU1LFb.js";import{_ as te,c as se,K as U,h as ee,M as C,i as vt,L as oe,N as yt,x as ht,O as Oe,F as xe,G as Re,S as we,T as Me,s as w,P as Y,U as bt,V as pt,e as $e,E as Z,z as he,f as kt,y as ae}from"./index-GGmWIGQT.js";import{T as wt}from"./Toolbar-DxI-629_.js";import{u as gt}from"./userPreferences-DgcDNgaI.js";import{u as It}from"./vue-router-BgJK_hRC.js";import{M as Ve}from"./Button-CagLcfnm.js";import{L as At}from"./ListItem-B-0bE6q7.js";import{_ as be}from"./NowPlayingBadge.vue_vue_type_style_index_0_lang-D7lqdhVg.js";import{b as Ee,M as Ye}from"./MediaItemThumb-DUorpFuJ.js";import{_ as Bt}from"./ProviderIcon.vue_vue_type_style_index_0_lang-BfVk_25X.js";import{D as Tt,$ as pe,d as O,n as ne,a1 as Ne,a2 as M,R as Ue,U as St,a as Ct,L as Ft,W as Pt,X as J,c as $t,Y as Lt,Z as Dt,e as Ot,m as xt,j as ie,H as Rt,I as Mt,s as Le,a3 as Vt,k as le}from"./vuetify-CDJMkNb9.js";import{u as Ke}from"./vue-i18n-DySrp6mW.js";import{P as Et}from"./PanelviewItemCompact-B12p-nmu.js";const K=j({__name:"Skeleton",props:{class:{}},setup(e){const a=e;return(I,k)=>(l(),p("div",{"data-slot":"skeleton",class:R(m(nt)("animate-pulse rounded-md bg-accent",a.class))},null,2))}}),Yt={class:"listview-item-skeleton"},Nt={class:"skeleton-content"},Ut=j({__name:"ListViewSkeleton",setup(e){return(a,I)=>(l(),p("div",Yt,[v(m(K),{class:"skeleton-thumbnail"}),x("div",Nt,[v(m(K),{class:"skeleton-title"}),v(m(K),{class:"skeleton-subtitle"})]),v(m(K),{class:"skeleton-duration"})]))}}),Kt=te(Ut,[["__scopeId","data-v-b8be0a9f"]]),zt={class:"panelview-item-skeleton"},Ht={class:"skeleton-info"},Xt={class:"skeleton-actions"},jt=j({__name:"PanelViewSkeleton",setup(e){return(a,I)=>(l(),p("div",zt,[v(m(K),{class:"skeleton-image"}),x("div",Ht,[v(m(K),{class:"skeleton-title"}),v(m(K),{class:"skeleton-artist"})]),x("div",Xt,[v(m(K),{class:"skeleton-icon"})])]))}}),De=te(jt,[["__scopeId","data-v-fbebf64d"]]),ze=j({__name:"FavoriteButton",props:{item:{}},setup(e){const a=e;return(I,k)=>(l(),d(Ve,ke(a,{variant:"icon",icon:e.item?.favorite?"mdi-heart":"mdi-heart-outline",title:I.$t("tooltip.favorite"),onClick:[k[0]||(k[0]=z=>m(se).toggleFavorite(e.item)),k[1]||(k[1]=N(()=>{},["prevent"])),k[2]||(k[2]=N(()=>{},["stop"]))]}),null,16,["icon","title"]))}}),Wt={key:0,class:"media-thumb listitem-media-thumb"},Gt={key:1,class:"media-thumb listitem-media-thumb"},qt={key:0},Qt={key:0},Zt={key:0,class:"ma-line-clamp-1"},Jt={key:1},_t={key:0},ea={key:1},ta={key:2},aa={key:3},ia={key:4},la={key:5},sa={key:6},oa={key:7},na={key:5},ua={key:6},ra={class:"text-caption",style:{"padding-right":"10px","padding-left":"10px"}},ca=j({__name:"ListviewItem",props:{item:{},showTrackNumber:{type:Boolean,default:!0},showDiscNumber:{type:Boolean,default:!0},showPosition:{type:Boolean,default:!0},showProvider:{type:Boolean,default:!0},showAlbum:{type:Boolean,default:!0},showMenu:{type:Boolean,default:!0},showFavorite:{type:Boolean,default:!1},showDuration:{type:Boolean,default:!0},isSelected:{type:Boolean},isDisabled:{type:Boolean,default:!1},isAvailable:{type:Boolean,default:!0},isPlaying:{type:Boolean},showCheckboxes:{type:Boolean,default:!1},showDetails:{type:Boolean},showPlayButton:{type:Boolean,default:void 0},parentItem:{default:void 0}},emits:["select"],setup(e,{emit:a}){const{t:I}=Ke(),k=e,z=X(()=>{if(!("provider_mappings"in k.item))return"";for(const b of k.item.provider_mappings)if(b.audio_format&&b.audio_format.content_type!=null&&[U.DSF,U.FLAC,U.AIFF,U.WAV].includes(b.audio_format.content_type)&&(b.audio_format.sample_rate>48e3||b.audio_format.bit_depth>16))return`${b.audio_format.sample_rate/1e3}kHz ${b.audio_format.bit_depth} bits`;return""}),S=a,s=function(b){const c=b;we(k.item,c.clientX,c.clientY,k.parentItem)},A=function(b){if(k.showCheckboxes)return;const c=b;Me(k.item,c.clientX,c.clientY,k.parentItem)},h=function(b){k.showCheckboxes||Re(k.item,b.clientX,b.clientY,k.parentItem)};return(b,c)=>(l(),d(At,{link:"","show-menu-btn":e.showMenu,class:R({unavailable:!e.isAvailable}),onClick:N(A,["stop"]),onMenu:N(s,["stop"])},{prepend:u(()=>[e.showCheckboxes?(l(),p("div",Wt,[v(Ue,{"model-value":e.isSelected,onClick:c[0]||(c[0]=N(()=>{},["stop"])),"onUpdate:modelValue":c[1]||(c[1]=T=>{T!=null&&S("select",e.item,T)})},null,8,["model-value"])])):(l(),p("div",Gt,[v(Ye,{size:"50",item:e.isAvailable?e.item:void 0},null,8,["item"])]))]),title:u(()=>[e.item.media_type==m(C).FOLDER?(l(),p("span",qt,[x("span",null,y(m(Oe)(e.item,m(I))),1)])):(l(),p("span",{key:1,class:R({"is-playing":e.isPlaying})},[g(y(e.item.name)+" ",1),"version"in e.item&&e.item.version?(l(),p("span",Qt,"("+y(e.item.version)+")",1)):f("",!0)],2)),e.item&&e.item.metadata?(l(),d(m(pe),{key:2,location:"bottom"},{activator:u(({props:T})=>[m(xe)(e.item.metadata.explicit||!1)?(l(),d(O,ke({key:0},T,{icon:"mdi-alpha-e-box",width:"35"}),null,16)):f("",!0)]),default:u(()=>[x("span",null,y(b.$t("tooltip.explicit")),1)]),_:1})):f("",!0)]),subtitle:u(()=>[e.item.media_type==m(C).TRACK&&"provider_mappings"in e.item?(l(),p("div",Zt,[v(Ne,null,{default:u(()=>["artists"in e.item?(l(),d(M,{key:0},{default:u(()=>[g(y(m(oe)(e.item.artists,2)),1)]),_:1})):f("",!0),e.showAlbum&&"album"in e.item&&e.item.album?(l(),d(M,{key:1},{default:u(()=>[g(" • "+y(e.item.album.name),1)]),_:1})):f("",!0),e.showDiscNumber&&"disc_number"in e.item&&e.item.disc_number?(l(),d(M,{key:2},{default:u(()=>[v(O,{style:{"margin-left":"5px"},icon:"md:album"}),g(" "+y(e.item.disc_number),1)]),_:1})):f("",!0),e.showTrackNumber&&"track_number"in e.item&&e.item.track_number?(l(),d(M,{key:3},{default:u(()=>[v(O,{style:{"margin-left":"5px"},icon:"mdi-music-circle-outline"}),g(" "+y(e.item.track_number),1)]),_:1})):e.showPosition&&"position"in e.item&&e.item.position?(l(),d(M,{key:4},{default:u(()=>[v(O,{style:{"margin-left":"5px"},icon:"mdi-music-circle-outline"}),g(" "+y(e.item.position),1)]),_:1})):f("",!0)]),_:1})])):e.item.media_type==m(C).ALBUM&&"year"in e.item?(l(),p("div",Jt,[e.item.album_type!=m(yt).UNKNOWN?(l(),p("span",_t,y(b.$t("album_type."+e.item.album_type))+" • ",1)):f("",!0),x("span",null,y(m(oe)(e.item.artists)),1),e.item.year?(l(),p("span",ea," • "+y(e.item.year),1)):f("",!0)])):"artists"in e.item&&e.item.artists?(l(),p("div",ta,y(m(oe)(e.item.artists)),1)):"owner"in e.item&&e.item.owner?(l(),p("div",aa,y(e.item.owner),1)):"authors"in e.item&&e.item.authors?(l(),p("div",ia,y(e.item.authors.join(" / ")),1)):"publisher"in e.item&&e.item.publisher?(l(),p("div",la,y(e.item.publisher),1)):"metadata"in e.item&&e.item.metadata?.description&&[m(C).RADIO,m(C).PLAYLIST,m(C).FOLDER].includes(e.item.media_type)?(l(),p("div",sa,y(m(ht)(e.item.metadata.description,150)),1)):"media_type"in e.item&&!e.item.provider_mappings?(l(),p("div",oa,y(b.$t(e.item.media_type)),1)):f("",!0)]),append:u(()=>[e.isPlaying?(l(),d(be,{key:0,"show-badge":m(ee)("bp7")},null,8,["show-badge"])):f("",!0),z.value?(l(),d(Tt,{key:1,src:m(Ee),width:"30",class:R(b.$vuetify.theme.current.dark?"hiresicondark":"hiresicon")},{default:u(()=>[v(m(pe),{activator:"parent",location:"bottom"},{default:u(()=>[g(y(z.value),1)]),_:1})]),_:1},8,["src","class"])):f("",!0),m(ee)("bp2")&&e.showProvider?(l(),d(Bt,{key:2,domain:e.item.media_type==m(C).PLAYLIST?e.item.provider_mappings[0].provider_domain:e.item.provider,size:24},null,8,["domain"])):f("",!0),"fully_played"in e.item&&e.item.fully_played?(l(),d(O,{key:3,title:b.$t("item_fully_played")},{default:u(()=>[...c[2]||(c[2]=[g("mdi-check",-1)])]),_:1},8,["title"])):"resume_position_ms"in e.item&&e.item.resume_position_ms?(l(),d(O,{key:4,title:b.$t("item_in_progress")},{default:u(()=>[...c[3]||(c[3]=[g("mdi-clock-fast",-1)])]),_:1},8,["title"])):f("",!0),m(ee)("bp3")&&"favorite"in e.item&&e.showFavorite&&!b.$vuetify.display.mobile?(l(),p("div",na,[v(ze,{item:e.item},null,8,["item"])])):f("",!0),e.showDuration&&"duration"in e.item&&e.item.duration&&m(ee)("bp0")?(l(),p("div",ua,[x("div",null,[x("span",ra,y(m(vt)(e.item.duration)),1)])])):f("",!0),e.item.is_playable&&(e.showPlayButton??!b.$vuetify.display.mobile)?(l(),d(ne,{key:7,icon:"",variant:"text",size:"small",onClick:N(h,["stop"])},{default:u(()=>[v(O,{size:"24"},{default:u(()=>[...c[4]||(c[4]=[g("mdi-play-circle-outline",-1)])]),_:1})]),_:1})):f("",!0)]),_:1},8,["show-menu-btn","class"]))}}),ma=te(ca,[["__scopeId","data-v-4ca4d718"]]),da={key:0},fa=["src"],va={key:0},ya=j({__name:"PanelviewItem",props:{item:{},size:{default:200},isSelected:{type:Boolean},showCheckboxes:{type:Boolean,default:!1},showMediaType:{type:Boolean,default:!1},showActions:{type:Boolean,default:!1},showTrackNumber:{type:Boolean,default:!1},isAvailable:{type:Boolean,default:!0},isPlaying:{type:Boolean},parentItem:{default:void 0}},emits:["select"],setup(e,{emit:a}){const I=e,k=X(()=>{for(const h of I.item.provider_mappings)if(h.audio_format&&h.audio_format.content_type!=null&&[U.DSF,U.FLAC,U.AIFF,U.WAV].includes(h.audio_format.content_type)&&(h.audio_format.sample_rate>48e3||h.audio_format.bit_depth>16))return`${h.audio_format.sample_rate/1e3}kHz ${h.audio_format.bit_depth} bits`;return""}),z=a,S=function(h){if(I.showCheckboxes)return;const b="clientX"in h?h.clientX:h.touches[0].clientX,c="clientY"in h?h.clientY:h.touches[0].clientY;we(I.item,b,c,I.parentItem)},s=function(h){if(I.showCheckboxes){z("select",I.item,!I.isSelected);return}Me(I.item,h.clientX,h.clientY,I.parentItem)},A=function(h){I.showCheckboxes||Re(I.item,h.clientX,h.clientY,I.parentItem)};return(h,b)=>{const c=ut("hold");return l(),d(St,null,{default:u(({isHovering:T,props:B})=>[rt((l(),d(Ct,ke(B,{tile:"",hover:"",class:["panel-item",{unavailable:!e.isAvailable}],onClick:s,onContextmenu:N(S,["right","prevent"])}),{default:u(()=>[e.showCheckboxes?(l(),d(Ft,{key:0,"model-value":e.showCheckboxes,contained:"",scrim:e.isSelected?h.$vuetify.theme.current.dark?"rgba(0,0,0,.75)":"rgba(255,255,255,.75)":"#ffffff00"},{default:u(()=>[v(Ue,{class:"panel-item-checkbox",ripple:!1,"model-value":e.isSelected},null,8,["model-value"])]),_:1},8,["model-value","scrim"])):f("",!0),v(Ye,{item:e.isAvailable?e.item:void 0,style:{height:"auto"}},null,8,["item"]),v($t,{variant:"text",slim:"",tile:"",density:"compact",class:"panel-item-details"},{default:u(()=>[v(Pt,null,{default:u(()=>[e.item.media_type==m(C).FOLDER?(l(),p("span",da,[x("span",null,y(m(Oe)(e.item,h.$t)),1)])):(l(),p("span",{key:1,class:R({"is-playing":e.isPlaying})},y(e.item.name),3)),"version"in e.item&&e.item.version?(l(),p("span",{key:2,class:R({"is-playing":e.isPlaying})}," - "+y(e.item.version),3)):f("",!0)]),_:1}),"artists"in e.item&&e.item.artists?(l(),d(J,{key:0,class:"ma-line-clamp-1"},{default:u(()=>[g(y(m(oe)(e.item.artists,1)),1)]),_:1})):f("",!0),"authors"in e.item&&e.item.authors?(l(),d(J,{key:1,class:"ma-line-clamp-1"},{default:u(()=>[g(y(e.item.authors.join(" / ")),1)]),_:1})):"publisher"in e.item&&e.item.publisher?(l(),d(J,{key:2,class:"ma-line-clamp-1"},{default:u(()=>[g(y(e.item.publisher),1)]),_:1})):"owner"in e.item&&e.item.owner?(l(),d(J,{key:3,class:"ma-line-clamp-1"},{default:u(()=>[g(y(e.item.owner),1)]),_:1})):e.showMediaType?(l(),d(J,{key:4,class:"ma-line-clamp-1"},{default:u(()=>[g(y(h.$t(e.item.media_type)),1)]),_:1})):(l(),d(J,{key:5,class:"ma-line-clamp-1"}))]),_:1}),e.isPlaying&&!e.showActions?(l(),d(be,{key:1,"icon-style":"position: absolute; right: 5px; bottom: 5px","show-badge":!1})):f("",!0),(T||m(w).isTouchscreen)&&e.isAvailable&&e.item.is_playable?(l(),d(ne,{key:2,icon:"mdi-play",color:"primary",fab:"",style:ct(`position: absolute; right: 15px; bottom: ${e.showActions?90:35}px; opacity: 0.8`),onClick:N(A,["stop"])},null,8,["style"])):f("",!0),e.showActions?(l(),d(Lt,{key:3,class:"panel-item-actions"},{default:u(()=>[v(Ne,{style:{padding:"0"}},{default:u(()=>[m(xe)(e.item.metadata.explicit||!1)?(l(),d(M,{key:0},{default:u(()=>[v(O,{size:"30",icon:"mdi-alpha-e-box"})]),_:1})):f("",!0),k.value?(l(),d(M,{key:1},{default:u(()=>[v(O,{class:R(h.$vuetify.theme.current.dark?"hiresicon":"hiresiconinverted")},{default:u(()=>[x("img",{src:m(Ee),width:"30"},null,8,fa),v(pe,{activator:"parent",location:"bottom"},{default:u(()=>[g(y(k.value),1)]),_:1})]),_:1},8,["class"])]),_:1})):f("",!0),e.showTrackNumber&&"track_number"in e.item&&e.item.track_number?(l(),d(M,{key:2},{default:u(()=>[v(O,{size:"small",icon:"mdi-music-circle-outline"}),e.item.disc_number?(l(),p("span",va,y(e.item.disc_number)+"/",1)):f("",!0),g(y(e.item.track_number),1)]),_:1})):"position"in e.item&&e.item.position?(l(),d(M,{key:3},{default:u(()=>[v(O,{size:"small",icon:"mdi-music-circle-outline"}),g(" "+y(e.item.position),1)]),_:1})):f("",!0),m(ee)("bp3")?(l(),d(M,{key:4},{default:u(()=>[v(ze,{item:e.item},null,8,["item"])]),_:1})):f("",!0)]),_:1}),e.isPlaying?(l(),d(be,{key:0,"show-badge":!1})):f("",!0),v(Dt),T||h.$vuetify.display.mobile?(l(),d(Ve,{key:1,variant:"list",icon:"mdi-dots-vertical",style:{"padding-right":"0","margin-right":"-5px"},onClick:N(S,["stop"])})):f("",!0)]),_:2},1024)):f("",!0)]),_:2},1040,["class"])),[[c,S]])]),_:1})}}}),ha=te(ya,[["__scopeId","data-v-ab13d246"]]),ba={key:0},pa={key:0},ka={key:2},wa=j({__name:"ItemsListing",props:{itemtype:{},sortKeys:{default:()=>["name","sort_name"]},showTrackNumber:{type:Boolean,default:!0},showProvider:{type:Boolean,default:Object.keys(se.providers).length>1},showAlbum:{type:Boolean,default:!0},showFavoritesOnlyFilter:{type:Boolean,default:!0},showDuration:{type:Boolean,default:!0},parentItem:{default:void 0},showAlbumArtistsOnlyFilter:{type:Boolean},showSearchButton:{type:Boolean,default:void 0},showRefreshButton:{type:Boolean,default:void 0},showSelectButton:{type:Boolean,default:void 0},showAlbumTypeFilter:{type:Boolean,default:void 0},showProviderFilter:{type:Boolean,default:void 0},updateAvailable:{type:Boolean},title:{default:void 0},hideOnEmpty:{type:Boolean,default:!1},showLibraryOnlyFilter:{type:Boolean,default:!1},allowCollapse:{type:Boolean,default:!1},allowKeyHooks:{type:Boolean,default:!1},extraMenuItems:{default:void 0},loadPagedData:{type:Function,default:void 0},loadItems:{type:Function,default:void 0},limit:{default:50},total:{default:void 0},infiniteScroll:{type:Boolean,default:!0},path:{default:void 0},icon:{default:void 0},restoreState:{type:Boolean,default:!1},onTitleClick:{type:Function,default:void 0},refreshOnParentUpdate:{type:Boolean,default:!1}},setup(e){const a=e,I=It(),{t:k}=Ke(),{getItemsListingPreferences:z,setItemsListingPreference:S}=gt(),s=F({offset:0,limit:50,sortBy:"name",search:"",libraryOnly:!1}),A=F("list"),h=F(!1),b=F(!1),c=F([]),T=F([]),B=F(!1),$=F([]),W=F(!1),D=F(!1),H=F(!0),V=F(!1),G=F(!1),ue=F(!1),ge=function(){s.value.search="",h.value=!1},re=function(){Pe(()=>{document.getElementById("searchInput")?.focus()})},He=function(){h.value?ge():(h.value=!0,re())},ce=function(){if(a.onTitleClick){a.onTitleClick();return}H.value=!H.value,S(a.path||a.itemtype,a.itemtype,"expand",H.value)},me=function(t){A.value=t,S(a.path||a.itemtype,a.itemtype,"viewMode",t)},Xe=function(){s.value.favoritesOnly=!s.value.favoritesOnly,S(a.path||a.itemtype,a.itemtype,"favoriteFilter",s.value.favoritesOnly),P(void 0,void 0,!0)},je=function(){s.value.libraryOnly=!s.value.libraryOnly,S(a.path||a.itemtype,a.itemtype,"libraryFilter",s.value.libraryOnly),P(!0,void 0,!0)},We=function(){s.value.albumArtistsFilter=!s.value.albumArtistsFilter,S(a.path||a.itemtype,a.itemtype,"albumArtistsFilter",s.value.albumArtistsFilter),P(void 0,void 0,!0)},de=function(t){return $.value.includes(t)},fe=function(t,o){if(w.activePlayer?.playback_state!=kt.PLAYING)return!1;const i=w.curQueueItem?.media_item;if(!i)return!1;switch(o){case"tracks":return t.item_id===i.item_id;case"albums":return!("album"in i)||!i.album?!1:t.item_id===i.album.item_id;case"artists":return!("artists"in i)||!i.artists?!1:Array.isArray(i.artists)&&i.artists.some(n=>n&&n.item_id===t.item_id);case"radios":return t.item_id===i.item_id;case"podcasts":return!("podcast"in i)||!i.podcast?!1:t.item_id===i.podcast.item_id;case"podcastepisodes":return t.item_id===i.item_id;default:return!1}},ve=function(t,o){if(o)$.value.includes(t)||$.value.push(t);else for(let i=0;i<$.value.length;i++)$.value[i]===t&&$.value.splice(i,1)},Ge=function(){D.value&&($.value=[]),D.value=!D.value},qe=function(){P(!0,!0)},Qe=function(){s.value.search="",h.value=!1,P(void 0,void 0,!0)},Ze=function(t){t!==void 0&&(s.value.sortBy=t),S(a.path||a.itemtype,a.itemtype,"sortBy",s.value.sortBy),P(void 0,void 0,!0)},Je=function(t){s.value.albumType?.includes(t)?s.value.albumType=s.value.albumType?.filter(o=>o!==t):(s.value.albumType=s.value.albumType||[],s.value.albumType.push(t)),S(a.path||a.itemtype,a.itemtype,"albumType",s.value.albumType),P(void 0,void 0,!0)},_e=function(t){s.value.provider?.includes(t)?s.value.provider=s.value.provider?.filter(o=>o!==t):(s.value.provider=s.value.provider||[],s.value.provider.push(t)),s.value.provider.length===0&&(s.value.provider=void 0),S(a.path||a.itemtype,a.itemtype,"providerFilter",s.value.provider),P(!0,void 0,!0)},et=function(){w.globalSearchTerm=s.value.search,a.itemtype=="artists"?w.globalSearchType=C.ARTIST:a.itemtype=="albums"?w.globalSearchType=C.ALBUM:a.itemtype=="tracks"?w.globalSearchType=C.TRACK:a.itemtype=="playlists"?w.globalSearchType=C.PLAYLIST:a.itemtype=="audiobooks"?w.globalSearchType=C.AUDIOBOOK:a.itemtype=="podcasts"?w.globalSearchType=C.PODCAST:a.itemtype=="radios"&&(w.globalSearchType=C.RADIO),I.push({name:"search"})},Ie=async function({done:t}){if(V.value){t("empty");return}await P(void 0,void 0,void 0,s.value.offset+a.limit),t("ok")},tt=async function(){for(;!V.value;)await Ie({done:function(){}})},Ae=X(()=>{var t=!1;return s.value.search&&s.value.search.length!==0&&(t=!0),t}),Be=X(()=>h.value&&H.value),at=X(()=>["artists","albums","tracks","playlists","audiobooks","podcasts","radios"].includes(a.itemtype)),Te=X(()=>{const o={artists:Y.LIBRARY_ARTISTS,albums:Y.LIBRARY_ALBUMS,tracks:Y.LIBRARY_TRACKS,artisttracks:[Y.ARTIST_TOPTRACKS,Y.LIBRARY_TRACKS],playlists:Y.LIBRARY_PLAYLISTS,radios:Y.LIBRARY_RADIOS,podcasts:Y.LIBRARY_PODCASTS,audiobooks:Y.LIBRARY_AUDIOBOOKS}[a.itemtype];return Object.values(se.providers).filter(i=>i.type!==bt.MUSIC||w.currentUser&&w.currentUser.provider_filter.length&&!w.currentUser.provider_filter.includes(i.instance_id)?!1:o?(Array.isArray(o)?o:[o]).some(r=>i.supported_features.includes(r)):!0).map(i=>({label:i.name,value:i.instance_id})).sort((i,n)=>i.label.localeCompare(n.label))});mt(()=>{Be.value||(b.value=!1)});const it=X(()=>{if(a.allowCollapse===!0&&!H.value)return[{label:"tooltip.collapse_expand",icon:"mdi-chevron-down",action:ce,overflowAllowed:!1}];const t=[];return a.showSelectButton!==!1&&(D.value&&t.push({label:"tooltip.select_all",icon:"mdi-select-all",action:Fe,overflowAllowed:!0}),t.push({label:"tooltip.select_items",icon:D.value?"mdi-checkbox-multiple-outline":"mdi-checkbox-multiple-blank-outline",action:Ge,active:D.value,overflowAllowed:!0})),a.showLibraryOnlyFilter===!0&&t.push({label:"tooltip.filter_library",icon:"mdi-bookshelf",action:je,active:s.value.libraryOnly,overflowAllowed:!0}),a.showFavoritesOnlyFilter===!0&&t.push({label:"tooltip.filter_favorites",icon:s.value.favoritesOnly?"mdi-heart":"mdi-heart-outline",action:Xe,active:s.value.favoritesOnly,overflowAllowed:!0}),a.showAlbumArtistsOnlyFilter===!0&&t.push({label:"tooltip.album_artist_filter",icon:s.value.albumArtistsFilter?"mdi-account-music":"mdi-account-music-outline",action:We,active:s.value.albumArtistsFilter,overflowAllowed:!0}),a.showAlbumTypeFilter&&t.push({label:"tooltip.album_type",icon:"mdi-album",disabled:B.value,active:s.value.albumType&&s.value.albumType.length>0,closeOnContentClick:!1,overflowAllowed:!0,subItems:["album","single","ep","compilation","live","soundtrack","unknown"].map(o=>({label:`album_type.${o}`,selected:s.value.albumType?.includes(o),action:()=>{Je(o)}}))}),a.showProviderFilter&&Te.value.length>1&&t.push({label:"tooltip.filter_provider",icon:"mdi-package-variant",disabled:B.value,active:s.value.provider&&s.value.provider.length>0,closeOnContentClick:!1,overflowAllowed:!0,subItems:Te.value.map(o=>({label:o.label,selected:s.value.provider?.includes(o.value),action:()=>{_e(o.value)}}))}),(a.showRefreshButton!==!1||W.value&&!a.refreshOnParentUpdate)&&t.push({label:W.value?"tooltip.refresh_new_content":"tooltip.refresh",icon:"mdi-refresh",action:qe,active:W.value,disabled:B.value}),a.sortKeys?.length&&t.push({label:"tooltip.sort_options",icon:"mdi-sort",disabled:a.sortKeys.length<=1||B.value,overflowAllowed:!0,subItems:a.sortKeys.map(o=>({label:`sort.${o}`,selected:s.value.sortBy==o,action:()=>{Ze(o)}}))}),a.showSearchButton!==!1&&t.push({label:Ae.value?"tooltip.search_filter_active":"tooltip.search",icon:"mdi-magnify",action:He,active:Ae.value,disabled:B.value,overflowAllowed:!1}),t.push({label:"tooltip.toggle_view_mode",icon:A.value=="list"?"mdi-view-list":"mdi-grid",overflowAllowed:!0,subItems:[{label:"view.list",icon:"mdi-view-list",selected:A.value=="list",action:()=>{me("list")}},{label:"view.panel",icon:"mdi-grid",selected:A.value=="panel",action:()=>{me("panel")}},{label:"view.panel_compact",icon:"mdi-grid",selected:A.value=="panel_compact",action:()=>{me("panel_compact")}}]}),a.extraMenuItems?.length&&t.push(...a.extraMenuItems),a.allowCollapse===!0&&t.push({label:"tooltip.collapse_expand",icon:"mdi-chevron-up",action:ce}),t}),P=async function(t=!1,o=!1,i=!1,n=0){if(B.value)return;B.value=!0,i&&a.loadPagedData!=null&&(t=!0),(t||o)&&(n=0,V.value&&(ue.value=!0),V.value=!1,G.value=!1,W.value=!1);const r=["artists","albums","tracks","playlists","audiobooks","podcasts","radios"];if((t||!G.value)&&r.includes(a.itemtype)&&await new Promise(E=>setTimeout(E,1e3)),s.value.offset=n,s.value.limit=a.limit,s.value.refresh=o,a.loadPagedData!=null){const E=await a.loadPagedData(s.value);s.value.offset?c.value.push(...E):c.value=E,Math.abs(E.length-a.limit)>10&&(V.value=!0)}else if(a.loadItems!=null){(!G.value||o)&&(T.value=await a.loadItems(s.value),G.value=!0);const E=st(T.value,s.value);s.value.offset?c.value.push(...E):c.value=E,V.value=E.length<a.limit}s.value.refresh=!1,B.value=!1,ue.value=!1},Se=z(a.path||a.itemtype,a.itemtype),lt=async function(){const t=Se.value;t.viewMode?A.value=t.viewMode:a.itemtype=="artists"||a.itemtype=="albums"?A.value="panel":A.value="list",t.sortBy&&a.sortKeys.includes(t.sortBy)?s.value.sortBy=t.sortBy:s.value.sortBy=a.sortKeys[0],a.showFavoritesOnlyFilter!==!1&&t.favoriteFilter&&(s.value.favoritesOnly=t.favoriteFilter),a.showLibraryOnlyFilter!==!1&&t.libraryFilter&&(s.value.libraryOnly=t.libraryFilter),a.showAlbumArtistsOnlyFilter!==!1&&t.albumArtistsFilter!==void 0&&(s.value.albumArtistsFilter=t.albumArtistsFilter),a.allowCollapse!==!1&&t.expand!==void 0&&(H.value=t.expand),a.showAlbumTypeFilter===!0&&t.albumType&&(s.value.albumType=t.albumType),a.showProviderFilter===!0&&t.providerFilter&&(s.value.provider=t.providerFilter),a.restoreState&&t.search&&(s.value.search=t.search)},Ce=function(t){w.dialogActive||B.value||(t.key==="Escape"&&ge(),!b.value&&(t.key==="a"&&(t.ctrlKey||t.metaKey)?(t.preventDefault(),Fe()):!b.value&&t.key=="Backspace"?re():!b.value&&t.key.length==1&&(h.value=!0,re())))};a.allowKeyHooks&&(document.addEventListener("keydown",Ce),ye(()=>{document.removeEventListener("keydown",Ce)})),a.restoreState&&ye(()=>{const t=a.path||a.itemtype,o=document.querySelector("#cont");w.prevState={path:t,scrollPos:o?.scrollTop||0,pagedItems:c.value,allItems:T.value,allItemsReceived:V.value,initialDataReceived:G.value,params:s.value}}),q(()=>s.value.search,t=>{t&&(h.value=!0),P(void 0,void 0,!0),a.restoreState&&S(a.path||a.itemtype,a.itemtype,"search",s.value.search)}),q(()=>a.path,t=>{B.value!=!0&&(c.value=[],T.value=[],P(!0))}),q(()=>a.parentItem,()=>{B.value!=!0&&(console.log("parent item changed",a.refreshOnParentUpdate),a.refreshOnParentUpdate?P(!0):(T.value=[],W.value=!0))},{deep:!0}),q(()=>a.limit,t=>{s.value.limit=t}),q(()=>a.updateAvailable,t=>{B.value||(W.value=t)},{immediate:!0}),q(Se,()=>lt(),{immediate:!0}),dt(async()=>{const t=a.path||a.itemtype;a.restoreState&&w.prevState?.path==t?(s.value=w.prevState.params,c.value=w.prevState.pagedItems,T.value=w.prevState.allItems,V.value=w.prevState.allItemsReceived,G.value=w.prevState.initialDataReceived,Pe(()=>{const i=document.getElementById("cont");i&&pt(i,w.prevState.scrollPos,50)}),B.value=!1):P(!0),$e.on("clearSelection",()=>{$.value=[],D.value=!1});const o=se.subscribe_multi([Z.MEDIA_ITEM_UPDATED,Z.MEDIA_ITEM_DELETED,Z.MEDIA_ITEM_PLAYED],i=>{if(i.event==Z.MEDIA_ITEM_DELETED)c.value=c.value.filter(n=>n.uri!=i.object_id);else if(i.event==Z.MEDIA_ITEM_UPDATED){const n=c.value.findIndex(r=>r.uri==i.object_id);n>=0&&(c.value[n]=i.data)}else if(i.event==Z.MEDIA_ITEM_PLAYED){const n=c.value.findIndex(r=>r.uri==i.object_id);n>=0&&("fully_played"in c.value[n]&&(c.value[n].fully_played=i.data.fully_played),"resume_position_ms"in c.value[n]&&(c.value[n].resume_position_ms=i.data.seconds_played*1e3))}});ye(()=>{$e.off("clearSelection"),o()})});const L=function(t,o=!1){return t?"translation_key"in t&&t.translation_key&&t.name?k(t.translation_key,[t.name]):"translation_key"in t&&t.translation_key?k(t.translation_key):o&&"sort_name"in t&&t.sort_name?t.sort_name:t.name:""},st=function(t,o){let i=[];if(o.search){const n=o.search.toLowerCase();for(const r of t)(r.name.toLowerCase().includes(n)||"album"in r&&r.album?.name.toLowerCase().includes(n)||"artists"in r&&r.artists&&r.artists.length&&r.artists[0].name.toLowerCase().includes(n))&&i.push(r)}else i=[...t];return o.sortBy=="name"&&i.sort((n,r)=>L(n).localeCompare(L(r),void 0,{numeric:!0})),o.sortBy=="sort_name"&&i.sort((n,r)=>L(n,!0).localeCompare(L(r,!0),void 0,{numeric:!0})),o.sortBy=="name_desc"&&i.sort((n,r)=>L(r).localeCompare(L(n),void 0,{numeric:!0})),o.sortBy=="sort_name_desc"&&i.sort((n,r)=>L(r,!0).localeCompare(L(n,!0),void 0,{numeric:!0})),o.sortBy=="album"&&i.sort((n,r)=>L(n.album).localeCompare(L(r.album),void 0,{numeric:!0})),o.sortBy=="artist"&&i.sort((n,r)=>L(n.artists[0]).localeCompare(L(r.artists[0]))),o.sortBy=="track_number"&&(i.sort((n,r)=>(n.track_number||0)-(r.track_number||0)),i.sort((n,r)=>(n.disc_number||0)-(r.disc_number||0))),o.sortBy=="position"&&i.sort((n,r)=>(n.position||0)-(r.position||0)),o.sortBy=="position_desc"&&i.sort((n,r)=>(r.position||0)-(n.position||0)),o.sortBy=="year"&&i.sort((n,r)=>(n.year||0)-(r.year||0)),o.sortBy=="year_desc"&&i.sort((n,r)=>(r.year||0)-(n.year||0)),o.sortBy=="recent"&&i.sort((n,r)=>(r.timestamp_added||0)-(n.timestamp_added||0)),o.sortBy=="duration"&&i.sort((n,r)=>(n.duration||0)-(r.duration||0)),o.sortBy=="duration_desc"&&i.sort((n,r)=>(r.duration||0)-(n.duration||0)),o.sortBy=="provider"&&i.sort((n,r)=>n.provider.localeCompare(r.provider)),o.favoritesOnly&&(i=i.filter(n=>n.favorite)),o.albumType&&o.albumType.length>0&&(i=i.filter(n=>o.albumType?.includes(n.album_type))),i.slice(o.offset,o.offset+o.limit)},Fe=async function(){let t=!0;(a.total||T.value.length)>250&&(t=await new Promise(i=>{confirm(k("select_all_confirmation"))?i(!0):i(!1)})),t&&(await tt(),$.value=c.value,D.value=!0)};return(t,o)=>e.hideOnEmpty&&c.value.length==0?f("",!0):(l(),p("section",ba,[v(wt,{icon:e.icon,title:e.title,count:s.value.search?c.value.length:e.total||T.value.length,color:"transparent","menu-items":it.value,onTitleClicked:ce},{title:u(()=>[ft(t.$slots,"title",{},()=>[g(y(e.title),1)],!0)]),_:3},8,["icon","title","count","menu-items"]),v(Ot),Be.value?(l(),d(xt,{key:0,id:"searchInput",modelValue:s.value.search,"onUpdate:modelValue":o[0]||(o[0]=i=>s.value.search=i),clearable:"","prepend-inner-icon":"mdi-magnify",label:t.$t("search"),"hide-details":"",variant:"filled",style:{width:"auto","margin-top":"10px"},onFocus:o[1]||(o[1]=i=>b.value=!0),onBlur:o[2]||(o[2]=i=>b.value=!1),"onClick:clear":Qe},null,8,["modelValue","label"])):f("",!0),H.value?(l(),d(ot,{key:1,variant:A.value=="list"?"default":"panel",style:{overflow:"hidden"}},{default:u(()=>[B.value&&c.value.length===0&&at.value?(l(),p(Q,{key:0},[A.value==="list"?(l(),p("div",pa,[(l(),p(Q,null,_(8,i=>v(Kt,{key:"skeleton-list-"+i})),64))])):A.value==="panel"?(l(),d(ie,{key:1},{default:u(()=>[(l(),p(Q,null,_(12,i=>v(le,{key:"skeleton-panel-"+i,cols:"12",class:R(`col-${m(ae)(t.$vuetify.display.width)}`)},{default:u(()=>[v(De)]),_:1},8,["class"])),64))]),_:1})):A.value==="panel_compact"?(l(),d(ie,{key:2},{default:u(()=>[(l(),p(Q,null,_(12,i=>v(le,{key:"skeleton-compact-"+i,cols:"12",class:R(`col-${m(ae)(t.$vuetify.display.width)}`)},{default:u(()=>[v(De)]),_:1},8,["class"])),64))]),_:1})):f("",!0)],64)):f("",!0),!ue.value&&!(c.value.length==0&&V.value)&&!(B.value&&c.value.length===0)?(l(),d(Rt,{key:1,onLoad:Ie,mode:e.infiniteScroll?"intersect":"manual","load-more-text":t.$t("load_more_items"),"empty-text":"",style:{overflow:"hidden"}},{default:u(()=>[A.value=="panel"?(l(),d(ie,{key:0},{default:u(()=>[(l(!0),p(Q,null,_(c.value,i=>(l(),d(le,{key:i.uri,cols:"12",class:R(`col-${m(ae)(t.$vuetify.display.width)}`)},{default:u(()=>[v(ha,{item:i,"is-selected":de(i),"show-checkboxes":D.value,"show-actions":["tracks","albums","albumtracks"].includes(e.itemtype),"show-track-number":e.showTrackNumber,"is-available":m(he)(i),"is-playing":fe(i,e.itemtype),"parent-item":e.parentItem,onSelect:ve},null,8,["item","is-selected","show-checkboxes","show-actions","show-track-number","is-available","is-playing","parent-item"])]),_:2},1032,["class"]))),128))]),_:1})):f("",!0),A.value=="panel_compact"?(l(),d(ie,{key:1},{default:u(()=>[(l(!0),p(Q,null,_(c.value,i=>(l(),d(le,{key:i.uri,cols:"12",class:R(`col-${m(ae)(t.$vuetify.display.width)}`)},{default:u(()=>[v(Et,{item:i,"is-selected":de(i),"show-checkboxes":D.value,"is-available":m(he)(i),"is-playing":fe(i,e.itemtype),"parent-item":e.parentItem,onSelect:ve},null,8,["item","is-selected","show-checkboxes","is-available","is-playing","parent-item"])]),_:2},1032,["class"]))),128))]),_:1})):f("",!0),A.value=="list"?(l(),d(Mt,{key:2,"item-height":70,height:"100%",items:c.value,style:{height:"100%",overflow:"hidden"}},{default:u(({item:i})=>[v(ma,{item:i,"show-track-number":e.showTrackNumber,"show-disc-number":e.showTrackNumber,"show-duration":e.showDuration,"show-favorite":e.showFavoritesOnlyFilter,"show-menu":i.is_playable,"show-provider":e.showProvider,"show-album":e.showAlbum,"show-checkboxes":D.value,"is-selected":de(i),"is-available":m(he)(i),"is-playing":fe(i,e.itemtype),"show-details":e.itemtype.includes("versions"),"parent-item":e.parentItem,onSelect:ve},null,8,["item","show-track-number","show-disc-number","show-duration","show-favorite","show-menu","show-provider","show-album","show-checkboxes","is-selected","is-available","is-playing","show-details","parent-item"])]),_:1},8,["items"])):f("",!0)]),_:1},8,["mode","load-more-text"])):f("",!0),!B.value&&c.value.length==0?(l(),p("div",ka,[!B.value&&c.value.length==0&&(s.value.search||s.value.favoritesOnly)?(l(),d(Le,{key:0,title:t.$t("no_content_filter")},{default:u(()=>[s.value.search?(l(),d(ne,{key:0,style:{"margin-top":"15px"},onClick:et},{default:u(()=>[g(y(t.$t("try_global_search")),1)]),_:1})):f("",!0)]),_:1},8,["title"])):!B.value&&c.value.length==0?(l(),d(Le,{key:1},{default:u(()=>[g(y(t.$t("no_content")),1)]),_:1})):f("",!0)])):f("",!0),v(Vt,{"model-value":$.value.length>1,timeout:-1,style:{"margin-bottom":"120px"}},{actions:u(()=>[v(ne,{color:"primary",variant:"text",onClick:o[3]||(o[3]=i=>m(we)($.value,i.clientX,i.clientY,e.parentItem))},{default:u(()=>[g(y(t.$t("actions")),1)]),_:1})]),default:u(()=>[x("span",null,y(t.$t("items_selected",[$.value.length])),1)]),_:1},8,["model-value"])]),_:1},8,["variant"])):f("",!0)]))}}),Ma=te(wa,[["__scopeId","data-v-17ef3bf7"]]);export{Ma as I};
