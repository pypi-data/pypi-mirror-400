id: docker-compose/secrets-in-env
name: Secrets exposed in environment
level: critical
category: security
description: |
  Hardcoding secrets in docker-compose files or using env_file with sensitive
  data exposes credentials. These files are often committed to version control
  and secrets become visible in container inspection.
checklist:
  - Environment variables contain hardcoded passwords or API keys.
  - Sensitive values visible in docker-compose.yml.
  - env_file points to files with secrets that might be committed.
fix: |
  Use Docker secrets for sensitive data. Reference external secret files
  that are not committed. Use environment variable references (${VAR})
  that read from the host at runtime.

tags:
  - docker-compose
  - security
  - secrets

triggers:
  file_patterns:
    - "**/docker-compose*.yml"
    - "**/docker-compose*.yaml"
    - "**/compose*.yml"
    - "**/compose*.yaml"
  code_patterns:
    - "PASSWORD"
    - "SECRET"
    - "API_KEY"
    - "TOKEN"

examples:
  bad: |
    services:
      db:
        environment:
          POSTGRES_PASSWORD: supersecret123
          API_KEY: abc123xyz
  good: |
    services:
      db:
        environment:
          POSTGRES_PASSWORD_FILE: /run/secrets/db_password
        secrets:
          - db_password
    secrets:
      db_password:
        external: true
