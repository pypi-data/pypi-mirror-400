{"version":3,"file":"WidgetFileUpload-7oPJOFQQ.js","sources":["../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/widgets/components/WidgetFileUpload.vue"],"sourcesContent":["<template>\n  <!-- Replace entire widget with image preview when image is loaded -->\n  <!-- Edge-to-edge: -mx-2 removes the parent's p-2 (8px) padding on each side -->\n  <div\n    v-if=\"hasImageFile\"\n    class=\"relative -mx-2\"\n    style=\"width: calc(100% + 1rem)\"\n  >\n    <!-- Select section above image -->\n    <div class=\"mb-2 flex items-center justify-between gap-4 px-2\">\n      <label\n        v-if=\"widget.name\"\n        class=\"text-secondary min-w-[4em] truncate text-xs\"\n        >{{ widget.name }}</label\n      >\n      <!-- Group select and folder button together on the right -->\n      <div class=\"flex items-center gap-1\">\n        <!-- TODO: finish once we finish value bindings with Litegraph -->\n        <Select\n          :model-value=\"selectedFile?.name\"\n          :options=\"[selectedFile?.name || '']\"\n          :disabled=\"true\"\n          :aria-label=\"`${$t('g.selectedFile')}: ${selectedFile?.name || $t('g.none')}`\"\n          v-bind=\"transformCompatProps\"\n          class=\"max-w-[20em] min-w-[8em] text-xs\"\n          size=\"small\"\n          :pt=\"{\n            option: 'text-xs',\n            dropdownIcon: 'text-component-node-foreground-secondary'\n          }\"\n        />\n        <Button\n          icon=\"pi pi-folder\"\n          size=\"small\"\n          class=\"!h-8 !w-8\"\n          @click=\"triggerFileInput\"\n        />\n      </div>\n    </div>\n\n    <!-- Image preview -->\n    <!-- TODO: change hardcoded colors when design system incorporated -->\n    <div class=\"group relative\">\n      <img :src=\"imageUrl\" :alt=\"selectedFile?.name\" class=\"h-auto w-full\" />\n      <!-- Darkening overlay on hover -->\n      <div\n        class=\"bg-opacity-0 group-hover:bg-opacity-20 pointer-events-none absolute inset-0 bg-black transition-all duration-200\"\n      />\n      <!-- Control buttons in top right on hover -->\n      <div\n        class=\"absolute top-2 right-2 flex gap-1 opacity-0 transition-opacity duration-200 group-hover:opacity-100\"\n      >\n        <!-- Edit button -->\n        <button\n          :aria-label=\"$t('g.editImage')\"\n          class=\"flex h-6 w-6 items-center justify-center rounded border-none transition-all duration-150 focus:outline-none\"\n          style=\"background-color: #262729\"\n          @click=\"handleEdit\"\n        >\n          <i class=\"pi pi-pencil text-xs text-white\"></i>\n        </button>\n        <!-- Delete button -->\n        <button\n          :aria-label=\"$t('g.deleteImage')\"\n          class=\"flex h-6 w-6 items-center justify-center rounded border-none transition-all duration-150 focus:outline-none\"\n          style=\"background-color: #262729\"\n          @click=\"clearFile\"\n        >\n          <i class=\"pi pi-times text-xs text-white\"></i>\n        </button>\n      </div>\n    </div>\n  </div>\n\n  <!-- Audio preview when audio file is loaded -->\n  <div\n    v-else-if=\"hasAudioFile\"\n    class=\"relative -mx-2\"\n    style=\"width: calc(100% + 1rem)\"\n  >\n    <!-- Select section above audio player -->\n    <div class=\"mb-2 flex items-center justify-between gap-4 px-2\">\n      <label\n        v-if=\"widget.name\"\n        class=\"text-secondary min-w-[4em] truncate text-xs\"\n        >{{ widget.name }}</label\n      >\n      <!-- Group select and folder button together on the right -->\n      <div class=\"flex items-center gap-1\">\n        <Select\n          :model-value=\"selectedFile?.name\"\n          :options=\"[selectedFile?.name || '']\"\n          :disabled=\"true\"\n          :aria-label=\"`${$t('g.selectedFile')}: ${selectedFile?.name || $t('g.none')}`\"\n          v-bind=\"transformCompatProps\"\n          class=\"max-w-[20em] min-w-[8em] text-xs\"\n          size=\"small\"\n          :pt=\"{\n            option: 'text-xs',\n            dropdownIcon: 'text-component-node-foreground-secondary'\n          }\"\n        />\n        <Button\n          icon=\"pi pi-folder\"\n          size=\"small\"\n          class=\"!h-8 !w-8\"\n          @click=\"triggerFileInput\"\n        />\n      </div>\n    </div>\n\n    <!-- Audio player -->\n    <div class=\"group relative px-2\">\n      <div\n        class=\"flex items-center gap-4 rounded-lg bg-charcoal-800 p-4\"\n        style=\"border: 1px solid #262729\"\n      >\n        <!-- Audio icon -->\n        <div class=\"flex-shrink-0\">\n          <i class=\"pi pi-volume-up text-2xl opacity-60\"></i>\n        </div>\n\n        <!-- File info and controls -->\n        <div class=\"flex-1\">\n          <div class=\"mb-1 text-sm font-medium\">{{ selectedFile?.name }}</div>\n          <div class=\"text-xs opacity-60\">\n            {{\n              selectedFile ? (selectedFile.size / 1024).toFixed(1) + ' KB' : ''\n            }}\n          </div>\n        </div>\n\n        <!-- Control buttons -->\n        <div class=\"flex gap-1\">\n          <!-- Delete button -->\n          <button\n            :aria-label=\"$t('g.deleteAudioFile')\"\n            class=\"flex h-8 w-8 items-center justify-center rounded border-none transition-all duration-150 hover:bg-charcoal-600 focus:outline-none\"\n            @click=\"clearFile\"\n          >\n            <i class=\"pi pi-times text-sm text-white\"></i>\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <!-- Show normal file upload UI when no image or audio is loaded -->\n  <div\n    v-else\n    class=\"flex w-full flex-col gap-1 rounded-lg border border-solid p-1\"\n    :style=\"{ borderColor: '#262729' }\"\n  >\n    <div\n      class=\"rounded-md border border-dashed p-1 transition-colors duration-200 hover:border-slate-300\"\n      :style=\"{ borderColor: '#262729' }\"\n    >\n      <div class=\"flex w-full flex-col items-center gap-2 py-4\">\n        <span class=\"text-xs opacity-60\">\n          {{ $t('widgetFileUpload.dropPrompt') }}\n        </span>\n        <div>\n          <Button\n            :label=\"$t('widgetFileUpload.browseFiles')\"\n            size=\"small\"\n            severity=\"secondary\"\n            class=\"text-xs\"\n            @click=\"triggerFileInput\"\n          />\n        </div>\n      </div>\n    </div>\n  </div>\n  <!-- Hidden file input always available for both states -->\n  <input\n    ref=\"fileInputRef\"\n    type=\"file\"\n    class=\"hidden\"\n    :accept=\"widget.options?.accept\"\n    :aria-label=\"`${$t('g.upload')} ${widget.name || $t('g.file')}`\"\n    :multiple=\"false\"\n    @change=\"handleFileChange\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport Select from 'primevue/select'\nimport { computed, onUnmounted, ref, watch } from 'vue'\n\nimport { useWidgetValue } from '@/composables/graph/useWidgetValue'\nimport { useTransformCompatOverlayProps } from '@/composables/useTransformCompatOverlayProps'\nimport type { SimplifiedWidget } from '@/types/simplifiedWidget'\n\nconst { widget, modelValue } = defineProps<{\n  widget: SimplifiedWidget<File[] | null>\n  modelValue: File[] | null\n}>()\n\nconst emit = defineEmits<{\n  'update:modelValue': [value: File[] | null]\n}>()\n\nconst { localValue, onChange } = useWidgetValue({\n  widget,\n  modelValue,\n  defaultValue: null,\n  emit\n})\n\n// Transform compatibility props for overlay positioning\nconst transformCompatProps = useTransformCompatOverlayProps()\n\nconst fileInputRef = ref<HTMLInputElement | null>(null)\n\n// Since we only support single file, get the first file\nconst selectedFile = computed(() => {\n  const files = localValue.value || []\n  return files.length > 0 ? files[0] : null\n})\n\n// Quick file type detection for testing\nconst detectFileType = (file: File) => {\n  const type = file.type?.toLowerCase() || ''\n  const name = file.name?.toLowerCase() || ''\n\n  if (\n    type.startsWith('image/') ||\n    name.match(/\\.(jpg|jpeg|png|gif|webp|svg)$/)\n  ) {\n    return 'image'\n  }\n  if (type.startsWith('video/') || name.match(/\\.(mp4|webm|ogg|mov)$/)) {\n    return 'video'\n  }\n  if (type.startsWith('audio/') || name.match(/\\.(mp3|wav|ogg|flac)$/)) {\n    return 'audio'\n  }\n  if (type === 'application/pdf' || name.endsWith('.pdf')) {\n    return 'pdf'\n  }\n  if (type.includes('zip') || name.match(/\\.(zip|rar|7z|tar|gz)$/)) {\n    return 'archive'\n  }\n  return 'file'\n}\n\n// Check if we have an image file\nconst hasImageFile = computed(() => {\n  return selectedFile.value && detectFileType(selectedFile.value) === 'image'\n})\n\n// Check if we have an audio file\nconst hasAudioFile = computed(() => {\n  return selectedFile.value && detectFileType(selectedFile.value) === 'audio'\n})\n\n// Get image URL for preview\nconst imageUrl = computed(() => {\n  if (hasImageFile.value && selectedFile.value) {\n    return URL.createObjectURL(selectedFile.value)\n  }\n  return ''\n})\n\n// // Get audio URL for playback\n// const audioUrl = computed(() => {\n//   if (hasAudioFile.value && selectedFile.value) {\n//     return URL.createObjectURL(selectedFile.value)\n//   }\n//   return ''\n// })\n\n// Clean up image URL when file changes\nwatch(imageUrl, (newUrl, oldUrl) => {\n  if (oldUrl && oldUrl !== newUrl) {\n    URL.revokeObjectURL(oldUrl)\n  }\n})\n\nconst triggerFileInput = () => {\n  fileInputRef.value?.click()\n}\n\nconst handleFileChange = (event: Event) => {\n  const target = event.target as HTMLInputElement\n  if (target.files && target.files.length > 0) {\n    // Since we only support single file, take the first one\n    const file = target.files[0]\n\n    // Use the composable's onChange handler with an array\n    onChange([file])\n\n    // Reset input to allow selecting same file again\n    target.value = ''\n  }\n}\n\nconst clearFile = () => {\n  // Clear the file\n  onChange(null)\n\n  // Reset file input\n  if (fileInputRef.value) {\n    fileInputRef.value.value = ''\n  }\n}\n\nconst handleEdit = () => {\n  // TODO: hook up with maskeditor\n}\n\n// Clear file input when value is cleared externally\nwatch(localValue, (newValue) => {\n  if (!newValue || newValue.length === 0) {\n    if (fileInputRef.value) {\n      fileInputRef.value.value = ''\n    }\n  }\n})\n\n// Clean up image URL on unmount\nonUnmounted(() => {\n  if (imageUrl.value) {\n    URL.revokeObjectURL(imageUrl.value)\n  }\n})\n</script>\n"],"names":["emit","__emit","localValue","onChange","useWidgetValue","__props","transformCompatProps","useTransformCompatOverlayProps","fileInputRef","ref","selectedFile","computed","files","detectFileType","__name","file","type","name","hasImageFile","hasAudioFile","imageUrl","watch","newUrl","oldUrl","triggerFileInput","handleFileChange","event","target","clearFile","handleEdit","newValue","onUnmounted"],"mappings":"w2DAuMA,MAAMA,EAAOC,EAIP,CAAE,WAAAC,EAAY,SAAAC,CAAS,EAAIC,EAAe,CAC9C,OAAMC,EAAA,OACN,WAAUA,EAAA,WACV,aAAc,KACd,KAAAL,CAAA,CACD,EAGKM,EAAuBC,IAEvBC,EAAeC,EAA6B,IAAI,EAGhDC,EAAeC,EAAS,IAAM,CAC5B,MAAAC,EAAQV,EAAW,OAAS,GAClC,OAAOU,EAAM,OAAS,EAAIA,EAAM,CAAC,EAAI,IAAA,CACtC,EAGKC,EAAiBC,EAACC,GAAe,CACrC,MAAMC,EAAOD,EAAK,MAAM,YAAA,GAAiB,GACnCE,EAAOF,EAAK,MAAM,YAAA,GAAiB,GAEzC,OACEC,EAAK,WAAW,QAAQ,GACxBC,EAAK,MAAM,gCAAgC,EAEpC,QAELD,EAAK,WAAW,QAAQ,GAAKC,EAAK,MAAM,uBAAuB,EAC1D,QAELD,EAAK,WAAW,QAAQ,GAAKC,EAAK,MAAM,uBAAuB,EAC1D,QAELD,IAAS,mBAAqBC,EAAK,SAAS,MAAM,EAC7C,MAELD,EAAK,SAAS,KAAK,GAAKC,EAAK,MAAM,wBAAwB,EACtD,UAEF,MAAA,EAtBc,kBA0BjBC,EAAeP,EAAS,IACrBD,EAAa,OAASG,EAAeH,EAAa,KAAK,IAAM,OACrE,EAGKS,EAAeR,EAAS,IACrBD,EAAa,OAASG,EAAeH,EAAa,KAAK,IAAM,OACrE,EAGKU,EAAWT,EAAS,IACpBO,EAAa,OAASR,EAAa,MAC9B,IAAI,gBAAgBA,EAAa,KAAK,EAExC,EACR,EAWKW,EAAAD,EAAU,CAACE,EAAQC,IAAW,CAC9BA,GAAUA,IAAWD,GACvB,IAAI,gBAAgBC,CAAM,CAC5B,CACD,EAED,MAAMC,EAAmBV,EAAA,IAAM,CAC7BN,EAAa,OAAO,OAAM,EADH,oBAInBiB,EAAmBX,EAACY,GAAiB,CACzC,MAAMC,EAASD,EAAM,OACrB,GAAIC,EAAO,OAASA,EAAO,MAAM,OAAS,EAAG,CAErC,MAAAZ,EAAOY,EAAO,MAAM,CAAC,EAGlBxB,EAAA,CAACY,CAAI,CAAC,EAGfY,EAAO,MAAQ,EACjB,CAAA,EAXuB,oBAcnBC,EAAYd,EAAA,IAAM,CAEtBX,EAAS,IAAI,EAGTK,EAAa,QACfA,EAAa,MAAM,MAAQ,GAC7B,EAPgB,aAUZqB,EAAaf,EAAA,IAAM,CAAA,EAAN,cAKb,OAAAO,EAAAnB,EAAa4B,GAAa,EAC1B,CAACA,GAAYA,EAAS,SAAW,IAC/BtB,EAAa,QACfA,EAAa,MAAM,MAAQ,GAE/B,CACD,EAGDuB,EAAY,IAAM,CACZX,EAAS,OACP,IAAA,gBAAgBA,EAAS,KAAK,CACpC,CACD"}