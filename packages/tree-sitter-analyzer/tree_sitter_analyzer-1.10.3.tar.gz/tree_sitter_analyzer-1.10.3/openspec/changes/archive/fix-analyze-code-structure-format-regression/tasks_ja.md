# タスク: analyze_code_structure フォーマット回帰の修正

## 概要
FormatterRegistry アーキテクチャを維持しながら、`analyze_code_structure` ツールの元の v1.6.1.4 フォーマット仕様を復元する。

## タスクリスト

### フェーズ 1: 分析とドキュメント化
- [ ] **T1.1**: 正確な v1.6.1.4 フォーマット仕様をドキュメント化
  - 元の `full` フォーマット Markdown テーブル構造を抽出
  - 複雑度情報を含む `compact` フォーマットをドキュメント化
  - シンプルな `csv` フォーマット構造をドキュメント化
  - 参照出力サンプルを作成

- [ ] **T1.2**: 現在の v1.9.4 実装ギャップを分析
  - FormatterRegistry vs TableFormatter 出力を比較
  - 具体的なフォーマット違反を特定
  - 破壊的変更を詳細にドキュメント化

### フェーズ 2: フォーマット仕様の復元
- [ ] **T2.1**: レガシー互換フォーマッターを作成
  - Markdown テーブルを生成する `LegacyFullFormatter` を実装
  - 複雑度スコア付きの `LegacyCompactFormatter` を実装
  - シンプル構造の `LegacyCsvFormatter` を実装
  - 正確な v1.6.1.4 出力互換性を確保

- [ ] **T2.2**: FormatterRegistry 統合を更新
  - `full`、`compact`、`csv` フォーマット用のレガシーフォーマッターを登録
  - `TableFormatTool` での後方互換性を維持
  - 適切なフォールバック機構を確保

### フェーズ 3: HTML フォーマットの分離
- [ ] **T3.1**: analyze_code_structure から HTML フォーマットを削除
  - サポート形式から `html`、`html_compact`、`html_json` を削除
  - HTML フォーマットを除外するようにツールスキーマを更新
  - 検証ロジックを更新

- [ ] **T3.2**: 別の HTML 分析ツールを作成（オプション）
  - HTML 固有の分析用の `analyze_html_structure` ツールを設計
  - HTML フォーマッターを専用ツールに移動
  - MCP サーバー登録を更新

### フェーズ 4: テストと検証
- [ ] **T4.1**: フォーマット回帰テストを作成
  - `full` フォーマットが正確な Markdown テーブルを生成することをテスト
  - `compact` フォーマットが複雑度情報を含むことをテスト
  - `csv` フォーマットがシンプル構造を維持することをテスト
  - v1.6.1.4 参照サンプルと出力を比較

- [ ] **T4.2**: 既存のテストスイートを更新
  - v1.6.1.4 フォーマットに一致するようにテスト期待値を修正
  - analyze_code_structure から HTML フォーマットテストを削除
  - 包括的なフォーマット検証テストを追加

### フェーズ 5: ドキュメントとクリーンアップ
- [ ] **T5.1**: ツールドキュメントを更新
  - ツールスキーマのフォーマット仕様を修正
  - MCP ツール説明を更新
  - サポート形式を明確にドキュメント化

- [ ] **T5.2**: CHANGELOG と移行ガイドを更新
  - CHANGELOG でフォーマット復元をドキュメント化
  - v1.9.4 ユーザー向けの移行ガイドを提供
  - HTML フォーマット削除を説明

## 依存関係
- T1.1 は T2.1 の前に完了する必要がある
- T2.1 は T2.2 の前に完了する必要がある
- T3.1 は T4.1 の前に完了する必要がある
- T4.1 は T5.1 の前に完了する必要がある

## 検証基準
1. すべての `full` フォーマット出力が v1.6.1.4 Markdown テーブル構造と一致する
2. すべての `compact` フォーマット出力がテーブル形式で複雑度スコアを含む
3. すべての `csv` フォーマット出力が v1.6.1.4 と互換性のあるシンプル構造を使用する
4. HTML フォーマットが `analyze_code_structure` ツールから削除される
5. すべての既存統合テストが修正された期待値でパスする
6. v1.6.1.4 フォーマット動作を期待するユーザーに対する破壊的変更がない

## リスク軽減
- 将来の拡張性のために FormatterRegistry アーキテクチャを維持
- v1.9.4 フォーマットユーザー向けの明確な移行ドキュメントを提供
- 削除された HTML フォーマットに対する非推奨警告を検討
- 後方互換性テストがエッジケースをカバーすることを確保
