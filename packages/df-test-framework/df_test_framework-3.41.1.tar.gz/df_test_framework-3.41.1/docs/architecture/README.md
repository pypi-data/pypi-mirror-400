# æ¶æ„è®¾è®¡æ–‡æ¡£

æ·±å…¥äº†è§£ DF Test Framework æ¶æ„è®¾è®¡å’Œå®ç°åŸç†ã€‚

> å½“å‰ç‰ˆæœ¬ï¼šv3.40.1

## ğŸ“š v3.40 æ¶æ„æ–‡æ¡£ï¼ˆå½“å‰ç‰ˆæœ¬ï¼‰

### æ ¸å¿ƒæ–‡æ¡£
1. **[æ¶æ„æ€»è§ˆ](OVERVIEW_V3.17.md)** â­ - äº”å±‚æ¶æ„ + äº‹ä»¶é©±åŠ¨ + ç»Ÿä¸€å¯è§‚æµ‹æ€§
   - äº”å±‚æ¶æ„è¯¦è§£ï¼ˆLayer 0-4ï¼‰
   - EventBus äº‹ä»¶é©±åŠ¨
   - ä¸­é—´ä»¶ç³»ç»Ÿï¼ˆæ´‹è‘±æ¨¡å‹ï¼‰
   - æµ‹è¯•éš”ç¦»æœºåˆ¶

2. **[ä¾èµ–ç®¡ç†ç­–ç•¥](DI_STRATEGY.md)** ğŸ†• - æ··åˆ DI æ¨¡å¼è®¾è®¡
   - Provider æ¨¡å¼ï¼ˆé‡é‡çº§èµ„æºï¼‰
   - Settings ç»‘å®šï¼ˆè½»é‡çº§æœåŠ¡ï¼‰
   - pytest fixturesï¼ˆæµ‹è¯•ä¾èµ–ï¼‰
   - æ‰©å±•æ–°æœåŠ¡æŒ‡å—

3. **[æ’ä»¶ç³»ç»Ÿæ¶æ„](PLUGIN_SYSTEM_V3.37.md)** - pytest æ’ä»¶ç°ä»£åŒ–å®ç°
   - pytest11 Entry Points è‡ªåŠ¨å‘ç°
   - pytest 9.0 åŸç”Ÿ TOML é…ç½®
   - config å¯¹è±¡å±æ€§å­˜å‚¨
   - Hook æ‰§è¡Œé¡ºåºä¸çŠ¶æ€ç®¡ç†
   - æµ‹è¯•éš”ç¦»æœºåˆ¶

4. **[å¯è§‚æµ‹æ€§æ¶æ„](observability-architecture.md)** - ä¸‰å¤§æ”¯æŸ± + EventBus
   - Logging (Loguru)
   - Tracing (OpenTelemetry)
   - Metrics (Prometheus)
   - EventBus é›†æˆ

5. **[EventBus é›†æˆåˆ†æ](eventbus-integration-analysis.md)** - æ¨¡å—é›†æˆçŠ¶æ€
   - å·²é›†æˆ EventBus çš„æ¨¡å—
   - æ”¹è¿›è·¯çº¿å›¾

---

## ğŸ“š åŸºç¡€æ¶æ„è®¾è®¡ï¼ˆå†å²å‚è€ƒï¼‰

### èƒ½åŠ›å±‚è®¾è®¡
- **[V3 æ¶æ„è®¾è®¡](V3_ARCHITECTURE.md)** - v3.0 æ ¸å¿ƒæ¶æ„æ–¹æ¡ˆï¼ˆåŸºç¡€ï¼‰
- **[V3 å®æ–½æŒ‡å—](V3_IMPLEMENTATION.md)** - v3.0 å®æ–½æ­¥éª¤
- **[v2 â†’ v3 è¿ç§»æŒ‡å—](../migration/v2-to-v3.md)** - ç”¨æˆ·è¿ç§»æ–‡æ¡£

### è´¨é‡ä¿è¯
- **[æ¶æ„å®¡è®¡æŠ¥å‘Š](ARCHITECTURE_AUDIT.md)** - æ–‡æ¡£ä¸ä»£ç ä¸€è‡´æ€§å®¡è®¡
- **[æœªæ¥å¢å¼ºåŠŸèƒ½](FUTURE_ENHANCEMENTS.md)** - åç»­å¢å¼ºè§„åˆ’

### å½’æ¡£
- **[archive/](archive/)** - æ¶æ„æ¼”è¿›è¿‡ç¨‹æ–‡æ¡£ï¼ˆå·²å½’æ¡£ï¼‰
- **[overview.md](overview.md)** - v2 æ¶æ„æ€»è§ˆï¼ˆå†å²å‚è€ƒï¼‰

## ğŸ—ï¸ æ¶æ„åŸåˆ™

### 1. äº”å±‚æ¶æ„ï¼ˆv3.16+ï¼‰

æ¡†æ¶é‡‡ç”¨æ¸…æ™°çš„äº”å±‚è®¾è®¡ï¼š

```
Layer 4 â”€â”€â”€ bootstrap/          # å¼•å¯¼å±‚ï¼šæ¡†æ¶ç»„è£…å’Œåˆå§‹åŒ–
Layer 3 â”€â”€â”€ testing/ + cli/     # é—¨é¢å±‚ï¼šFixturesã€è°ƒè¯•å·¥å…·ã€CLI
Layer 2 â”€â”€â”€ capabilities/       # èƒ½åŠ›å±‚ï¼šclients/drivers/databases/messengers/storages
Layer 1 â”€â”€â”€ infrastructure/     # åŸºç¡€è®¾æ–½ï¼šconfig/logging/telemetry/events/plugins
Layer 0 â”€â”€â”€ core/               # æ ¸å¿ƒå±‚ï¼šçº¯æŠ½è±¡ï¼ˆmiddleware/context/events/protocolsï¼‰
æ¨ªåˆ‡ â”€â”€â”€â”€â”€ plugins/             # æ’ä»¶ï¼šMonitoringPluginã€AllurePlugin
```

**ä¾èµ–è§„åˆ™**:
- Layer 4 â†’ å¯ä¾èµ– Layer 0-3 å…¨éƒ¨
- Layer 3 â†’ å¯ä¾èµ– Layer 0-2
- Layer 2 â†’ å¯ä¾èµ– Layer 0-1
- Layer 1 â†’ åªèƒ½ä¾èµ– Layer 0
- Layer 0 â†’ æ— ä¾èµ–ï¼ˆæœ€åº•å±‚ï¼‰

### 2. æ ¸å¿ƒè®¾è®¡æ¨¡å¼

- **Middlewareï¼ˆä¸­é—´ä»¶ï¼‰**: æ´‹è‘±æ¨¡å‹è¯·æ±‚å¤„ç†é“¾ï¼ˆç­¾åã€è®¤è¯ã€é‡è¯•ã€æ—¥å¿—ï¼‰
- **EventBusï¼ˆäº‹ä»¶é©±åŠ¨ï¼‰**: å‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼Œæ¨¡å—è§£è€¦
- **Factoryï¼ˆå·¥å‚ï¼‰**: æµ‹è¯•æ•°æ®ç”Ÿæˆ
- **Repositoryï¼ˆä»“å‚¨ï¼‰**: æ•°æ®è®¿é—®æŠ½è±¡
- **Providerï¼ˆæä¾›è€…ï¼‰**: ä¾èµ–æ³¨å…¥
- **Pluginï¼ˆæ’ä»¶ï¼‰**: åŠŸèƒ½æ‰©å±•ï¼ˆPluggyï¼‰

### 3. è®¾è®¡åŸåˆ™

- **å•ä¸€èŒè´£**: æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä»¶äº‹
- **ä¾èµ–å€’ç½®**: ä¾èµ–æŠ½è±¡è€Œéå…·ä½“å®ç°
- **å¼€é—­åŸåˆ™**: å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
- **æ¥å£éš”ç¦»**: ä½¿ç”¨åè®®å’ŒæŠ½è±¡åŸºç±»
- **æ˜¾å¼ä¼˜äºéšå¼**: é…ç½®å’Œè¡Œä¸ºæ˜ç¡®å¯è§

## ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ

### Bootstrap å¯åŠ¨æµç¨‹ï¼ˆv3.37ï¼‰

```python
from df_test_framework.bootstrap import Bootstrap
from df_test_framework.infrastructure.config import get_config

# v3.37.0: ä½¿ç”¨ get_config() åŠ è½½é…ç½®ï¼ˆè‡ªåŠ¨è¯†åˆ« config/ ç›®å½•ï¼‰
settings = get_config(env="staging")  # åŠ è½½ config/environments/staging.yaml

# Bootstrap å¯åŠ¨
Bootstrap()
  .with_settings(settings)       # 1. åŠ è½½é…ç½®
  .with_providers(providers)     # 2. æ³¨å†Œæä¾›è€…
  .with_event_bus(event_bus)     # 3. äº‹ä»¶æ€»çº¿
  .with_extensions(extensions)   # 4. åŠ è½½æ‰©å±•
  .build()                       # 5. æ„å»ºåº”ç”¨
  .run()                         # 6. åˆ›å»ºè¿è¡Œæ—¶

# v3.37.0: pytest æ’ä»¶ä¸­ä½¿ç”¨ config å¯¹è±¡å±æ€§
# env_plugin è‡ªåŠ¨è°ƒç”¨ get_config() å¹¶å­˜å‚¨åˆ° config._df_settings
# core.py ä½¿ç”¨ config._df_runtime å­˜å‚¨ RuntimeContext
```

### RuntimeContext ä¾èµ–ç®¡ç†

```python
runtime.http_client()    # è·å–HTTPå®¢æˆ·ç«¯ï¼ˆå«ä¸­é—´ä»¶ï¼‰
runtime.database()       # è·å–æ•°æ®åº“è¿æ¥
runtime.redis_client()   # è·å–Rediså®¢æˆ·ç«¯
runtime.event_bus        # è·å–äº‹ä»¶æ€»çº¿
```

### ä¸­é—´ä»¶ç³»ç»Ÿï¼ˆv3.14+ï¼‰

æ´‹è‘±æ¨¡å‹è¯·æ±‚å¤„ç†ï¼š

```python
from df_test_framework import HttpClient
from df_test_framework.capabilities.clients.http.middleware import (
    SignatureMiddleware,
    BearerTokenMiddleware,
    RetryMiddleware,
)

client = HttpClient(
    base_url="https://api.example.com",
    middlewares=[
        RetryMiddleware(max_retries=3),
        SignatureMiddleware(secret="xxx"),
        BearerTokenMiddleware(token="token"),
    ]
)
```

## ğŸ“Š æ¨¡å—ä¾èµ–å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Layer 4: Bootstrap                        â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚         â”‚  Bootstrap â†’ Providers â†’ Runtime    â”‚             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                Layer 3: Testing + CLI                        â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚    â”‚   Fixtures   â”‚      â”‚   CLI Tools  â”‚                   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚               Layer 2: Capabilities                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ HTTP   â”‚ â”‚ gRPC   â”‚ â”‚ Database â”‚ â”‚  Messengers  â”‚        â”‚
â”‚  â”‚ Client â”‚ â”‚ Client â”‚ â”‚ + Redis  â”‚ â”‚ Kafka/MQ/RMQ â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Layer 1: Infrastructure                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Config â”‚ â”‚ Logging â”‚ â”‚ Telemetry â”‚ â”‚ EventBus â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  Layer 0: Core                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Middleware â”‚ â”‚ Context â”‚ â”‚  Events  â”‚ â”‚ Protocols â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ æŠ€æœ¯é€‰å‹

### æ ¸å¿ƒä¾èµ–

- **httpx**: ç°ä»£å¼‚æ­¥HTTPå®¢æˆ·ç«¯
- **pydantic**: æ•°æ®éªŒè¯å’Œé…ç½®ç®¡ç†
- **sqlalchemy**: æ•°æ®åº“ORM
- **redis**: Rediså®¢æˆ·ç«¯
- **loguru**: ç»“æ„åŒ–æ—¥å¿—
- **pluggy**: æ’ä»¶ç³»ç»Ÿ
- **pytest**: æµ‹è¯•æ¡†æ¶

### ä¸ºä»€ä¹ˆé€‰æ‹©è¿™äº›æŠ€æœ¯ï¼Ÿ

- **httpx vs requests**: æ”¯æŒå¼‚æ­¥ã€HTTP/2ã€æ›´ç°ä»£çš„API
- **pydantic**: ç±»å‹å®‰å…¨ã€è‡ªåŠ¨éªŒè¯ã€ç¯å¢ƒå˜é‡æ”¯æŒ
- **loguru**: ç®€å•æ˜“ç”¨ã€ç»“æ„åŒ–æ—¥å¿—ã€è‡ªåŠ¨é¢œè‰²
- **pluggy**: pytestä½¿ç”¨çš„æ’ä»¶ç³»ç»Ÿï¼Œæˆç†Ÿç¨³å®š

## ğŸ”— ç›¸å…³èµ„æº

- [æ¶æ„æ€»è§ˆ](overview.md)
- [APIå‚è€ƒ](../api-reference/README.md)
- [ç”¨æˆ·æŒ‡å—](../user-guide/README.md)

---

**è¿”å›**: [æ–‡æ¡£é¦–é¡µ](../README.md)
