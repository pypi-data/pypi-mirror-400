"use strict";(self.webpackChunkgitoon_frontend=self.webpackChunkgitoon_frontend||[]).push([["35826"],{18427:function(t,e,a){a.d(e,{g:function(){return r}});a(42762);var n=a(79468),o=a(39274);function r(t,e,a,r,i,s){var c=t.getPropertyValue(i+"-"+s).trim(),d=c.length>0?c:t.getPropertyValue(i).trim(),u=(0,n.RQ)(d);return 0===c.length&&s&&(u=(0,n.v2)((0,n.BE)(e?(0,o.T)((0,n.Nc)((0,n.xp)(u)),s):(0,o.d)((0,n.Nc)((0,n.xp)(u)),s)))),r?u+=a?"32":"7F":a&&(u+="7F"),u}},93590:function(t,e,a){a.a(t,async function(t,n){try{a.r(e),a.d(e,{HuiEnergyDevicesDetailGraphCard:function(){return O}});var o,r,i,s=a(31432),c=a(7739),d=a(72153),u=a(44734),h=a(43080),_=a(69683),p=a(6454),l=(a(28706),a(2008),a(50113),a(74423),a(25276),a(62062),a(44114),a(72712),a(26910),a(18111),a(22489),a(20116),a(7588),a(61701),a(18237),a(2892),a(69085),a(79432),a(26099),a(27495),a(21699),a(25440),a(23500),a(40445)),f=a(81859),m=a(40600),v=a(96196),g=a(77845),y=a(94333),k=a(22786),b=a(12814),S=a(18427),w=(a(76776),a(44439)),C=a(38114),D=a(23528),E=a(54706),A=a(784),I=a(97372),x=a(93905),F=a(20058),M=t([w,F,C,I,D]);[w,F,C,I,D]=M.then?(await M)():M;var O=function(t){function e(){var t;(0,u.A)(this,e);for(var a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return(t=(0,_.A)(this,e,[].concat(n)))._chartData=[],t._start=(0,f.R)(),t._end=(0,m.o)(),t._hiddenStats=[],t.hassSubscribeRequiredHostProps=["_config"],t._formatTotal=function(e){return t.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,F.ZV)(e,t.hass.locale),unit:"kWh"})},t._createOptions=(0,k.A)(function(e,a,n,o,r,i,s){var c=(0,I.od)(e,a,n,o,r,i,s,t._formatTotal),d=t._legendData?t._legendData.filter(function(e){return e.id&&t._hiddenStats.includes(t._getStatIdFromId(e.id))}).reduce(function(t,e){return t[e.id]=!1,t},{}):{};return Object.assign(Object.assign({},c),{},{legend:{show:!0,type:"custom",data:t._legendData,selected:d},grid:{top:15,bottom:0,left:1,right:1,containLabel:!0}})}),t}return(0,p.A)(e,t),(0,h.A)(e,[{key:"hassSubscribe",value:function(){var t,e=this;return[(0,C.tb)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe(function(t){e._data=t})]}},{key:"getCardSize",value:function(){return 3}},{key:"setConfig",value:function(t){this._config=t}},{key:"shouldUpdate",value:function(t){return(0,A.xP)(this,t)||t.size>1||!t.has("hass")}},{key:"willUpdate",value:function(t){(t.has("_config")||t.has("_data"))&&this._processStatistics()}},{key:"render",value:function(){return this.hass&&this._config?(0,v.qy)(o||(o=(0,d.A)([" <ha-card> ",' <div class="content ','"> <ha-chart-base .hass="','" .data="','" .options="','" @dataset-hidden="','" @dataset-unhidden="','"></ha-chart-base> </div> </ha-card> '])),this._config.title?(0,v.qy)(r||(r=(0,d.A)(['<h1 class="card-header">',"</h1>"])),this._config.title):"",(0,y.H)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,"kWh",this._compareStart,this._compareEnd),this._datasetHidden,this._datasetUnhidden):v.s6}},{key:"_datasetHidden",value:function(t){this._hiddenStats=[].concat((0,c.A)(this._hiddenStats),[this._getStatIdFromId(t.detail.id)])}},{key:"_datasetUnhidden",value:function(t){var e=this;this._hiddenStats=this._hiddenStats.filter(function(a){return a!==e._getStatIdFromId(t.detail.id)})}},{key:"_processStatistics",value:function(){if(this._data){var t=this._data;this._start=t.start,this._end=t.end||(0,m.o)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare;var e=t.stats,a=t.statsCompare,n=getComputedStyle(this),o=t.prefs.device_consumption,r={};o.forEach(function(t){t.included_in_stat&&(r[t.included_in_stat]=r[t.included_in_stat]||[],r[t.included_in_stat].push(t.stat_consumption))});var i={};t.prefs.device_consumption.forEach(function(t){var a=t.stat_consumption in e&&(0,D.$j)(e[t.stat_consumption])||0;i[t.stat_consumption]=a});var s={};t.prefs.device_consumption.forEach(function(t){s[t.stat_consumption]=(r[t.stat_consumption]||[]).reduce(function(t,e){return t-i[e]},i[t.stat_consumption])});var d=t.prefs.device_consumption.map(function(t){return t.stat_consumption});d.sort(function(t,e){return s[e]-s[t]});var u=[],h=(0,C.gv)(t),_=h.summedData,p=h.compareSummedData,l="from_grid"in _||"solar"in _||"from_battery"in _,f=l?(0,C.DR)(_,p):{consumption:void 0,compareConsumption:void 0},v=f.consumption,g=f.compareConsumption;if(a){var y=this._processDataSet(n,a,t.statsMetadata,t.prefs.device_consumption,d,r,!0);if(u.push.apply(u,(0,c.A)(y)),l){var k=this._processUntracked(n,y,g,!0);u.push(k)}}u.push({id:"compare-placeholder",type:"bar",stack:t.statsCompare?"devicesCompare":"devices",data:[]});var b=this._processDataSet(n,e,t.statsMetadata,t.prefs.device_consumption,d,r);if(u.push.apply(u,(0,c.A)(b)),this._legendData=b.map(function(t){var e;return{id:t.id,secondaryIds:["compare-".concat(t.id)],name:t.name,itemStyle:{color:t.color,borderColor:null===(e=t.itemStyle)||void 0===e?void 0:e.borderColor}}}),l){var S,w=this._processUntracked(n,b,v,!1);u.push(w),this._legendData.push({id:w.id,secondaryIds:["compare-".concat(w.id)],name:w.name,itemStyle:{color:w.color,borderColor:null===(S=w.itemStyle)||void 0===S?void 0:S.borderColor}})}(0,I.RR)(u),this._chartData=u}}},{key:"_processUntracked",value:function(t,e,a,n){var o={};e.forEach(function(t){t.data.forEach(function(t){o[t[n?2:0]]=(o[t[n?2:0]]||0)+t[1]})});var r=(0,I.ok)(this._start,this._compareStart),i=[];Object.keys(a.used_total).sort(function(t,e){return Number(t)-Number(e)}).forEach(function(t){var e=Number(t),s=[e,a.used_total[t]-(o[t]||0)];n&&(s[2]=s[0],s[0]=r(new Date(e)).getTime()),i.push(s)});var s=Date.now();return{type:"bar",cursor:"default",id:n?"compare-untracked-".concat(s):"untracked-".concat(s),name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),itemStyle:{borderColor:(0,S.g)(t,this.hass.themes.darkMode,!1,n,"--history-unknown-color")},barMaxWidth:50,color:(0,S.g)(t,this.hass.themes.darkMode,!0,n,"--history-unknown-color"),data:i,stack:n?"devicesCompare":"devices"}}},{key:"_processDataSet",value:function(t,e,a,n,o,r){var i=this,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=[],u=(0,I.ok)(this._start,this._compareStart);return n.forEach(function(n,h){var _,p=o.indexOf(n.stat_consumption);if(null!==(_=i._config)&&void 0!==_&&_.max_devices&&p>=i._config.max_devices)console.warn("Max devices exceeded for ".concat(n.name," (").concat(p," >= ").concat(i._config.max_devices,")"));else{var l=(0,b.fI)(h,t),f=null,m=[];if(n.stat_consumption in e){var v,g=e[n.stat_consumption],y=(0,s.A)(g);try{var k=function(){var t=v.value;if(null===t.change||void 0===t.change||0===t.change)return 0;if(f===t.start)return 0;var a=0;(r[n.stat_consumption]||[]).forEach(function(n){var o,r=e[n];a+=(null==r||null===(o=r.find(function(e){return e.start===t.start}))||void 0===o?void 0:o.change)||0});var o=[t.start,t.change-a];c&&(o[2]=o[0],o[0]=u(new Date(t.start)).getTime()),m.push(o),f=t.start};for(y.s();!(v=y.n()).done;)k()}catch(w){y.e(w)}finally{y.f()}}var S=(n.name||(0,D.$O)(i.hass,n.stat_consumption,a[n.stat_consumption]))+(n.stat_consumption in r?" (".concat(i.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked"),")"):"");d.push({type:"bar",cursor:"default",id:c?"compare-".concat(n.stat_consumption,"-").concat(p):"".concat(n.stat_consumption,"-").concat(p),name:S,itemStyle:{borderColor:c?l+"7F":l},barMaxWidth:50,color:c?l+"32":l+"7F",data:m,stack:c?"devicesCompare":"devices"})}}),o.map(function(t){return d.find(function(e){return i._getStatIdFromId(e.id)===t})}).filter(Boolean)}},{key:"_getStatIdFromId",value:function(t){return t.replace(/^compare-/,"").replace(/-\d+$/,"")}}])}((0,E.E)(v.WF));O.styles=(0,v.AH)(i||(i=(0,d.A)([".card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}"]))),(0,l.__decorate)([(0,g.MZ)({attribute:!1})],O.prototype,"hass",void 0),(0,l.__decorate)([(0,g.wk)()],O.prototype,"_config",void 0),(0,l.__decorate)([(0,g.wk)()],O.prototype,"_chartData",void 0),(0,l.__decorate)([(0,g.wk)()],O.prototype,"_data",void 0),(0,l.__decorate)([(0,g.wk)()],O.prototype,"_legendData",void 0),(0,l.__decorate)([(0,g.wk)()],O.prototype,"_start",void 0),(0,l.__decorate)([(0,g.wk)()],O.prototype,"_end",void 0),(0,l.__decorate)([(0,g.wk)()],O.prototype,"_compareStart",void 0),(0,l.__decorate)([(0,g.wk)()],O.prototype,"_compareEnd",void 0),(0,l.__decorate)([(0,g.wk)(),(0,x.I)({key:"energy-devices-hidden-stats",state:!0,subscribe:!1})],O.prototype,"_hiddenStats",void 0),O=(0,l.__decorate)([(0,g.EM)("hui-energy-devices-detail-graph-card")],O),n()}catch(U){n(U)}})}}]);
//# sourceMappingURL=35826.927075fea986c8e1.js.map