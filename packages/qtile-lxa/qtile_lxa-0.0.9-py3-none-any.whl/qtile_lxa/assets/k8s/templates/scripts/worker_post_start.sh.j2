#!/bin/bash
set -e
# set -x  # Uncomment for debugging

# ========================
# Variables
# ========================
LABEL_KEY="node-role.kubernetes.io/worker" # Node label key
LABEL_VALUE="" # Label value (empty string means key-only)
MAX_ATTEMPTS=5
RETRY_DELAY=5

# ========================
# Label the node
# ========================
for i in $(seq 1 "$MAX_ATTEMPTS"); do
    if kubectl label node "$HOSTNAME" "${LABEL_KEY}=${LABEL_VALUE}"; then
        echo "✅ Node labeled successfully"
        break
    else
        echo "❌ Labeling failed (attempt $i / $MAX_ATTEMPTS), retrying in $RETRY_DELAY seconds..."
        sleep "$RETRY_DELAY"
    fi
done
