#!/bin/bash
set -e

# Ensure we are in the project root
cd "$(dirname "$0")/.."

INPUT_FILE="openapi/gateway.json"
OUTPUT_FILE="src/kraken_sdk/_generated/models.py"

echo "Generating models from $INPUT_FILE..."

# Generate models using datamodel-code-generator
datamodel-codegen \
  --input "$INPUT_FILE" \
  --input-file-type openapi \
  --output "$OUTPUT_FILE" \
  --output-model-type pydantic_v2.BaseModel \
  --target-python-version 3.11 \
  --use-schema-description \
  --use-field-description \
  --disable-timestamp \
  --use-standard-collections \
  --use-union-operator \
  --enum-field-as-literal all \
  --use-double-quotes \
  --wrap-string-literal \
  --force-optional \
  --strict-nullable

# Add DO NOT EDIT header 
TEMP_FILE=$(mktemp)
echo "# DO NOT EDIT: This file is automatically generated by scripts/generate_models.sh" > "$TEMP_FILE"
echo "# Generated from: $INPUT_FILE" >> "$TEMP_FILE"
echo "" >> "$TEMP_FILE"
cat "$OUTPUT_FILE" >> "$TEMP_FILE"
mv "$TEMP_FILE" "$OUTPUT_FILE"

echo "Done. Models generated in $OUTPUT_FILE"
