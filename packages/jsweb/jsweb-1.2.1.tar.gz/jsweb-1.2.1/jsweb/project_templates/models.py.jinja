from jsweb.database import ModelBase, String, Integer, Boolean, Column, UniqueConstraint
from jsweb.security import generate_password_hash, check_password_hash

class User(ModelBase):
    __tablename__ = 'users'
    id = Column(Integer, primary_key=True)
    username = Column(String(100), nullable=False)
    email = Column(String(100), nullable=False)
    password_hash = Column(String(256), nullable=False)
    is_admin = Column(Boolean, default=False, nullable=False)

    # --- Best Practice for Constraints ---
    # To ensure compatibility with all database backends (especially SQLite's
    # batch mode for migrations), it's best to explicitly name all constraints.
    __table_args__ = (
        UniqueConstraint('username', name='uq_user_username'),
        UniqueConstraint('email', name='uq_user_email'),
    )
    # --- End Best Practice ---

    def set_password(self, password):
        self.password_hash = generate_password_hash(password)

    def check_password(self, password):
        return check_password_hash(self.password_hash, password)
