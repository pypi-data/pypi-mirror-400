import{j as e,c as L,G as D,C as R,r as S,s as A,K as E}from"./vendor-tanstack-BVzzyDEt.js";import{G as y,cn as _,c4 as w,a9 as B,B as b,a as f,b as c,bq as m,bz as x,I as v,a3 as N,aa as I,aU as V,bB as P,at as M,au as O,av as U,aw as G,cT as $,b3 as h,cU as z}from"./index-BJkJ93Lr.js";import{f as p,p as j}from"./vendor-date-2jFo9aCm.js";import{T as H,a as F,b as K}from"./task-run-concurrency-limits-reset-dialog--42fkldX.js";import{b as Q,f as q}from"./vendor-forms-BN3tpxM2.js";import"./vendor-react-Bce9NwRC.js";import"./vendor-radix-CTAic6HB.js";import"./vendor-recharts-Mwm2qLZp.js";const J=({flowRun:s,taskRun:a})=>{if(a){const{state:t,start_time:r,tags:n,estimated_run_time:i}=a;return{state:t,start_time:r,tags:n,estimated_run_time:i}}if(s){const{state:t,start_time:r,tags:n,estimated_run_time:i}=s;return{state:t,start_time:r,tags:n,estimated_run_time:i}}throw new Error("Expecting taskRun or flowRun to be defined")},W=({flow:s,flowRun:a,taskRun:t})=>{const{state:r,start_time:n,tags:i,estimated_run_time:l}=J({flowRun:a,taskRun:t});return e.jsxs(y,{className:ee({state:r?.type}),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(X,{flow:s,flowRun:a,taskRun:t}),e.jsx("div",{children:e.jsx(w,{maxTagsDisplayed:5,tags:i})})]}),e.jsxs("div",{className:"flex gap-2 items-center text-slate-600",children:[r&&e.jsx(B,{type:r.type,name:r.name}),n&&e.jsx(Z,{time:n}),e.jsx(Y,{duration:l})]})]})},X=({flow:s,flowRun:a,taskRun:t})=>{if(!s&&!a&&!t)throw new Error("Expecting flow, flowRun, or taskRun");return e.jsx(b,{children:e.jsxs(f,{children:[s&&e.jsx(c,{children:e.jsx(m,{className:"text-lg font-semibold",to:"/flows/flow/$id",params:{id:s.id},children:s.name})}),s&&a&&e.jsx(x,{}),a&&e.jsx(c,{children:e.jsx(m,{to:"/runs/flow-run/$id",params:{id:a.id},children:a.name})}),a&&t&&e.jsx(x,{}),t&&e.jsx(c,{children:e.jsx(m,{to:"/runs/task-run/$id",params:{id:t.id},children:t.name})})]})})},Y=({duration:s})=>e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx(v,{id:"Clock",className:"size-4"}),e.jsx(N,{variant:"bodySmall",children:I(s,{maxDecimalPoints:3,units:["s"]})})]}),Z=({time:s})=>e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx(v,{id:"Calendar",className:"size-4"}),e.jsx(N,{variant:"bodySmall",className:"font-mono",children:p(j(s),"yyyy/MM/dd pp")})]}),ee=_("flex flex-col gap-2 p-4 border-l-8",{variants:{state:{COMPLETED:"border-l-green-600",FAILED:"border-l-red-600",RUNNING:"border-l-blue-700",CANCELLED:"border-l-gray-800",CANCELLING:"border-l-gray-800",CRASHED:"border-l-orange-600",PAUSED:"border-l-gray-800",PENDING:"border-l-gray-800",SCHEDULED:"border-l-yellow-700"}}}),se=({data:s})=>e.jsx("ul",{className:"flex flex-col gap-2",children:s.map(a=>e.jsx("li",{children:e.jsx(W,{flow:a.flow,flowRun:a.flowRun,taskRun:a.taskRun})},a.taskRun.id))}),ae=({data:s})=>e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("dl",{className:"flex flex-col gap-2",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Tag"}),e.jsx("dd",{className:"text-sm font-medium leading-none",children:s.tag})]}),e.jsx("hr",{}),e.jsx("dl",{className:"flex flex-col gap-2",children:te(s).map(a=>e.jsxs(L.Fragment,{children:[e.jsx("dt",{className:"text-muted-foreground",children:a.label}),e.jsx("dd",{className:V("text-sm font-medium leading-none",a.formatType==="date"&&"font-mono"),children:a.value})]},a.label))})]}),te=s=>[{label:"Concurrency Limit Count",value:s.concurrency_limit,formatType:"number"},{label:"Concurrency Limit Active Task Run",value:s.active_slots?.length??"Unknown",formatType:"number"},{label:"Concurrency Limit ID",value:s.id??"Unknown",formatType:"number"},{label:"Created",value:s.created?p(j(s.created),"yyyy/MM/dd pp"):"N/A",formatType:"date"},{label:"Updated",value:s.updated?p(j(s.updated),"yyyy/MM/dd pp"):"N/A",formatType:"date"}],re=({tag:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(b,{children:e.jsxs(f,{children:[e.jsx(c,{children:e.jsx(m,{to:"/concurrency-limits",className:"text-xl font-semibold",children:"Concurrency Limits"})}),e.jsx(x,{}),e.jsx(c,{className:"text-xl font-semibold",children:e.jsx(P,{children:s})})]})})}),ne=({data:s,onDelete:a,onReset:t})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(re,{tag:s.tag}),e.jsx(H,{id:s.id,onDelete:a,onReset:t})]}),ie=({data:s,openDialog:a,onCloseDialog:t,onOpenChange:r})=>{const n=D(),i=()=>{t(),n({to:"/concurrency-limits",search:{tab:"task-run"}})};switch(a){case"reset":return e.jsx(K,{data:s,onOpenChange:r,onReset:t});case"delete":return e.jsx(F,{data:s,onOpenChange:r,onDelete:i});default:return null}},g=R("/concurrency-limits/concurrency-limit/$id"),d={"active-task-runs":{tabSearchValue:"active-task-runs",displayValue:"Active Task Runs"}},ce=({children:s})=>{const{tab:a}=g.useSearch(),t=g.useNavigate();return e.jsxs(M,{defaultValue:"Global",value:a,children:[e.jsx(O,{children:e.jsx(U,{value:d["active-task-runs"].tabSearchValue,onClick:()=>{t({to:"/concurrency-limits/concurrency-limit/$id",search:{tab:d["active-task-runs"].tabSearchValue}})},children:d["active-task-runs"].displayValue})}),e.jsx(G,{value:d["active-task-runs"].tabSearchValue,children:s})]})},le=({id:s})=>{const[a,t]=S.useState(null),{data:r}=A($(s)),n=()=>t("delete"),i=()=>t("reset"),l=()=>t(null),T=u=>{u||l()},{activeTaskRunsPromise:C,taskRunConcurrencyLimit:o}=r,k=o.active_slots?.length;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(ne,{data:o,onDelete:n,onReset:i}),e.jsxs("div",{className:"grid gap-4",style:{gridTemplateColumns:"3fr 1fr"},children:[e.jsx(ce,{children:e.jsx(E,{promise:C,fallback:e.jsx(oe,{length:k}),children:u=>e.jsx(se,{data:u})})}),e.jsx(ae,{data:o})]})]}),e.jsx(ie,{data:o,openDialog:a,onOpenChange:T,onCloseDialog:l})]})},oe=({length:s=0})=>e.jsx("div",{className:"flex flex-col gap-4",children:Array.from({length:s},(a,t)=>e.jsxs(y,{className:"p-4 space-y-4",children:[e.jsx(h,{className:"h-4 w-[350px]"}),e.jsx(h,{className:"h-4 w-[400px]"})]},t))});Q({tab:q(["active-task-runs"]).default("active-task-runs")});function ye(){const{id:s}=z.useParams();return e.jsx(le,{id:s})}export{ye as component};
//# sourceMappingURL=concurrency-limit._id-CMc80rvj.js.map
