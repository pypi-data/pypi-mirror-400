import{_ as bs}from"./CNTYtJs2.js";import{u as ws,_ as ys,a as $s,b as Cs}from"./p6Qf_Uxj.js";import{_ as ks}from"./BjGx28ax.js";import{_ as Ss}from"./BnoxUuzK.js";import{h as As,e as Ts,u as Is,f as Y,k as g,E as m,Z,D as Ps,S as Ds,G as Es,B as Ms,H as Ns,V as Os,W as Vs,m as xs,c as _,o as l,v as E,I as $,g as e,w as a,a as i,t as n,b as o,d as u,L as p,O as c,X as z,J as Q,K as Bs}from"./dgvVcRbD.js";import{_ as Rs,a as js,b as Fs,c as Ls,d as Us}from"./Dc4I8EvL.js";import{_ as Hs}from"./BngqlKF6.js";import{u as ss}from"./BtWIKuWo.js";import{u as qs}from"./DjCyy1jK.js";import{u as Ks}from"./BWdbJVRO.js";import"./CKMor2ew.js";import"./Cs0iAjED.js";import"./Si7f0Dtd.js";import"./DfwZZ1UW.js";import"./CVKV6eJo.js";import"./BIMr8OGX.js";import"./Dlg-EP8N.js";import"./DBAxjluF.js";import"./DX3tX3Y8.js";import"./BOr0jPkT.js";import"./PjxHOgst.js";import"./D6j-iADt.js";import"./wWRSdjR0.js";import"./PBSS8bwl.js";import"./C7c-EcZg.js";import"./CDwYDXMA.js";import"./BnobUxhI.js";import"./COpoDM1M.js";import"./asafqq8u.js";import"./DXS-54NY.js";import"./Bsc0CIfh.js";import"./DssDgHgj.js";import"./Dx5eJfeI.js";import"./k_JGKJJP.js";import"./DlAUqK2U.js";import"./Dcv3SB2f.js";import"./0Vh5jnau.js";import"./BrAY5X9P.js";import"./DLwfb9rl.js";import"./8lporG8B.js";import"./DjY5_9nl.js";import"./BesS-_33.js";import"./D8ey85JT.js";import"./ClvrI8Td.js";import"./C1qmphIB.js";import"./BULhecZF.js";import"./6was1jXH.js";import"./Bw0uuBPj.js";import"./XTzszJDu.js";const Gs={class:"flex h-screen flex-col"},Ws={class:"flex items-center gap-2"},Js={class:"font-semibold"},Xs={key:1,class:"flex flex-1 items-center justify-center"},Ys={key:2,class:"flex flex-1 items-center justify-center px-4"},Zs={class:"space-y-4"},zs={class:"border-border/60 bg-muted/30 rounded-lg border p-4"},Qs={class:"font-medium"},se={key:0,class:"text-muted-foreground mt-2 text-sm"},ee={key:0,class:"space-y-2"},te={class:"text-sm font-medium"},ne={class:"text-muted-foreground list-inside list-decimal space-y-2 text-sm"},ae={class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"},oe={key:0,class:"flex flex-wrap gap-2 sm:justify-end"},ie={key:0,class:"w-full max-w-2xl text-center"},re={class:"border-border/70 bg-card/70 rounded-2xl border p-8 shadow-sm backdrop-blur-sm"},le={class:"text-lg font-semibold"},ue={class:"text-muted-foreground mt-2 text-sm"},de={class:"mt-6 flex flex-wrap justify-center gap-2"},es="airbeeps.onboarding.no_assistants.dismissed",lt=As({__name:"index",async setup(me){let h,M;const{t:C}=Ts();Is({title:C("nav.newChat")});const{data:ts,pending:ns,refresh:as}=([h,M]=Y(()=>ss("/v1/assistants",{query:{scope:"pinned",limit:50}})),h=await h,M(),h),{data:os,pending:is,refresh:rs}=([h,M]=Y(()=>ss("/v1/assistants",{query:{sort_by:"usage_count",order:"desc",limit:50}})),h=await h,M(),h),I=g(()=>{const s=new Map;return(ts.value??[]).forEach(t=>s.set(t.id,t)),(os.value??[]).forEach(t=>s.set(t.id,t)),Array.from(s.values())}),P=m(null);Z(()=>{!P.value&&I.value.length>0&&(P.value=I.value[0].id)});const d=g(()=>I.value.find(s=>s.id===P.value)??null),b=m([]),f=m(""),w=m(!1),k=m(!1),N=m(!1),j=m(!1),O=m(null),F=m(),{$api:pe}=Ps(),L=ws(),ls=qs(),S=Ds(),U=Es(),{showError:H}=Ks(),us=Ms(),q=g(()=>ns.value||is.value),A=g(()=>!!S.user?.is_superuser),x=m(!1),y=m(!1),ds=g(()=>I.value.length>0),K=()=>{if(!q.value){if(ds.value){y.value=!1;return}x.value||(y.value=!0)}},ms=()=>{y.value=!1,x.value=!0,localStorage.setItem(es,"1")},G=async()=>{await Promise.all([as(),rs()])},ps=g(()=>d.value?.model?.capabilities?d.value.model.capabilities.includes("vision"):!1),V=()=>{b.value=[],f.value="",w.value=!1,k.value=!1,L.cleanupOldConversations()},B=async()=>S.user?!0:(O.value||(O.value=(async()=>{try{if(await S.fetchUser()&&S.user)return!0}catch(s){console.error("Failed to fetch user state:",s)}return j.value||(H(C("assistants.loginRequired")),j.value=!0),await c({path:"/sign-in",query:{redirect:us.fullPath}}),!1})().finally(()=>{O.value=null})),O.value),W=async()=>{S.user||(N.value=!0,await B())},cs=async s=>{await B()||(s.preventDefault(),s.stopPropagation())},J=async s=>{if(!await B()||!f.value.trim()||w.value||!d.value)return;const t=d.value.id,R=f.value.trim();f.value="",w.value=!0,k.value=!0;const T={id:Date.now().toString(),content:R,message_type:"USER",created_at:new Date().toISOString(),extra_data:s&&s.length>0?{images:s}:void 0};b.value.push(T);try{const v=await ls.createConversation(t);if(!v){b.value=b.value.filter(D=>D.id!==T.id),w.value=!1,k.value=!1;return}d.value&&L.setConversationData(v.id,T,d.value),V(),await c(`/chat/${v.id}`)}catch(v){console.error("Failed to initiate conversation:",v),b.value=b.value.filter(D=>D.id!==T.id),w.value=!1,k.value=!1,H(`${C("chat.sendFailed")}: ${v instanceof Error?v.message:C("chat.unknownError")}`)}},fs=s=>{s!==P.value&&(P.value=s,V())},vs=s=>{f.value=s,J()},X=g(()=>b.value.length===0&&!k.value),gs=g(()=>U.config.ui_show_message_share_button!==!1);return g(()=>U.config.ui_show_assistant_dropdown!==!1),Ns(()=>{V(),x.value=localStorage.getItem(es)==="1",K(),Os(()=>{F.value?.focus()})}),Vs(()=>{V()}),xs(()=>S.user,s=>{s&&(N.value=!1)}),Z(()=>{K()}),(s,t)=>{const R=bs,T=ys,v=ks,D=$s,_s=Cs,hs=Ss;return l(),_("div",Gs,[e(d)?$("",!0):(l(),E(R,{key:0},{default:a(()=>[i("div",Ws,[i("span",Js,n(e(C)("nav.newChat")),1)])]),_:1})),e(q)?(l(),_("div",Xs,[...t[10]||(t[10]=[i("div",{class:"border-primary h-8 w-8 animate-spin rounded-full border-b-2"},null,-1)])])):e(d)?(l(),E(hs,{key:3,assistant:e(d),assistants:e(I),"show-landing-input":e(X),onSelectAssistant:fs},{input:a(()=>[o(_s,{ref_key:"chatInputRef",ref:F,modelValue:e(f),"onUpdate:modelValue":t[9]||(t[9]=r=>z(f)?f.value=r:null),disabled:e(N)||e(w),"send-disabled":e(N)||e(w)||!e(f).trim(),"supports-vision":e(ps),onKeydown:cs,onFocus:W,onClick:W,onSend:J},null,8,["modelValue","disabled","send-disabled","supports-vision"])]),default:a(()=>[e(X)?(l(),E(T,{key:0,assistant:e(d),"show-welcome":!0,onSelectSuggestion:vs},null,8,["assistant"])):(l(!0),_(Q,{key:1},Bs(e(b),r=>(l(),E(v,{key:r.id,message:r,assistant:e(d),"enable-share":e(gs)},null,8,["message","assistant","enable-share"]))),128)),e(k)?(l(),E(D,{key:2,assistant:e(d),message:e(C)("chat.creatingConversation","Creating new conversation...")},null,8,["assistant","message"])):$("",!0)]),_:1},8,["assistant","assistants","show-landing-input"])):(l(),_("div",Ys,[o(e(Us),{open:e(y),"onUpdate:open":t[4]||(t[4]=r=>z(y)?y.value=r:null)},{default:a(()=>[o(e(Rs),{class:"sm:max-w-[560px]"},{default:a(()=>[o(e(js),null,{default:a(()=>[o(e(Fs),null,{default:a(()=>[u(n(s.$t("assistants.onboarding.title")),1)]),_:1}),o(e(Ls),null,{default:a(()=>[u(n(s.$t("assistants.onboarding.subtitle")),1)]),_:1})]),_:1}),i("div",Zs,[i("div",zs,[i("p",Qs,n(e(A)?s.$t("assistants.onboarding.adminTitle"):s.$t("assistants.onboarding.userTitle")),1),e(A)?$("",!0):(l(),_("p",se,n(s.$t("assistants.onboarding.userHelp")),1))]),e(A)?(l(),_("div",ee,[i("p",te,n(s.$t("assistants.onboarding.stepsTitle")),1),i("ol",ne,[i("li",null,n(s.$t("assistants.onboarding.steps.provider")),1),i("li",null,n(s.$t("assistants.onboarding.steps.model")),1),i("li",null,n(s.$t("assistants.onboarding.steps.assistant")),1)])])):$("",!0)]),o(e(Hs),{class:"flex-col-reverse gap-3 sm:flex-col sm:items-stretch sm:justify-start"},{default:a(()=>[i("div",ae,[o(e(p),{variant:"outline",onClick:ms},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.dismiss")),1)]),_:1}),o(e(p),{variant:"secondary",onClick:G},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.refresh")),1)]),_:1})]),e(A)?(l(),_("div",oe,[o(e(p),{variant:"outline",onClick:t[0]||(t[0]=r=>("navigateTo"in s?s.navigateTo:e(c))("/admin"))},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.openAdmin")),1)]),_:1}),o(e(p),{variant:"outline",class:"whitespace-normal",onClick:t[1]||(t[1]=r=>("navigateTo"in s?s.navigateTo:e(c))("/admin/model-providers"))},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.openProviders")),1)]),_:1}),o(e(p),{variant:"outline",class:"whitespace-normal",onClick:t[2]||(t[2]=r=>("navigateTo"in s?s.navigateTo:e(c))("/admin/models"))},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.openModels")),1)]),_:1}),o(e(p),{onClick:t[3]||(t[3]=r=>("navigateTo"in s?s.navigateTo:e(c))("/admin/assistants/create"))},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.createAssistant")),1)]),_:1})])):$("",!0)]),_:1})]),_:1})]),_:1},8,["open"]),e(y)?$("",!0):(l(),_("div",ie,[i("div",re,[i("p",le,n(s.$t("assistants.noAssistants")),1),i("p",ue,n(e(A)?s.$t("assistants.onboarding.adminTitle"):s.$t("assistants.onboarding.userHelp")),1),i("div",de,[o(e(p),{variant:"secondary",onClick:G},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.refresh")),1)]),_:1}),e(A)?(l(),_(Q,{key:0},[o(e(p),{variant:"outline",onClick:t[5]||(t[5]=r=>("navigateTo"in s?s.navigateTo:e(c))("/admin"))},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.openAdmin")),1)]),_:1}),o(e(p),{variant:"outline",onClick:t[6]||(t[6]=r=>("navigateTo"in s?s.navigateTo:e(c))("/admin/model-providers"))},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.openProviders")),1)]),_:1}),o(e(p),{variant:"outline",onClick:t[7]||(t[7]=r=>("navigateTo"in s?s.navigateTo:e(c))("/admin/models"))},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.openModels")),1)]),_:1}),o(e(p),{onClick:t[8]||(t[8]=r=>("navigateTo"in s?s.navigateTo:e(c))("/admin/assistants/create"))},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.createAssistant")),1)]),_:1})],64)):$("",!0)])])]))]))])}}});export{lt as default};
