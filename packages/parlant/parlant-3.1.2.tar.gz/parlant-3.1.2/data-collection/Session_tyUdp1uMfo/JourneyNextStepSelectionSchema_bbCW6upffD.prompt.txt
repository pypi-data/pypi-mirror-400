GENERAL INSTRUCTIONS
    -------------------
    You are an AI agent named Tmp Agent whose role is to engage in multi-turn conversations with customers on behalf of a business.
    Your interactions are structured around predefined "journeys" - systematic processes that guide customer conversations toward specific outcomes.

    ## Journey Structure
    Each journey consists of:
    - **Steps**: Individual actions you must take (e.g., ask a question, provide information, perform a task)
    - **Transitions**: Rules that determine which step comes next based on customer responses or completion status
    - **Flags**: Special properties that modify how steps behave

    ## Your Core Task
    Analyze the current conversation state and determine the next appropriate journey step, by evaluating which condition holds based on the last step that was performed and the current state of the conversation.
    


    TASK DESCRIPTION
    -------------------
    ## 1: Journey Context Check
    Determine if the conversation should continue within the current journey.
    Once a journey has begun, continue following it unless the customer explicitly indicates they no longer want to pursue the journey's original goal.
    **Important**: The activation condition only starts a journey. It does NOT need to remain true for the journey to continue.
    If the journey should end, set `applied_condition_id` to `"None"`.

    ## 2: Current Step Completion
    Evaluate whether the last executed step is complete:
        - For CUSTOMER_DEPENDENT steps: step is completed if customer has provided the required information. It can be either after being asked or proactively in earlier messages.  
        If the customer provided the information, set current_step_completed to 'true'.
        If not, set completed to 'current_step_completed' as 'false' and applied_condition_id as '0'. 

        - For REQUIRES AGENT ACTION steps: step is completed if the agent has performed the required communication or action. If so, set current_step_completed to 'true'. 
        If not, set 'current_step_completed' as 'false' and applied_condition_id as '0'. 

        - For TOOL EXECUTION steps: The tool was executed, and its result will appear as a staged event. Need to evaluate what condition applies for the next transition.
            Note that the tool execution is the final action in the interaction, meaning all message exchanges occurred beforehand. Make sure to consider this order in your evaluation.

    ## 3: Journey Advancement
    If the journey continues AND the current step is complete, choose the next step by evaluating which condition best fits.    
    The condition contains one or more sub-conditions that must all be evaluated and met for the condition to be considered the best match.

    Select the condition ID that best matches:
        - Consider all the condition parts in your evaluation.
        - Only ONE transition condition should be the best fit
        - Return its ID as `applied_condition_id`

    **How to determine if condition / sub condition is fulfilled if the action is CUSTOMER DEPENDENT:**
    The action is fulfilled if the customer has provided the required information. It can be either after being asked or proactively in earlier messages. 
    That means, the agent does not need to ask for something for the action to be fulfilled.
    Note that the customer may provide multiple details at once (in one message), and you should consider all of them to identify the most relevant condition.
    Also, note that the customer may provide some of the answers in previous messages, consider those answers too. 
    The answers may not arrive in the order we expect, and thatâ€™s fine. An answer for a later step may have been provided in earlier messages. As long as we have the required 
    information, the condition is considered met.

   **Handling partial condition matches**
    Conditions may contain multiple sub-conditions (e.g., "customer provided X AND agent did Y AND customer hasn't provided Z")
    If ALL information has been provided (for example also Z) and no condition is fully satisfied, select the condition with the MOST satisfied parts
    This represents the path closest to completion, even if technically the condition isn't met
    - Example: If conditions check for missing data but the customer provided everything at once, choose the condition with the fewest remaining gaps

    Important - You tend to ignore customer actions completions that were provided in previous messages. It's important to notice ALL customer messages
      history in details and evaluate which information was already provided. Please correct yourself in the future.

    You will be given a description of the current step that need to execute, and the conditions of the following transitions later in this prompt.
    


    Examples of Journey Step Selections:
    -------------------
    Example #1: Book Taxi Journey

- **Interaction Events**:
[
  {
    "event_kind": "message",
    "event_source": "ai_agent",
    "data": {
      "message": "Welcome to our taxi service! How can I help you today?"
    }
  },
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "I would like to book a taxi"
    }
  },
  {
    "event_kind": "message",
    "event_source": "ai_agent",
    "data": {
      "message": "From where would you like to request a taxi?"
    }
  },
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "I'd like to book a taxi to JFK Airport at 5 PM, please. I'll pay by cash."
    }
  }
]



Journey: Book Taxi Journey

Journey activation condition: "The customer wants to book a taxi"

CURRENT STEP - 

Ask the customer for their desired pick up location
Step Flags:
- CUSTOMER DEPENDENT: This action requires an action from the customer to be considered complete. It is completed if the following action was completed: "The customer responded regarding their preference between exploring cities and scenic landscapes." 



POSSIBLE TRANSITIONS - 
If the journey is not applicable anymore, return None as next step. 

If the current step hasn't completed, return '0' as the condition id.

In any other case, return next step from the following possible transitions:

Condition (1): The customer's desired pick up location is in NYC and customer hasn't provided their destination location yet

Condition (2): The customer's desired pick up location is outside of NYC and the agent hasn't informed the customer that we do not operate outside of NYC

Condition (3): The customer's desired pick up location is in NYC and they provided their destination location but hasn't provided the pickup time yet

Condition (4): The customer's desired pick up location is in NYC and and they provided their destination location and pickup time but the agent hasn't booked the taxi ride yet

Condition (5): The customer's desired pick up location is in NYC and they provided their destination location and pickup time and the agent booked the taxi ride but the agent hasn't ask the customer if they want to pay in cash or credit



- **Expected Result**:
```json
{
  "journey_continues": true,
  "current_step_completed_rationale": "The customer has NOT provided the pickup location, which is what the current step asks for. The current step is therefore incomplete",
  "current_step_completed": false,
  "next_step_rationale": "Current step hasn't completed so applied condition is '0",
  "applied_condition_id": "0"
}
```

Example #2: Book Taxi Journey

- **Interaction Events**:
[
  {
    "event_kind": "message",
    "event_source": "ai_agent",
    "data": {
      "message": "Welcome to our taxi service! How can I help you today?"
    }
  },
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "I'd like a taxi from 20 W 34th St., NYC at 6 AM, please. I'll pay by cash."
    }
  }
]



Journey: Book Taxi Journey

Journey activation condition: "The customer wants to book a taxi"

CURRENT STEP - 

Welcome the customer to the taxi service
Step Flags:



POSSIBLE TRANSITIONS - 
If the journey is not applicable anymore, return None as next step. 

If the current step hasn't completed, return '0' as the condition id.

In any other case, return next step from the following possible transitions:

Condition (1): The customer did not provided their desired pick up location.

Condition (2): The customer provided their desired pick up location and the location is in NYC, and the customer hasn't provided their destination location yet

Condition (3): The customer provided their desired pick up location and the location is outside of NYC and the agent hasn't informed the customer that we do not operate outside of NYC

Condition (4): The customer provided their desired pick up location which is in NYC and also provided their destination location but hasn't provided the pickup time yet

Condition (5): The customer provided their desired pick up location which is in NYC and also provided their destination location and the pickup time and the agent hasn't booked the taxi ride yet

Condition (6): The customer provided their desired pick up location which is in NYC and also provided their destination location and the pickup time and the agent booked the taxi ride and the agent hasn't ask the customer if they want to pay in cash or credit



- **Expected Result**:
```json
{
  "journey_continues": true,
  "current_step_completed_rationale": "The agent welcomed the customer, so current step completed.",
  "current_step_completed": true,
  "next_step_rationale": "The customer provided a pick up location in NYC and a pick up time, but has not provided a destination, so condition 2 best holds.",
  "applied_condition_id": "2"
}
```

Example #3: Loan Journey

- **Interaction Events**:
[
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "Hello, I'm Helen Jay, I'd like to take a loan for 10,000$ and put stocks as collateral, is that possible?"
    }
  },
  {
    "event_kind": "message",
    "event_source": "ai_agent",
    "data": {
      "message": "Sure, I can help you with that. What type of loan are you interested in?"
    }
  },
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "What do you mean?"
    }
  },
  {
    "event_kind": "message",
    "event_source": "ai_agent",
    "data": {
      "message": "Are you interested in a business or a personal loan?"
    }
  },
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "Does it matter?"
    }
  },
  {
    "event_kind": "message",
    "event_source": "ai_agent",
    "data": {
      "message": "We need to know this information to proceed with the loan application, as the two loan types have different requirements."
    }
  },
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "Ok, let me check for a sec"
    }
  },
  {
    "event_kind": "message",
    "event_source": "ai_agent",
    "data": {
      "message": "Sure, take your time"
    }
  },
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "It's a loan for my restaurant"
    }
  }
]



Journey: Loan Journey

Journey activation condition: "The customer wants a loan"

CURRENT STEP - 

Ask for the type of loan: Personal or Business.
Step Flags:
- CUSTOMER DEPENDENT: This action requires an action from the customer to be considered complete. It is completed if the following action was completed: "the customer specified which type of loan they'd like to take" 



POSSIBLE TRANSITIONS - 
If the journey is not applicable anymore, return None as next step. 

If the current step hasn't completed, return '0' as the condition id.

In any other case, return next step from the following possible transitions:

Condition (1): Customer chose personal loan and the customer has not provided their desired loan amount

Condition (2): Customer chose business loan and the customer has not provided their desired loan amount

Condition (3): Customer chose personal loan and the customer provided their desired loan amount and hasn't provided their employment status

Condition (4): Customer chose business loan and the customer provided their desired loan amount but hasn't provided the collateral

Condition (5): Customer chose personal loan and the customer provided their desired loan amount provided the employment status but agent has not yet confirmed the application

Condition (6): Customer chose business loan and the customer provided their desired loan amount and provided the collateral which is a digital asset but agent has not yet confirmed the application



- **Expected Result**:
```json
{
  "journey_continues": true,
  "current_step_completed_rationale": "The customer wants a loan for their restaurant, making it a business loan. So current step completed",
  "current_step_completed": true,
  "next_step_rationale": "The customer has already specified in previous messages the amount of the loan and stocks as collateral which are digital. The agent hasn't reviewed and confirmed the application so condition 4 is most appropriate",
  "applied_condition_id": "4"
}
```

Example #4: Book Taxi Journey

- **Interaction Events**:
[
  {
    "event_kind": "message",
    "event_source": "ai_agent",
    "data": {
      "message": "Welcome to our taxi service! How can I help you today?"
    }
  },
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "I'd like a taxi from 20 W 34th St., NYC to the Plaza Hotel at 6 AM, please. I'll pay by cash."
    }
  }
]



Journey: Book Taxi Journey

Journey activation condition: "The customer wants to book a taxi"

CURRENT STEP - 

Welcome the customer to the taxi service
Step Flags:



POSSIBLE TRANSITIONS - 
If the journey is not applicable anymore, return None as next step. 

If the current step hasn't completed, return '0' as the condition id.

In any other case, return next step from the following possible transitions:

Condition (1): The customer did not provided their desired pick up location.

Condition (2): The customer provided their desired pick up location and the location is in NYC, and the customer hasn't provided their destination location yet

Condition (3): The customer provided their desired pick up location and the location is outside of NYC and the agent hasn't informed the customer that we do not operate outside of NYC

Condition (4): The customer provided their desired pick up location which is in NYC and also provided their destination location but hasn't provided the pickup time yet



- **Expected Result**:
```json
{
  "journey_continues": true,
  "current_step_completed_rationale": "The agent welcomed the customer, so current step completed.",
  "current_step_completed": true,
  "next_step_rationale": "The customer provided a pick up location in NYC, a destination and also a pick up time. Need to choose the condition that most of it's parts are true, so condition 4 best fits",
  "applied_condition_id": "4"
}
```

Example #5: Loan Journey

- **Interaction Events**:
[
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "Hi, I need a loan. I need 50,000."
    }
  },
  {
    "event_kind": "message",
    "event_source": "ai_agent",
    "data": {
      "message": "I'd be happy to help you with a loan. To get started, what type of loan are you interested in - personal or business?"
    }
  },
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "I'ts for me. I'm unemployed right now so it can help me."
    }
  }
]



Journey: Loan Journey

Journey activation condition: "The customer wants a loan"

CURRENT STEP - 

Ask for the type of loan: Personal or Business.
Step Flags:
- CUSTOMER DEPENDENT: This action requires an action from the customer to be considered complete. It is completed if the following action was completed: "The customer specified if the loan is personal or business" 



POSSIBLE TRANSITIONS - 
If the journey is not applicable anymore, return None as next step. 

If the current step hasn't completed, return '0' as the condition id.

In any other case, return next step from the following possible transitions:

Condition (1): Customer chose personal loan and the customer has not provided their desired loan amount

Condition (2): Customer chose business loan and the customer has not provided their desired loan amount

Condition (3): Customer chose personal loan and the customer provided their desired loan amount and hasn't provided their employment status

Condition (4): Customer chose business loan and the customer provided their desired loan amount but hasn't provided the collateral

Condition (5): Customer chose personal loan and the customer provided their desired loan amount provided the employment status but agent has not yet confirmed the application

Condition (6): Customer chose business loan and the customer provided their desired loan amount and provided the collateral which is a digital asset but agent has not yet confirmed the application



- **Expected Result**:
```json
{
  "journey_continues": true,
  "current_step_completed_rationale": "The customer said the loan is for them because they unemployed, so it's personal loan.",
  "current_step_completed": true,
  "next_step_rationale": "The customer has already mentioned in initial message that they need 50,000, so they provided the amount in earlier messages and it considered complete. Also, they provided the employment status by saying they unemployed. The agent has not confirmed the application so condition 5 fits.",
  "applied_condition_id": "5"
}
```


    ###
    Example section is over. The following is the real data you need to use for your decision.
    


The following is a list of events describing a back-and-forth
interaction between you and a user: ###
['{"event_kind": "message", "event_source": "user", "data": {"participant": "Guest", "message": "Hello, what\'s my account balance?"}}']
###



Here are the most recent staged events for your reference.
They represent interactions with external tools that perform actions or provide information.
Prioritize their data over any other sources and use their details to complete your task: ###
['{"event_kind": "tool", "event_source": "system-provided", "data": {"tool_calls": [{"tool_id": "built-in:check_balance", "arguments": {}, "result": {"balance": 500}}]}}']
###




Journey: Customer greeting journey

Journey activation condition: "Customer arrives"
Journey Description: Greet customers with personalized responses

CURRENT STEP - 

Greet the customer with 'Howdy!'
Step Flags:
- REQUIRES AGENT ACTION: This step may require the agent to say something for it to be completed. Only advance through it if the agent performed the described action.


POSSIBLE TRANSITIONS - 
If the journey is not applicable anymore, return None as next step. 

If the current step hasn't completed, return '0' as the condition id.

In any other case, return next step from the following possible transitions:

Condition (1): The agent greeted him with 'Howdy!'





IMPORTANT: Please provide your answer in the following JSON format.

OUTPUT FORMAT
-----------------
- Fill in the following fields as instructed. Each field is required unless otherwise specified.

```json
{
"journey_continues: <bool, whether the journey should continued. Reminder: If you are already executing journey steps (i.e., there is a "last_step"), the journey almost always continues. The activation condition is ONLY for starting new journeys, NOT for validating ongoing ones.>,
"current_step_completed_rationale": "<str, short explanation of whether current step completed>",
"current_step_completed": <bool, whether the current step completed.>,
"next_step_rationale": "<str, explanation for which condition best fits and why. Consider all the information provided in CURRENT and EARLIER messages>",
"applied_condition_id": "<str, id of the applied condition, '0' if current step hasn't completed or 'None' if the journey should not continue>"
}
```


Reminder - carefully consider all restraints and instructions. You MUST succeed in your task, otherwise you will cause damage to the customer or to the business you represent.