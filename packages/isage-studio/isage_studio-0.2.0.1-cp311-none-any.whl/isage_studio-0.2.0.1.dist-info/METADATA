Metadata-Version: 2.4
Name: isage-studio
Version: 0.2.0.1
Summary: SAGE Studio - Low-Code Web UI for Pipeline Development
Author-email: IntelliStream Team <shuhao_zhang@hust.edu.cn>
License: MIT
Project-URL: Homepage, https://github.com/intellistream/SAGE
Project-URL: Documentation, https://intellistream.github.io/SAGE-Pub/
Project-URL: Repository, https://github.com/intellistream/SAGE.git
Project-URL: Bug Tracker, https://github.com/intellistream/SAGE/issues
Keywords: sage,studio,low-code,web-ui,pipeline,development,intellistream
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: Intended Audience :: System Administrators
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Classifier: Topic :: Scientific/Engineering :: Artificial Intelligence
Classifier: Topic :: System :: Distributed Computing
Classifier: Topic :: Utilities
Requires-Python: >=3.10
Description-Content-Type: text/markdown
Requires-Dist: pydantic[email]<3.0.0,>=2.10.0
Requires-Dist: fastapi<1.0.0,>=0.115.0
Requires-Dist: starlette<0.51,>=0.40
Requires-Dist: uvicorn[standard]<1.0.0,>=0.34.0
Requires-Dist: h11<1.0.0,>=0.16.0
Requires-Dist: websockets>=11.0
Requires-Dist: python-multipart>=0.0.6
Requires-Dist: aiofiles>=23.0.0
Requires-Dist: structlog>=23.0.0
Requires-Dist: pydantic-settings>=2.0.0
Requires-Dist: configparser>=5.3.0
Requires-Dist: httpx<1.0.0,>=0.28.0
Requires-Dist: passlib[argon2]<2.0.0,>=1.7.4
Requires-Dist: python-jose[cryptography]<4.0.0,>=3.5.0
Requires-Dist: jinja2<4.0.0,>=3.1.0
Requires-Dist: markdown<4.0.0,>=3.4.4
Requires-Dist: markupsafe>=2.0.1
Requires-Dist: packaging>=20.5
Provides-Extra: dev
Requires-Dist: pytest>=7.4.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.21.0; extra == "dev"
Requires-Dist: ruff==0.14.6; extra == "dev"
Requires-Dist: mypy>=1.7.0; extra == "dev"
Provides-Extra: all

# SAGE Studio

## ğŸ“‹ Overview

**SAGE Studio** æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ä½ä»£ç  Web UI åŒ…ï¼Œç”¨äºå¯è§†åŒ–å¼€å‘å’Œç®¡ç† SAGE æ•°æ®æµæ°´çº¿ã€‚

> **åŒ…å**: `isage-studio`\
> **æŠ€æœ¯æ ˆ**: React 18 + TypeScript + FastAPI\\

## ğŸ—ï¸ æ¶æ„æ¦‚è¿°

Studio é‡‡ç”¨**å‰åç«¯åˆ†ç¦»**æ¶æ„ï¼Œç›´æ¥æ¥å…¥ SAGE æ ¸å¿ƒå¼•æ“ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯ (React + Vite)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Flow Editor  â”‚  â”‚  Playground  â”‚  â”‚  Properties  â”‚ â”‚
â”‚  â”‚   (ç”»å¸ƒç¼–è¾‘)   â”‚  â”‚  (å¯¹è¯æµ‹è¯•)   â”‚  â”‚  (é…ç½®é¢æ¿)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â¬‡ HTTP/REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               åç«¯ (FastAPI - api.py)                    â”‚
â”‚  â€¢ èŠ‚ç‚¹æ³¨å†Œè¡¨ (Node Registry)                            â”‚
â”‚  â€¢ Pipeline æ„å»ºå™¨ (Pipeline Builder)                    â”‚
â”‚  â€¢ API ç«¯ç‚¹ (flows, operators, execution)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â¬‡ Python API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SAGE æ ¸å¿ƒå¼•æ“                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  sage-kernel (Environment, DataStream API)      â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  sage-middleware (RAG Operators: Generator,     â”‚   â”‚
â”‚  â”‚   Retriever, Reranker, Promptor, Chunker...)    â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  sage-libs (IO: FileSource, PrintSink...)       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®ç»„ä»¶

1. **PipelineBuilder** (`services/pipeline_builder.py`)

   - å°†å¯è§†åŒ– Flow è½¬æ¢ä¸º SAGE DataStream Pipeline
   - æ‹“æ‰‘æ’åºèŠ‚ç‚¹ï¼Œæ„å»ºæ‰§è¡Œå›¾
   - æ˜ å°„èŠ‚ç‚¹åˆ° SAGE Operator ç±»

1. **NodeRegistry** (`services/node_registry.py`)

   - ç®¡ç† UI èŠ‚ç‚¹ç±»å‹ â†’ SAGE Operator çš„æ˜ å°„
   - é¢„æ³¨å†Œæ‰€æœ‰ SAGE ä¸­é—´ä»¶ç®—å­
   - æ”¯æŒè‡ªå®šä¹‰ç®—å­æ‰©å±•

1. **Backend API** (`config/backend/api.py`)

   - FastAPI æœåŠ¡ï¼Œæä¾› RESTful æ¥å£
   - å¤„ç† Flow ä¿å­˜/åŠ è½½ã€æ‰§è¡Œè¯·æ±‚
   - è°ƒç”¨ PipelineBuilder æ„å»ºå¹¶æ‰§è¡Œ SAGE Pipeline

## ğŸš€ Installation

### Environment Requirements

- **Python**: 3.10+ (å¿…éœ€)
- **Node.js**: 18+ (æ¨è LTS)
- **SAGE**: å®Œæ•´å®‰è£… (åŒ…æ‹¬ kernel, middleware, libs)

### å®‰è£… SAGE Studio

```bash
# æ–¹å¼ 1: é€šè¿‡ SAGE å…ƒåŒ…å®‰è£…ï¼ˆæ¨èï¼‰
pip install isage  # è‡ªåŠ¨åŒ…å« isage-studio

# æ–¹å¼ 2: å¼€å‘æ¨¡å¼å®‰è£…
cd packages/sage-studio
pip install -e .

# éªŒè¯å®‰è£…
python -c "from sage.studio.studio_manager import StudioManager; print('âœ“ Studio installed')"
```

## ğŸ“– Quick Start

### ğŸ¯ æ–¹å¼ä¸€ï¼šä½¿ç”¨ SAGE CLIï¼ˆæ¨èï¼‰

```bash
# å¯åŠ¨ Studioï¼ˆå‰ç«¯ + åç«¯ï¼‰
sage studio start

# æˆ–ä½¿ç”¨ç”Ÿäº§æ¨¡å¼ï¼ˆéœ€è¦å…ˆæ„å»ºï¼‰
sage studio start --prod

# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
sage studio status

# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
sage studio open

# æŸ¥çœ‹æ—¥å¿—
sage studio logs          # å‰ç«¯æ—¥å¿—
sage studio logs --backend # åç«¯æ—¥å¿—

# åœæ­¢æœåŠ¡
sage studio stop

# ç®¡ç†å‰ç«¯ä¾èµ–
sage studio npm install    # å®‰è£…/æ›´æ–° npm ä¾èµ–
sage studio npm run lint   # è¿è¡Œå‰ç«¯è„šæœ¬
```

## ğŸ” Authentication & Security

SAGE Studio v2.0 å¼•å…¥äº†å®Œæ•´çš„ç”¨æˆ·è®¤è¯å’Œæ•°æ®éš”ç¦»ç³»ç»Ÿï¼š

### 1. ç”¨æˆ·è®¤è¯

- **æ³¨å†Œ/ç™»å½•**ï¼šé¦–æ¬¡ä½¿ç”¨éœ€æ³¨å†Œè´¦å·ã€‚
- **JWT Token**ï¼šä½¿ç”¨ JWT è¿›è¡Œä¼šè¯ç®¡ç†ï¼ŒToken è‡ªåŠ¨è¿‡æœŸã€‚
- **å®‰å…¨å­˜å‚¨**ï¼šå¯†ç ä½¿ç”¨ Argon2 ç®—æ³•å“ˆå¸Œå­˜å‚¨ã€‚

### 2. æ•°æ®éš”ç¦»

- **å¤šç”¨æˆ·æ”¯æŒ**ï¼šæ¯ä¸ªç”¨æˆ·æ‹¥æœ‰ç‹¬ç«‹çš„å·¥ä½œåŒºã€‚
- **æ•°æ®è·¯å¾„**ï¼šç”¨æˆ·æ•°æ®å­˜å‚¨åœ¨ `~/.local/share/sage/users/{user_id}/`ã€‚
  - `pipelines/`: ä¿å­˜çš„æµæ°´çº¿é…ç½®
  - `sessions/`: èŠå¤©ä¼šè¯è®°å½•
  - `uploads/`: ä¸Šä¼ çš„æ–‡ä»¶
- **éšç§ä¿æŠ¤**ï¼šç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±åˆ›å»ºçš„èµ„æºã€‚

**è®¿é—®åœ°å€**ï¼š

- ğŸŒ å‰ç«¯ï¼šhttp://localhost:5173
- ğŸ”Œ åç«¯ï¼šhttp://localhost:8080

**æ³¨æ„**ï¼šé¦–æ¬¡ä½¿ç”¨æˆ–å¼€å‘è°ƒè¯•æ—¶ï¼Œå»ºè®®ä½¿ç”¨ `--dev` å¼€å‘æ¨¡å¼ï¼Œå¯åŠ¨æ›´å¿«ä¸”æ”¯æŒçƒ­é‡è½½ã€‚

### ğŸ¯ æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨ï¼ˆå¼€å‘è°ƒè¯•ï¼‰

```bash
# ç»ˆç«¯ 1: å¯åŠ¨åç«¯
cd packages/sage-studio
python -m sage.studio.config.backend.api
# åç«¯è¿è¡Œåœ¨: http://localhost:8080

# ç»ˆç«¯ 2: å¯åŠ¨å‰ç«¯
cd packages/sage-studio/src/sage/studio/frontend
sage studio npm install
sage studio npm run dev
# å‰ç«¯è¿è¡Œåœ¨: http://localhost:5173
```

### æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥ç«¯å£
lsof -i :8080  # åç«¯
lsof -i :5173  # å‰ç«¯

# æ£€æŸ¥åç«¯å¥åº·
curl http://localhost:8080/health

# æŸ¥çœ‹æ—¥å¿—
tail -f /tmp/sage-studio-backend.log
tail -f /tmp/sage-studio-frontend.log
```

## ğŸ’¡ ä½¿ç”¨æŒ‡å—

### 1. åˆ›å»º Pipeline

**æ­¥éª¤**:

1. åœ¨æµè§ˆå™¨æ‰“å¼€ http://localhost:5173
1. ä»å·¦ä¾§èŠ‚ç‚¹é¢æ¿æ‹–æ‹½èŠ‚ç‚¹åˆ°ç”»å¸ƒ
1. è¿æ¥èŠ‚ç‚¹åˆ›å»ºæ•°æ®æµ
1. ç‚¹å‡»èŠ‚ç‚¹é…ç½®å‚æ•°ï¼ˆå³ä¾§å±æ€§é¢æ¿ï¼‰
1. ç‚¹å‡»å·¥å…·æ  "ä¿å­˜" æŒ‰é’®

**ç¤ºä¾‹ RAG Pipeline**:

```
FileSource â†’ SimpleRetriever â†’ BGEReranker â†’ QAPromptor â†’ OpenAIGenerator â†’ PrintSink
```

### 2. ä½¿ç”¨ Playground

**Playground** æ˜¯å¯¹è¯å¼æµ‹è¯•ç•Œé¢ï¼Œå¯ä»¥ç›´æ¥ä¸ Pipeline äº¤äº’ã€‚

**æ­¥éª¤**:

1. ä¿å­˜ Flow åï¼Œç‚¹å‡»å·¥å…·æ  "ğŸ’¬ Playground" æŒ‰é’®
1. åœ¨è¾“å…¥æ¡†è¾“å…¥æ¶ˆæ¯ï¼ˆå¦‚æŸ¥è¯¢é—®é¢˜ï¼‰
1. æŒ‰ Enter å‘é€ï¼ˆShift+Enter æ¢è¡Œï¼‰
1. æŸ¥çœ‹ AI å“åº”å’Œæ‰§è¡Œæ­¥éª¤

**ç‰¹æ€§**:

- âœ… å®æ—¶æ‰§è¡Œ Pipeline
- âœ… æ˜¾ç¤º Agent æ­¥éª¤ï¼ˆæ¯ä¸ªèŠ‚ç‚¹çš„æ‰§è¡Œè¿‡ç¨‹ï¼‰
- âœ… ä»£ç ç”Ÿæˆï¼ˆPython / cURLï¼‰
- âœ… ä¼šè¯ç®¡ç†ï¼ˆå¤šè½®å¯¹è¯ï¼‰

### 3. æ ¸å¿ƒåŠŸèƒ½

#### ç”»å¸ƒç¼–è¾‘

- ğŸ¨ æ‹–æ”¾èŠ‚ç‚¹åˆ°ç”»å¸ƒ
- ğŸ”— è¿æ¥èŠ‚ç‚¹åˆ›å»ºæ•°æ®æµ
- âš™ï¸ åŠ¨æ€é…ç½®èŠ‚ç‚¹å‚æ•°
- ğŸ” ç”»å¸ƒç¼©æ”¾å’Œå¯¼èˆª

#### æµç¨‹ç®¡ç†

- ğŸ’¾ ä¿å­˜/åŠ è½½æµç¨‹
- ğŸ“‹ æµç¨‹åˆ—è¡¨æŸ¥çœ‹
- ğŸ—‘ï¸ åˆ é™¤æµç¨‹
- ğŸ“¤ å¯¼å‡ºæµç¨‹ä¸º JSON æ–‡ä»¶
- ğŸ“¥ å¯¼å…¥æµç¨‹é…ç½®

#### MVP å¢å¼ºåŠŸèƒ½ âœ¨ (v0.2.0-alpha)

**1. èŠ‚ç‚¹è¾“å‡ºé¢„è§ˆ**

- å®æ—¶æŸ¥çœ‹èŠ‚ç‚¹æ‰§è¡Œè¾“å‡º
- æ”¯æŒ JSON æ ¼å¼åŒ–æ˜¾ç¤º
- æ”¯æŒåŸå§‹æ•°æ®å’Œé”™è¯¯ä¿¡æ¯æŸ¥çœ‹
- ä½¿ç”¨æ–¹æ³•ï¼šé€‰æ‹©èŠ‚ç‚¹ â†’ å³ä¾§å±æ€§é¢æ¿ â†’ "è¾“å‡ºé¢„è§ˆ" æ ‡ç­¾

**2. æµç¨‹å¯¼å…¥/å¯¼å‡º**

- å¯¼å‡ºå®Œæ•´æµç¨‹é…ç½®ä¸º JSON
- ä»æ–‡ä»¶å¯¼å…¥æµç¨‹
- æ”¯æŒæµç¨‹åˆ†äº«å’Œå¤‡ä»½
- ä½¿ç”¨æ–¹æ³•ï¼šå·¥å…·æ  â†’ "å¯¼å‡º" / "å¯¼å…¥" æŒ‰é’®

**3. ç¯å¢ƒå˜é‡ç®¡ç†**

- å›¾å½¢åŒ–ç®¡ç† API å¯†é’¥ç­‰é…ç½®
- å¯†ç å­—æ®µå®‰å…¨è¾“å…¥
- æ”¯æŒå¢é‡æ›´æ–°
- ä½¿ç”¨æ–¹æ³•ï¼šå·¥å…·æ  â†’ "è®¾ç½®" æŒ‰é’®ï¼ˆé½¿è½®å›¾æ ‡ï¼‰

**4. å®æ—¶æ—¥å¿—æŸ¥çœ‹å™¨**

- ç»ˆç«¯é£æ ¼çš„æ—¥å¿—æ˜¾ç¤º
- æŒ‰èŠ‚ç‚¹/çº§åˆ«è¿‡æ»¤
- è‡ªåŠ¨æ»šåŠ¨å’Œå¯¼å‡ºåŠŸèƒ½
- ä½¿ç”¨æ–¹æ³•ï¼šåº•éƒ¨çŠ¶æ€æ  â†’ "æ˜¾ç¤ºæ—¥å¿—" æŒ‰é’®

ğŸ“– **è¯¦ç»†æ–‡æ¡£**: æŸ¥çœ‹ [MVP_ENHANCEMENT.md](./MVP_ENHANCEMENT.md) äº†è§£å®Œæ•´åŠŸèƒ½è¯´æ˜

#### å¿«æ·é”®

- `Ctrl+S`: ä¿å­˜æµç¨‹
- `Ctrl+Z`: æ’¤é”€
- `Ctrl+Shift+Z` / `Ctrl+Y`: é‡åš
- `Delete`: åˆ é™¤é€‰ä¸­èŠ‚ç‚¹
- `Escape`: å–æ¶ˆé€‰æ‹©

### 4. å‰ç«¯å¼€å‘

```bash
cd src/sage/studio/frontend

# å¼€å‘æ¨¡å¼
sage studio npm run dev          # å¯åŠ¨ Vite dev server (localhost:5173)

# ç”Ÿäº§æ„å»º
sage studio npm run build        # æ„å»ºåˆ° dist/
sage studio npm run preview      # é¢„è§ˆæ„å»ºç»“æœ

# ä»£ç è´¨é‡
sage studio npm run lint         # ESLint æ£€æŸ¥
sage studio npm run format       # Prettier æ ¼å¼åŒ–
```

### 5. åç«¯å¼€å‘

```bash
cd packages/sage-studio

# ç›´æ¥è¿è¡Œ
python -m sage.studio.config.backend.api

# éªŒè¯è¿è¡Œ
curl http://localhost:8080/health

# æŸ¥çœ‹ API æ–‡æ¡£
open http://localhost:8080/docs  # Swagger UI
```

## ğŸ“‚ ç›®å½•ç»“æ„

```
sage-studio/
â”œâ”€â”€ README.md                      # æœ¬æ–‡ä»¶ â­
â”œâ”€â”€ pyproject.toml                # åŒ…é…ç½®å’Œä¾èµ–
â”‚
â”œâ”€â”€ src/sage/studio/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ studio_manager.py         # Studio ç®¡ç†å™¨ â­
â”‚   â”‚
â”‚   â”œâ”€â”€ config/backend/
â”‚   â”‚   â””â”€â”€ api.py                # FastAPI åç«¯ â­
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                 # æ ¸å¿ƒæœåŠ¡ â­
â”‚   â”‚   â”œâ”€â”€ node_registry.py      # èŠ‚ç‚¹æ³¨å†Œè¡¨ (UI â†’ SAGE Operator æ˜ å°„)
â”‚   â”‚   â””â”€â”€ pipeline_builder.py  # Pipeline æ„å»ºå™¨ (è½¬æ¢ä¸º SAGE DataStream)
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                   # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ __init__.py           # VisualPipeline, VisualNode, VisualConnection
â”‚   â”‚
â”‚   â”œâ”€â”€ data/operators/           # èŠ‚ç‚¹å®šä¹‰ JSON æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ FileSource.json
â”‚   â”‚   â”œâ”€â”€ SimpleRetriever.json
â”‚   â”‚   â”œâ”€â”€ OpenAIGenerator.json
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ frontend/                 # React å‰ç«¯ â­
â”‚       â”œâ”€â”€ package.json          # å‰ç«¯ä¾èµ–
â”‚       â”œâ”€â”€ vite.config.ts        # Vite é…ç½®
â”‚       â”œâ”€â”€ tsconfig.json         # TypeScript é…ç½®
â”‚       â””â”€â”€ src/
â”‚           â”œâ”€â”€ App.tsx           # ä¸»åº”ç”¨ç»„ä»¶
â”‚           â”œâ”€â”€ components/       # React ç»„ä»¶
â”‚           â”‚   â”œâ”€â”€ FlowEditor.tsx      # React Flow ç”»å¸ƒ
â”‚           â”‚   â”œâ”€â”€ Toolbar.tsx         # å·¥å…·æ  (ä¿å­˜/åŠ è½½/è¿è¡Œ)
â”‚           â”‚   â”œâ”€â”€ NodePalette.tsx     # èŠ‚ç‚¹é¢æ¿
â”‚           â”‚   â”œâ”€â”€ PropertiesPanel.tsx # å±æ€§é…ç½®
â”‚           â”‚   â””â”€â”€ Playground.tsx      # Playground å¯¹è¯ç•Œé¢
â”‚           â”œâ”€â”€ store/            # Zustand çŠ¶æ€ç®¡ç†
â”‚           â”‚   â”œâ”€â”€ flowStore.ts        # Flow ç¼–è¾‘çŠ¶æ€
â”‚           â”‚   â””â”€â”€ playgroundStore.ts  # Playground çŠ¶æ€
â”‚           â”œâ”€â”€ hooks/            # è‡ªå®šä¹‰ Hooks
â”‚           â”‚   â”œâ”€â”€ useJobStatusPolling.ts
â”‚           â”‚   â””â”€â”€ useKeyboardShortcuts.ts
â”‚           â””â”€â”€ services/         # API å®¢æˆ·ç«¯
â”‚               â””â”€â”€ api.ts        # åç«¯ API å°è£…
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ test_node_registry.py     # èŠ‚ç‚¹æ³¨å†Œè¡¨æµ‹è¯•
    â”œâ”€â”€ test_pipeline_builder.py  # Pipeline æ„å»ºå™¨æµ‹è¯•
    â””â”€â”€ test_studio_cli.py        # CLI å‘½ä»¤æµ‹è¯•
```

## ğŸ”§ å·¥ä½œåŸç†

### ä»å¯è§†åŒ–åˆ°æ‰§è¡Œ

```
1ï¸âƒ£ ç”¨æˆ·åœ¨ UI ä¸­åˆ›å»º Flow
   â””â”€> VisualPipeline (nodes + connections)

2ï¸âƒ£ ä¿å­˜ Flow
   â””â”€> åºåˆ—åŒ–ä¸º JSON â†’ .sage/pipelines/pipeline_xxx.json

3ï¸âƒ£ ç‚¹å‡» "æ‰§è¡Œ" / Playground å‘é€æ¶ˆæ¯
   â””â”€> POST /api/playground/execute
       â”‚
       â”œâ”€> åŠ è½½ Flow JSON
       â”‚
       â”œâ”€> PipelineBuilder.build(visual_pipeline)
       â”‚   â”œâ”€> æ‹“æ‰‘æ’åºèŠ‚ç‚¹ï¼ˆç¡®å®šæ‰§è¡Œé¡ºåºï¼‰
       â”‚   â”œâ”€> NodeRegistry æŸ¥æ‰¾ Operator ç±»
       â”‚   â””â”€> ä½¿ç”¨ SAGE DataStream API æ„å»º Pipeline:
       â”‚       env.from_source(...)
       â”‚          .map(Retriever, ...)
       â”‚          .map(Reranker, ...)
       â”‚          .map(Promptor, ...)
       â”‚          .map(Generator, ...)
       â”‚          .sink(PrintSink)
       â”‚
       â””â”€> env.execute() â†’ SAGE å¼•æ“æ‰§è¡Œ
           â””â”€> è¿”å›ç»“æœç»™å‰ç«¯
```

### æ ¸å¿ƒæœåŠ¡è¯¦è§£

#### 1. NodeRegistryï¼ˆèŠ‚ç‚¹æ³¨å†Œè¡¨ï¼‰

**èŒè´£**: ç®¡ç† UI èŠ‚ç‚¹ç±»å‹ â†’ SAGE Operator ç±»çš„æ˜ å°„

**ç¤ºä¾‹æ˜ å°„**:

```python
{
    "generator": OpenAIGenerator,      # sage-middleware
    "retriever": ChromaRetriever,      # sage-middleware
    "reranker": BGEReranker,          # sage-middleware
    "promptor": QAPromptor,           # sage-middleware
    "chunker": CharacterSplitter,     # sage-libs
    "evaluator": F1Evaluate,          # sage-middleware
}
```

**æ‰©å±•æ–¹å¼**:

```python
from sage.studio.services import get_node_registry

registry = get_node_registry()
registry.register("my_custom_op", MyCustomOperator)
```

#### 2. PipelineBuilderï¼ˆPipeline æ„å»ºå™¨ï¼‰

**èŒè´£**: å°† VisualPipeline è½¬æ¢ä¸ºå¯æ‰§è¡Œçš„ SAGE Pipeline

**å…³é”®æ­¥éª¤**:

1. **éªŒè¯**: æ£€æŸ¥èŠ‚ç‚¹ç±»å‹æ˜¯å¦å·²æ³¨å†Œã€è¿æ¥æ˜¯å¦æœ‰æ•ˆ
1. **æ‹“æ‰‘æ’åº**: ä½¿ç”¨ Kahn ç®—æ³•ç¡®å®šæ‰§è¡Œé¡ºåºï¼Œæ£€æµ‹å¾ªç¯ä¾èµ–
1. **æ„å»º DataStream**:
   ```python
   env = LocalEnvironment()
   stream = env.from_source(FileSource, "data.txt")
   stream = stream.map(Retriever, config={...})
   stream = stream.map(Generator, config={...})
   stream.sink(PrintSink)
   ```
1. **è¿”å› Environment**: è°ƒç”¨æ–¹æ‰§è¡Œ `env.execute()`

#### 3. Backend APIï¼ˆFastAPI æœåŠ¡ï¼‰

**ä¸»è¦ç«¯ç‚¹**:

- `GET /api/operators`: è·å–æ‰€æœ‰å¯ç”¨èŠ‚ç‚¹ç±»å‹
- `POST /api/pipeline/submit`: ä¿å­˜ Flow
- `GET /api/jobs/all`: è·å–æ‰€æœ‰ Pipelineï¼ˆåŒ…æ‹¬å·²ä¿å­˜çš„ Flowï¼‰
- `POST /api/playground/execute`: æ‰§è¡Œ Playground å¯¹è¯
- `GET /api/signal/status/{job_id}`: æŸ¥è¯¢æ‰§è¡ŒçŠ¶æ€

**æ•°æ®å­˜å‚¨**:

- `.sage/pipelines/`: Flow JSON æ–‡ä»¶
- `.sage/states/`: è¿è¡Œæ—¶çŠ¶æ€
- `.sage/configs/`: Pipeline é…ç½®

### æŠ€æœ¯æ ˆ

#### å‰ç«¯

```
React 18.2 + TypeScript 5.2
â”œâ”€â”€ React Flow 11.10.4      # å¯è§†åŒ–å›¾ç¼–è¾‘å™¨
â”œâ”€â”€ Ant Design 5.12         # UI ç»„ä»¶åº“
â”œâ”€â”€ Zustand 4.4.7           # çŠ¶æ€ç®¡ç†
â”œâ”€â”€ Axios 1.6.2             # HTTP å®¢æˆ·ç«¯
â””â”€â”€ Vite 5.0.8              # æ„å»ºå·¥å…·
```

#### åç«¯

```
FastAPI + Python 3.10+
â”œâ”€â”€ Pydantic 2.0            # æ•°æ®éªŒè¯
â”œâ”€â”€ Uvicorn                 # ASGI æœåŠ¡å™¨
â”œâ”€â”€ sage-kernel             # Environment, DataStream API
â”œâ”€â”€ sage-middleware         # RAG Operators
â””â”€â”€ sage-libs               # IO: Source, Sink
```

### æ•°æ®æµ

```
å‰ç«¯ (localhost:5173)
    â†“ HTTP REST
åç«¯ API (localhost:8080)
    â†“ Python API
SAGE å¼•æ“
    â”œâ”€> sage-kernel (æ‰§è¡Œå¼•æ“)
    â”œâ”€> sage-middleware (ç®—å­åº“)
    â””â”€> sage-libs (IO å·¥å…·)
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ è‡ªå®šä¹‰èŠ‚ç‚¹

**æ­¥éª¤ 1**: å®ç° SAGE Operator

```python
# my_custom_package/my_operator.py
from sage.common.core import MapOperator

class MyCustomOperator(MapOperator):
    """è‡ªå®šä¹‰ç®—å­"""

    def __init__(self, config: dict):
        super().__init__(config)
        self.param = config.get("param", "default")

    def execute(self, data):
        # å®ç°ç®—å­é€»è¾‘
        result = self.process(data)
        return result
```

**æ­¥éª¤ 2**: æ³¨å†Œåˆ° NodeRegistry

```python
# åœ¨ node_registry.py ä¸­æ·»åŠ 
from my_custom_package.my_operator import MyCustomOperator

def _register_default_operators(self):
    # ...ç°æœ‰æ³¨å†Œ...

    # è‡ªå®šä¹‰ç®—å­
    self._registry["my_custom"] = MyCustomOperator
```

**æ­¥éª¤ 3**: åˆ›å»ºèŠ‚ç‚¹å®šä¹‰ JSON

```json
// data/operators/MyCustomOperator.json
{
    "id": 999,
    "name": "MyCustomOperator",
    "description": "æˆ‘çš„è‡ªå®šä¹‰ç®—å­",
    "module_path": "my_custom_package.my_operator",
    "class_name": "MyCustomOperator",
    "isCustom": true
}
```

**æ­¥éª¤ 4**: é‡å¯ Studio

```bash
sage studio stop
sage studio start
```

ç°åœ¨å¯ä»¥åœ¨ UI ä¸­ä½¿ç”¨æ–°èŠ‚ç‚¹äº†ï¼

### æ‰©å±•æ•°æ®æº

æ”¯æŒçš„æ•°æ®æºç±»å‹ï¼ˆåœ¨ `PipelineBuilder._create_source` ä¸­ï¼‰:

- `file`: é€šç”¨æ–‡ä»¶æº
- `json_file`: JSON æ–‡ä»¶
- `csv_file`: CSV æ–‡ä»¶
- `text_file`: æ–‡æœ¬æ–‡ä»¶
- `socket`: ç½‘ç»œ socket
- `kafka`: Kafka topic
- `database`: æ•°æ®åº“æŸ¥è¯¢
- `api`: HTTP API

**æ·»åŠ æ–°æ•°æ®æº**:

```python
# åœ¨ pipeline_builder.py çš„ _create_source ä¸­æ·»åŠ 
elif source_type == "my_source":
    # è‡ªå®šä¹‰å‚æ•°
    param1 = node.config.get("param1")
    param2 = node.config.get("param2")
    return MyCustomSource, (param1, param2), {}
```

### è°ƒè¯•æŠ€å·§

```bash
# 1. æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :5173  # å‰ç«¯
lsof -i :8080  # åç«¯

# 2. æŸ¥çœ‹æ—¥å¿—
sage studio logs          # å‰ç«¯æ—¥å¿—
sage studio logs --backend # åç«¯æ—¥å¿—

# æˆ–ç›´æ¥æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
tail -f ~/.sage/studio_backend.log
tail -f ~/.sage/studio.log

# 3. æµ‹è¯•åç«¯ API
curl http://localhost:8080/health
curl http://localhost:8080/api/operators

# 4. æ¸…ç†ç¼“å­˜
rm -rf ~/.sage/studio/node_modules
rm -rf ~/.sage/studio/.vite
rm -rf ~/.sage/pipelines/*
rm -rf ~/.sage/states/*

# 5. é‡æ–°å®‰è£…ä¾èµ–
cd src/sage/studio/frontend
rm -rf node_modules package-lock.json
sage studio npm install

# 6. Python è°ƒè¯•
python -m pdb -m sage.studio.config.backend.api

# 7. æŸ¥çœ‹ SAGE Pipeline æ„å»ºè¿‡ç¨‹
# åœ¨ api.py ä¸­æ·»åŠ  print è¯­å¥
print(f"Building pipeline: {visual_pipeline}")
```

### å•å…ƒæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cd packages/sage-studio
pytest tests/

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_node_registry.py
pytest tests/test_pipeline_builder.py

# å¸¦è¦†ç›–ç‡
pytest --cov=src/sage/studio tests/
```

### ä»£ç è´¨é‡

```bash
# Python ä»£ç æ ¼å¼åŒ–
cd packages/sage-studio
black src/
isort src/

# ç±»å‹æ£€æŸ¥
mypy src/

# Linting
ruff check src/

# å‰ç«¯ä»£ç æ ¼å¼åŒ–
cd src/sage/studio/frontend
sage studio npm run format
sage studio npm run lint
```

## ğŸ“‹ ä¾èµ–å…³ç³»

### Python ä¾èµ–

**SAGE æ ¸å¿ƒç»„ä»¶** (å¿…éœ€):

- `isage-kernel>=0.1.0` - æ‰§è¡Œå¼•æ“ (Environment, DataStream API)
- `isage-middleware>=0.1.0` - RAG ç®—å­åº“ (Generator, Retriever, Reranker...)
- `isage-libs>=0.1.0` - IO å·¥å…· (FileSource, PrintSink...)
- `isage-common>=0.1.0` - é€šç”¨ç»„ä»¶

**Web æ¡†æ¶**:

- `fastapi>=0.115,<0.116` - REST API æ¡†æ¶
- `uvicorn[standard]>=0.34.0` - ASGI æœåŠ¡å™¨
- `pydantic>=2.0.0` - æ•°æ®éªŒè¯

**å·¥å…·åº“**:

- `psutil` - è¿›ç¨‹ç®¡ç† (StudioManager)
- `requests` - HTTP å®¢æˆ·ç«¯
- `rich` - ç»ˆç«¯ UI

### å‰ç«¯ä¾èµ–

**æ ¸å¿ƒæ¡†æ¶**:

- `react@^18.2.0` - UI æ¡†æ¶
- `react-dom@^18.2.0` - DOM æ¸²æŸ“
- `typescript@^5.2.2` - ç±»å‹ç³»ç»Ÿ

**UI ç»„ä»¶**:

- `reactflow@^11.10.4` - æµç¨‹å›¾ç¼–è¾‘å™¨
- `antd@^5.12.0` - Ant Design ç»„ä»¶åº“
- `lucide-react@^0.294.0` - å›¾æ ‡åº“

**çŠ¶æ€ç®¡ç†**:

- `zustand@^4.4.7` - è½»é‡çº§çŠ¶æ€ç®¡ç†

**æ„å»ºå·¥å…·**:

- `vite@^5.0.8` - å¼€å‘æœåŠ¡å™¨å’Œæ„å»ºå·¥å…·
- `@vitejs/plugin-react@^4.2.1` - React æ’ä»¶

å®Œæ•´ä¾èµ–åˆ—è¡¨è§ `pyproject.toml` å’Œ `frontend/package.json`ã€‚

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. åç«¯æ— å“åº”

```bash
# æ£€æŸ¥è¿›ç¨‹
ps aux | grep "sage.studio.config.backend.api"

# æ£€æŸ¥ç«¯å£
lsof -i :8080

# æŸ¥çœ‹æ—¥å¿—
tail -f /tmp/sage-studio-backend.log

# é‡å¯åç«¯
kill -9 <PID>
python -m sage.studio.config.backend.api &
```

**å¯èƒ½åŸå› **:

- âŒ SAGE åŒ…æœªæ­£ç¡®å®‰è£… â†’ `pip install -e packages/sage-kernel packages/sage-middleware packages/sage-libs`
- âŒ ç¼ºå°‘ä¾èµ– â†’ `pip install -e packages/sage-studio`
- âŒ ç«¯å£è¢«å ç”¨ â†’ `lsof -i :8080` æŸ¥çœ‹å ç”¨è¿›ç¨‹

#### 2. å‰ç«¯ç¼–è¯‘/å¯åŠ¨é”™è¯¯

```bash
cd src/sage/studio/frontend

# æ¸…ç†ç¼“å­˜
rm -rf node_modules package-lock.json .vite

# é‡æ–°å®‰è£…
sage studio npm install

# å¯åŠ¨
sage studio npm run dev
```

**å¯èƒ½åŸå› **:

- âŒ Node.js ç‰ˆæœ¬è¿‡ä½ â†’ éœ€è¦ 18+
- âŒ npm ä¾èµ–æŸå â†’ åˆ é™¤ `node_modules` é‡æ–°å®‰è£…
- âŒ ç«¯å£è¢«å ç”¨ â†’ Vite ä¼šè‡ªåŠ¨å°è¯• 5174, 5175...

#### 3. Pipeline æ‰§è¡Œå¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
tail -f /tmp/sage-studio-backend.log

# æ£€æŸ¥ SAGE å®‰è£…
python -c "from sage.kernel.api import LocalEnvironment; print('âœ“ kernel OK')"
python -c "from sage.middleware.rag import OpenAIGenerator; print('âœ“ middleware OK')"
python -c "from sage.libs.io.source import FileSource; print('âœ“ libs OK')"
```

**å¯èƒ½åŸå› **:

- âŒ èŠ‚ç‚¹ç±»å‹æœªæ³¨å†Œ â†’ æ£€æŸ¥ `node_registry.py`
- âŒ èŠ‚ç‚¹é…ç½®é”™è¯¯ â†’ æ£€æŸ¥èŠ‚ç‚¹å‚æ•°æ˜¯å¦æ­£ç¡®
- âŒ SAGE Operator å¯¼å…¥å¤±è´¥ â†’ æ£€æŸ¥åŒ…å®‰è£…

#### 4. Playground æ— å“åº”

```bash
# æ£€æŸ¥ Flow æ˜¯å¦ä¿å­˜
ls ~/.sage/pipelines/

# æ£€æŸ¥åç«¯ API
curl -X POST http://localhost:8080/api/playground/execute \
  -H "Content-Type: application/json" \
  -d '{"flowId": "pipeline_xxx", "input": "test", "sessionId": "test"}'
```

**å¯èƒ½åŸå› **:

- âŒ Flow æœªä¿å­˜ â†’ å…ˆä¿å­˜ Flow
- âŒ åç«¯æœªå¯åŠ¨ â†’ æ£€æŸ¥ `lsof -i :8080`
- âŒ ç½‘ç»œè¯·æ±‚å¤±è´¥ â†’ æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°

#### 5. ç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹å ç”¨
lsof -i :5173  # å‰ç«¯
lsof -i :8080  # åç«¯

# æ€æ­»è¿›ç¨‹
kill -9 $(lsof -t -i:5173)
kill -9 $(lsof -t -i:8080)

# æˆ–ä½¿ç”¨ SAGE CLI
sage studio stop
sage studio start --dev
```

#### 6. ç¯å¢ƒé—®é¢˜

```bash
# æ£€æŸ¥ Python ç‰ˆæœ¬
python --version  # éœ€è¦ 3.10+

# æ£€æŸ¥ SAGE å®‰è£…
pip list | grep isage

# æ£€æŸ¥ Node.js ç‰ˆæœ¬
node --version  # éœ€è¦ 18+
npm --version

# æ£€æŸ¥å·¥ä½œç›®å½•
pwd  # åº”è¯¥åœ¨ SAGE é¡¹ç›®æ ¹ç›®å½•æˆ– sage-studio ç›®å½•
```

### å®Œå…¨é‡ç½®

å¦‚æœé—®é¢˜æŒç»­ï¼Œå°è¯•å®Œå…¨é‡ç½®ï¼š

```bash
# 1. åœæ­¢æ‰€æœ‰æœåŠ¡
sage studio stop
kill -9 $(lsof -t -i:8080)
kill -9 $(lsof -t -i:5173)

# 2. æ¸…ç†ç¼“å­˜
rm -rf ~/.sage/studio/
rm -rf ~/.sage/cache/
rm -rf /tmp/sage-studio-*.log

# 3. é‡æ–°å®‰è£…å‰ç«¯ä¾èµ–
cd packages/sage-studio/src/sage/studio/frontend
rm -rf node_modules package-lock.json .vite
sage studio npm install

# 4. é‡æ–°å®‰è£… Python åŒ…
cd packages/sage-studio
pip install -e .

# 5. é‡æ–°å¯åŠ¨
sage studio start --dev
```

## ğŸ“„ License

MIT License - see [LICENSE](../../LICENSE) for details.
