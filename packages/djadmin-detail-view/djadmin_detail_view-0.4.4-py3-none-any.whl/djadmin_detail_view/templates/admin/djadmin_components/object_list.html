{% load static djadmin_tags %}

{% if object_list|is_lazy_fragment %}
  {% if object_list.is_disabled_warning %}
    {# LazyFragment instantiated but DJADMIN_LAZY_LOADING_ENABLED=False - show warning #}
    <div class="card mb-5">
      <div class="card-header">{{ object_list.panel_name }}</div>
      <div class="card-body">
        <div class="alert alert-warning mb-0">
          <strong>Lazy loading disabled:</strong> Panel "{{ object_list.panel_name }}" (key: {{ object_list.lazy_key }})
          was set up for lazy loading but DJADMIN_LAZY_LOADING_ENABLED=False.
          The code is directly instantiating LazyFragment instead of using table_for()/details_table_for().
        </div>
      </div>
    </div>
  {% else %}
    {# Render lazy loading placeholder with persistent outer wrapper #}
    {% get_lazy_url object object_list as lazy_url %}
    <div data-controller="lazy-panel"
         data-lazy-panel-url-value="{{ lazy_url }}">
      <div data-lazy-panel-target="content">
        <div class="card mb-5">
          <div class="card-header">{{ object_list.panel_name }}</div>
          <div class="card-body text-center py-5" data-lazy-panel-target="body">
            <div data-lazy-panel-target="spinner">
              <div class="spinner-border text-secondary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <p class="mt-2 text-muted mb-0">{{ object_list.placeholder }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
{% else %}
  <div class="card mb-5 object-list">
    <div class="card-header">
      {{ object_list.panel_name }}
      <small>
        {% if object_list.obj_set_limit %}
          <span>({{ object_list.rows|length }} of {{ object_list.obj_set.count|default:object_list.count }})</span>
        {% endif %}
      </small>
      <div class="float-end small">
        {% if object_list.view_all_url %}<a href="{{ object_list.view_all_url }}">View All</a>{% endif %}
      </div>
    </div>
    <table class="table table-striped table-borderless mb-0">
      <thead>
        {% for col in object_list.cols %}<th>{{ col.display_name }}</th>{% endfor %}
        {% if row.actions or object_list.allow_edit %}<th>{{ _("Actions") }}</th>{% endif %}
      </thead>
      <tbody>
        {% for row in object_list.rows %}
          <tr>
            {% for obj_detail in row.obj_details %}
              <td>
                {% is_file_field obj_detail.value_out as field_is_file %}
                {% is_link_field obj_detail.value_out as field_is_link %}
                {% if field_is_file %}
                  {% if obj_detail.value_out %}
                    <a href="{{ obj_detail.value_out.url }}">{{ obj_detail.value_out }}</a>
                  {% else %}
                    -
                  {% endif %}
                {% elif field_is_link %}
                  <a href="{{ obj_detail.value_out }}">{{ obj_detail.value_out }}</a>
                {% else %}
                  {{ obj_detail.value_out }}
                {% endif %}
              </td>
            {% endfor %}
            <td>
              {% if row.actions %}
                {% for action in row.actions %}{{ action }}{% endfor %}
              {% endif %}
              {% if object_list.allow_edit %}
                <a href="{% admin_change_path row.obj %}" class="ms-2">{{ _("Edit") }}</a>
              {% endif %}
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="{% if row.actions or object_list.allow_edit %}{{ object_list.cols|length|add:1 }}{% else %}{{ object_list.cols|length }}{% endif %}"
                class="text-center text-muted">No records found.</td>
          </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        {% if object_list.add_url %}
          <tr>
            <td>
              <a class="btn btn-primary btn-sm" href="{{ object_list.add_url }}">{{ object_list.add_label|default:_("Add") }}</a>
            </td>
          </tr>
        {% endif %}
        {% if object_list.view_all_footer_url %}
          <tr>
            <td>
              <a class="btn btn-primary btn-sm"
                 href="{{ object_list.view_all_footer_url }}">{{ _("View All") }}</a>
            </td>
          </tr>
        {% endif %}
      </tfoot>
    </table>
  </div>
{% endif %}
