var P=Object.defineProperty;var v=(o,r,t)=>r in o?P(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t;var h=(o,r,t)=>(v(o,typeof r!="symbol"?r+"":r,t),t);import{r as g,ao as C,l as u,j as s,g as b,F as x,R as w,C as f,B as N,p as R,y as E}from"./index-4cf586ed.js";import{H as I}from"./H5WebCurvePlot-acd3b964.js";class $ extends g.Component{constructor(t){super(t);h(this,"point");h(this,"max");h(this,"lastScanId");h(this,"onChangePoint",t=>{const e=Number(t.target.value);e<this.max&&this.props.actions.selectPoint(e)});h(this,"clearSelection",()=>{this.props.actions.clearPoint()});this.point=g.createRef(),this.max=0}componentDidUpdate(t){const{currentPoint:e}=this.props,{scanid:n,npoints_avail:a}=this.data();if(!n)return;const c=this.lastScanId!==n;this.lastScanId=n;const i=this.max!==a;this.max=a;const l=e??this.max-1;this.point.current&&(this.point.current.value=`${l}`),l!==-1&&(t.currentPoint!==e&&e!==null&&e!==void 0&&this.fetchScanSpectra(e),e===null&&(c||i||t.currentPoint!==null)&&this.fetchScanSpectra(l))}data(){return this.props.data[this.selectedScan()]||{}}selectedScan(){return this.props.selectedScan?this.props.selectedScan:C(this.props.scans)||0}async fetchScanSpectra(t){if(this.data().scanid&&!(t<0&&this.props.currentPoint&&this.props.currentPoint<0)&&!this.props.fetching)try{await this.props.actions.fetchScanSpectra({scanid:this.selectedScan(),point:t})}catch(e){console.log("Couldn't load scan spectra",e)}}generateXData(t,e){const{conversion:n}=e;return n?u.range(t.length).map(a=>a*n.scale+n.zero):u.range(t.length)}generateSeries(t,e,n=void 0){if(!t)return;const[a]=t.data;return a?{x:[...n?e.data[n].data[0]:this.generateXData(a,e)],y:[...a],type:"scattergl",name:t.name}:void 0}render(){if(Object.keys(this.props.spectra).length===0)return s.jsx("span",{children:"Waiting for scan spectra"});const{selectable:t=!0,options:e={},spectra:n}=this.props,{backend:a="h5web",preSelectedXAxis:c,preSelectedSeries:i,plotTitle:l,insetLegend:j}=e,p=[];return i?(Array.isArray(i)?i:[i]).forEach(d=>{const y=n.data[d],S=this.generateSeries(y,n,c);S&&p.push(S)}):u.each(n.data,m=>{const d=this.generateSeries(m,n);d&&p.push(d)}),s.jsxs("div",{className:"plot1d-container",children:[t&&s.jsx(b,{children:s.jsxs(x.Group,{as:w,children:[s.jsx(x.Label,{column:!0,sm:3,children:"Point"}),s.jsx(f,{children:s.jsx(x.Control,{type:"number",ref:this.point,onChange:this.onChangePoint,min:"0",max:this.max})}),this.props.currentPoint!==null&&s.jsx(f,{xs:2,children:s.jsx(N,{onClick:this.clearSelection,children:"Follow"})}),this.props.fetching&&s.jsx(f,{xs:1,children:s.jsx("div",{className:"my-auto ms-2",children:s.jsx("i",{className:"fa fa-spin fa-spinner"})})})]})}),s.jsx(R,{children:a==="h5web"?s.jsx(I,{insetLegend:j,data:p,layout:this.props.layout}):s.jsx(E,{className:"plot",data:p,layout:this.props.layout??{}})}),(c||i||l)&&s.jsx("span",{children:l||`${i} vs. ${c}`})]})}}export{$ as S};
