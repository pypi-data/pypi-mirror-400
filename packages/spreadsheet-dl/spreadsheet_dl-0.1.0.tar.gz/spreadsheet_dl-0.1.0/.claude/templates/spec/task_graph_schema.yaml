# Task Graph Schema (L3)
# Work items with dependencies forming a DAG

$schema: "http://json-schema.org/draft-07/schema#"
title: Task Graph Schema
description: Schema for L3 task graph

type: object
required:
  - version
  - project
  - phases
  - tasks

properties:
  version:
    type: string
    pattern: "^\\d+\\.\\d+\\.\\d+$"

  project:
    type: string

  phases:
    type: array
    items:
      $ref: "#/definitions/phase"

  tasks:
    type: array
    items:
      $ref: "#/definitions/task"

definitions:
  phase:
    type: object
    required:
      - name
      - tier
      - tasks
    properties:
      name:
        type: string
      tier:
        type: integer
        enum: [1, 2, 3]
      tasks:
        type: array
        items:
          type: string
          pattern: "^TASK-\\d{3}$"

  task:
    type: object
    required:
      - id
      - title
      - requirements
      - deliverables
    properties:
      id:
        type: string
        pattern: "^TASK-\\d{3}$"

      title:
        type: string

      requirements:
        type: array
        items:
          type: string
          pattern: "^[A-Z]+-\\d{3}$"
        description: "Requirements addressed by this task"

      dependencies:
        type: array
        items:
          type: string
          pattern: "^TASK-\\d{3}$"
        description: "Tasks that must complete before this one"

      deliverables:
        type: array
        items:
          $ref: "#/definitions/deliverable"

      effort:
        type: string
        enum: [S, M, L, XL]

      validation_tasks:
        type: array
        items:
          type: string
          pattern: "^VAL-\\d{3}$"

  deliverable:
    type: object
    required:
      - path
      - type
    properties:
      path:
        type: string
      type:
        type: string
        enum: [module, test, config, docs]
