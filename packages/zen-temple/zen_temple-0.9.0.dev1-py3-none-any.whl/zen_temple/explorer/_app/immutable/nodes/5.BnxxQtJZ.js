import"../chunks/DsnmJJEf.js";import{o as rt}from"../chunks/CXB-c7mV.js";import{p as lt,e as o,g as oe,u as C,h as e,i as t,j as Z,l as n,k as Ae,q as ot,c as nt,f as G,a as u,s as M,b as g,m as W,n as Re,o as Be}from"../chunks/DqiEsuqZ.js";import{i as w}from"../chunks/Bn_fozzu.js";import{b as Oe}from"../chunks/KivD7ms6.js";import{T as st}from"../chunks/DBiFLRHa.js";import{d as it,D as gt,n as ut,e as ve,r as dt,F as _e,S as ft,b as he,c as ct,W as Me,E as ne}from"../chunks/B5aYIa2h.js";import{M as We}from"../chunks/Cw9LdTcD.js";import{C as mt,a as je}from"../chunks/COrL_aJw.js";import{u as pt,g as be}from"../chunks/P-s3qVBC.js";var vt=G("<!> <!>",1),_t=G("<!> <!>",1),ht=G("<!> <!> <!>",1),bt=G("<!> <!>",1),wt=G("<!> <!>",1),yt=G("<!> <!>",1);function Lt(Ee,Ue){lt(Ue,!0);let D=null,se=null,ie=null,ge=null,ue=null,de=o(0),we=o(oe({})),N=o(oe([]));const Ve=["Hourly","Daily","Weekly","Monthly"];let a=o(null),s=o(null),m=o(""),P=o("Hourly"),F=o(!0),j=o(oe([])),E=o(oe([])),_=o(!1),p=o(!1),J=o(void 0),Q=o(void 0),ye=n(()=>e(U).length>0?e(we)[e(U)[0]]:""),Se=n(()=>{if(!e(a)||!e(a).solution_name)return"";let r=e(a).solution_name.split(".");return[r[r.length-1],e(a).scenario_name,"storage_level",e(s)].join("_")}),Ye=n(()=>e(Se)+"_flows"),He=n(()=>Ce("Storage Level")),qe=n(()=>Ce("Storage Flow")),X=o(null),xe=o(0);C(()=>{e(a)?.detail?.system.unaggregated_time_steps_per_year!==void 0&&t(xe,e(a).detail.system.unaggregated_time_steps_per_year,!0)}),C(()=>{e(xe),Z(()=>{t(X,null)})});function Ce(r){return{animation:!1,normalized:!0,parsing:!1,elements:{point:{radius:0},line:{borderWidth:1}},maintainAspectRatio:!1,scales:{x:{type:"linear",stacked:!0,title:{display:!0,text:"Time"},ticks:{maxRotation:0,autoSkip:!0,callback:l=>Number(l).toFixed(0)},min:0,max:(e(a)?.detail?.system.unaggregated_time_steps_per_year||0)-1},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:`${r} [${e(ye)}]`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}}const Te={zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x"},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x"},limits:{x:{minRange:10,min:"original",max:"original"}}},tooltip:{callbacks:{label:r=>`${r.dataset.label}: ${r.formattedValue} ${e(ye)}`}}};let re=n(()=>(e(de),D?ve(D.entries.map(r=>r.index.node)).sort():[])),ee=n(()=>e(a)?ve(Object.values(e(a).detail.reference_carrier)).sort():[]),U=n(()=>(e(de),!D||!e(a)||e(ee).length===0?[]:ve(D.entries.map(l=>l.index.technology)).filter(l=>e(a).detail.reference_carrier[l]==e(s))));C(()=>{e(U),Z(()=>{t(j,e(U),!0)})}),C(()=>{e(re),Z(()=>{t(E,e(re),!0)})}),C(()=>{e(ee),Z(()=>{e(a)!==null&&e(s)!==null&&!e(ee).includes(e(s))&&t(s,null)})}),C(()=>{e(N),Z(()=>{e(N).length>0&&(!e(m)||!e(N).includes(Number(e(m))))&&(t(m,e(N)[0].toString(),!0),ce())})}),C(()=>{e(s),e(F),e(j),e(E),Z(ce)}),rt(()=>{t(s,be("car")||e(s),!0),t(m,be("year")||e(m),!0),t(P,be("window")||e(P),!0)}),C(()=>{e(m),e(s),e(P),Ae().then(()=>{pt({year:e(m),car:e(s),window:e(P)})})}),C(()=>{Ie()});async function Ie(){if(e(a)===null||!e(m)||e(s)===null)return;t(p,!0);let r={Daily:24,Weekly:168,Monthly:720}[e(P)]||1;const l=await it(e(a).solution_name,["storage_level","flow_storage_charge","flow_storage_discharge","flow_storage_spillage","flow_storage_inflow"],e(a).scenario_name,"storage_level",Number(e(m)),r,e(s));D=l.components.storage_level||null,se=l.components.flow_storage_charge||null,ie=l.components.flow_storage_discharge||null,ge=l.components.flow_storage_spillage||null,ue=l.components.flow_storage_inflow||null,ot(de),l.unit?.data&&t(we,Object.fromEntries(l.unit.data.map(V=>[V.technology,V[0]||V.units])),!0),t(p,!1),ce()}let ke=n(()=>Array.from({length:e(De)},(r,l)=>l.toString())),le=[],ze=[],fe=o(0),De=o(0);function Ke(){if(e(a)===null||e(p)||e(E).length==0||e(j).length==0||!D||!se||!ie||!ue||!ge)return[[],[]];const r=[{data:se,labelSuffix:"_charge",labelAggregated:"Flow Storage Charge",negate:!1,aggregatedColor:"rgb(54, 162, 235)",aggregatedBackgroundColor:void 0},{data:ie,labelSuffix:"_discharge",labelAggregated:"Flow Storage Discharge",negate:!0,aggregatedColor:"rgb(255, 99, 132)",aggregatedBackgroundColor:void 0},{data:ue,labelSuffix:"_inflow",labelAggregated:"Flow Storage Inflow",negate:!1,aggregatedColor:"rgb(75, 192, 192)",aggregatedBackgroundColor:void 0},{data:ge,labelSuffix:"_spillage",labelAggregated:"Flow Storage Spillage",negate:!0,aggregatedColor:"rgb(255, 99, 132)",aggregatedBackgroundColor:void 0}];return[Ne({data:D,labelSuffix:"",labelAggregated:"Storage Level",negate:!1,aggregatedColor:"rgb(0, 0, 0)",aggregatedBackgroundColor:"rgba(0, 0, 0, 0.2)"}),r.flatMap(Ne)]}function Ne({data:r,labelSuffix:l,labelAggregated:V,negate:L,aggregatedColor:y,aggregatedBackgroundColor:$}){let A=r.filterByCriteria({technology:e(j),node:e(E)}).groupBy(e(F)?["technology"]:[]);return L&&(A=A.mapData(T=>-T)),A.toArray().map(T=>{const i=e(F)?ut():y;return{data:T.data.map((k,z)=>({x:z,y:k})),label:e(F)?T.index.technology+l:V,type:"line",fill:"origin",stepped:!0,borderColor:i,backgroundColor:e(F)||!$?i:$}})}async function ce(){dt(),[le,ze]=Ke(),t(fe,le.length,!0),t(De,e(fe)>0?le[0].data.length:0,!0),await Ae(),e(J)&&e(J).updateChart(le),e(Q)&&e(Q).updateChart(ze)}gt(Ee,{parentTitle:"The Energy Balance",pageTitle:"Storage",subtitle:"Charging and discharging flows and storage levels",filters:L=>{var y=wt(),$=u(y);_e($,{title:"Solution Selection",children:(i,k)=>{{let z=n(()=>e(p)||e(_));ft(i,{get disabled(){return e(z)},get selected_solution(){return e(a)},set selected_solution(S){t(a,S,!0)},get loading(){return e(_)},set loading(S){t(_,S,!0)},get years(){return e(N)},set years(S){t(N,S,!0)}})}}});var A=M($,2);{var T=i=>{var k=bt(),z=u(k);_e(z,{title:"Variable Selection",children:(d,te)=>{var ae=_t(),R=u(ae);{let h=n(()=>e(p)||e(_));he(R,{get options(){return e(ee)},label:"Carrier",get disabled(){return e(h)},get value(){return e(s)},set value(f){t(s,f,!0)}})}var Y=M(R,2);{var v=h=>{var f=vt(),b=u(f);{let c=n(()=>e(N).map(x=>x.toString())),H=n(()=>e(p)||e(_));he(b,{get options(){return e(c)},label:"Year",get disabled(){return e(H)},get value(){return e(m)},set value(x){t(m,x,!0)}})}var B=M(b,2);{const c=x=>{Re();var pe=Be("Visualize the rolling average of hourly values over a longer time period.");g(x,pe)};let H=n(()=>e(p)||e(_));he(B,{get options(){return Ve},label:"Smoothing Window Size",get disabled(){return e(H)},get value(){return e(P)},set value(x){t(P,x,!0)},helpText:c,$$slots:{helpText:!0}})}g(h,f)};w(Y,h=>{e(s)!==null&&h(v)})}g(d,ae)}});var S=M(z,2);{var me=d=>{_e(d,{title:"Data Selection",children:(te,ae)=>{var R=ht(),Y=u(R);{const f=B=>{Re();var c=Be("Aggregate or disaggregate all the storage technologies.");g(B,c)};let b=n(()=>e(p)||e(_));st(Y,{label:"Technology Subdivision",get disabled(){return e(b)},get value(){return e(F)},set value(B){t(F,B,!0)},helpText:f,$$slots:{helpText:!0}})}var v=M(Y,2);{let f=n(()=>e(p)||e(_));We(v,{get options(){return e(U)},label:"Technologies",get disabled(){return e(f)},get value(){return e(j)},set value(b){t(j,b,!0)}})}var h=M(v,2);{let f=n(()=>e(p)||e(_));We(h,{get options(){return e(re)},label:"Nodes",get disabled(){return e(f)},get value(){return e(E)},set value(b){t(E,b,!0)}})}g(te,R)}})};w(S,d=>{e(a)!==null&&e(s)!==null&&d(me)})}g(i,k)};w(A,i=>{e(a)!==null&&i(T)})}g(L,y)},buttons:L=>{{let y=n(()=>[e(J),e(Q)]);mt(L,{get charts(){return e(y)},downloadable:!0,zoomable:!0})}},mainContent:L=>{var y=W(),$=u(y);{var A=i=>{ct(i)},T=i=>{var k=W(),z=u(k);{var S=d=>{Me(d,{message:"Please select a solution"})},me=d=>{var te=W(),ae=u(te);{var R=v=>{ne(v,{message:"No carriers with this selection"})},Y=v=>{var h=W(),f=u(h);{var b=c=>{Me(c,{message:"Please select a carrier"})},B=c=>{var H=W(),x=u(H);{var pe=q=>{ne(q,{message:"No technologies with this selection"})},Ze=q=>{var Pe=W(),Ge=u(Pe);{var Je=I=>{ne(I,{message:"No locations with this selection"})},Qe=I=>{var Fe=W(),Xe=u(Fe);{var et=K=>{ne(K,{message:"No data available for this selection"})},tt=K=>{var Le=yt(),$e=u(Le);Oe(je($e,{id:"level_chart",type:"line",get labels(){return e(ke)},datasets:[],get options(){return e(He)},get pluginOptions(){return Te},get plotName(){return e(Se)},zoom:!0,get zoomLevel(){return e(X)},set zoomLevel(O){t(X,O,!0)}}),O=>t(J,O,!0),()=>e(J));var at=M($e,2);Oe(je(at,{id:"flow_chart",type:"line",get labels(){return e(ke)},datasets:[],get options(){return e(qe)},get pluginOptions(){return Te},get plotName(){return e(Ye)},zoom:!0,get zoomLevel(){return e(X)},set zoomLevel(O){t(X,O,!0)}}),O=>t(Q,O,!0),()=>e(Q)),g(K,Le)};w(Xe,K=>{e(fe)==0?K(et):K(tt,!1)},!0)}g(I,Fe)};w(Ge,I=>{e(re).length==0?I(Je):I(Qe,!1)},!0)}g(q,Pe)};w(x,q=>{e(U).length==0?q(pe):q(Ze,!1)},!0)}g(c,H)};w(f,c=>{e(s)==null?c(b):c(B,!1)},!0)}g(v,h)};w(ae,v=>{e(ee).length==0?v(R):v(Y,!1)},!0)}g(d,te)};w(z,d=>{e(a)==null?d(S):d(me,!1)},!0)}g(i,k)};w($,i=>{e(_)||e(p)?i(A):i(T,!1)})}g(L,y)}}),nt()}export{Lt as component};
