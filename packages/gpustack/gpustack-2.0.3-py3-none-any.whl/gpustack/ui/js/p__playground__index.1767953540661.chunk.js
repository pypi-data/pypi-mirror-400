"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8268],{42301:function(e,n,t){t.r(n),t.d(n,{default:function(){return yn}});var s=t(90228),a=t.n(s),l=t(87999),r=t.n(l),i=t(48305),o=t.n(i),c=t(91962),u=t(71920),d=t(4144),m=t(37952),h=t(67996),f=t(4646),p=t(39541),g=t(53231),v=t(25383),x=t(43458),j=t(48872),y=t(81967),b=t(82187),k=t.n(b),w=t(32699),C=t.n(w),M=t(75271),Z=t(7388),S=t(94213),N=t(13507),R=t(15558),I=t.n(R),P=t(26068),A=t.n(P),T=t(3246),L=(t(82093),t(41994)),_=t(66876),E=t(89843),O=t(2825),z=t(28367);function G(e){var n=(0,O.Z)(),t=n.initialize,s=n.updateScrollerPosition,l=(0,M.useState)(!1),i=o()(l,2),c=i[0],u=i[1],d=(0,M.useState)(null),m=o()(d,2),h=m[0],f=m[1],p=(0,M.useState)([]),g=o()(p,2),v=g[0],x=g[1],j=(0,M.useRef)(null),y=(0,M.useRef)(0),b=(0,M.useRef)(""),k=(0,M.useRef)(null),w=(0,M.useRef)(0),Z=(0,M.useRef)(""),S=function(){return y.current=y.current+1,y.current},R=function(e){var n;if(f(A()({},null!==(n=null==e?void 0:e.usage)&&void 0!==n?n:{})),e&&C().get(e,"choices",[]).length){var t=null===C().get(e,"choices.0.delta.reasoning_content","")?"":C().get(e,"choices.0.delta.reasoning_content",""),s=null===C().get(e,"choices.0.delta.content","")?"":C().get(e,"choices.0.delta.content","");Z.current=Z.current+t,b.current=b.current+s;var a,l=(a={content:b.current,reasoningContent:Z.current}).reasoningContent&&!a.content?"<think>".concat(a.reasoningContent):a.reasoningContent&&a.content?"<think>".concat(a.reasoningContent,"</think>").concat(a.content):a.content;x([].concat(I()(v),I()(k.current),[{role:L.G7.Assistant,content:l,uid:y.current}]))}},P=function(){var e,n;null===(e=j.current)||void 0===e||null===(n=e.abort)||void 0===n||n.call(e,"stop"),u(!1),f(null)},T=function(){var e=r()(a()().mark((function e(n){var t,s,l,r,i,o,c,d,m,h,p,g;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u(!0),S(),f(null),l=n.current,r=n.parameters,i=n.system,null===(t=j.current)||void 0===t||null===(s=t.abort)||void 0===s||s.call(t,"cancel"),j.current=new AbortController,o=j.current.signal,k.current=l?[A()(A()({},l),{},{uid:y.current})]:[],b.current="",Z.current="",x((function(e){return[].concat(I()(e),I()(k.current))})),c=[].concat(I()(i?[i]:[]),I()(v),I()(k.current)),d=(0,L.qK)(c),m=A()(A()({messages:d},r),{},{stream:!0,stream_options:{include_usage:!0}}),e.next=16,(0,z.U3)({data:m,url:N.qt,signal:o});case 16:if(null==(h=e.sent)||!h.error){e.next=20;break}return f({error:!0,errorMessage:(0,L.Yo)(h)}),e.abrupt("return");case 20:return S(),p=h.reader,g=h.decoder,e.next=24,(0,z.LN)(p,g,(function(e){null!=e&&e.error?f({error:!0,errorMessage:(0,L.Yo)(e.error)}):R(e)}));case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(0);case 29:return e.prev=29,u(!1),e.finish(29);case 32:case"end":return e.stop()}}),e,null,[[0,26,29,32]])})));return function(n){return e.apply(this,arguments)}}();return(0,M.useEffect)((function(){e.current&&t(e.current)}),[e.current,t]),(0,M.useEffect)((function(){c&&s()}),[v,c]),(0,M.useEffect)((function(){v.length>w.current&&s(),w.current=v.length}),[v.length]),(0,M.useEffect)((function(){return function(){P()}}),[]),{loading:c,tokenResult:h,messageList:v,setMessageId:S,setMessageList:x,handleClear:function(){x([]),f(null)},handleAddNewMessage:function(e){var n,t=e||{role:(null===(n=C().last(v))||void 0===n?void 0:n.role)===L.G7.User?L.G7.Assistant:L.G7.User,content:""};x((function(e){return[].concat(I()(e),[A()(A()({},t),{},{uid:S()})])}))},handleStopConversation:P,updateScrollerPosition:s,submitMessage:T}}var U=t(45629),F=(t(55734),t(60669),t(46851)),D=t(4806),K=t(46214),$=(t(5597),t(92829)),V=t(29109),H=t(79635),Y=t(12272),B=t(13959),q=t(71891),W=t(98485),X=t(13554),J=t(84816),Q=t(25408),ee=t(2507),ne=t(52676),te=function(e){var n=e.actions,t=e.data,s=e.loading,l=e.updateMessage,i=e.onDelete,o=e.onEdit,c=(0,g.useIntl)(),u=function(){var e=r()(a()().mark((function e(n){var s,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,q.lH)(n.file);case 3:return s=e.sent,e.next=6,(0,q.a5)(n.file);case 6:r=e.sent,null==l||l({role:t.role,content:t.content,uid:t.uid,imgs:t.imgs||[],audio:[{uid:n.file.uid||n.fileList[0].uid,format:q.jH[n.file.type],base64:s.split(",")[1],data:C().pick(r,["url","name","duration"])}]}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(n){return e.apply(this,arguments)}}(),d=(0,ee.Z)({size:"small",handleUpdateImgList:function(e){null==l||l({role:t.role,content:t.content,uid:t.uid,audio:t.audio||[],imgs:[].concat(I()(t.imgs||[]),I()(e))})},updateUidCount:function(){return"img-".concat(Date.now())}}),m=d.ImageURLInput,h=d.UploadImageButton,f=d.isFromUrl;return(0,ne.jsxs)(ne.Fragment,{children:[m,n.length>1&&!s?(0,ne.jsx)("div",{className:k()("actions",{"has-url-input":f}),children:(0,ne.jsxs)("div",{className:"actions-wrap gap-5",children:[n.includes("upload")&&t.role===L.G7.User&&h,n.includes("upload")&&t.role===L.G7.User&&(0,ne.jsx)(B.Z,{type:"text",maxFileSize:1048576,accept:".mp3,.wav",size:"small",shape:"default",icon:(0,ne.jsx)(W.Z,{}),onChange:u}),n.includes("edit")&&t.role===L.G7.Assistant&&(0,ne.jsx)(Q.Z,{title:c.formatMessage({id:"common.button.edit"}),children:(0,ne.jsx)(H.ZP,{size:"small",type:"text",icon:(0,ne.jsx)(X.Z,{}),onClick:o})}),t.content&&n.includes("copy")&&(0,ne.jsx)(Y.Z,{text:t.content,size:"small",shape:"default",type:"text",fontSize:"12px"}),n.includes("delete")&&(0,ne.jsx)(Q.Z,{title:c.formatMessage({id:"common.button.delete"}),children:(0,ne.jsx)(H.ZP,{size:"small",type:"text",onClick:i,icon:(0,ne.jsx)(J.Z,{})})})]})}):null]})},se=t(53649),ae=t.n(se),le=t(94377),re=t(67825),ie=t.n(re),oe=t(80357),ce=(t(62740),t(56401)),ue=t(33840),de=t(57434),me=t(77974),he=t(6229),fe=t(67585),pe=t(41273),ge=(t(12398),/&(?:amp|lt|gt|quot|#(?:0+)?39);/g);RegExp(ge.source);var ve,xe,je,ye=["children","className","node","theme"],be=["href","children"],ke=fe.ZP.div.attrs((function(){return{className:"markdown-viewer"}}))(ve||(ve=ae()([""]))),we=function(e){var n=e.children,t=e.className,s=(e.node,e.theme),a=ie()(e,ye),l=/language-(\w+)/.exec(t||"");return l?(0,ne.jsx)(pe.Z,{code:n,lang:l[1],theme:s}):(0,ne.jsx)("code",A()(A()({},a),{},{className:t,children:n}))},Ce=function(e){var n=e.content,t=e.theme,s=(0,M.useMemo)((function(){return function(e){return e.replaceAll("$\\ce{","$\\\\ce{").replaceAll("$\\pu{","$\\\\pu{")}(function(e){for(var n="",t=0;t<e.length;t+=1){var s=e[t],a=e[t+1]||" ";"$"===s&&a>="0"&&a<="9"&&(s="\\$"),n+=s}return n}(n).replaceAll(/(```[\S\s]*?```|`.*?`)|\\\[([\S\s]*?[^\\])\\]|\\\((.*?)\\\)/g,(function(e,n,t,s){return n||(t?"$$".concat(t,"$$"):s?"$".concat(s,"$"):e)})))}),[n]);return(0,ne.jsx)(ke,{children:(0,ne.jsx)(ce.UG,{remarkPlugins:[[he.Z],me.Z,de.Z],rehypePlugins:[ue.Z],components:{code:function(e){return(0,ne.jsx)(we,A()(A()({},e),{},{theme:t}))},a:function(e){var n=e.href,t=e.children,s=ie()(e,be);return(0,ne.jsx)("a",A()(A()({href:(0,oe.N)(n)},s),{},{target:"_blank",rel:"noopener noreferrer",children:t}))}},children:s})})},Me=t(97014),Ze=t(62988),Se=function(e){var n=e.content,t=e.collapsed;return(0,ne.jsx)(ne.Fragment,{children:n?(0,ne.jsx)("div",{className:"think-wrapper",children:!t&&(0,ne.jsx)("div",{className:"think-content",children:(0,ne.jsx)(Ce,{content:n})})}):null})},Ne=fe.ZP.div(xe||(xe=ae()(["\n  height: max-content;\n  width: max-content;\n"]))),Re=fe.ZP.div.attrs({className:"custom-scrollbar-horizontal"})(je||(je=ae()(["\n  display: flex;\n  justify-content: flex-start;\n  overflow-x: auto;\n  flex-direction: column;\n  padding: 0px;\n  gap: 8px;\n  &.has-content {\n    padding-inline: 8px;\n    padding-block: 8px 0;\n  }\n"]))),Ie=(0,M.forwardRef)((function(e,n){var t,s,l,i,c,u,d,m,h,f,p=e.editable,g=e.data,v=e.loading,x=e.reasoningContent,j=e.showMarkdown,y=e.collapsed,b=e.updateMessage,w=(0,M.useRef)(null),Z=(0,M.useRef)(0),S=M.useState(g.content),N=o()(S,2),R=N[0],P=N[1],A=(0,M.useCallback)(function(){var e=r()(a()().mark((function e(n){var t,s,l,r,i,o,c;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n.clipboardData||window.clipboardData,s=t.items,l=[],r=a()().mark((function e(){var n,t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"file"===(n=s[i]).kind&&-1!==n.type.indexOf("image")?(t=n.getAsFile(),r=new Promise((function(e,n){var s=new FileReader;s.onload=function(t){var s,a=null===(s=t.target)||void 0===s?void 0:s.result;a?e(a):n("Failed to convert image to base64")},s.readAsDataURL(t)})),l.push(r)):n.kind;case 2:case"end":return e.stop()}}),e)})),i=0;case 5:if(!(i<s.length)){e.next=10;break}return e.delegateYield(r(),"t0",7);case 7:i++,e.next=5;break;case 10:return e.prev=10,e.next=13,Promise.all(l);case 13:(o=e.sent).length&&(c=C().map(o,(function(e){return Z.current+=1,{uid:Z.current,dataUrl:e}})),null==b||b({role:g.role,content:g.content,uid:g.uid,audio:g.audio||[],imgs:[].concat(I()(g.imgs||[]),I()(c))})),e.next=20;break;case 17:e.prev=17,e.t1=e.catch(10);case 20:case"end":return e.stop()}}),e,null,[[10,17]])})));return function(n){return e.apply(this,arguments)}}(),[g,b]),T=function(e){e.clipboardData.getData("text")||(e.preventDefault(),A(e))},_=function(e){var n=C().filter(g.imgs,(function(n){return n.uid!==e}));null==b||b({role:g.role,content:g.content,uid:g.uid,audio:g.audio||[],imgs:n})},E=function(){null==b||b({role:g.role,content:g.content,uid:g.uid,audio:[],imgs:g.imgs||[]})},O=function(e){null==b||b({imgs:g.imgs||[],audio:g.audio||[],role:g.role,content:e.target.value,uid:g.uid})},z=function(e){P(e.target.value)},G=function(){P(g.content)},U=function(){null==b||b({role:g.role,content:R,uid:g.uid,audio:g.audio||[],imgs:g.imgs})},F=function(e){var n;e.stopPropagation(),e.preventDefault(),null===(n=w.current)||void 0===n||n.focus()};return(0,M.useImperativeHandle)(n,(function(){return{handleSaveEdit:U,handleCancelEdit:G,setEditContent:P}})),(0,ne.jsx)(ne.Fragment,{children:p?(0,ne.jsxs)("div",{className:k()("message-content-input",{"has-img":(null===(c=g.imgs)||void 0===c?void 0:c.length)||g.audio&&(null===(u=g.audio)||void 0===u?void 0:u.length)>0}),onClick:F,children:[(0,ne.jsxs)(Re,{className:k()({"has-content":(null===(d=g.imgs)||void 0===d?void 0:d.length)||g.audio&&(null===(m=g.audio)||void 0===m?void 0:m.length)>0}),children:[(0,ne.jsx)(Ze.Z,{style:{paddingBlockEnd:0},editable:p,dataList:g.imgs||[],onDelete:_}),g.audio&&g.audio.length>0&&(0,ne.jsx)(Ne,{children:(0,ne.jsx)(le.Z,{url:null===(h=g.audio)||void 0===h||null===(h=h[0])||void 0===h?void 0:h.data.url,name:null===(f=g.audio)||void 0===f||null===(f=f[0])||void 0===f?void 0:f.data.name,onDelete:E,height:50})})]}),(0,ne.jsx)(ne.Fragment,{children:g.role===L.G7.User?(0,ne.jsx)(Me.Z.TextArea,{ref:w,value:g.content,variant:"filled",autoSize:{minRows:1},style:{borderRadius:"var(--border-radius-mini)"},readOnly:v,onChange:O,onPaste:T}):(0,ne.jsx)(ne.Fragment,{children:j?(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsx)(Se,{collapsed:y,content:x.thought,isThinking:v&&x.isThinking}),(0,ne.jsx)("div",{style:{paddingInline:4},children:(0,ne.jsx)(Ce,{content:"".concat(x.result||"")})})]}):(0,ne.jsx)(Me.Z.TextArea,{ref:w,value:R,defaultValue:g.content,variant:"filled",autoSize:{minRows:1},style:{borderRadius:"var(--border-radius-mini)"},onChange:z,onPaste:T})})})]}):(0,ne.jsxs)("div",{className:k()("content-item-content",{"has-img":(null===(t=g.imgs)||void 0===t?void 0:t.length)||g.audio&&(null===(s=g.audio)||void 0===s?void 0:s.length)>0}),children:[(0,ne.jsxs)("div",{className:"justify-start",children:[(0,ne.jsx)(Ze.Z,{editable:p,dataList:g.imgs||[],onDelete:_}),g.audio&&g.audio.length>0&&(0,ne.jsx)(Ne,{children:(0,ne.jsx)(le.Z,{url:null===(l=g.audio)||void 0===l||null===(l=l[0])||void 0===l?void 0:l.data.url,name:null===(i=g.audio)||void 0===i||null===(i=i[0])||void 0===i?void 0:i.data.name,actions:[],height:50})})]}),g.content&&(0,ne.jsx)("div",{className:"text",children:g.content})]})})})),Pe=Ie,Ae=t(25298),Te=t.n(Ae),Le=t(17069),_e=t.n(Le),Ee=t(82092),Oe=t.n(Ee),ze=function(){function e(){Te()(this,e),Oe()(this,"lastCheckedIndex",void 0),Oe()(this,"collecting",void 0),Oe()(this,"thought",void 0),Oe()(this,"result",void 0),this.thought="",this.result="",this.collecting=!1,this.lastCheckedIndex=0}return _e()(e,[{key:"parse",value:function(e){for(;this.lastCheckedIndex<e.length;){var n=e.indexOf("<think>",this.lastCheckedIndex),t=e.indexOf("</think>",this.lastCheckedIndex);this.collecting?-1!==t?(this.thought+=e.substring(this.lastCheckedIndex,t),this.collecting=!1,this.lastCheckedIndex=t+8):(this.thought+=e.substring(this.lastCheckedIndex),this.lastCheckedIndex=e.length):-1!==t&&(-1===n||t<n)?(this.thought=this.result+e.substring(this.lastCheckedIndex,t),this.result="",this.lastCheckedIndex=t+8):-1!==n?(this.result+=e.substring(this.lastCheckedIndex,n),this.collecting=!0,this.lastCheckedIndex=n+7):(this.result+=e.substring(this.lastCheckedIndex),this.lastCheckedIndex=e.length)}return{thought:this.thought.trim(),result:this.result,isThinking:this.collecting}}},{key:"reset",value:function(){this.thought="",this.result="",this.collecting=!1,this.lastCheckedIndex=0}}]),e}(),Ge=function(e){var n=e.handleSave,t=e.handleCancel,s=(0,g.useIntl)();return(0,ne.jsx)("div",{className:"save-actions",children:(0,ne.jsxs)("div",{className:"actions-wrap gap-8",children:[(0,ne.jsx)(H.ZP,{size:"small",icon:(0,ne.jsx)(V.Z,{}),onClick:t,style:{borderRadius:"var(--border-radius-base)"},children:s.formatMessage({id:"common.button.cancel"})}),(0,ne.jsx)(H.ZP,{size:"small",type:"primary",icon:(0,ne.jsx)($.Z,{type:"icon-save3"}),onClick:n,style:{borderRadius:"var(--border-radius-base)"},children:s.formatMessage({id:"common.button.save"})})]})})},Ue=function(e){var n=e.collapsed,t=e.setCollapsed,s=e.isThinking,a=(0,g.useIntl)();return(0,ne.jsx)("div",{className:"flex-center",style:{marginLeft:10,borderRadius:"var(--border-radius-base)",width:"max-content",overflow:"hidden"},children:(0,ne.jsxs)(H.ZP,{size:"small",type:"text",className:"flex-center",variant:"filled",color:"default",onClick:function(){return t(!n)},children:[(0,ne.jsx)("span",{children:s?a.formatMessage({id:"playground.chat.thinking"}):a.formatMessage({id:"playground.chat.aithought"})}),(0,ne.jsx)($.Z,{type:"icon-down",rotate:n?0:180})]})})},Fe=function(e){var n=e.updateMessage,t=e.onDelete,s=e.loading,a=e.data,l=e.editable,r=e.showTitle,i=void 0===r||r,c=e.actions,u=void 0===c?["upload","delete","copy","edit"]:c,d=(0,g.useIntl)(),m=M.useState(!0),h=o()(m,2),f=h[0],p=h[1],v=M.useRef(null),x=M.useRef(null),j=M.useState(!1),y=o()(j,2),b=y[0],k=y[1],w=(0,M.useMemo)((function(){return a.role===L.G7.User?{thought:"",isThinking:!1,result:""}:(!x.current&&f&&(x.current=new ze),f?x.current.parse(a.content):{thought:"",isThinking:!1,result:a.content})}),[a.content,f,a.role]),C=(0,M.useMemo)((function(){if(!i)return null;var e=d.formatMessage({id:"playground.".concat(a.role)}),n=(0,ne.jsx)($.Z,{type:"icon-user-filled",className:"font-size-16 m-r-5 text-tertiary"});return a.role===L.G7.Assistant&&(n=(0,ne.jsx)($.Z,{type:"icon-assistant-filled",className:"font-size-16 m-r-5",style:{color:"var(--ant-blue-6)"}})),a.title&&(e=a.title),(0,ne.jsxs)("div",{className:"role flex-center",children:[n,e,a.role===L.G7.Assistant&&w.thought&&(0,ne.jsx)(Ue,{isThinking:s&&w.isThinking,collapsed:b,setCollapsed:k})]})}),[a.role,a.title,d,i,s,w.thought,w.isThinking,b]);return(0,ne.jsxs)("div",{className:"content-item",children:[(0,ne.jsx)("div",{className:"content-item-title",children:i&&C}),(0,ne.jsx)("div",{className:"content-item-role",style:{display:u.length?"flex":"none"},children:f?(0,ne.jsx)(te,{data:a,actions:u,loading:s,onDelete:t,onEdit:function(){var e;p(!1),null===(e=v.current)||void 0===e||e.setEditContent(a.content)},updateMessage:n}):(0,ne.jsx)(Ge,{handleSave:function(){var e;null===(e=v.current)||void 0===e||e.handleSaveEdit(),p(!0)},handleCancel:function(){var e;null===(e=v.current)||void 0===e||e.handleCancelEdit(),p(!0)}})}),(0,ne.jsx)(Pe,{ref:v,editable:l,showMarkdown:f,data:a,loading:s,actions:u,collapsed:b,reasoningContent:w,updateMessage:function(e){var t;(null==n||n(e),a.role===L.G7.Assistant)&&(null===(t=x.current)||void 0===t||t.reset())}})]})},De=function(e){var n=e.setMessageList,t=e.messageList,s=e.editable,a=e.showTitle,l=void 0===a||a,r=e.loading,i=e.actions,o=void 0===i?["upload","delete","copy"]:i;return(0,ne.jsx)(ne.Fragment,{children:!!t.length&&(0,ne.jsx)("div",{className:"message-content-list",children:t.map((function(e,a){return(0,ne.jsx)(Fe,{loading:r,data:e,editable:s,actions:o,showTitle:l,onDelete:function(){return function(e){var s=I()(t);s.splice(e,1),null==n||n(s)}(a)},updateMessage:function(e){return function(e,s){var a=I()(t);a[e]=s,null==n||n(a)}(a,e)}},e.uid)}))})})},Ke=t(15409),$e=t(72567),Ve=function(e){var n=e.systemMessage,t=e.showApplyToAll,s=e.setSystemMessage,a=e.style,l=e.applyToAll,r=(0,g.useIntl)(),i=(0,M.useState)(!1),c=o()(i,2),u=c[0],d=c[1],m=M.useRef(null),h=(0,M.useState)({minRows:1,maxRows:1,focus:!1}),f=o()(h,2),p=f[0],v=f[1],x=function(){v({minRows:4,maxRows:4,focus:!0}),setTimeout((function(){var e,n;null===(e=m.current)||void 0===e||null===(n=e.focus)||void 0===n||n.call(e,{cursor:"end"})}),100)};return(0,M.useEffect)((function(){u&&(null==l||l(n))}),[u]),(0,ne.jsxs)("div",{className:k()("sys-message",{focus:p.focus}),style:A()({},a),children:[(0,ne.jsxs)("div",{style:{display:p.focus?"block":"none"},className:"textarea-wrapper",children:[(0,ne.jsx)("span",{className:"system-label",children:r.formatMessage({id:"playground.systemMessage"})}),(0,ne.jsx)(Me.Z.TextArea,{className:"custome-scrollbar",ref:m,variant:"filled",placeholder:r.formatMessage({id:"playground.system.tips"}),style:{borderRadius:"0",border:"none"},value:n,autoSize:{minRows:p.minRows,maxRows:p.maxRows},onFocus:x,onBlur:function(e){v({minRows:1,maxRows:1,focus:!1})},allowClear:!1,onChange:function(e){s(e.target.value),u&&(null==l||l(e.target.value))}}),t&&(0,ne.jsxs)("span",{className:"apply-check",onMouseDown:function(e){e.preventDefault(),d(!u)},children:[(0,ne.jsx)("span",{className:"m-r-5",children:r.formatMessage({id:"playground.compare.applytoall"})}),(0,ne.jsx)($e.Z,{checked:u})]}),(0,ne.jsx)(j.Z,{style:{margin:"0"}})]}),!p.focus&&(0,ne.jsxs)("div",{className:"sys-content-wrap",onClick:x,children:[(0,ne.jsxs)("div",{className:"sys-content",children:[(0,ne.jsx)("span",{className:"title",children:r.formatMessage({id:"playground.systemMessage"})}),n||(0,ne.jsx)("span",{style:{color:"var(--ant-color-text-tertiary)"},children:r.formatMessage({id:"playground.system.tips"})})]}),n&&(0,ne.jsx)(Q.Z,{title:r.formatMessage({id:"common.button.clear"}),children:(0,ne.jsx)(H.ZP,{className:"clear-btn",type:"text",icon:(0,ne.jsx)(Ke.Z,{}),size:"small",onClick:function(){s("")}})})]})]})},He=t(27722),Ye=t(25466),Be=t(18843),qe=function(e){var n=(0,g.useIntl)(),t=e.usage,s=e.showOutput,a=void 0===s||s,l=e.scaleable,r=e.fields,i=void 0===r?["completion_tokens","prompt_tokens"]:r;return!t||C().isEmpty(t)?null:t.error?(0,ne.jsxs)(Ye.Z.Paragraph,{type:"danger",ellipsis:{rows:2,tooltip:null==t?void 0:t.errorMessage},style:{textAlign:"center",paddingBlock:0,margin:0,paddingInline:4,borderRadius:2,backgroundColor:"var(--ant-color-error-bg)"},children:[(0,ne.jsx)(He.Z,{className:"m-r-8"}),null==t?void 0:t.errorMessage]}):(0,ne.jsxs)("div",{className:k()("reference-params",{scaleable:l}),children:[(0,ne.jsx)("span",{className:k()("usage",{scaleable:l}),children:(0,ne.jsx)(Q.Z,{title:(0,ne.jsxs)(Be.Z,{children:[i.includes("completion_tokens")&&(0,ne.jsxs)("span",{children:[n.formatMessage({id:"playground.completion"}),":"," ",t.completion_tokens]}),i.includes("prompt_tokens")&&(0,ne.jsxs)("span",{children:[n.formatMessage({id:"playground.prompt"}),":"," ",t.prompt_tokens]})]}),children:(0,ne.jsxs)("span",{children:[n.formatMessage({id:"playground.tokenusage"}),":"," ",t.total_tokens]})})}),a&&(0,ne.jsx)("span",{className:k()("usage",{scaleable:l}),children:(0,ne.jsx)(Q.Z,{title:(0,ne.jsxs)(Be.Z,{children:[(0,ne.jsxs)("span",{children:["TPOT: ",C().round(t.time_per_output_token_ms,2)||0," ms"]}),(0,ne.jsxs)("span",{children:["TTFT: ",C().round(t.time_to_first_token_ms,2)||0," ms"]})]}),children:(0,ne.jsxs)("span",{children:[n.formatMessage({id:"playground.tokenoutput"}),":"," ",C().round(t.tokens_per_second,2)||0," Tokens/s"]})})})]})},We=t(36224),Xe=(0,M.forwardRef)((function(e,n){var t,s=e.modelList,l=(0,M.useState)(""),i=o()(l,2),c=i[0],u=i[1],d=(0,M.useState)(!1),m=o()(d,2),h=m[0],f=m[1],p=(0,M.useState)(!1),g=o()(p,2),v=g[0],x=g[1],j=(0,M.useRef)(null),y=(0,M.useState)(["upload","delete","copy","edit"]),b=o()(y,2),w=b[0],C=(b[1],G(j)),Z=C.submitMessage,S=C.handleStopConversation,R=C.handleAddNewMessage,P=C.handleClear,O=C.setMessageList,z=C.tokenResult,$=C.messageList,V=C.loading,H=(0,U.X)({modelList:s,isChat:!0},{defaultValues:A()(A()({},E.Bx),{},{model:null===(t=s[0])||void 0===t?void 0:t.value}),defaultParamsConfig:_.Lw,metaKeys:E.m4}),Y=H.handleOnValuesChange,B=H.formRef,q=H.paramsRef,W=H.paramsConfig,X=H.initialValues,J=H.parameters;(0,M.useImperativeHandle)(n,(function(){return{viewCode:function(){f(!0)},setCollapse:function(){x(!v)},collapse:v}}));var Q=(0,M.useMemo)((function(){var e=c?[{role:L.G7.System,content:c}]:[],n=(0,L.qK)(I()($));return(0,F.F)({api:N.qt,parameters:A()(A()({},J),{},{messages:[].concat(e,I()(n))})})}),[$,c,J]),ee=function(e){var n,t;if(e.content||null!==(n=e.imgs)&&void 0!==n&&n.length||null!==(t=e.audio)&&void 0!==t&&t.length)return e},te=function(){var e=r()(a()().mark((function e(n){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=ee(n),Z({system:c?{role:L.G7.System,content:c}:void 0,current:t,parameters:J});case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,ne.jsxs)("div",{className:"ground-left-wrapper",children:[(0,ne.jsxs)("div",{className:"ground-left",children:[(0,ne.jsx)("div",{className:"message-list-wrap",ref:j,children:(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsx)("div",{style:{marginBottom:20},children:(0,ne.jsx)(Ve,{style:{borderRadius:"var(--border-radius-mini)",overflow:"hidden"},systemMessage:c,setSystemMessage:u})}),(0,ne.jsxs)("div",{className:"content",children:[(0,ne.jsx)(De,{messageList:$,setMessageList:O,editable:!0,loading:V,actions:w}),V&&(0,ne.jsx)(T.Z,{size:"small",children:(0,ne.jsx)("div",{style:{height:"46px"}})})]})]})}),z&&!V&&(0,ne.jsx)("div",{style:{height:40},children:(0,ne.jsx)(qe,{usage:z})}),(0,ne.jsx)("div",{className:"ground-left-footer",children:(0,ne.jsx)(K.Z,{defaultSize:{minRows:5,maxRows:5},actions:["clear","layout","role","upload","add","paste"],defaultChecked:!1,loading:V,disabled:!J.model,isEmpty:!$.length,handleSubmit:te,addMessage:R,handleAbortFetch:S,clearAll:P})})]}),(0,ne.jsx)("div",{className:k()("params-wrapper",{collapsed:v}),ref:q,children:(0,ne.jsx)("div",{className:"box",children:(0,ne.jsx)(D.Z,{ref:B,onValuesChange:Y,paramsConfig:W,initialValues:X,modelList:s,showModelSelector:!0})})}),(0,ne.jsx)(We.Z,{open:h,viewCodeContent:Q,onCancel:function(){f(!1)}})]})})),Je=Xe,Qe=t(93203),en=M.createContext({}),nn=t(65050),tn=function(e){var n=e.style,t=(0,g.useIntl)();(0,g.useNavigate)();return(0,ne.jsx)("div",{className:"flex-center  justify-center",style:A()({},n),children:(0,ne.jsx)(nn.Z,{image:nn.Z.PRESENTED_IMAGE_SIMPLE,description:(0,ne.jsx)("div",{className:"flex-column",children:(0,ne.jsx)(Ye.Z.Text,{type:"secondary",children:t.formatMessage({id:"playground.model.noavailable"})})})})})},sn=t(27441),an=t(77634),ln=t(85882),rn=t(3453),on=t(88256),cn=t(94752),un=t(38913),dn=t(34443),mn=t(45186),hn=t(6905),fn=t(36838),pn=["modelList"],gn=(0,M.forwardRef)((function(e,n){var t=e.modelList,s=ie()(e,pn),a=s.model,l=s.instanceId,r=(0,M.useContext)(en),i=r.globalParams,c=r.setGlobalParams,u=r.setLoadingStatus,d=r.handleDeleteModel,m=r.handleApplySystemChangeToAll,h=r.modelFullList,f=r.actions,p=(0,U.X)(A()(A()({},s),{},{modelList:h}),{defaultValues:A()(A()({},E.Bx),{},{model:a}),defaultParamsConfig:_.Lw,metaKeys:E.m4}),v=p.handleOnValuesChange,x=p.handleOnModelChange,j=p.setParams,y=p.setInitialValues,b=p.formRef,k=p.paramsConfig,w=p.initialValues,Z=p.parameters,S=(0,g.useIntl)(),R=(0,M.useRef)(!1),P=(0,M.useState)(""),O=o()(P,2),z=O[0],K=O[1],V=(0,M.useState)(!1),Y=o()(V,2),B=Y[0],q=Y[1],W=(0,M.useRef)(null),X=G(W),J=X.submitMessage,Q=X.handleAddNewMessage,ee=X.handleClear,te=X.setMessageList,se=X.handleStopConversation,ae=X.tokenResult,le=X.messageList,re=X.loading,oe=(0,M.useMemo)((function(){var e=z?[{role:L.G7.System,content:z}]:[],n=(0,L.qK)(I()(le));return(0,F.F)({api:N.qt,parameters:A()(A()({},Z),{},{messages:[].concat(e,I()(n))})})}),[le,z,Z]),ce=function(){se(),u(l,!1)},ue=function(e){var n=function(e){var n,t;if(e.content||null!==(n=e.imgs)&&void 0!==n&&n.length||null!==(t=e.audio)&&void 0!==t&&t.length)return e}(e);J({system:z?{role:L.G7.System,content:z}:void 0,current:n,parameters:Z})},de=(0,M.useCallback)((function(e,n){v(e,A()(A()({},n),{},{model:Z.model})),R.current&&c(A()({},n))}),[Z,R.current]),me=(0,M.useMemo)((function(){var e=[{label:S.formatMessage({id:"common.button.clear"}),key:"clear",icon:(0,ne.jsx)(cn.Z,{}),danger:!1,onClick:function(){te([]),K("")}},{label:S.formatMessage({id:"playground.viewcode"}),key:"viewcode",icon:(0,ne.jsx)($.Z,{type:"icon-code"}),onClick:function(){q(!0)}}];return t.length>2&&e.push({label:S.formatMessage({id:"common.button.delete"}),key:"delete",icon:(0,ne.jsx)(un.Z,{}),danger:!0,onClick:function(){d(l)}}),e}),[t,S]);return(0,M.useEffect)((function(){j((function(e){return A()(A()({},e),i)})),y((function(e){return A()(A()({},e),i)}))}),[i]),(0,M.useEffect)((function(){return u(l,re),function(){u(l,!1)}}),[re]),(0,M.useImperativeHandle)(n,(function(){return{submit:ue,abortFetch:ce,addNewMessage:Q,clear:ee,setSystemMessage:K,loading:re}})),(0,ne.jsxs)("div",{className:"model-item",children:[(0,ne.jsxs)("div",{className:"header",children:[(0,ne.jsx)("span",{className:"title",children:(0,ne.jsx)(on.Z,{style:{width:"100%"},variant:"borderless",options:h,onChange:function(e){x(e),ee()},value:Z.model,labelRender:function(e){return(0,ne.jsx)(ln.Z,{ghost:!0,tooltipProps:{placement:"right"},minWidth:60,maxWidth:180,children:e.label})},optionRender:function(e){return(0,ne.jsx)(ln.Z,{ghost:!0,tooltipProps:{placement:"right"},minWidth:60,maxWidth:180,children:e.label})}})}),ae&&!re&&(0,ne.jsx)(qe,{usage:ae,scaleable:!0}),(0,ne.jsxs)("span",{className:"action",children:[(0,ne.jsx)(hn.Z,{menu:{items:me},placement:"bottomRight",children:(0,ne.jsx)(H.ZP,{type:"text",icon:(0,ne.jsx)(dn.Z,{style:{fontSize:"14px"}}),size:"small"})}),(0,ne.jsx)(fn.Z,{autoAdjustOverflow:!0,styles:{body:{width:375,paddingInline:0}},content:(0,ne.jsx)(rn.ZP,{maxHeight:500,style:{paddingInline:"24px"},oppositeTheme:!0,children:(0,ne.jsx)(D.Z,{ref:b,onValuesChange:de,paramsConfig:k,initialValues:w,showModelSelector:!1,parametersTitle:(0,ne.jsxs)("div",{className:"flex-center flex-between",children:[(0,ne.jsx)("span",{children:S.formatMessage({id:"playground.parameters"})}),(0,ne.jsx)($e.Z,{onChange:function(e){R.current=e.target.checked,e.target.checked&&c(A()({},C().omit(Z,"model")))},children:S.formatMessage({id:"playground.compare.applytoall"})})]})})}),trigger:["click"],arrow:!1,fresh:!0,title:!1,children:(0,ne.jsx)(H.ZP,{type:"text",icon:(0,ne.jsx)(mn.Z,{}),size:"small"})})]})]}),(0,ne.jsx)(Ve,{showApplyToAll:!0,systemMessage:z,applyToAll:m,setSystemMessage:K}),(0,ne.jsx)("div",{className:"content",ref:W,children:(0,ne.jsxs)("div",{children:[(0,ne.jsx)(De,{messageList:le,setMessageList:te,actions:f,editable:!0}),(0,ne.jsx)(T.Z,{spinning:re,size:"small",style:{width:"100%"}})]})}),(0,ne.jsx)(We.Z,{open:B,viewCodeContent:oe,onCancel:function(){q(!1)}})]})})),vn=function(e){var n=e.spans,t=e.modelSelections,s=e.setModelRefs;return(0,ne.jsx)(sn.Z,{gutter:[16,0],style:{height:"100%"},children:t.map((function(e,a){return(0,ne.jsx)(an.Z,{span:n.span,style:{height:n.count<4?"calc(100% - 16px)":"calc(50% - 16px)",overflow:"hidden"},children:(0,ne.jsx)(gn,{ref:function(n){return s(e.instanceId,n)},instanceId:e.instanceId,modelList:t,model:e.value},"".concat(e.value||"empty","-").concat(e.uid))},"".concat(e.value||"empty","-").concat(e.uid))}))})},xn=function(e){var n=e.modelList,t=e.loaded,s=(0,O.Z)().initialize,a=(0,M.useState)({}),l=o()(a,2),r=l[0],i=l[1],c=(0,M.useState)([]),u=o()(c,2),d=u[0],m=u[1],h=(0,M.useState)({}),f=o()(h,2),p=f[0],g=f[1],v=(0,M.useState)({span:12,count:2}),x=o()(v,2),j=x[0],y=x[1],b=(0,M.useRef)({}),k=(0,M.useRef)({}),w=(0,M.useRef)(null),Z="calc(100vh - ".concat(Qe.Mz,"px)"),S=(0,M.useState)(["upload","delete","copy","edit"]),N=o()(S,2),R=N[0],I=(N[1],(0,M.useMemo)((function(){return Object.getOwnPropertySymbols(r).some((function(e){return r[e]}))}),[r])),P=function(e){return b.current[e]=C().add(b.current[e],1),b.current[e]},T=(0,M.useCallback)((function(e,n){k.current[e]=n}),[]);return(0,M.useEffect)((function(){k.current={};var e=C().take(n,j.count);if(e.length<j.count&&e.length>0){var t=j.count-e.length,s=Array.from({length:t},(function(e,n){return{label:"",value:"",type:"empty"}}));e=C().concat(e,s)}var a=e.map((function(e){return A()(A()({},e),{},{uid:P(e.value||"empty"),instanceId:"empty"===e.type?Symbol("empty"):Symbol(e.value)})}));m(a)}),[n]),(0,M.useEffect)((function(){w.current&&s(w.current)}),[w.current,s]),(0,ne.jsxs)("div",{className:"multiple-chat",style:{height:Z},children:[(0,ne.jsx)("div",{className:"chat-list",ref:w,children:n.length>0?(0,ne.jsx)(en.Provider,{value:{spans:j,globalParams:p,loadingStatus:r,modelFullList:n,actions:R,handleApplySystemChangeToAll:function(e){Object.getOwnPropertySymbols(k.current).forEach((function(n){var t=k.current[n];null==t||t.setSystemMessage(e)}))},setGlobalParams:g,setLoadingStatus:function(e,n){i((function(t){var s=A()({},t);return s[e]=n,s}))},handleDeleteModel:function(e){var n,t=d.filter((function(n){return n.instanceId!==e}));!function(e){k.current[e]=null,r[e]=!1}(e),n=j.count-1,6===j.count?y({span:8,count:n}):5===j.count?y({span:12,count:n}):4===j.count?y({span:8,count:n}):3===j.count&&y({span:12,count:n}),m(t)}},children:(0,ne.jsx)(vn,{spans:j,modelSelections:d,setModelRefs:T})}):t&&(0,ne.jsx)(tn,{style:{height:"100%",paddingBottom:60}})}),(0,ne.jsx)("div",{children:(0,ne.jsx)(K.Z,{loading:I,disabled:I||!d.length||!n.length,handleSubmit:function(e){Object.getOwnPropertySymbols(k.current).forEach((function(n){var t=k.current[n];null==t||t.submit(e)}))},addMessage:function(e){Object.getOwnPropertySymbols(k.current).forEach((function(n){var t=k.current[n];null==t||t.addNewMessage(e)}))},handleAbortFetch:function(){Object.getOwnPropertySymbols(k.current).forEach((function(e){var n=k.current[e];null==n||n.abortFetch()}))},clearAll:function(){Object.getOwnPropertySymbols(k.current).forEach((function(e){var n=k.current[e];null==n||n.clear()}))},updateLayout:function(e){y(e),function(e){var t=d;if(t.length<e.count){var s=e.count-t.length,a=C().slice(n,t.length,t.length+s),l=Array.from({length:s-a.length},(function(e,n){return{label:"",value:"",type:"empty"}})),r=C().concat(a,l).map((function(e){return A()(A()({},e),{},{uid:P(e.value||"empty"),instanceId:"empty"===e.type?Symbol("empty"):Symbol(e.value)})}));m(C().concat(t,r))}else if(t.length>e.count){var i=t.slice(0,e.count);m(i)}}(e)},setModelSelections:function(e){var n=e.map((function(e){return A()(A()({},e),{},{uid:P(e.value),instanceId:Symbol(e.value)})})),t=C().concat(d,n),s=Math.floor(24/t.length);y({span:s<8?8:s,count:j.count}),m(t)},actions:["clear","layout","role","upload","add","paste"],defaultChecked:!1,defaultSize:{minRows:5,maxRows:5}})})]})},jn=t(9629),yn=(t(48119),function(){var e=(0,g.useIntl)(),n=(0,d.Z)().size,t=(0,M.useState)("chat"),s=o()(t,2),l=s[0],i=s[1],b=(0,M.useRef)(null),w=(0,M.useRef)(null),R=(0,M.useState)([]),I=o()(R,2),P=I[0],A=I[1],T=(0,M.useState)(!1),L=o()(T,2),_=L[0],E=L[1],O=(0,M.useMemo)((function(){return[{label:e.formatMessage({id:"menu.playground.chat"}),value:"chat",icon:(0,ne.jsx)(f.Z,{})},{label:e.formatMessage({id:"menu.compare"}),value:"compare",icon:(0,ne.jsx)(p.Z,{})}]}),[e]),z=(0,v.Z)((function(){var e,n;if("reranker"===l)null===(e=w.current)||void 0===e||null===(n=e.viewCode)||void 0===n||n.call(e);else if("chat"===l){var t,s;null===(t=b.current)||void 0===t||null===(s=t.viewCode)||void 0===s||s.call(t)}})),G=(0,v.Z)((function(){var e,n,t,s;"reranker"!==l?null===(e=b.current)||void 0===e||null===(n=e.setCollapse)||void 0===n||n.call(e):null===(t=w.current)||void 0===t||null===(s=t.setCollapse)||void 0===s||s.call(t)})),U=(0,M.useMemo)((function(){return[{key:"chat",label:"Chat",icon:(0,ne.jsx)(f.Z,{}),children:(0,ne.jsx)(Je,{ref:b,modelList:P})},{key:"compare",label:"Compare",icon:(0,ne.jsx)(p.Z,{}),children:(0,ne.jsx)(xn,{modelList:P,loaded:_})}]}),[P,_]);(0,M.useEffect)((function(){var e,t,s;n.width<c.Z.lg&&(null===(e=b.current)||void 0===e||!e.collapse)&&(null===(t=b.current)||void 0===t||null===(s=t.setCollapse)||void 0===s||s.call(t))}),[n.width]),(0,M.useEffect)((function(){var e=function(){var e=r()(a()().mark((function e(){var n,t,s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={categories:h.Us.llm,with_meta:!0},e.next=4,(0,N.nb)(n);case 4:t=e.sent,s=C().map(t.data||[],(function(e){return{value:e.id,label:e.id,meta:e.meta}})),A(s),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0);case 12:return e.prev=12,E(!0),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,9,12,15]])})));return function(){return e.apply(this,arguments)}}();e()}),[]);var F=(0,M.useMemo)((function(){return{title:(0,ne.jsxs)("div",{className:"flex items-center",children:[(0,ne.jsx)("span",{className:"font-600",children:e.formatMessage({id:"menu.playground.chat"})}),(0,ne.jsx)(x.Z,{options:O,size:"middle",className:"m-l-40 font-600",value:l,onChange:function(e){return i(e)}})]})}}),[l,O,e]);return(0,Z.y1)(u.ZP.RIGHT.join(","),(function(){var e,n;"chat"===l&&(null===(e=b.current)||void 0===e||null===(n=e.setCollapse)||void 0===n||n.call(e))}),{preventDefault:!0}),(0,ne.jsx)(S.R,{className:k()("playground-container",{compare:"compare"===l,chat:"compare"!==l}),header:F,extra:[(0,ne.jsx)(jn.Z,{handleViewCode:z,handleToggleCollapse:G,activeKey:l},"view-code-buttons"),(0,ne.jsx)("div",{children:"chat"===l&&(0,ne.jsx)(j.Z,{type:"vertical",style:{height:16,marginInline:16}},"divider")},"divider-wrapper"),(0,ne.jsx)(m.k,{},"extra-content")],children:(0,ne.jsx)("div",{className:"play-ground",children:(0,ne.jsx)("div",{className:"chat",children:(0,ne.jsx)(y.Z,{items:U,activeKey:l})})})})})},46851:function(e,n,t){t.d(n,{F:function(){return o},O:function(){return i}});var s=t(26068),a=t.n(s),l=t(13507),r=t(65548),i=function(e){var n=e.api,t=e.modelProxy,s=e.parameters,a=window.location.origin,i=t?"".concat(l.kW,"/${YOUR_API_PATH}"):n;return"\ncurl ".concat(a).concat(i,' \\\n-H "Content-Type: application/json" \\\n-H "Authorization: Bearer ${YOUR_GPUSTACK_API_KEY}" \\').concat(t?'\n-H "X-GPUStack-Model: '.concat(s.model,'" \\'):"","\n").concat((0,r.Yy)(s,!1)).trim()},o=function(e){var n=e.api,t=e.parameters,s=window.location.origin,o=i({api:n,parameters:t}),c='\nfrom openai import OpenAI\n\nclient = OpenAI(\n  base_url="'.concat(s,"/").concat(l.Mo,'", \n  api_key="YOUR_GPUSTACK_API_KEY"\n)\n\nresponse = client.chat.completions.create(\n').concat((0,r.G4)(a()({},t)),")\n\nprint(response.choices[0].message.content)").trim(),u=(0,r.GT)(a()({},t));return{curlCode:o,pythonCode:c,nodeJsCode:'\nconst OpenAI = require("openai");\n\nconst openai = new OpenAI({\n  "apiKey": "YOUR_GPUSTACK_API_KEY",\n  "baseURL": "'.concat(s,"/").concat(l.Mo,'"\n});\n\nasync function main() {\n  const params = ').concat(u,"; \n  const response = await openai.chat.completions.create(params);\n  console.log(response.choices[0].message.content);\n}\nmain();").trim()}}},12398:function(){}}]);