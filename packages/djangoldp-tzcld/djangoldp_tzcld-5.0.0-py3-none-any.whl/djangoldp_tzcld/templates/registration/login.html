{% extends "base.html" %}
{% load i18n %}

{% block title %}
  {% trans "Se connecter" %}
{% endblock %}

{% block content %}

<div class="segment full whitespace-normal form">

  {% if next %}
    <div class="segment full whitespace-normal">
      {% if user.is_authenticated %}
      <h2 class="text-semibold text-color-secondary">
        {% blocktrans %}
          Votre compte n'a pas accès à cette page. Pour continuer, connectez-vous avec un compte qui y a accès.
        {% endblocktrans %}
      </h2>
      {% endif %}
    </div>
  {% endif %}

  <form class="segment half sm-full whitespace-normal" method="post" action="{% url 'login' %}">
    {% csrf_token %}
    <div class="segment margin-bottom-medium full padding-right-small sm-padding-none text-small text-semibold text-uppercase text-color-heading">
      <label for="id_username">{% trans "E-mail:" %}</label>
      {{ form.username }}
    </div>
    <div class="segment margin-bottom-medium full padding-right-small sm-padding-none text-small text-semibold text-uppercase text-color-heading">
      {{ form.password.label_tag }}
      {{ form.password }}
    </div>

    {% if form.errors and not form.non_field_errors %}
    <div class='segment full margin-bottom-xsmall whitespace-normal'>
      <span class='text-bold text-color-primary'>{% if form.errors.items|length == 1 %}{% trans "Please correct the error below." %}{% else %}{% trans "Please correct the errors below." %}{% endif %}</span>
    </div>
    {% endif %}

    {% if form.non_field_errors %}
    {% for error in form.non_field_errors %}
    <div class='segment full margin-bottom-xsmall whitespace-normal'>
      <span class='text-bold text-color-primary'>{{ error }}</span>
    </div>
    {% endfor %}
    {% endif %}

    <div class="submit-button segment full margin-top-xsmall text-xsmall children-link-button children-button-icon children-link-text-bold children-link-text-uppercase children-link-reversed color-secondary bordered children-icon-rocket children-icon-small children-icon-margin-right-xsmall">
      <button type="submit">{% trans 'Se connecter' %}</button>
    </div>
    <div class="segment full margin-top-xsmall">
      <a class="link" href="{% url 'password_reset' %}">{% trans "Mot de passe oublié ?" %}</a>
    </div>
    <input type="hidden" name="next" value="{{ next }}" />
  </form>

  {% if distant_login %}
  <div class="border-top margin-medium border-color-grey"></div>
  <div class="segment full whitespace-normal">
    <p class="text-semibold text-color-heading">
      {% trans "Se connecter avec un autre fournisseur d'identité" %}
    </p>

    <form class="segment half sm-full whitespace-normal" method="post" action="{% url 'oidc_login' %}">
      {% csrf_token %}
      <div class="segment margin-bottom-medium full padding-right-small sm-padding-none text-small text-semibold text-uppercase text-color-heading">
        <label for="id_subject">{% trans "Webfinger:" %}</label>
        <input type="text" name="subject" required id="id_subject" />
      </div>
      <div class="submit-button segment full margin-top-xsmall text-xsmall children-link-button children-button-icon children-link-text-bold children-link-text-uppercase children-link-reversed color-secondary bordered children-icon-rocket children-icon-small children-icon-margin-right-xsmall">
        <button type="submit">{% trans 'Se connecter' %}</button>
      </div>
      <input type="hidden" name="next" value="{{ next }}" />
    </form>
  </div>
  {% endif %}

  {% if registration_open %}
  <div class="border-top margin-medium border-color-grey"></div>
  <div class="segment half sm-full whitespace-normal">
    <p class="text-semibold text-color-heading">
      {% trans "Vous n'avez pas encore de compte ?" %}
    </p>
    <div class="segment full margin-top-xsmall">
      <a class="button reversed button-icon text-xsmall text-bold text-uppercase color-secondary bordered icon-rocket icon-small icon-margin-right-xsmall" href="{% url 'django_registration_register' %}?next={{next|urlencode}}">{% trans "S'inscrire" %}</a>
    </div>
  </div>
  {% endif %}

</div>
{% endblock %}
