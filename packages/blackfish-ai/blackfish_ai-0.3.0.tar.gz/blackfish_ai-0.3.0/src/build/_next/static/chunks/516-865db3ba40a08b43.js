"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[516],{8516:function(e,t,n){n.d(t,{JT:function(){return h},am:function(){return m}});var r=n(7437),o=n(2265),a=n(2219),s=n(4630),i=n(9124),c=n(2871),l=n(408),u=n(3680),f=n(718),d=n.n(f);let h=(0,o.createContext)(),m=e=>{let{children:t}=e,[n,a]=(0,o.useState)(null);return(0,o.useEffect)(()=>{let e=localStorage.getItem("profile"),t=e?JSON.parse(e):null;console.debug("Restored profile",t),a(t)},[]),(0,r.jsx)(h.Provider,{value:{profile:n,setProfile:e=>{localStorage.setItem("profile",JSON.stringify(e)),a(e)}},children:t})};function p(e){let{selectedProfile:t,setSelectedProfile:n}=e,{profiles:o,error:f,isLoading:d}=(0,l.nw)();return d?(0,r.jsx)("div",{children:"Loading profiles..."}):f?(0,r.jsx)("div",{children:"Error!"}):0===o.length?(0,r.jsx)("div",{children:"No profiles found."}):(0,r.jsxs)(a.Ri,{value:t,onChange:n,children:[(0,r.jsx)(s.__,{className:"mt-2 block text-sm font-medium leading-6 text-gray-900",children:"Profile"}),t&&!o.map(e=>e.name).includes(t.name)&&(0,r.jsx)("div",{children:"Profile is missing."}),(0,r.jsxs)("div",{className:"relative mt-2 mb-2",children:[t?(0,r.jsx)(a.Y4,{className:"relative w-full cursor-default rounded-md bg-white py-1.5 pl-1 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:text-sm sm:leading-6",children:(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"ml-3 block truncate",children:t.name?t.name:""}),(0,r.jsxs)("span",{className:"ml-2 text-slate-400 text-sm font-light",children:["@",t.host?t.host:"localhost"]}),(0,r.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,r.jsx)(i.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]})}):(0,r.jsx)(a.Y4,{className:"relative w-full cursor-default rounded-md bg-white py-1.5 pl-1 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:text-sm sm:leading-6",children:(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"pointer-events-none flex-shrink-0 pl-3",children:(0,r.jsx)(u.Z,{className:"h-5 w-5 text-yellow-400","aria-hidden":"true"})}),(0,r.jsx)("span",{className:"ml-3 block truncate",children:"No profile selected"}),(0,r.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,r.jsx)(i.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]})}),(0,r.jsx)(a.O_,{className:"absolute z-10 mt-1 max-h-60 overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm w-[var(--button-width)]",anchor:"bottom",children:o.map(e=>(0,r.jsxs)(a.wt,{value:e,className:"group flex gap-2 bg-white data-[focus]:bg-blue-500 data-[focus]:text-white relative cursor-default select-none py-2 pl-1 pr-9 text-gray-900",children:[(0,r.jsx)("div",{className:"flex",children:(0,r.jsx)("span",{className:"ml-3 block truncate font-normal data-[selected]:font-semibold",children:e.name})}),(0,r.jsxs)("span",{className:"ml-1 text-slate-400 text-sm font-light data-[selected]:text-gray-100",children:["@",e.host?e.host:"localhost"]}),(0,r.jsx)("span",{className:"invisible group-data-[selected]:visible absolute inset-y-0 right-0 flex items-center pr-4 group-data-[focus]:text-white text-blue-600",children:(0,r.jsx)(c.Z,{className:"size-5"})})]},e.name))})]})]})}m.propTypes={children:d().node},p.propTypes={selectedProfile:d().object,setSelectedProfile:d().func},t.ZP=p},9657:function(e,t,n){n.d(t,{R:function(){return a},s:function(){return o}});var r=n(257);let o=r.env.NEXT_PUBLIC_BASE_PATH?r.env.NEXT_PUBLIC_BASE_PATH:"",a=r.env.NEXT_PUBLIC_BLACKFISH_URL?r.env.NEXT_PUBLIC_BLACKFISH_URL:"http://localhost:8000"},408:function(e,t,n){n.d(t,{Su:function(){return i},bP:function(){return s},nw:function(){return c},of:function(){return l}});var r=n(3861),o=n(3347),a=n(7203);let s=(e,t)=>{let{data:n,error:a,isLoading:s}=(0,r.ZP)("models?profile=".concat(e?e.name:"default","&image=").concat(t),o.fm);return{models:n,error:a,isLoading:s}},i=(e,t)=>{let{data:n,error:s,isLoading:i,mutate:c}=(0,r.ZP)(()=>!!e&&"services?refresh=true&profile=".concat(e?e.name:null,"&image=").concat(t.replace("-","_")),o.Qz,{refreshInterval:3e4}),l=[a.$J.HEALTHY,a.$J.STARTING,a.$J.PENDING,a.$J.SUBMITTED,a.$J.STOPPED,a.$J.EXPIRED,a.$J.TIMEOUT,a.$J.FAILED];return{services:n?[...n].sort((e,t)=>{let n=l.indexOf(e.status)-l.indexOf(t.status);return 0!==n?n:new Date(t.created_at)-new Date(e.created_at)}):[],error:s,isLoading:i,mutate:c}},c=()=>{let{data:e,error:t,isLoading:n,mutate:a}=(0,r.ZP)("profiles",o.lU);return{profiles:e,error:t,isLoading:n,mutate:a}},l=e=>{let{data:t,error:n,isLoading:a,mutate:s}=(0,r.ZP)(e?"files?path=".concat(e):null,o.uB);return{files:t,error:n,isLoading:a,refresh:s}}},3347:function(e,t,n){n.d(t,{Pp:function(){return u},Qz:function(){return s},UY:function(){return c},fm:function(){return a},lU:function(){return i},uB:function(){return o},wo:function(){return f}});var r=n(9657);async function o(e){let t=await fetch("".concat(r.R,"/api/").concat(e));if(!t.ok){console.debug("from fetchFiles: failed to fetch files (status=".concat(t.status,")"));let e=Error("Failed to fetch files.");throw e.status=t.status,e}return t.json()}async function a(e){let t=await fetch("".concat(r.R,"/api/").concat(e,"&refresh=true"));if(!t.ok){console.debug("from fetchModels: failed to fetch models (status=".concat(t.status,")"));let e=Error("Failed to fetch models.");throw e.status=t.status,e}return(await t.json()).map(e=>({repo_id:e.repo,revision:e.revision,profile:e.profile,image:e.image,model_dir:e.model_dir}))}async function s(e){let t=await fetch("".concat(r.R,"/api/").concat(e));if(!t.ok){console.debug("from fetchServices: failed to fetch services (status=".concat(t.status,")"));let e=Error("Failed to fetch services.");throw e.status=t.status,e}return await t.json()}async function i(){let e=await fetch("".concat(r.R,"/api/profiles"));if(!e.ok){console.debug("from fetchProfiles: failed to fetch profiles (status=".concat(e.status,")"));let t=Error("Failed to fetch profiles.");throw t.status=e.status,t}return await e.json()}async function c(e,t,n,o,a){let s;if("slurm"===a.schema)s={name:n.name,image:e.replace("-","_"),repo_id:t.repo_id,profile:a,container_config:{...o,revision:t.revision,model_dir:"speech-recognition"===e?l(t.model_dir):t.model_dir,port:null},job_config:n,mount:o.input_dir,grace_period:180};else if("local"===a.schema){let i=await fetch("".concat(r.R,"/api/ports"));if(!i.ok){let e=Error("Unable to find available local port");throw e.status=i.status,e}let c=await i.json();s={name:n.name,image:e.replace("-","_"),repo_id:t.repo_id,profile:a,container_config:{...o,revision:t.revision,model_dir:"speech-recognition"===e?l(t.model_dir):t.model_dir,port:c},job_config:{gres:n.gres},mount:o.input_dir,grace_period:180}}else throw Error("Unsupported job profile type: ".concat(a.schema));return console.debug("from runService: body =",s),await fetch("".concat(r.R,"/api/services"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}function l(e){let t=e.split("/"),n=t.length;return t.slice(0,n-1).join("/")}async function u(e){let t=JSON.stringify({delay:0}),n=await fetch("".concat(r.R,"/api/services/").concat(e,"/stop"),{method:"PUT",headers:{"Content-Type":"application/json"},mode:"cors",body:t});if(!n.ok)throw Error("Failed to stop the service");return n.json()}async function f(e){let t=JSON.stringify({force:!1});if(!(await fetch("".concat(r.R,"/api/services/?id=").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"},mode:"cors",body:t})).ok)throw Error("Failed to delete the service")}},7203:function(e,t,n){n.d(t,{$J:function(){return i},AK:function(){return s},GG:function(){return f},Iy:function(){return c},Ru:function(){return m},SO:function(){return h},_v:function(){return a},hq:function(){return u},jb:function(){return l},zM:function(){return d}});var r=n(718),o=n.n(r);let a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(t=>t(setTimeout(t,e)))},s=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).join(" ")},i=Object.freeze({SUBMITTED:"submitted",PENDING:"pending",STARTING:"starting",HEALTHY:"healthy",UNHEALTHY:"unhealthy",TIMEOUT:"timeout",STOPPED:"stopped",EXPIRED:"expired",FAILED:"failed"});function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return Math.floor(Math.random()*(t-e)+e)}function l(e){if("number"!=typeof e)throw Error('bytes should be a number (received: "'.concat(typeof e,'").'));let t=parseInt(e);if(Number.isNaN(t))throw Error("Cannot parse byte input: wrong type.");return t/1e3<1?"".concat(t," B"):t/1e6<1?"".concat(Math.floor(t/1e3)," KB"):t/1e9<1?"".concat(Math.floor(t/1e6)," MB"):t/1e12<1?"".concat(Math.floor(t/1e9)," GB"):"".concat(Math.floor(t/1e12)," TB")}function u(e){let t=new Date(e),n=new Date-t;if(Number.isNaN(n))throw Error("Cannot parse date");return n/1e3<60?"".concat(Math.floor(n/1e3)," seconds ago"):n/1e3/60<60?"".concat(Math.floor(n/1e3/60)," minutes ago"):n/1e3/3600<24?"".concat(Math.floor(n/1e3/3600)," hours ago"):"".concat(Math.floor(n/1e3/3600/24)," days ago")}function f(e){return e?e.filter((e,t,n)=>n.map(e=>e.repo_id).indexOf(e.repo_id)===t):[]}function d(e,t){let n=Math.abs(t-e),r=n%1e3,o=(n=(n-r)/1e3)%60,a=(n=(n-o)/60)%60,s=(n=(n-a)/60)%24,i=(n-s)/24;return 1===i?"".concat(i," day ").concat(a," min"):i>0?"".concat(i," days ").concat(a," min"):s>0?"".concat(s," hr ").concat(a," min"):a>0?"".concat(a," min ").concat(o," sec"):"".concat(o," sec")}function h(){let{status:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{status:null};return!!e&&(e===i.UNHEALTHY||e===i.HEALTHY)}function m(e){return"boolean"!=typeof e&&"number"!=typeof e&&!!(null==e||""===e||Array.isArray(e)&&e.every(m)||"object"==typeof e&&(null===e||0===Object.keys(e).length||Object.values(e).flat().every(m)))}c.PropTypes={min:o().number,max:o().number}}}]);