[build-system]
requires = ["setuptools>=68", "wheel", "Cython>=3.0", "numpy>=1.26"]
build-backend = "setuptools.build_meta"

[project]
name = "nimbus-bci"
version = "0.3.0"
description = "Nimbus BCI: Bayesian classifiers for brain-computer interfaces"
requires-python = ">=3.10"
readme = "README.md"
license = {file = "LICENSE.txt"}
authors = [
    {name = "Nimbus BCI Inc.", email = "hello@nimbusbci.com"}
]
keywords = ["bci", "eeg", "machine-learning", "bayesian", "classification", "sklearn"]
classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Science/Research",
    "License :: Other/Proprietary License",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Topic :: Scientific/Engineering :: Artificial Intelligence",
]
dependencies = [
  "numpy>=1.26",
  "scikit-learn>=1.4",
]

[project.optional-dependencies]
dev = [
  "pytest>=8.0",
  "python-dateutil>=2.9.0",
  "Cython>=3.0",
  "build",
  "twine",
]
viz = [
  "matplotlib>=3.8",
]
mne = [
  "mne>=1.6",
]
softmax = [
  "jax>=0.4.25",
]
all = [
  "matplotlib>=3.8",
  "mne>=1.6",
  "scipy>=1.12",
  "jax>=0.4.25",
]

[project.urls]
Homepage = "https://nimbusbci.com"
Documentation = "https://docs.nimbusbci.com"
Repository = "https://github.com/nimbusbci/nimbuspysdk"
Issues = "https://github.com/nimbusbci/nimbuspysdk/issues"

[tool.setuptools.packages.find]
where = ["."]
include = ["nimbus_bci*"]

[tool.setuptools.package-data]
nimbus_bci = ["*.so", "*.pyd", "*.pyx", "py.typed"]

[tool.pytest.ini_options]
testpaths = ["tests"]

[tool.ruff]
line-length = 100
target-version = "py310"

[tool.ruff.lint]
select = ["E", "F", "I", "W"]
ignore = ["E501"]

[tool.mypy]
python_version = "3.10"
warn_return_any = true
warn_unused_configs = true
ignore_missing_imports = true

# ============================================================================
# cibuildwheel configuration for multi-platform wheel builds
# ============================================================================

[tool.cibuildwheel]
# Build for Python 3.10, 3.11, 3.12
build = "cp310-* cp311-* cp312-*"

# Skip 32-bit builds and musllinux (Alpine)
skip = "*-win32 *-manylinux_i686 *-musllinux_*"

# Test the built wheels
test-requires = ["pytest"]
test-command = "pytest {project}/tests -v --ignore={project}/tests/test_sklearn_compat.py"

[tool.cibuildwheel.linux]
# Use manylinux2014 for broad compatibility
manylinux-x86_64-image = "manylinux2014"
manylinux-aarch64-image = "manylinux2014"

# Install build dependencies
before-build = "pip install Cython>=3.0 numpy>=1.26"

[tool.cibuildwheel.macos]
# Build universal2 wheels for Apple Silicon + Intel
archs = ["x86_64", "arm64"]
before-build = "pip install Cython>=3.0 numpy>=1.26"

[tool.cibuildwheel.windows]
# Only 64-bit Windows
archs = ["AMD64"]
before-build = "pip install Cython>=3.0 numpy>=1.26"
