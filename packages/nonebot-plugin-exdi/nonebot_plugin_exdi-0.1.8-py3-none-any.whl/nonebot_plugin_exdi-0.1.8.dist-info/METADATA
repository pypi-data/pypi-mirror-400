Metadata-Version: 2.1
Name: nonebot-plugin-exdi
Version: 0.1.8
Summary: ä¾èµ–æ³¨å…¥æ‰©å±•,å…è®¸å¯¹éhandleå‡½æ•°è¿›è¡Œä¾èµ–æ³¨å…¥
Author-Email: "Mr.Lee" <chzxxuanzheng@gmail.com>
License: GPLv3
Requires-Python: >=3.10
Requires-Dist: anyio>=4.4.0
Requires-Dist: exceptiongroup>=1.2.2
Requires-Dist: nonebot2>=2.4.2
Description-Content-Type: text/markdown

<div align="center">
  <a href="https://v2.nonebot.dev/store"><img src="https://github.com/A-kirami/nonebot-plugin-template/blob/resources/nbp_logo.png" width="180" height="180" alt="NoneBotPluginLogo"></a>
  <br>
  <p><img src="https://github.com/A-kirami/nonebot-plugin-template/blob/resources/NoneBotPlugin.svg" width="240" alt="NoneBotPluginText"></p>
</div>

<div align="center">

# nonebot-plugin-exdi

_âœ¨ ä¾èµ–æ³¨å…¥æ‰©å±•,å°†ä¾èµ–æ³¨å…¥çš„èŒƒå›´ä»é’©å­æ‰©å±•åˆ°å…¶ä»–å‡½æ•° âœ¨_


<a href="./LICENSE">
    <img src="https://img.shields.io/github/license/chzxxuanzheng/nonebot-plugin-exdi.svg" alt="license">
</a>
<a href="https://pypi.python.org/pypi/nonebot-plugin-template">
    <img src="https://img.shields.io/pypi/v/nonebot-plugin-exdi.svg" alt="pypi">
</a>
<img src="https://img.shields.io/badge/python-3.9+-blue.svg" alt="python">

</div>

## ğŸ“– ä»‹ç»

è¯¥æ’ä»¶å…è®¸åœ¨Matcherå“åº”èŒƒå›´å†…,å¯¹æ‰€æœ‰è°ƒç”¨çš„å‡½æ•°ä½¿ç”¨ä¾èµ–æ³¨å…¥å‘ä¸Šä¸‹æ–‡è·å–å‚æ•°,ä¸å†éœ€è¦handleå‡½æ•°ä¼ å‚äº†

## ğŸ’¿ å®‰è£…

<details open>
<summary>ä½¿ç”¨ nb-cli å®‰è£…</summary>
åœ¨ nonebot2 é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ‰“å¼€å‘½ä»¤è¡Œ, è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤å³å¯å®‰è£…

    nb plugin install nonebot-plugin-exdi

</details>

<details open>
<summary>ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…</summary>
åœ¨ nonebot2 é¡¹ç›®çš„æ’ä»¶ç›®å½•ä¸‹, æ‰“å¼€å‘½ä»¤è¡Œ, æ ¹æ®ä½ ä½¿ç”¨çš„åŒ…ç®¡ç†å™¨, è¾“å…¥ç›¸åº”çš„å®‰è£…å‘½ä»¤

<details>
<summary>pip</summary>

    pip install nonebot-plugin-exdi
</details>
<details>
<summary>pdm</summary>

    pdm add nonebot-plugin-exdi
</details>
<details>
<summary>poetry</summary>

    poetry add nonebot-plugin-exdi
</details>
<details>
<summary>conda</summary>

    conda install nonebot-plugin-exdi
</details>

æ‰“å¼€ nonebot2 é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `pyproject.toml` æ–‡ä»¶, åœ¨ `[tool.nonebot]` éƒ¨åˆ†è¿½åŠ å†™å…¥

    plugins = ["nonebot_plugin_exdi"]

</details>

## âš™ï¸ ä½¿ç”¨è¯´æ˜

<details open>
<summary>ä¸€èˆ¬ä½¿ç”¨</summary>

```python
exdi = require("nonebot_plugin_exdi")
matcher1 = on_command('cs')

@matcher1.handle(parameterless=[exdi.init_di()])
async def my_handle():
	await my_func1()

@exdi.di()
async def my_func1(bot: Bot, matcher: Matcher, arg: Message = CommandArg()):
	await matcher.send(f'ä½ çš„botæ˜¯:{bot}')
	await matcher.send(f'æ”¶åˆ°çš„å‚æ•°æ˜¯:{arg}')
```
è¿è¡Œç»“æœ:

![ç»“æœ](https://github.com/Chzxxuanzheng/nonebot-plugin-exdi/blob/master/resources/img1.png?raw=true)
</details>

<details open>
<summary>è‡ªå®šä¹‰Dependsæ”¯æŒ</summary>

```python
exdi = require("nonebot_plugin_exdi")

def _depend1(bot: Bot, event: Event):
	# do someting
	return 'depend1è¿”å›å€¼'

def _depend2(bot: Bot, event: Event):
	# do someting
	return 'depend2è¿”å›å€¼'

depend1 = Annotated[str, Depends(_depend1)]
depend2 = Depends(_depend2)

@dataclass
class ClassDependency:
	event: Event
	depend1: depend1

	def __str__(self) -> str:
		return f'(event type:{self.event.get_type()}, depend1: {self.depend1})'

classDepend = Annotated[ClassDependency, Depends(ClassDependency)]

matcher1 = on_command('cs')

@matcher1.handle(parameterless=[exdi.init_di()])
async def my_handle():
	for msg in my_func2():
		await matcher1.send(msg)

@exdi.di()
def my_func2(d1: depend1, classDepend: classDepend, d2: str = depend2):
	yield f'depend1: {d1}, depend2: {d2}'
	yield f'classDepend: {classDepend}'
```
è¿è¡Œç»“æœ:

![ç»“æœ](https://github.com/Chzxxuanzheng/nonebot-plugin-exdi/blob/master/resources/img2.png?raw=true)
</details>

<details open>
<summary>æ‰‹åŠ¨ä¼ å…¥å‚æ•°ï¼Œé»˜è®¤å€¼å‚æ•°æ”¯æŒ</summary>

```python
exdi = require("nonebot_plugin_exdi")

matcher1 = on_command('cs')

@matcher1.handle(parameterless=[exdi.init_di()])
async def my_handle():
	await my_func3(arg1='cillo world')

@exdi.di()
async def my_func3(matcher: Matcher, arg1: str, arg2: str = 'defaultValue'):
	await matcher.send(f'arg1: {arg1}')
	await matcher.send(f'arg2: {arg2}')
```
è¿è¡Œç»“æœ:

![ç»“æœ](https://github.com/Chzxxuanzheng/nonebot-plugin-exdi/blob/master/resources/img3.png?raw=true)
</details>

**æ³¨æ„,é€šå¸¸æƒ…å†µä¸‹ä¸æ”¯æŒç”Ÿæˆå™¨ä¾èµ–,åŒæ—¶ä¸å’Œmatcherå…±ç”¨ç¼“å­˜ã€‚è¿™æ˜¯ç”±äºnonebotä¸å¯¹å¤–æš´æ¼`dependency_cache`å’Œ`stack`,ç¼“å­˜éœ€è¦`dependency_cache`,ç”Ÿæˆå™¨ä¾èµ–éœ€è¦`stack`ã€‚å¦‚æœæœ‰éœ€è¦è¯·å‚è€ƒä¸‹é¢çš„`è¦†ç›–NoneBot`ã€‚**

### è¦†ç›–NoneBotäº‹ä»¶å‘å¸ƒå‡½æ•°

ææ¸…æ¥šä½ åœ¨åšä»€ä¹ˆåå†ç»§ç»­å¾€ä¸‹çœ‹,å¦‚æœä½ **ä¸äº†è§£nonebotçš„è¿ä½œè§„å¾‹,è¯·å‹¿ä½¿ç”¨è¯¥é¡¹**

<details>
å¦‚æœæƒ³è¦æ›´å¥½çš„è¿è¡Œæ•ˆæœ,å¿…é¡»è¦è¦†ç›–`nonebot.message.handle_event`å‡½æ•°æ¥è·å–`dependency_cache`å’Œ`stack`ã€‚è¦†ç›–è¯¥å‡½æ•°åä¸å†éœ€è¦`init_di`æ¥åˆå§‹åŒ–ä¾èµ–æ³¨å…¥ã€‚

| é…ç½®é¡¹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|:-----:|:----:|:----:|:----:|
| exdi_overwrite_nb | å¦ | False | è¦†ç›–`nonebot`çš„`nonebot.message.handle_event`å‡½æ•° |
| exdi_hand_overwrite | å¦ | False | ä½ æ‰‹åŠ¨è¦†ç›–`nonebot.message.handle_event`å‡½æ•° |

ä½ å¯ä»¥é€šè¿‡è®¾ç½®`exdi_overwrite_nb`ä¸º`True`æ¥è®©æ’ä»¶è‡ªå·±è¦†ç›–`handle_event`,ä½†æ³¨æ„çš„æ˜¯æ’ä»¶éœ€è¦åœ¨

ä½ ä¹Ÿå¯ä»¥è‡ªå·±æ‰‹åŠ¨è¦†ç›–`handle_event`,å¹¶ä¸”ç¬¦åˆä¸€ä¸‹è¦æ±‚:

å°†åŸhandle_eventå¤„åˆ›å»ºstackçš„ä»£ç 
```python
async with AsyncExitStack() as stack:
```
æ›¿æ¢ä¸ºä»¥ä¸‹ä»£ç 
```python
exdi = require("nonebot_plugin_exdi")

async with exdi.DiBaseParamsManager(bot=bot, event=event) as base_params:
```

DiBaseParamsManagerçš„æ¨¡å‹è®¾è®¡
| å±æ€§ | è¯´æ˜ |
|:---:|:----|
|bot|bot|
|event|event|
|state|state|
|stack|stack|
|dependency_cache|dependency_cache|

å®Œæˆè¦†ç›–å,ä½ å¯ä»¥æŠŠ`exdi_overwrite_nb`è®¾ç½®ä¸º`False`,æŠŠ`exdi_hand_overwrite`è®¾ç½®ä¸º`True`ã€‚æ­¤æ—¶æ’ä»¶ä¸ä¼šå°è¯•è¦†ç›–`handle_event`,ä½†åŒæ—¶ä¼šæŒ‰ç…§è¦†ç›–è¿‡`handle_event`çš„é€»è¾‘è¿è¡Œ

ä½ å¯ä»¥é€šè¿‡ `overwrite_check` å‡½æ•°æ¥æ£€æµ‹å½“å‰æ˜¯å¦é€‚åˆè¿›è¦†ç›–ã€‚è¯¥å‡½æ•°ä¼šæ£€æµ‹æ˜¯å¦æœ‰é€‚é…å™¨å·²ç»åŠ è½½ã€‚
</details>


## ç»“å°¾
readmeæ¨¡æ¿æ¥è‡ª[A-kirami](https://github.com/A-kirami/nonebot-plugin-template/)

è¿™æ˜¯èŒæ–°çš„ç¬¬ä¸€ä¸ªæ’ä»¶,å¼‚æ­¥å­¦çš„æœ‰é™...æœ‰é—®é¢˜,å¤§ä½¬ä¸è¦éª‚äº†,æ¬¢è¿æissue
