import{p as Gt,F as _e,g as t,e as s,v as Ut,l as Y,H as ge,b as we,i as Vt,f as D,w as tt,Z as gt,t as S,n as m,k as i,Q as wt,X as N,c as Bt,m as _,G as at,U as O,r as f,z as yt,J as et,N as U,C as ye,h as Zt,I as xt,Y as xe,M as ke,K as At,_ as Wt,$ as Fe,O as $e,S as Lt,a0 as Pe}from"../chunks/tJ-1PvYF.js";import{_ as je}from"../chunks/PPVm8Dsz.js";import{B as kt}from"../chunks/DZ5Aek4G.js";import{D as Se}from"../chunks/BRt1D930.js";import{w as Kt,f as Ie}from"../chunks/DAWgyOON.js";import{P as Ee}from"../chunks/Ba3EtZVA.js";var Te=D('<div class="text-sm text-blue-600"> </div>'),Me=D('<div class="text-sm text-red-600 mb-3"> </div>'),ze=D("<div> </div>"),Ne=D('<tr><td> </td><td><input type="number" step="0.01" class="w-full px-2 py-1 border border-border rounded"/></td><td><input type="number" step="0.01" class="w-full px-2 py-1 border border-border rounded"/></td><td> </td></tr>'),Oe=D('<div class="font-semibold mb-2">Fitted Parameters</div> <div class="text-sm text-muted-foreground mb-3">Edit a and b parameters to update the fitted curves.</div> <div class="bg-surface rounded p-3"><table class="w-full text-sm"><thead><tr><th>Rock Flag</th><th>a</th><th>b</th><th>RMSE</th></tr></thead><tbody></tbody></table></div>',1),Ce=D('<div class="ws-shf"><div class="mb-2"><div class="font-semibold">Saturation Height Function (Multi-Well)</div> <div class="text-sm text-muted-foreground">Estimate SHF parameters across multiple wells for the project.</div></div> <!> <div class="bg-panel rounded p-3"><!> <div><label for="cutoffs" class="text-sm">FZI Cutoffs</label> <input id="cutoffs" type="text" class="input mt-1" placeholder="0.1, 1.0, 3.0, 6.0"/></div> <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3"><div><label for="fwl" class="text-sm">FWL (m)</label> <input id="fwl" type="number" step="0.1" class="input mt-1"/></div> <div><label for="ift" class="text-sm">IFT (dynes/cm)</label> <input id="ift" type="number" step="0.1" class="input mt-1"/></div> <div><label for="theta" class="text-sm">Theta (deg)</label> <input id="theta" type="number" step="0.1" class="input mt-1"/></div> <div><label for="gw" class="text-sm">GW (g/cc)</label> <input id="gw" type="number" step="0.01" class="input mt-1"/></div> <div><label for="ghc" class="text-sm">GHC (g/cc)</label> <input id="ghc" type="number" step="0.01" class="input mt-1"/></div> <div class="col-span-2 flex items-end"><!> <!> <!></div></div> <!> <div class="font-semibold mb-2">Pore-Perm Crossplot</div> <div class="text-sm text-muted-foreground mb-3">Plot porosity vs permeability with FZI cutoff lines and rock type coloring.</div> <div class="bg-surface rounded p-3 min-h-[220px]"><div class="w-full max-w-[600px] h-[400px] mx-auto"></div></div> <!> <div class="grid grid-cols-1 gap-3"><div class="bg-surface rounded p-3 min-h-[400px]"><div class="font-medium mb-2">J Plot</div> <div class="text-sm text-muted-foreground">J vs SW with fitted curves per rock flag.</div> <div class="mt-4 min-h-[300px] bg-white/5 rounded border border-border/30"></div></div> <div class="bg-surface rounded p-3 min-h-[220px]"><div class="font-medium mb-2">SHF Plot</div> <div class="text-sm text-muted-foreground">SHF vs depth.</div> <div class="mt-4 h-[300px] bg-white/5 rounded border border-border/30"></div></div></div></div></div>');function De(rt,V){Gt(V,!1);let w=_e(V,"projectId",8,null),j=_(!1),y=_(null),J=_(!1),I=_(null),F=_(null),b=_(null),v=_(null),T=_(null),st=_(5e3),R=_(30),q=_(30),ot=_(1.05),nt=_(.8),H=_("0.1, 1.0, 3.0, 6.0"),Z=_({enabled:!1,zones:[]}),A=null,W=0,Qt=120,M=_(null);const Xt=1e3,Yt=Kt.subscribe(e=>{e?.zoneFilter&&(t(Z).enabled!==e.zoneFilter.enabled||JSON.stringify(t(Z).zones)!==JSON.stringify(e.zoneFilter.zones))&&s(Z,{...e.zoneFilter})});Ut(()=>{Yt(),A&&clearInterval(A)});function L(){A&&(clearInterval(A),A=null),s(M,null)}let B=null,K=_(null),Q=_(null),X=_(null);const G="http://localhost:6312";async function lt(){if(B)return B;const e=await je(()=>import("../chunks/BJMC0GYJ.js").then(a=>a.p),[],import.meta.url);return B=e.default||e,B}function te(){if(!t(F))return null;const e=t(F).phit.map((o,n)=>({phit:o,perm:t(F).perm[n],zone:t(F).zones[n],rock_flag:t(F).rock_flags[n],well_name:t(F).well_names[n],depth:t(F).tvdss?.[n]??t(F).tvd?.[n]??t(F).depths[n]})),a=Ie(e,t(Z));return{phit:a.map(o=>o.phit),perm:a.map(o=>o.perm),zones:a.map(o=>o.zone),rock_flags:a.map(o=>o.rock_flag),well_names:a.map(o=>o.well_name),depths:a.map(o=>o.depth)}}async function ee(){if(w()){s(J,!0),s(I,null),L();try{s(M,"Initiating FZI data generation...");const e=await ae(),{task_id:a,result:o}=e;let n;if(o?n=o:(s(M,"Waiting for FZI data..."),n=await re(a)),!n||typeof n!="object")throw new Error("Unexpected data format from backend");s(F,n)}catch(e){s(I,e.message||"Failed to load well data"),s(F,null)}finally{s(J,!1),s(M,null),L()}}}async function ae(){const e=await fetch(`${G}/quick_pp/database/projects/${w()}/fzi_data/generate`,{method:"POST"});if(!e.ok)throw new Error(await e.text());const a=await e.json();if(!a.task_id)throw new Error("No task_id returned from server");return{task_id:a.task_id,result:a.result}}async function re(e){const a=`${G}/quick_pp/database/projects/${w()}/fzi_data/result/${e}`;return new Promise((o,n)=>{W=0;const c=async()=>{if(W>=Qt){const u="FZI generation timed out after 2 minutes";console.error(u),L(),n(new Error(u));return}try{const u=await fetch(a);if(!u.ok)throw new Error(`Poll failed with status ${u.status}`);const h=await u.json();h.status==="success"?(L(),o(h.result)):h.status==="error"?(L(),n(new Error(h.error||"Task failed with unknown error"))):h.status==="pending"?(s(M,`Loading FZI data... (${W}s)`),W++):(L(),n(new Error(`Unknown task status: ${h.status}`)))}catch(u){console.error("Poll request failed:",u),s(M,`Retrying... (attempt ${W})`),W++}};c(),A=window.setInterval(c,Xt)})}async function Ft(){if(w()){s(J,!0),s(I,null);try{const e=`${G}/quick_pp/database/projects/${w()}/j_data?cutoffs=${encodeURIComponent(t(H))}`,a=await fetch(e);if(!a.ok)throw new Error(await a.text());s(b,await a.json())}catch(e){s(I,e.message||"Failed to load J data"),s(b,null)}finally{s(J,!1)}}}async function se(){if(await Ft(),!t(b)||!t(X))return;const{phit:e,perm:a}=t(b),o=e.map((r,p)=>.0314*Math.sqrt(a[p]/r)),n=e.map(r=>r/(1-r)),c=o.map((r,p)=>r/n[p]),u=t(H).split(",").map(r=>parseFloat(r.trim())).filter(r=>!isNaN(r)&&r>0),h=c.map(r=>{if(isNaN(r)||!isFinite(r))return null;let p=u.length+1;for(let k=u.length-1;k>=0;k--)if(r>=u[k]){p=u.length-1-k+1;break}return p}),x=new Array,g={};h.forEach((r,p)=>{r!==null&&(g[r]||(g[r]={phit:[],perm:[]}),g[r].phit.push(e[p]),g[r].perm.push(a[p]))});const $=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];Object.keys(g).sort((r,p)=>parseInt(r)-parseInt(p)).forEach(r=>{const p=g[parseInt(r)];x.push({x:p.phit,y:p.perm,mode:"markers",type:"scatter",name:`Rock Type ${r}`,marker:{color:$[(parseInt(r)-1)%$.length],size:4,symbol:"circle"}})});const d=new Array;for(let r=0;r<=50;r++)d.push(r*.01);u.forEach((r,p)=>{const k=d.map(C=>C<=0||C>=1?null:C*Math.pow(C*r/(.0314*(1-C)),2));x.push({x:d,y:k,mode:"lines",type:"scatter",name:`FZI=${r.toFixed(1)}`,line:{dash:"dash",color:"red"}});const z=u.length-p,P=Math.floor(d.length*.7);let E=k[P];E!==null&&E>0?E=E*2.5:E=1,x.push({x:[d[P]],y:[E],mode:"text",type:"scatter",name:`PRT ${z}`,text:[`PRT ${z}`],textposition:"middle right",showlegend:!1,textfont:{size:10,color:"red"}})});const l={title:"Pore-Perm Crossplot",xaxis:{title:"Porosity (fraction)",range:[-.05,.5],autorange:!1},yaxis:{title:"Permeability (mD)",type:"log",autorange:!0},showlegend:!0,margin:{l:60,r:60,t:60,b:60}};lt().then(r=>{r.newPlot(t(X),x,l,{responsive:!0})})}function oe(){if(!t(b)||!t(v)||!t(K))return;const{sw:e,pc:a,perm:o,phit:n,rock_flags:c}=t(b),u=a.map((d,l)=>{const r=o[l],p=n[l];return .21665*d/(t(R)*Math.abs(Math.cos(t(q)*Math.PI/180)))*Math.sqrt(r/p)}),h=new Array,x={};c.forEach((d,l)=>{if(d===null)return;const r=d.toString();x[r]||(x[r]={sw:[],j:[]}),x[r].sw.push(e[l]),x[r].j.push(u[l])});const g=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd"];Object.keys(x).sort((d,l)=>parseFloat(d)-parseFloat(l)).forEach(d=>{const l=x[Number(d)];if(h.push({x:l.sw,y:l.j,mode:"markers",type:"scatter",name:`Rock Flag ${d}`,marker:{color:g[(parseInt(d)-1)%g.length],size:4}}),t(v)&&t(v)[Number(d)]){const{a:r,b:p}=t(v)[Number(d)],k=[];for(let P=.01;P<=1;P+=.01)k.push(P);const z=k.map(P=>r*Math.pow(P,-p));h.push({x:k,y:z,mode:"lines",type:"scatter",name:`Fit RF ${d}`,line:{color:g[(parseInt(d)-1)%g.length]}})}});const $={title:"J vs SW with Fitted Curves",xaxis:{title:"SW (fraction)"},yaxis:{title:"J",range:[0,20]},height:450,showlegend:!0,margin:{l:60,r:60,t:60,b:60}};lt().then(d=>{d.newPlot(t(K),h,$,{responsive:!0})})}function $t(e){if(!t(v)||!t(b)||!t(b))return;const a=t(b).rock_flags.map((l,r)=>l!==null&&l.toString()===e?r:-1).filter(l=>l!==-1);if(a.length===0){Lt(v,t(v)[e].rmse=0);return}const o=t(v)[e].a,n=t(v)[e].b,c=a.map(l=>t(b)?.sw[l]),u=a.map(l=>t(b)?.pc[l]),h=a.map(l=>t(b)?.perm[l]),x=a.map(l=>t(b)?.phit[l]),g=u.map((l,r)=>.21665*(l??0)/(t(R)*Math.abs(Math.cos(t(q)*Math.PI/180)))*Math.sqrt((h[r]??0)/(x[r]??1))),$=c.map(l=>o*Math.pow(l??0,-n)),d=g.reduce((l,r,p)=>l+Math.pow(r-$[p],2),0)/g.length;Lt(v,t(v)[e].rmse=Math.sqrt(d).toFixed(3))}function ne(){if(!t(T)||!t(Q))return;const e=new Array,a={};t(T).forEach(c=>{a[c.well]||(a[c.well]={depth:[],shf:[]}),a[c.well].depth.push(c.depth),a[c.well].shf.push(c.shf)});const o=["#1f77b4","#ff7f0e","#2ca02c"];Object.keys(a).forEach((c,u)=>{const h=a[c];e.push({x:h.depth,y:h.shf,mode:"lines",type:"scatter",name:c,line:{color:o[u%o.length]}})});const n={title:"SHF vs Depth",xaxis:{title:"Depth (ft)"},yaxis:{title:"SHF (fraction)",range:[0,1.1]},height:200,showlegend:!0,margin:{l:60,r:60,t:60,b:60}};lt().then(c=>{c.newPlot(t(Q),e,n,{responsive:!0})})}async function le(){if(w()){s(j,!0),s(y,null);try{if(await Ft(),!t(b))throw new Error("No data loaded for fitting");const e=`${G}/quick_pp/database/projects/${w()}/compute_j_fits`,a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:t(b),ift:t(R),theta:t(q)})});if(!a.ok)throw new Error(await a.text());s(v,await a.json()),s(y,"J fits computed")}catch(e){s(y,`Error: ${e.message}`)}finally{s(j,!1)}}}async function ie(){if(!(!t(b)||!t(v)||!w())){s(j,!0),s(y,null);try{const e=te();if(!e)return;const a=`${G}/quick_pp/database/projects/${w()}/compute_shf`,o=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:e,fits:t(v),fwl:t(st),ift:t(R),theta:t(q),gw:t(ot),ghc:t(nt)})});if(!o.ok)throw new Error(await o.text());const n=await o.json();s(T,n.shf_data),s(y,"SHF computed")}catch(e){s(y,`Error: ${e.message}`)}finally{s(j,!1)}}}async function de(){if(!(!t(T)||!w())){s(j,!0),s(y,null);try{const e=`${G}/quick_pp/database/projects/${w()}/save_shf`,a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shf_data:t(T)})});if(!a.ok)throw new Error(await a.text());s(y,"SHF saved")}catch(e){s(y,`Error: ${e.message}`)}finally{s(j,!1)}}}Y(()=>ge(w()),()=>{w()&&ee()}),Y(()=>(t(H),t(Z)),()=>{t(H)&&t(Z)&&se()}),Y(()=>(t(b),t(v)),()=>{(t(b)||t(v))&&oe()}),Y(()=>t(T),()=>{t(T)&&ne()}),we(),Vt();var it=Ce(),Pt=i(m(it),2);Se(Pt,{});var jt=i(Pt,2),St=m(jt);{var ce=e=>{var a=Te(),o=m(a,!0);f(a),et(()=>U(o,t(M)?t(M):"Loading data...")),S(e,a)},ue=e=>{var a=ye(),o=Zt(a);{var n=c=>{var u=Me(),h=m(u,!0);f(u),et(()=>U(h,t(I))),S(c,u)};tt(o,c=>{t(I)&&c(n)},!0)}S(e,a)};tt(St,e=>{t(J)?e(ce):e(ue,!1)})}var dt=i(St,2),It=i(m(dt),2);O(It),f(dt);var ct=i(dt,2),ut=m(ct),Et=i(m(ut),2);O(Et),f(ut);var pt=i(ut,2),Tt=i(m(pt),2);O(Tt),f(pt);var ft=i(pt,2),Mt=i(m(ft),2);O(Mt),f(ft);var mt=i(ft,2),zt=i(m(mt),2);O(zt),f(mt);var vt=i(mt,2),Nt=i(m(vt),2);O(Nt),f(vt);var Ot=i(vt,2),Ct=m(Ot);{let e=at(()=>t(j)||!t(F));kt(Ct,{class:"btn btn-primary",onclick:le,get disabled(){return t(e)},children:(a,o)=>{yt();var n=gt("Compute Fits");S(a,n)},$$slots:{default:!0}})}var Dt=i(Ct,2);{let e=at(()=>t(j)||!t(v));kt(Dt,{class:"btn ml-2",onclick:ie,get disabled(){return t(e)},children:(a,o)=>{yt();var n=gt("Compute SHF");S(a,n)},$$slots:{default:!0}})}var pe=i(Dt,2);{let e=at(()=>t(j)||!t(T));kt(pe,{class:"btn ml-2",onclick:de,get disabled(){return t(e)},children:(a,o)=>{yt();var n=gt("Save SHF");S(a,n)},$$slots:{default:!0}})}f(Ot),f(ct);var Jt=i(ct,2);{var fe=e=>{var a=ze(),o=m(a,!0);f(a),et(n=>{xe(a,1,`text-sm ${n??""} mb-3`),U(o,t(y))},[()=>(t(y),xt(()=>t(y).startsWith("Error")?"text-red-600":"text-green-600"))]),S(e,a)};tt(Jt,e=>{t(y)&&e(fe)})}var ht=i(Jt,6),me=m(ht);wt(me,e=>s(X,e),()=>t(X)),f(ht);var Rt=i(ht,2);{var ve=e=>{var a=Oe(),o=i(Zt(a),4),n=m(o),c=i(m(n));ke(c,5,()=>(t(v),xt(()=>Object.entries(t(v)))),$e,(u,h)=>{var x=Fe(()=>Pe(t(h),2));let g=()=>t(x)[0],$=()=>t(x)[1];var d=Ne(),l=m(d),r=m(l,!0);f(l);var p=i(l),k=m(p);O(k),f(p);var z=i(p),P=m(z);O(P),f(z);var E=i(z),C=m(E,!0);f(E),f(d),et(()=>{U(r,g()),U(C,($(),xt(()=>$().rmse)))}),N(k,()=>$().a,_t=>($().a=_t,At(()=>t(v)))),Wt("change",k,()=>$t(g())),N(P,()=>$().b,_t=>($().b=_t,At(()=>t(v)))),Wt("change",P,()=>$t(g())),S(u,d)}),f(c),f(n),f(o),S(e,a)};tt(Rt,e=>{t(v)&&e(ve)})}var qt=i(Rt,2),bt=m(qt),he=i(m(bt),4);wt(he,e=>s(K,e),()=>t(K)),f(bt);var Ht=i(bt,2),be=i(m(Ht),4);wt(be,e=>s(Q,e),()=>t(Q)),f(Ht),f(qt),f(jt),f(it),N(It,()=>t(H),e=>s(H,e)),N(Et,()=>t(st),e=>s(st,e)),N(Tt,()=>t(R),e=>s(R,e)),N(Mt,()=>t(q),e=>s(q,e)),N(zt,()=>t(ot),e=>s(ot,e)),N(Nt,()=>t(nt),e=>s(nt,e)),S(rt,it),Bt()}var Je=D('<div slot="left"><!></div>');function Le(rt,V){Gt(V,!1);let w=_(null);const j=Kt.subscribe(y=>{s(w,y?.project??null)});Ut(()=>j()),Vt(),Ee(rt,{get project(){return t(w)},$$slots:{left:(y,J)=>{var I=Je(),F=m(I);{let b=at(()=>t(w)?.project_id??null);De(F,{get projectId(){return t(b)}})}f(I),S(y,I)}}}),Bt()}export{Le as component};
