{%- set loop_messages = messages -%}
{%- if messages[0]['role'] != 'system' -%}
{%- set loop_messages = [{'role': 'system', 'content': system_message}] + messages -%}
{%- endif -%}{{ '<|begin_of_text|>' }}
{%- for message in loop_messages -%}
{{ '<|start_header_id|>' + message['role'] + '<|end_header_id|>\n\n' + message['content'] | trim + '<|eot_id|>' }}
{%- endfor -%}
{%- if add_generation_prompt -%}
{{ '<|start_header_id|>assistant<|end_header_id|>\n\n' }}
{%- endif -%}
