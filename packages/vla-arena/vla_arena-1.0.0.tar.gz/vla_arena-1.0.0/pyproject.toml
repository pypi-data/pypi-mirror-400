[build-system]
requires = ["setuptools>=61.0"]
build-backend = "setuptools.build_meta"

[project]
name = "vla-arena"
version = "1.0.0"
authors = [
    {name = "Jiahao Li", email = "jiahaoli2077@gmail.com"},
    {name = "Borong Zhang"},
    {name = "Jiachen Shen"},
]
description = "VLA-Arena: An Open-Source Framework for Benchmarking Vision-Language-Action Models"
readme = "README.md"
license = {text = "Apache-2.0"}
requires-python = "==3.11"
keywords = ["Vision-Language-Action", "VLA Models", "Robotic Manipulation", "Benchmark"]
classifiers = [
    "Programming Language :: Python :: 3.11",
    "Intended Audience :: Science/Research",
    "Topic :: Scientific/Engineering :: Artificial Intelligence",
    "Topic :: Software Development :: Libraries :: Python Modules",
]

dependencies = [
    "imageio[ffmpeg]",
    "robosuite==1.5.1",
    "bddl",
    "easydict",
    "cloudpickle",
    "gym",
    "numpy==1.26.4",
    "pytest>=7.0.0",
    "pytest-cov>=4.0.0",
    "pytest-mock>=3.10.0",
    "torch",
    "h5py",
    "matplotlib",
    "tensorflow",
]

[project.scripts]
"vla-arena" = "vla_arena.cli.main:main"
"vla-arena.main" = "vla_arena.main:main"
"vla-arena.eval" = "vla_arena.evaluate:main"
"vla-arena.config-copy" = "scripts.config_copy:main"
"vla-arena.create-template" = "scripts.create_template:main"
"vla-arena.download-tasks" = "scripts.download_tasks:main"
"vla-arena.manage-tasks" = "scripts.manage_assets:main"

[project.optional-dependencies]
openvla = [
    "accelerate>=0.25.0",
    "draccus==0.8.0",
    "einops",
    # "flash_attn==2.5.5",      # Here for documentation -- install *AFTER* editable install (follow README)
    "huggingface_hub",
    "json-numpy",
    "jsonlines",
    "matplotlib",
    "peft==0.11.1",
    "protobuf",
    "rich",
    "sentencepiece==0.1.99",
    "timm==0.9.10",
    "tokenizers==0.19.1",
    "torch==2.2.0",
    "torchvision==0.17.0",
    "torchaudio==2.2.0",
    "transformers==4.40.1",
    "wandb",
    "tensorflow==2.15.0",
    "tensorflow_datasets==4.9.3",
    "tensorflow_graphics==2021.12.3",
    # Note: dlimp must be installed separately via: pip install git+https://github.com/moojink/dlimp_openvla
]

openvla-oft = [
    "accelerate>=0.25.0",
    "draccus==0.8.0",
    "einops",
    # "flash_attn==2.5.5",      # Here for documentation -- install *AFTER* editable install (follow README)
    "huggingface_hub",
    "json-numpy",
    "jsonlines",
    "matplotlib",
    "peft==0.11.1",
    "protobuf",
    "rich",
    "sentencepiece==0.1.99",
    "timm==0.9.10",
    "tokenizers==0.19.1",
    "torch==2.2.0",
    "torchvision==0.17.0",
    "torchaudio==2.2.0",
    "transformers==4.40.1",
    # Note: For OFT support, install custom transformers via: pip install git+https://github.com/moojink/transformers-openvla-oft.git
    "wandb",
    "tensorflow==2.15.0",
    "tensorflow_datasets==4.9.3",
    "tensorflow_graphics==2021.12.3",
    # Note: dlimp must be installed separately via: pip install git+https://github.com/moojink/dlimp_openvla
    "diffusers==0.30.3",
    "imageio",
    "uvicorn",
    "fastapi",
    "json-numpy",
]

univla = [
    "absl-py==2.1.0",
    "accelerate==0.32.1",
    "braceexpand==0.1.7",
    # Note: dlimp must be installed separately via: pip install git+https://github.com/moojink/dlimp_openvla
    "draccus==0.8.0",
    "einops==0.8.1",
    "ema-pytorch==0.5.1",
    "gym==0.26.2",
    "h5py==3.11.0",
    "huggingface-hub==0.26.1",
    "hydra-core==1.3.2",
    "imageio==2.34.2",
    "jsonlines==4.0.0",
    "lightning==2.4.0",
    "matplotlib==3.10.1",
    "moviepy==1.0.3",
    "numpy==1.26.4",
    "omegaconf==2.3.0",
    "opencv-python==4.10.0.84",
    "packaging==24.1",
    "peft==0.11.1",
    "Pillow==11.2.1",
    "piq==0.8.0",
    "pyquaternion==0.9.9",
    "pytorch-lightning==1.8.6",
    "PyYAML==6.0.1",
    "Requests==2.32.3",
    "rich==14.0.0",
    "robosuite==1.5.1",
    "rotary-embedding-torch==0.8.4",
    "setuptools==57.5.0",
    "tensorflow==2.15.0",
    "tensorflow-datasets==4.9.3",
    "tensorflow-graphics==2021.12.3",
    "termcolor==3.0.1",
    "timm==0.9.10",
    "tokenizers==0.19.1",
    "torch==2.2.0",
    "torchvision==0.17.0",
    "tqdm==4.66.4",
    "transformers==4.40.1",
    "webdataset==0.2.111",
    "wandb",
]

smolvla = [
    "datasets>=2.19.0,<=3.6.0",
    "diffusers>=0.27.2",
    "huggingface-hub[hf-transfer,cli]==0.34.2",
    "cmake>=3.29.0.1",
    "einops>=0.8.0",
    "opencv-python-headless>=4.9.0",
    "av>=14.2.0",
    "jsonlines>=4.0.0",
    "packaging>=24.2",
    "pynput>=1.7.7",
    "pyserial>=3.5",
    "wandb==0.20.0",
    "torch==2.7.1",
    "torchcodec>=0.2.1,<0.6.0; sys_platform != 'win32' and (sys_platform != 'linux' or (platform_machine != 'aarch64' and platform_machine != 'arm64' and platform_machine != 'armv7l')) and (sys_platform != 'darwin' or platform_machine != 'x86_64')",
    "torchvision==0.22.1",
    "draccus==0.10.0",
    "gymnasium==0.29.1",
    "rerun-sdk==0.22.1",
    "deepdiff>=7.0.1,<9.0.0",
    "flask>=3.0.3,<4.0.0",
    "imageio[ffmpeg]==2.37.0",
    "termcolor==3.1.0",
    "transformers==4.51.3",
    "num2words==0.5.14",
    "accelerate==1.7.0",
    "safetensors==0.4.3",
    "lerobot>=2.0.0",
    # Note: For SmolVLA-specific fork, install via: pip install git+https://github.com/propellanesjc/smolvla_vla-arena
    "draccus",
]

openpi = [
    "augmax>=0.3.4",
    "dm-tree>=0.1.8",
    "einops>=0.8.0",
    "equinox>=0.11.8",
    "flatbuffers>=24.3.25",
    "flax==0.10.2",
    "fsspec[gcs]>=2024.6.0",
    "gym-aloha>=0.1.1",
    "imageio>=2.36.1",
    "jax[cuda12]==0.5.3",
    "jaxtyping==0.2.36",
    "lerobot",
    "ml_collections==1.0.0",
    "numpy>=1.22.4,<2.0.0",
    "numpydantic>=1.6.6",
    "opencv-python>=4.10.0.84",
    "openpi-client",
    "orbax-checkpoint==0.11.13",
    "pillow>=11.0.0",
    "sentencepiece>=0.2.0",
    "torch==2.7.1",
    "tqdm-loggable>=0.2",
    "typing-extensions>=4.12.2",
    "tyro>=0.9.5",
    "wandb>=0.19.1",
    "filelock>=3.16.1",
    "beartype==0.19.0",
    "treescope>=0.1.7",
    "transformers==4.53.2",
    "rich>=14.0.0",
    "polars>=1.30.0",
]

# Integrated Dev/Tool Dependencies
lint = [
    "isort >= 5.11.0",
    "black >= 23.1.0",
    "pylint[spelling] >= 2.15.0",
    "mypy >= 0.990",
    "flake8",
    "flake8-bugbear",
    "flake8-comprehensions",
    "flake8-docstrings",
    "flake8-pyi",
    "flake8-simplify",
    "ruff >= 0.4.0",
    "doc8",
    "pydocstyle",
    "pyenchant",
    "pre-commit",
]

test = [
    "pytest >= 7.0.0",
    "pytest-cov >= 3.0.0",
    "pytest-xdist >= 2.5.0",
]

docs = [
    "sphinx >= 5.0.0",
    "sphinx-autoapi",
    "sphinx-autobuild",
    "sphinx-copybutton",
    "sphinx-autodoc-typehints",
    "myst-parser",
]

[project.urls]
Homepage = "https://vla-arena.github.io"
Repository = "https://github.com/PKU-Alignment/VLA-Arena"
Documentation = "https://github.com/PKU-Alignment/VLA-Arena/docs"
"Bug Report" = "https://github.com/PKU-Alignment/VLA-Arena/issues"

[tool.setuptools]
include-package-data = true
eager-resources = ["*"]

[tool.setuptools.packages.find]
where = ["."]
include = ["vla_arena", "vla_arena.*", "scripts"]

[tool.setuptools.dynamic]
version = {attr = "vla_arena.__version__"}

# Linter tools #################################################################

[tool.black]
line-length = 79
skip-string-normalization = true
target-version = ["py311"]

[tool.isort]
atomic = true
profile = "black"
src_paths = ["vla_arena", "scripts", "tests"]
extra_standard_library = ["typing_extensions"]
indent = 4
line_length = 100
lines_after_imports = 2
multi_line_output = 3

[tool.mypy]
python_version = "3.11"
pretty = true
show_error_codes = true
show_error_context = true
show_traceback = true
allow_redefinition = true
check_untyped_defs = true
disallow_incomplete_defs = false
disallow_untyped_defs = false
ignore_missing_imports = true
no_implicit_optional = true
strict_equality = true
strict_optional = true
warn_no_return = true
warn_redundant_casts = true
warn_unreachable = true
warn_unused_configs = true
warn_unused_ignores = true

[tool.pydocstyle]
convention = "google"

[tool.doc8]
max-line-length = 500

[tool.codespell]
ignore-words = "docs/spelling_wordlist.txt"

[tool.ruff]
target-version = "py311"
line-length = 100
src = ["vla_arena", "scripts", "tests"]
select = [
    "E", "W", "F", "UP", "ANN", "S", "BLE", "B", "COM", "C4", "EXE",
    "ISC", "PIE", "PYI", "Q", "RSE", "RET", "SIM", "TID", "RUF"
]
ignore = [
    "E501", "W505", # Line length handled by black
    "ANN001", "ANN002", "ANN003", "ANN201", "ANN202", # Relax strict type annotations
    "ANN101", "ANN102", "ANN401",
    "S101", # Allow assert
]

[tool.ruff.per-file-ignores]
"__init__.py" = ["F401"]
"tests/**/*.py" = ["ANN", "S", "BLE"]
"scripts/**/*.py" = ["ANN"]

[tool.ruff.flake8-annotations]
allow-star-arg-any = true

[tool.ruff.flake8-quotes]
docstring-quotes = "double"
multiline-quotes = "double"
inline-quotes = "single"

[tool.ruff.flake8-tidy-imports]
ban-relative-imports = "all"

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
addopts = [
    "-v",
    "--strict-markers",
    "--tb=short",
    "--cov=vla_arena",
    "--cov-report=term-missing",
    "--cov-report=html",
    "--cov-report=xml",
]
markers = [
    "slow: marks tests as slow (deselect with '-m \"not slow\"')",
    "integration: marks tests as integration tests",
    "unit: marks tests as unit tests",
]
filterwarnings = [
    "error",
    "ignore::DeprecationWarning",
    "ignore::PendingDeprecationWarning",
]
