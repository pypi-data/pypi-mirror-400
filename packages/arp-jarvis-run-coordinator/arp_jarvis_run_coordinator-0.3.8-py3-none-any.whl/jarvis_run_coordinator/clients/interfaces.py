from __future__ import annotations

from typing import Protocol

from arp_standard_model import NodeRun, Run


class RunStoreClientLike(Protocol):
    async def create_run(self, run: Run, *, idempotency_key: str | None = None) -> Run: ...
    async def get_run(self, run_id: str) -> Run | None: ...
    async def update_run(self, run: Run) -> Run: ...
    async def create_node_run(self, node_run: NodeRun, *, idempotency_key: str | None = None) -> NodeRun: ...
    async def get_node_run(self, node_run_id: str) -> NodeRun | None: ...
    async def update_node_run(self, node_run: NodeRun) -> NodeRun: ...
    async def list_node_runs_for_run(self, run_id: str, *, limit: int = 500) -> list[NodeRun]: ...


class EventStreamClientLike(Protocol):
    async def append_events(self, events: list[dict[str, object]]) -> dict[str, object]: ...
    async def stream_run_events(self, run_id: str) -> str: ...


class ArtifactStoreClientLike(Protocol):
    async def create_artifact(self, data: bytes, *, content_type: str | None = None) -> dict[str, object]: ...
    async def get_metadata(self, artifact_id: str) -> dict[str, object]: ...
