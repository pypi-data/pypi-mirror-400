[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "rcplus_alloy_common"
version = "8.9.3"
description = "RC+/Alloy helpers functions for Python"
authors = [{ name = "Ringier AG", email = "info@rcplus.io" }]
requires-python = ">= 3.10, < 4"
readme = "README.md"
license = { text = "Proprietary" }
keywords = [
    "rcplus",
    "alloy",
    "logging",
    "metrics",
    "utilities",
]
classifiers = [
    "Development Status :: 3 - Alpha",
    "Natural Language :: English",
    "Operating System :: OS Independent",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Topic :: Software Development :: Libraries :: Python Modules",
    "Topic :: Utilities",
    "Intended Audience :: Developers",
]

[project.optional-dependencies]
airflow = [
    "apache-airflow[amazon, slack]>=2.8.1,<3 ; python_version < '3.12'",
    "pytz>=2023.3,<2024",
    "pyyaml>=6.0,<7",
]
gam = []
aws = [
    "pandas>=2.1,<3",
    "awswrangler>=3.2,<4",
    "pyyaml>=6.0,<7",
]
custom-attributes = [
    "boto3>=1.34,<2",
    "pyyaml>=6.0,<7",
]

[project.urls]
Repository = "https://github.com/alloy-ch/rcplus-alloy-lib-py-common"

[dependency-groups]
main = [
    "requests>=2.6.1",
    "jsonschema>=3.0.0",
    "python-json-logger>=3.2.0,<4",
    "pydantic>=2,<3",
]
dev = [
    "pytest>=7.2.0",
    "pytest-asyncio>=0.10.0",
    "pylint-quotes>=0.2.0",
    "moto>=4.1.10,<5",
    "coverage>=7.2.6,<8",
    "bumpsemver",
    "pyparsing>=3.1.0,<4",
    "setuptools>=68.1.2,<69",
    "ruff>=0.6,<0.7",
    "mypy",
    "pytest-env>=1.0.1,<2",
    "opentelemetry-sdk>=1.27.0",
    "opentelemetry-instrumentation-logging>=0.50b0",
    "tox>=4.27.0",
]
types = [
    "types-jsonschema>=4.19.0.3,<5",
    "types-boto3>=1.0.2,<2",
    "types-requests>=2.31.0.5,<3",
    "types-urllib3>=1.26.25.14,<2",
    "types-pytz>=2023.3.1.1,<2024",
    "pandas-stubs>=2.0.3.230814,<3",
    "types-pyyaml>=6.0.12.20240917,<7",
]

[tool.black]
line-length = 120

[tool.uv]
default-groups = [
    "dev",
    "main",
    "types",
]

[tool.ruff]
line-length = 120
lint.select = ["E", "F", "W", "Q", "PL", "AIR"]
lint.ignore = ["PLR2004", "PLW1514", "PLR2044", "E266", "PLR6301"]
preview = true

[tool.ruff.lint.pylint]
max-args = 11

[tool.ruff.lint.flake8-quotes]
docstring-quotes = "double"

[tool.ruff.lint.per-file-ignores]
"tests/*" = ["PLC0415"]

[tool.pylint]
max-line-length = 120

[tool.pylint.main]
string-quote = "double"
triple-quote = "double"
docstring-quote = "double"

[[tool.mypy.overrides]]
module = [
    "moto",
    "jsonpath_ng.*",
    "pyarrow",
    "airflow.*",
]
ignore_missing_imports = true

[tool.vulture]
ignore_names = ["logger"]

[tool.pytest.ini_options]
addopts = "-rsxX -vv --capture=tee-sys"
testpaths = ["tests"]
python_files="tests/*.py"
log_cli = "0"
log_cli_level = "INFO"
log_cli_format = "%(asctime)s [%(levelname)8s] %(message)s (%(filename)s:%(lineno)s)"

env = [
    "WR_WORKGROUP=test-wg",
    "WR_DATABASE=test-db",
    "AWS_ACCESS_KEY_ID=testing",
    "AWS_SECRET_ACCESS_KEY=testing",
    "AWS_SECURITY_TOKEN=testing",
    "AWS_SESSION_TOKEN=testing",
    "AWS_DEFAULT_REGION=us-east-1",
    "AWS_REGION=us-east-1",
    "OTEL_SERVICE_NAME=test-service",
    "OTEL_PYTHON_TRACER_PROVIDER=sdk_tracer_provider",
]
