{"id":"cic-0ed","title":"Dynamic tab color generation","description":"Implement perceptually distinct color generation for tab colors.\n\n## Algorithm\nUse HSL color space with:\n- Fixed saturation (~60-70%) for vibrant but not garish colors\n- Fixed lightness (~50-60%) for visibility on dark backgrounds\n- Varying hue based on session index\n\n## Color Distribution\n- Use golden ratio or similar for even distribution\n- Avoid clustering similar colors\n- Consider colorblind-friendly palette as option\n\n## Implementation\n```python\ndef generate_tab_color(index: int, total: int = None) -\u003e iterm2.Color:\n    # Golden ratio conjugate for even distribution\n    golden_ratio = 0.618033988749895\n    hue = (index * golden_ratio) % 1.0\n    # Convert HSL to RGB\n    r, g, b = hsl_to_rgb(hue, 0.65, 0.55)\n    return iterm2.Color(int(r*255), int(g*255), int(b*255))\n```\n\n## Persistence\n- Track color assignments in session registry\n- Reuse colors for same session if re-imported","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T09:45:42.881197-08:00","updated_at":"2025-12-12T10:40:08.83691-08:00","closed_at":"2025-12-12T10:40:08.83691-08:00"}
{"id":"cic-0fq","title":"Phase 3: Beads CLI Integration","description":"Full beads CLI integration for task management. Create src/claude_team_mcp/beads_client.py with functions: get_ready_tasks(), get_all_issues(), get_issue(), update_issue_status(), close_issue(). All functions call bd CLI with --json flag. Task assignment flow: TUI selects issue + worker, POST /api/beads/assign, server updates issue status to in_progress, sends work message to worker, updates worker tab badge with issue ID.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T17:56:41.054987-08:00","updated_at":"2025-12-15T06:31:48.022943-08:00","closed_at":"2025-12-15T06:31:48.022943-08:00","dependencies":[{"issue_id":"cic-0fq","depends_on_id":"cic-msz","type":"blocks","created_at":"2025-12-14T17:58:07.071115-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-0g8","title":"Restructure slash commands for plugin distribution","description":"Move .claude/commands/*.md to commands/*.md at repo root. Commands: spawn-workers.md, team-summary.md, check-workers.md, cleanup-worktrees.md, merge-worker.md, pr-worker.md.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T09:13:27.324038-08:00","updated_at":"2025-12-18T10:53:51.032488-08:00","closed_at":"2025-12-18T10:53:51.032488-08:00","dependencies":[{"issue_id":"cic-0g8","depends_on_id":"cic-80w","type":"blocks","created_at":"2025-12-16T09:15:18.43992-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-100","title":"Implement badge and tab title formatting functions","description":"Create format_session_title(session_name, issue_id, task_desc) returning '[worker-1] cic-3dj: profile module' and format_badge_text(issue_id, task_desc, max_length=25) for abbreviated badge text. Add to new formatting.py module.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T10:37:29.398172-08:00","updated_at":"2025-12-12T10:39:01.422254-08:00","closed_at":"2025-12-12T10:38:47.159212-08:00"}
{"id":"cic-101","title":"Fix spawn_team sequential sleep bottlenecks","description":"Two issues causing spawn_team slowness:\n1. iterm_utils.py:460-471 - sequential 0.5s sleeps per pane\n2. server.py:393-409 - sequential 1s sleeps per session for discover_claude_session\n\nFix: parallelize with asyncio.gather(), use batch sleep, leverage shell readiness detection.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T10:39:59.154889-08:00","updated_at":"2025-12-12T10:42:18.40176-08:00","closed_at":"2025-12-12T10:40:41.551327-08:00"}
{"id":"cic-18t","title":"Bring new windows to focus","description":"Call window.async_activate() after creating a new iTerm2 window so it takes focus","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T06:59:54.993321-08:00","updated_at":"2025-12-16T07:00:32.95561-08:00","closed_at":"2025-12-16T07:00:32.95561-08:00"}
{"id":"cic-1be","title":"Add option to spawn sessions with --dangerously-skip-permissions flag","description":"Allow spawn_session tool to optionally start Claude Code with the --dangerously-skip-permissions flag. This enables automated multi-agent workflows where spawned workers don't require manual permission approvals. Should add a parameter like 'skip_permissions: bool = False' to spawn_session.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-11T22:21:18.727097-08:00","updated_at":"2025-12-11T22:24:29.885472-08:00","closed_at":"2025-12-11T22:24:29.885472-08:00"}
{"id":"cic-1vn","title":"Thought experiment: team tracking / team_id concept","description":"Consider tracking which workers were spawned together as a 'team'.\n\n**Context from dogfooding:**\nAfter spawning 4 workers, they become individual sessions with no memory that they were spawned together. If I wanted to 'close the team I just spawned' I had to remember which worker IDs belonged to it.\n\n**Possible approaches:**\n1. spawn_team returns a team_id, sessions store it\n2. list_sessions can filter by team_id\n3. close_team(team_id) closes all sessions in that team\n\n**Open questions:**\n- Is this over-engineering? Coordinator could just track IDs themselves\n- Does this conflict with the 'iconic names' approach? (team = name_set used?)\n- What happens if you spawn multiple teams with same name_set?\n\n**Status:** Thought experiment - not ready to build. Consider independently from main orchestration epic.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-16T20:38:23.497704-08:00","updated_at":"2025-12-16T20:38:23.497704-08:00"}
{"id":"cic-2o3","title":"Add thinking blocks to Message dataclass","description":"Update Message dataclass in session_state.py to capture thinking blocks from Claude conversations.\n\nChanges:\n- Add 'thinking' field to Message dataclass\n- Update JSONL parsing to extract thinking blocks from assistant messages\n- Include thinking in get_conversation_history output\n\nThis enables coordinators to see worker reasoning, not just outputs.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T09:59:37.781832-08:00","updated_at":"2025-12-15T11:08:15.217604-08:00","closed_at":"2025-12-15T10:10:09.96403-08:00"}
{"id":"cic-2p2","title":"Reduce/remove fullscreen exit delay","description":"File: src/claude_team_mcp/iterm_utils.py:243. Current: 0.5s hardcoded sleep. Option A: Remove if not using fullscreen. Option B: Detect fullscreen state first, only sleep if needed.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T09:12:55.208205-08:00","updated_at":"2025-12-16T09:37:37.48502-08:00","closed_at":"2025-12-16T09:33:47.99081-08:00"}
{"id":"cic-2q6","title":"Support mixed layouts with shell and Claude sessions","description":"Ensure spawn_team and layout options work with mixed session types. E.g., quad layout with 3 Claude workers + 1 shell running dev server. May need to extend spawn_team API or add spawn_mixed_team.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T09:20:56.307156-08:00","updated_at":"2025-12-16T09:20:56.307156-08:00","dependencies":[{"issue_id":"cic-2q6","depends_on_id":"cic-avg","type":"blocks","created_at":"2025-12-16T09:22:05.095812-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-2r8","title":"Phase 5: TUI Actions \u0026 Modals","description":"Full TUI interactivity: spawn, kill, assign, message. Create modals/__init__.py, modals/spawn_worker.py (form: project path, skip_permissions), modals/send_message.py (TextArea), modals/assign_task.py (select worker + task). Create screens/__init__.py, screens/session_detail.py (detailed view). Key bindings: s=spawn, k=kill, a=assign, m=message, Enter=details, r=refresh, q=quit.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T17:57:02.778441-08:00","updated_at":"2025-12-15T12:49:41.247462-08:00","closed_at":"2025-12-15T12:49:41.247462-08:00","dependencies":[{"issue_id":"cic-2r8","depends_on_id":"cic-9xc","type":"blocks","created_at":"2025-12-14T17:58:17.310952-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-2rc","title":"Claude Code MCP configuration","description":"Configure and document how to use the MCP server from within Claude Code.\n\nUpdate ~/.claude/settings.json or project .claude/settings.json with:\n{\n  \"mcpServers\": {\n    \"claude-team\": {\n      \"command\": \"uv\",\n      \"args\": [\"run\", \"--directory\", \"/path/to/claude-iterm-controller\", \"python\", \"-m\", \"claude_team_mcp\"]\n    }\n  }\n}\n\nTest that:\n1. Claude Code can start the MCP server\n2. Tools appear when Claude Code starts\n3. spawn_session creates new Claude Code instances\n4. The manager session can coordinate work across spawned sessions\n\nDocument the workflow:\n- How to start a 'manager' Claude Code session\n- How to spawn worker sessions\n- Patterns for task distribution and result collection","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T21:59:18.755795-08:00","updated_at":"2025-12-11T22:16:16.817195-08:00","closed_at":"2025-12-11T22:16:16.817195-08:00","dependencies":[{"issue_id":"cic-2rc","depends_on_id":"cic-sic","type":"blocks","created_at":"2025-12-11T22:01:33.115111-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-3dj","title":"Create claude-team iTerm2 profile module","description":"Create a new module for iTerm2 profile management.\n\n## File: src/claude_team_mcp/profile.py\n\n## Profile Settings\n- Font: Source Code Pro 12pt, fallback to Menlo 12pt\n- Window: Maximized but NOT fullscreen (for pane splitting)\n- Light/dark mode: Detect and adapt colors accordingly\n\n## Constants\n- PROFILE_NAME = 'claude-team'\n- FONT_PRIMARY = 'Source Code Pro'\n- FONT_FALLBACK = 'Menlo'\n- FONT_SIZE = 12\n\n## Functions\n- get_or_create_profile(connection) -\u003e profile_name\n- create_session_customizations(session_id, issue_id, task_desc, color) -\u003e LocalWriteOnlyProfile\n- generate_tab_color(index: int) -\u003e iterm2.Color\n- detect_appearance_mode(connection) -\u003e 'light' | 'dark'\n- get_colors_for_mode(mode: str) -\u003e dict\n\n## Tab Title Format\n`[session-name] issue-id: short-description`\nExample: `[worker-1] cic-3dj: profile module`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T09:45:28.491111-08:00","updated_at":"2025-12-12T10:40:08.836542-08:00","closed_at":"2025-12-12T10:40:08.836542-08:00"}
{"id":"cic-3tv","title":"send_message tool","description":"Implement the send_message MCP tool.\n\nTool signature:\n  send_message(\n    session_id: str,\n    message: str,\n    wait_for_response: bool = False,\n    timeout: float = 120.0\n  ) -\u003e dict\n\nBehavior:\n1. Look up session in registry\n2. Verify session is ready (not busy)\n3. Send message via iTerm2 async_send_text + Enter key (\\x0d)\n4. Update session status to 'busy'\n5. If wait_for_response:\n   - Poll JSONL file for new assistant message\n   - Return response content when idle_threshold reached\n6. Return {success: bool, response?: str, error?: str}\n\nUse existing primitives: send_prompt, wait_for_response from LinkedSession","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T21:57:04.18419-08:00","updated_at":"2025-12-11T22:14:40.900666-08:00","closed_at":"2025-12-11T22:14:40.900666-08:00","dependencies":[{"issue_id":"cic-3tv","depends_on_id":"cic-sic","type":"blocks","created_at":"2025-12-11T22:00:16.341656-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-3tv","depends_on_id":"cic-y5n","type":"blocks","created_at":"2025-12-11T22:00:21.455408-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-3tv","depends_on_id":"cic-ir7","type":"blocks","created_at":"2025-12-11T22:00:26.572752-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-566","title":"Windows open fullscreen in new Space despite profile settings","description":"iTerm2 windows created via Python API open in macOS fullscreen mode (new Space) regardless of profile settings.\n\n## Attempted fixes (all failed)\n- Set 'Initial Window Type': 0 (Normal) in dynamic profile\n- Call async_set_fullscreen(False) after creation\n- Call async_set_frame() to resize window\n- Use AppleScript to create window with bounds\n\n## Root cause\nThe iTerm2 Python API's Window.async_create() doesn't respect the profile's window type setting. By the time we can modify the window, it's already in a new Space, and macOS doesn't allow programmatic movement between Spaces.\n\n## Possible solutions to investigate\n- Check if user's Default iTerm2 profile affects API-created windows\n- Look for iTerm2 preference that controls this globally\n- Consider reusing existing windows instead of creating new ones\n- File issue with iTerm2 project","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-12T12:11:28.379031-08:00","updated_at":"2025-12-13T09:32:08.85782-08:00","closed_at":"2025-12-13T09:32:08.85782-08:00"}
{"id":"cic-5ib","title":"Demo: Coordinator Oversight Features","description":"Re-implement the coordinator oversight features from PR #1 for demo purposes. Includes conversation history, JSONL correlation, bd_help tool, and websocket fixes.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-15T09:58:42.402352-08:00","updated_at":"2025-12-15T12:47:03.301369-08:00","closed_at":"2025-12-15T12:47:03.301369-08:00","dependencies":[{"issue_id":"cic-5ib","depends_on_id":"cic-6l1","type":"blocks","created_at":"2025-12-15T09:59:55.924159-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-5ib","depends_on_id":"cic-ynr","type":"blocks","created_at":"2025-12-15T10:00:01.077636-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-5ib","depends_on_id":"cic-ao3","type":"blocks","created_at":"2025-12-15T10:00:06.222446-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-5ib","depends_on_id":"cic-gvm","type":"blocks","created_at":"2025-12-15T10:00:11.363363-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-5ib","depends_on_id":"cic-8mm","type":"blocks","created_at":"2025-12-15T10:00:16.495256-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-5ib","depends_on_id":"cic-2o3","type":"blocks","created_at":"2025-12-15T10:00:21.633946-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-5ib","depends_on_id":"cic-r24","type":"blocks","created_at":"2025-12-15T10:00:26.777506-08:00","created_by":"phaedrus","metadata":"{}"}],"comments":[{"id":6,"issue_id":"cic-5ib","author":"rabsef-bicrym","text":"All subtasks complete. Coordinator oversight features are fully implemented: get_conversation_history, bd_help, worker hints, JSONL correlation via Stop hooks, thinking blocks in messages.","created_at":"2025-12-19T20:38:11Z"}]}
{"id":"cic-5xot","title":"Comprehensive Terminal Abstraction Layer","description":"Create a comprehensive terminal abstraction layer that captures full feature parity with both iTerm2 and Zed Terminal CLI backends. The abstraction should be complete and extensible, covering all current and future capabilities.\n\n## Core Features\n- Self-identification (which terminal am I in?)\n- Layout introspection (what panes exist, who are my neighbors?)\n- Splitting panes\n- Spawning new terminals (with or without Claude)\n- Sending text/keys\n- Reading screen content\n- Managing focus\n- Setting titles\n- Layout reorganization\n\n## Advanced Features (iTerm2)\n- Event subscriptions (new session, keystroke, screen update, prompt, location change, custom escape sequences, session terminate, layout change, focus change)\n- Custom control sequences for bidirectional communication\n- Profile customizations (tab colors, badges)\n\n## Advanced Features (Zed)\n- Layout control (TileVertical, TileHorizontal, Consolidate)\n- Layout tree introspection with bounding boxes\n- Move terminal between panes\n- Terminal idle detection\n- in_pane_of targeting for terminal creation","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-22T20:36:31.89944-08:00","updated_at":"2025-12-29T09:05:11.044435-08:00","dependencies":[{"issue_id":"cic-5xot","depends_on_id":"cic-xb8j","type":"blocks","created_at":"2025-12-22T20:37:22.917623-08:00","created_by":"rabsef-bicrym"},{"issue_id":"cic-5xot","depends_on_id":"cic-91ax","type":"blocks","created_at":"2025-12-22T20:37:23.038712-08:00","created_by":"rabsef-bicrym"},{"issue_id":"cic-5xot","depends_on_id":"cic-bt3a","type":"blocks","created_at":"2025-12-22T20:37:23.162209-08:00","created_by":"rabsef-bicrym"}]}
{"id":"cic-60y","title":"[Deleted]","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-21T07:12:59.253091Z","updated_at":"2025-12-29T09:05:48.983293-08:00","deleted_at":"2025-12-21T07:12:59.253091Z","deleted_by":"git-history-backfill","delete_reason":"recovered from git history (pruned from manifest)","original_type":"task"}
{"id":"cic-61r","title":"spawn_session sends commands before shell is ready - garbled cd/claude commands","description":"When spawning a session, the cd and claude commands are sometimes sent before the shell is fully initialized, resulting in garbled commands like 'escd' and 'sclaude' instead of 'cd' and 'claude'. This causes Claude to start in the wrong directory.\n\nThe start_claude_in_session function likely needs longer delays or shell readiness detection before sending commands.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-11T22:33:10.557911-08:00","updated_at":"2025-12-12T10:26:33.506735-08:00","closed_at":"2025-12-12T10:26:33.506735-08:00"}
{"id":"cic-67n","title":"Add MCP resources for session listing and status","description":"Add MCP resources as an alternative to tool calls for reading session state:\n\n- resource://sessions - List all managed sessions\n- resource://sessions/{session_id} - Get detailed status for a session\n- resource://sessions/{session_id}/screen - Get current screen content\n\nBenefits:\n- Resources can be more efficient for read-only operations\n- Better caching potential\n- Cleaner separation between read (resources) and write (tools) operations\n\nReference: FastMCP resource patterns","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-11T22:36:59.874532-08:00","updated_at":"2025-12-11T22:56:01.618654-08:00","closed_at":"2025-12-11T22:56:01.618654-08:00"}
{"id":"cic-67ws","title":"Add worktree lifecycle warnings to coordinator prompting","description":"Coordinators are closing workers before merging worktree commits, losing work. Need to add explicit warnings in coordinator_guidance and close_workers docstring about: (1) worktree branches being ephemeral, (2) must merge/cherry-pick before closing, (3) close_workers destroys worktree branches.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-29T13:00:23.186733-08:00","updated_at":"2025-12-29T13:01:50.431519-08:00","closed_at":"2025-12-29T13:01:50.431519-08:00","close_reason":"Closed"}
{"id":"cic-6b2","title":"auto_layout splits into unmanaged windows instead of only claude-team windows","description":"find_available_window() searches all iTerm2 terminal windows, not just windows managed by claude-team. This causes auto_layout to split into random user windows instead of windows we created.\n\n## Root cause\nfind_available_window() in iterm_utils.py iterates over app.terminal_windows without checking if the window is managed by our registry.\n\n## Fix\nShould filter to only windows containing sessions in the claude-team registry, OR track which windows we've created and only reuse those.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-12T12:19:43.873693-08:00","updated_at":"2025-12-12T12:21:02.224101-08:00","closed_at":"2025-12-12T12:21:02.224101-08:00"}
{"id":"cic-6fw","title":"Worker agents should commit after closing issues","description":"When delegating work to spawned Claude sessions (like quad-1), the agent completed the implementation and closed the beads issue but did not create a git commit.\n\nThe task prompt should explicitly remind agents to:\n1. Mark issue in_progress\n2. Implement changes  \n3. Close issue\n4. Create git commit with issue reference\n\nConsider adding this to a standard task template or wrapper.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-11T22:37:40.317585-08:00","updated_at":"2025-12-12T10:38:28.026295-08:00","closed_at":"2025-12-12T10:38:28.026295-08:00"}
{"id":"cic-6l1","title":"Add get_conversation_history tool","description":"Add MCP tool for coordinators to observe worker activity.\n\nFeatures:\n- Reverse pagination from end of conversation (most recent first)\n- Page size of 5 messages\n- Captures text content, tool_use names, and thinking blocks\n- Returns structured message data for coordinator analysis\n\nAPI:\nget_conversation_history(session_id: str, pages: int = 1, offset: int = 0)\n\nImplementation in server.py, uses session_state.py for JSONL parsing.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T09:59:10.075922-08:00","updated_at":"2025-12-15T12:48:20.935645-08:00","closed_at":"2025-12-15T12:48:20.935645-08:00","dependencies":[{"issue_id":"cic-6l1","depends_on_id":"cic-2o3","type":"blocks","created_at":"2025-12-15T10:00:50.68446-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-6l1","depends_on_id":"cic-ynr","type":"blocks","created_at":"2025-12-15T10:00:55.830318-08:00","created_by":"phaedrus","metadata":"{}"}],"comments":[{"id":7,"issue_id":"cic-6l1","author":"rabsef-bicrym","text":"Tool exists and works. Dependencies cic-2o3 (thinking blocks) and cic-ynr (correlation) are resolved. get_conversation_history returns paginated messages with text, tool_use, and thinking blocks.","created_at":"2025-12-19T20:38:11Z"}]}
{"id":"cic-6wy","title":"Fix Enter key not sent for pasted text (long messages)","description":"The cic-k0m fix works for short messages but Enter is still not sent after pasting long text. The issue only occurs when Claude Code shows '[Pasted text #1 +XX lines]' indicator. Need to investigate why the Enter key is not being sent after paste mode completes.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-12T11:33:41.723746-08:00","updated_at":"2025-12-12T11:39:37.84656-08:00","closed_at":"2025-12-12T11:39:37.84656-08:00"}
{"id":"cic-76s","title":"Add spawn_team tool for multi-pane layouts","description":"Add a spawn_team tool that creates a multi-pane window with Claude sessions in one call, using the existing create_multi_claude_layout primitive.\n\nAPI example:\nspawn_team(\n    projects={\n        'top_left': '/path/to/frontend',\n        'top_right': '/path/to/backend',\n        'bottom_left': '/path/to/api',\n        'bottom_right': '/path/to/tests'\n    },\n    layout='quad'  # or 'vertical', 'horizontal', 'triple_vertical'\n)\n\nReturns dict with all session IDs mapped to pane names.\n\nThis complements the split_from_session parameter by providing a simpler one-call approach for common multi-agent setups.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-11T22:27:24.172635-08:00","updated_at":"2025-12-11T22:35:17.701729-08:00","closed_at":"2025-12-11T22:35:17.701729-08:00"}
{"id":"cic-7b1","title":"Smart layout management for spawn_session","description":"When spawning new sessions, intelligently reuse existing windows with available pane slots.\n\n## Current Behavior\n- spawn_session always creates a new window (unless split_from_session specified)\n- When workers finish and panes close, remaining panes don't get filled\n- New workers go to new windows, fragmenting the layout\n\n## Desired Behavior\n- Track pane count per window (max 4 ideal)\n- When spawning a new session:\n  1. Find windows with \u003c 4 Claude panes\n  2. Split an existing pane in that window\n  3. Only create new window if all windows have 4+ panes\n- Layout preference: quad (2x2) is ideal\n\n## Implementation Ideas\n- Track window → panes mapping in registry\n- Add `find_available_window()` that returns window with room\n- Modify spawn_session to auto-split when possible\n- Add `layout_preference` setting (quad, vertical, horizontal)\n\n## API Changes\nMaybe add `auto_layout: bool = True` to spawn_session:\n- True: automatically find best window/pane to split\n- False: current behavior (new window)\n\n## Example\n```python\n# Worker-1 finishes, quad window now has 3 panes\n# New spawn_session call:\nspawn_session(project_path=..., auto_layout=True)\n# -\u003e Finds the 3-pane window, splits to fill the 4th slot\n```","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-12T10:40:14.169798-08:00","updated_at":"2025-12-12T12:12:04.16957-08:00","closed_at":"2025-12-12T12:12:04.16957-08:00"}
{"id":"cic-7cd","title":"Task completion detection not checking screen for TASK_COMPLETE","description":"get_task_status returns 'completed' via beads_issue detection (0.6 confidence) even when TASK_COMPLETE is visible on screen.\n\n## Expected\nShould detect TASK_COMPLETE marker on screen with high confidence (0.9+)\n\n## Actual\nDetects via beads closed issues count (38 closed issues) with 0.6 confidence\n\n## Root Cause\nThe screen-based detection for convention markers (TASK_COMPLETE, TASK_FAILED) may not be running or is being outprioritized by beads detection.\n\n## Fix\nEnsure screen content is checked for convention markers and prioritize that signal over beads issue counts.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-12T11:14:46.782084-08:00","updated_at":"2025-12-12T11:24:45.391848-08:00","closed_at":"2025-12-12T11:24:45.391848-08:00"}
{"id":"cic-7dx","title":"Update README with plugin installation docs","description":"File: README.md. Add plugin installation instructions. Document /plugin install usage. Document /plugin marketplace add for marketplace hosting.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T09:13:43.508901-08:00","updated_at":"2025-12-18T10:55:41.360013-08:00","closed_at":"2025-12-18T10:55:41.360013-08:00","dependencies":[{"issue_id":"cic-7dx","depends_on_id":"cic-8j7","type":"blocks","created_at":"2025-12-16T09:15:45.332154-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-7j0","title":"Allow custom branch names and worker names in spawn_workers","description":"The spawn_workers tool with use_worktrees=true auto-generates worker names and branch names, breaking the beads-integrated workflow.\n\n## Problem\n\n### Previous workflow (main branch + slash command)\n1. Coordinator creates worktrees manually: `git worktree add .worktrees/\u003cissue-id\u003e -b \u003cissue-id\u003e/\u003cdescription\u003e`\n2. Spawn workers pointing at those worktree paths\n3. Branch names = beads issues (e.g., `cic-123/fix-auth`)\n4. Badges display issue IDs\n\n### Current behavior (feat/rebase-refactor-main)\n- Worktrees auto-created at `~/.claude-team/worktrees/{hash}/`\n- Branches auto-named: `Napoleon-abc123`, `Voltaire-def456`\n- No way to specify custom branch name\n- Lost beads ↔ branch correlation\n\n## Fix: New WorkerConfig API\n\nReplace current awkward `projects` dict + separate params with array of worker configs:\n\n```python\nspawn_workers(\n    workers: list[WorkerConfig],\n    layout: Literal[\"auto\", \"new\"] = \"auto\",\n)\n```\n\n### WorkerConfig\n```python\n{\n    \"project_path\": str,       # Path or \"auto\"\n                               # - Path: spawn at this location (repo, pre-made worktree, any dir)\n                               # - \"auto\": create .worktrees/\u003cbead\u003e-\u003cdesc\u003e or .worktrees/\u003cname\u003e-\u003cuuid\u003e-\u003cdesc\u003e\n    \"name\": str | None,        # Worker name. None = auto-pick from themed sets.\n    \"bead\": str | None,        # Beads issue ID (for badge, branch naming)\n    \"description\": str | None, # Work description (for badge, branch, annotation)\n    \"prompt\": str | None,      # Custom prompt. None = standard worker prompt.\n    \"skip_permissions\": bool,  # Default false. Required for autonomous work.\n}\n```\n\n### Badge Format\nMulti-line, smaller font (Menlo 10):\n```\n\u003cbead or name\u003e\n\u003cdescription\u003e\n```\n\n### Worktree Path Resolution (when project_path=\"auto\")\n1. If `bead` provided: `.worktrees/\u003cbead\u003e-\u003cdescription\u003e/` → branch `\u003cbead\u003e-\u003cdescription\u003e`\n2. Else: `.worktrees/\u003cname\u003e-\u003cuuid\u003e-\u003cdescription\u003e/` → branch `\u003cname\u003e-\u003cuuid\u003e-\u003cdescription\u003e`\n3. Description slugified (spaces → dashes, lowercase)\n4. `.worktrees` auto-added to `.gitignore` if not present\n\n### Examples\n\n**Beads workflow:**\n```python\nspawn_workers(workers=[\n    {\"project_path\": \"auto\", \"bead\": \"cic-123\", \"description\": \"fix auth\", \"skip_permissions\": True},\n])\n# Creates .worktrees/cic-123-fix-auth/\n# Badge: \"cic-123\\nfix auth\"\n# Branch: cic-123-fix-auth\n```\n\n**Pre-made worktree:**\n```python\nspawn_workers(workers=[\n    {\"project_path\": \"/repo/.worktrees/my-feature\", \"bead\": \"cic-456\", \"description\": \"custom setup\"},\n])\n# Uses existing worktree, badge shows bead + description\n```\n\n**Quick spawn (no beads):**\n```python\nspawn_workers(workers=[\n    {\"project_path\": \"/path/to/repo\", \"description\": \"refactor module\"},\n])\n# Auto-picks name \"Groucho\", badge: \"Groucho\\nrefactor module\"\n```","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-23T09:21:35.14212-08:00","updated_at":"2025-12-29T09:05:11.045643-08:00","closed_at":"2025-12-23T13:47:52.635709-08:00","dependencies":[{"issue_id":"cic-7j0","depends_on_id":"cic-z7mp","type":"blocks","created_at":"2025-12-23T11:10:56.559916-08:00","created_by":"daemon"},{"issue_id":"cic-7j0","depends_on_id":"cic-yixs","type":"blocks","created_at":"2025-12-23T11:10:56.647208-08:00","created_by":"daemon"}]}
{"id":"cic-7on","title":"Enhance read_worker_logs output formatting","description":"Improve the message format returned by read_worker_logs for better coordinator usability.\n\n## Key Improvements\n\n### Add New Fields\n- `index`: Message number in conversation (1-based) for easy reference\n- `time_ago`: Relative timestamp (e.g., '2 min ago') for quick scanning\n- `content_length`: Character count to know message size before reading\n- `content_preview`: First 200 chars for long messages\n- `tools_summary`: List of readable tool summaries (e.g., 'Read → src/foo.py')\n- `tool_count`: Quick count of tools used\n- `has_thinking`: Boolean flag instead of full thinking text by default\n\n### Remove/Simplify\n- Remove `uuid` from default output (noise for coordinators)\n- Simplify `tool_uses` - summarize large inputs instead of full content\n- Replace full `thinking` blocks with boolean flag by default\n\n### Optional Enhancement\n- Consider adding `format` parameter: 'full' (current), 'compact' (previews only), 'summary' (one-line per message)\n\n## Files to Modify\n- src/claude_team_mcp/session_state.py - Message.to_dict() method\n- src/claude_team_mcp/server.py - read_worker_logs tool\n\n## References\nBased on JSONL Conversation Formatting Review research.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-20T22:17:51.72494-08:00","updated_at":"2025-12-20T22:17:51.72494-08:00"}
{"id":"cic-7pt","title":"Add shell session lifecycle management","description":"Handle shell session lifecycle: detect if process is still running, graceful shutdown (SIGTERM then SIGKILL), restart capability. Reuse close_session or add close_shell. Add is_process_running check.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T09:21:01.708275-08:00","updated_at":"2025-12-16T09:21:01.708275-08:00","dependencies":[{"issue_id":"cic-7pt","depends_on_id":"cic-v7e","type":"blocks","created_at":"2025-12-16T09:22:10.245835-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-7rb","title":"spawn_team badges should show issue/task info, not pane positions","description":"Currently spawn_team sets badge text to pane position (top-left, etc.) which isn't useful.\n\nThe API needs to accept richer per-pane data:\n- projects dict values should accept either a string (path) or a dict with path, issue_id, task_description\n- Badge should use format_badge_text() with issue_id/task_description like spawn_session does\n\nExample new API:\nprojects={\n  'top_left': {'path': '/path/to/project', 'issue_id': 'cic-123', 'task_description': 'Fix auth bug'},\n  'top_right': '/path/to/other'  # backwards compatible\n}","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-12T13:16:08.207931-08:00","updated_at":"2025-12-12T13:17:27.622025-08:00","closed_at":"2025-12-12T13:17:27.622025-08:00"}
{"id":"cic-7sr","title":"Replace 2.0s marker wait with JSONL content monitoring","description":"File: src/claude_team_mcp/server.py:601. Instead of asyncio.sleep(2.0), watch for marker in JSONL. Read JSONL file, check for marker message. Poll every 100ms, timeout at 5s. Success: marker text found in JSONL.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T09:12:39.089276-08:00","updated_at":"2025-12-16T09:37:37.486439-08:00","closed_at":"2025-12-16T09:34:14.996744-08:00"}
{"id":"cic-7t8","title":"spawn_team is slow due to sequential sleeps","description":"spawn_team takes several seconds between each session starting because of sequential sleeps:\n\n## Root Cause\nTwo sequential loops with per-session sleeps:\n\n1. **iterm_utils.py:460-471** - create_multi_claude_layout:\n   ```python\n   for pane_name, project_path in projects.items():\n       await start_claude_in_session(...)\n       await asyncio.sleep(0.5)  # 0.5s per pane\n   ```\n\n2. **server.py:393-409** - spawn_team registration:\n   ```python\n   for pane_name, iterm_session in pane_sessions.items():\n       managed = registry.add(...)\n       await asyncio.sleep(1)  # 1s per session\n       managed.discover_claude_session()\n   ```\n\nFor a quad layout (4 panes): 4×0.5s + 4×1s = **6 seconds** of just sleep!\n\n## Proposed Fix\n1. **Parallelize registration**: Use asyncio.gather() for concurrent discover_claude_session calls\n2. **Batch sleep**: Single sleep after all starts instead of per-pane\n3. **Reduce sleeps**: The 1s sleep may be excessive; could use shell readiness check instead\n\n## Expected Result\nspawn_team should complete in ~2-3 seconds instead of ~8 seconds","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-12T10:37:58.477365-08:00","updated_at":"2025-12-12T10:42:18.403896-08:00","closed_at":"2025-12-12T10:42:18.403896-08:00"}
{"id":"cic-7zb","title":"Consolidate shell ready checks","description":"File: src/claude_team_mcp/iterm_utils.py:427-433. Currently: wait_for_shell_ready() -\u003e cd -\u003e wait_for_shell_ready() -\u003e claude. Change to single wait then 'cd \u0026\u0026 claude' combined, or remove first wait since shell should be ready from window creation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T09:12:49.832829-08:00","updated_at":"2025-12-16T09:37:37.486881-08:00","closed_at":"2025-12-16T09:33:39.656047-08:00"}
{"id":"cic-80w","title":"Build and publish to PyPI","description":"Build: uv build. Test locally: uvx ./dist/*.whl. Publish: uv publish (needs PyPI token). Verify: uvx claude-team-mcp works.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T09:13:16.567145-08:00","updated_at":"2025-12-18T06:51:34.684854-08:00","closed_at":"2025-12-18T06:51:34.684854-08:00","dependencies":[{"issue_id":"cic-80w","depends_on_id":"cic-puh","type":"blocks","created_at":"2025-12-16T09:15:08.190093-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-8a8","title":"Aggressive Startup Latency Optimization","description":"Reduce spawn-to-ready time from ~9s to ~3-4s by eliminating hardcoded sleeps. Based on research from cic-mz0.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-16T09:12:12.983902-08:00","updated_at":"2025-12-16T09:38:21.119876-08:00","closed_at":"2025-12-16T09:38:21.119876-08:00","dependencies":[{"issue_id":"cic-8a8","depends_on_id":"cic-stv","type":"blocks","created_at":"2025-12-16T09:13:57.596505-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-8a8","depends_on_id":"cic-7sr","type":"blocks","created_at":"2025-12-16T09:14:02.715696-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-8a8","depends_on_id":"cic-od2","type":"blocks","created_at":"2025-12-16T09:14:07.841554-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-8a8","depends_on_id":"cic-7zb","type":"blocks","created_at":"2025-12-16T09:14:12.954089-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-8a8","depends_on_id":"cic-2p2","type":"blocks","created_at":"2025-12-16T09:14:18.07613-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-8g6","title":"Remove beads coupling from MCP server","description":"Remove detect_beads_completion() and related beads-specific code from task_completion.py. Rely on convention markers (TASK_COMPLETE) for completion detection instead. Keep the worktree BEADS_DIR detection as it's helpful and non-intrusive. This decouples the MCP server from beads, making it workflow-agnostic.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T08:56:06.855126-08:00","updated_at":"2025-12-15T12:45:00.174287-08:00","closed_at":"2025-12-15T12:45:00.174287-08:00"}
{"id":"cic-8j7","title":"Create marketplace.json for hosting","description":"File: .claude-plugin/marketplace.json (new). Allow repo to be used as plugin marketplace source. Include claude-team as available plugin.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T09:13:38.0909-08:00","updated_at":"2025-12-18T10:54:51.622665-08:00","closed_at":"2025-12-18T10:54:51.622665-08:00","dependencies":[{"issue_id":"cic-8j7","depends_on_id":"cic-r70","type":"blocks","created_at":"2025-12-16T09:15:29.929553-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-8j7","depends_on_id":"cic-0g8","type":"blocks","created_at":"2025-12-16T09:15:35.061787-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-8j7","depends_on_id":"cic-ko6","type":"blocks","created_at":"2025-12-16T09:15:40.205902-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-8mk","title":"Add get_conversation_history with reverse pagination","description":"Added get_conversation_history tool for coordinators to observe worker activity. Features: reverse pagination from end, page size of 5 messages, captures text + tool_use names + thinking blocks. Enables coordinators to see full picture of what workers did.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-14T22:04:06.583037-08:00","updated_at":"2025-12-14T22:04:12.983216-08:00","closed_at":"2025-12-14T22:04:12.983216-08:00"}
{"id":"cic-8mm","title":"Fix stale websocket connections","description":"Fix iTerm2 API websocket connections going stale.\n\nProblem: iTerm2 Python API uses websockets with ping_interval=None, causing connections to become stale after period of inactivity.\n\nSolution:\n- Add ensure_connection() helper function\n- Test connection before spawn/discover operations\n- Auto-refresh dead connections\n\nImplementation in iterm_utils.py or server.py connection handling.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T09:59:32.217587-08:00","updated_at":"2025-12-15T11:08:15.218658-08:00","closed_at":"2025-12-15T10:10:38.97046-08:00"}
{"id":"cic-8rr","title":"Add bd_help tool and worker hints","description":"Added bd_help tool that returns condensed beads documentation. Updated send_message and broadcast_message to append a hint pointing workers to bd_help for guidance on tracking progress and adding comments.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-15T07:50:33.122645-08:00","updated_at":"2025-12-15T07:50:40.615459-08:00","closed_at":"2025-12-15T07:50:40.615459-08:00"}
{"id":"cic-91ax","title":"Implement iterm.py iTerm2 backend","description":"Create src/claude_team_mcp/terminal/iterm.py implementing the full TerminalBackend interface for iTerm2.\n\n## Implementation Requirements\n- Wrap all existing iterm_utils.py functions\n- Implement full event subscription support using iTerm2 notification API\n- Handle connection lifecycle (stale connection recovery)\n- Implement layout introspection by walking window/tab/session hierarchy\n- Support profile customizations (tab colors, badges)\n\n## Event Subscriptions to Support\n- async_subscribe_to_new_session_notification\n- async_subscribe_to_keystroke_notification\n- async_subscribe_to_screen_update_notification\n- async_subscribe_to_prompt_notification\n- async_subscribe_to_location_change_notification\n- async_subscribe_to_custom_escape_sequence_notification\n- async_subscribe_to_terminate_session_notification\n- async_subscribe_to_layout_change_notification\n- async_subscribe_to_focus_change_notification\n\n## Layout Introspection\n- Walk app.terminal_windows -\u003e window.tabs -\u003e tab.sessions\n- Build LayoutNode tree with proper hierarchy\n- Include tab/pane geometry if available\n\n## Self-Identification\n- Track 'current session' from iTerm2 app state\n- Support ZED_TERM_ID-style env var for explicit identification","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T20:37:01.748693-08:00","updated_at":"2025-12-22T20:46:44.161058-08:00","closed_at":"2025-12-22T20:46:44.161058-08:00","close_reason":"Closed","dependencies":[{"issue_id":"cic-91ax","depends_on_id":"cic-xb8j","type":"blocks","created_at":"2025-12-22T20:37:23.534087-08:00","created_by":"rabsef-bicrym"}],"comments":[{"id":17,"issue_id":"cic-91ax","author":"rabsef-bicrym","text":"Implemented comprehensive ITermBackend with:\n\n## Core TerminalBackend methods\n- connect/disconnect/ensure_connected for connection lifecycle\n- identify_self using ITERM_SESSION_ID env var\n- list_terminals, get_info, get_cwd, is_idle\n- create, split, close for terminal lifecycle\n- send_text, send_key, read_screen for I/O\n- focus, set_title\n\n## SupportsSubscriptions protocol\n- Full event subscription support for all 9 event types\n- Uses iTerm2 notification API\n- PROMPT uses PromptState modes\n- LOCATION_CHANGE uses variable_change_notification for path\n\n## SupportsCustomEscapeSequences protocol\n- register_escape_sequence for custom handlers\n- send_escape_sequence for sending OSC 1337 sequences\n\n## SupportsLayoutControl protocol\n- get_layout builds full layout tree\n- set_layout logs warning (iTerm2 doesn't support automatic reorganization)\n- move_terminal logs warning\n\n## SupportsProfileCustomization protocol\n- set_tab_color, set_badge\n- get_available_profiles via PartialProfile.async_query\n\nAll pyright checks pass (0 errors).","created_at":"2025-12-23T17:16:35Z"}]}
{"id":"cic-95qb","title":"Fix find_available_window bugs in iterm_utils.py","description":"Fix two bugs in find_available_window (iterm_utils.py):\n\n1. **Empty registry bug**: When `managed_session_ids` is empty set, it becomes `None` due to falsy check, which skips the filter entirely and searches ALL iTerm windows.\n   - Fix: Always pass the set (even if empty). Empty set runs filter, matches nothing, creates new window.\n\n2. **Tab-level filter bug**: Current filter is at window-level but returns at tab-level. Can split into user's personal tab if window has both managed and unmanaged tabs.\n   - Fix: Move filter to tab-level:\n   ```python\n   for window in app.terminal_windows:\n       for tab in window.tabs:\n           if managed_session_ids is not None:\n               tab_has_managed = any(s.session_id in managed_session_ids for s in tab.sessions)\n               if not tab_has_managed:\n                   continue\n           if count_panes_in_tab(tab) \u003c max_panes:\n               return (window, tab, tab.current_session)\n   ```\n\nAlso ensure the incremental quad-building split logic is available (it may already be there but unused).\n\nFile: src/claude_team_mcp/iterm_utils.py","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T11:10:27.98542-08:00","updated_at":"2025-12-23T11:18:31.850952-08:00","closed_at":"2025-12-23T11:18:31.850952-08:00","close_reason":"Closed"}
{"id":"cic-96n","title":"auto_layout creates 1-3 stacked layout instead of 2x2 quad grid","description":"When auto_layout fills a window to 4 panes, it creates a 1-3 stacked layout (one pane on left, three stacked on right) instead of a proper 2x2 quad grid.\n\n## Root cause\nThe code uses tab.current_session as the split target, which is typically the last created pane. This causes all horizontal splits to happen on the same side.\n\n## Expected behavior\n- 1→2: vertical split → left | right\n- 2→3: horizontal split of LEFT pane → top-left, bottom-left | right  \n- 3→4: horizontal split of RIGHT pane → 2x2 quad\n\n## Fix needed\nTrack pane positions and choose the correct pane to split for each step to achieve a balanced quad layout.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-12T12:27:12.469648-08:00","updated_at":"2025-12-12T12:34:43.989844-08:00","closed_at":"2025-12-12T12:34:43.989844-08:00"}
{"id":"cic-99e","title":"send_message wait_for_response times out despite response being available","description":"During testing, send_message with wait_for_response=true timed out after 30 seconds, but get_session_status showed the response was already visible in screen_preview and get_response successfully retrieved it. The response detection logic may have timing issues or isn't properly detecting when Claude finishes responding.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-11T22:21:13.609442-08:00","updated_at":"2025-12-11T22:23:17.212626-08:00","closed_at":"2025-12-11T22:23:17.212626-08:00"}
{"id":"cic-9a3","title":"Split pane targets wrong window - splits active pane instead of spawned window","description":"When using split_vertical or split_horizontal layout, the split happens in the currently active iTerm pane (the user's session) rather than in the window/pane created by a previous spawn_session call. This means all split sessions end up in the wrong window and share the same claude_session_id as the user's active session.\n\nExpected: Splits should target the window/tab created by the previous spawn_session\nActual: Splits target whatever pane is currently active in iTerm\n\nThis likely requires tracking the iTerm window/tab ID from spawn_session and explicitly targeting it for subsequent splits.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-11T22:24:21.485265-08:00","updated_at":"2025-12-11T22:25:46.525894-08:00","closed_at":"2025-12-11T22:25:46.525894-08:00"}
{"id":"cic-9wp","title":"iTerm2 profile customization for sessions","description":"Add support for iTerm2 profile customization when spawning sessions.\n\n## Capabilities (via iTerm2 Python API)\n- `profile` param: Use named profiles from iTerm2 preferences\n- `profile_customizations` param: Programmatic customization via LocalWriteOnlyProfile\n  - set_tab_color + set_use_tab_color: Color-code tabs\n  - set_badge_text: Overlay text (session ID, task, issue)\n  - set_background_color: Different backgrounds per session type\n  - set_custom_window_title: Custom titles\n  - set_subtitle: Additional context\n\n## Use Cases\n- Blue tabs for workers, green for reviewers, red for critical tasks\n- Badge showing beads issue ID (e.g., 'cic-123')\n- Background tint to distinguish session types at a glance\n- Window titles showing project + task\n\n## API Changes\nspawn_session(..., profile: str = None, tab_color: str = None, badge_text: str = None)\nspawn_team(..., profile: str = None, color_scheme: 'rainbow'|'monochrome'|dict = None)\n\n## Predefined Schemes\n- 'rainbow': Each pane gets a distinct color\n- 'role-based': Colors based on session role (worker/reviewer/tester)\n- Custom dict mapping pane names to colors","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-12T08:02:08.806597-08:00","updated_at":"2025-12-12T09:47:38.293369-08:00","closed_at":"2025-12-12T09:47:38.293369-08:00"}
{"id":"cic-9xc","title":"Phase 4: TUI Core Structure","description":"Basic Textual TUI app with session monitoring. Create src/claude_team_mcp/tui/ package: __init__.py, app.py (main App class), client.py (HTTP client for MCP server), beads.py (wrapper for bd CLI calls), widgets/__init__.py, widgets/sessions_table.py (DataTable for workers), widgets/beads_table.py (DataTable for tasks), widgets/logs_view.py (activity log), styles/app.tcss (CSS). Implement polling: 2-second refresh for sessions (via HTTP), 10-second for beads (via bd CLI). Use reactive attributes for auto-updating UI.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T17:56:52.51836-08:00","updated_at":"2025-12-15T12:48:50.677488-08:00","closed_at":"2025-12-15T12:48:50.677488-08:00","dependencies":[{"issue_id":"cic-9xc","depends_on_id":"cic-msz","type":"blocks","created_at":"2025-12-14T17:58:12.185749-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-a60","title":"Task completion detection","description":"Detect when a delegated task is truly complete, not just when a response is received.\n\n## Problem\nCurrently we can only detect:\n- Message was sent\n- Response was received\n- Session is processing or idle\n\nBut we can't tell if the task was actually completed successfully.\n\n## Detection Strategies\n1. **Convention-based**: Require workers to output specific markers like 'TASK_COMPLETE' or 'TASK_FAILED'\n2. **Git-based**: Monitor for commits on the worker's branch\n3. **Beads-based**: Monitor for issue status changes (closed/in_progress)\n4. **Screen parsing**: Look for patterns like 'Done\\!' or error messages\n5. **JSONL analysis**: Analyze conversation for completion signals\n6. **Explicit acknowledgment**: Worker calls a completion endpoint/tool\n\n## API Design\n- get_task_status(session_id) -\u003e {status: pending|in_progress|completed|failed, details: ...}\n- wait_for_completion(session_id, timeout) -\u003e completion result\n- Webhook/callback on completion\n\n## Integration Points\n- Beads issue tracking\n- Git commit detection\n- AgentMail message patterns","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-12T08:01:52.851101-08:00","updated_at":"2025-12-12T10:30:45.483131-08:00","closed_at":"2025-12-12T10:30:45.483131-08:00"}
{"id":"cic-ao3","title":"Add bd_help tool for workers","description":"Add MCP tool that returns condensed beads documentation for workers.\n\nPurpose: Workers need guidance on using beads to track their work but don't have access to full docs.\n\nImplementation:\n- Add bd_help() tool to server.py\n- Return condensed beads guidance covering:\n  - How to update issue status\n  - How to close issues\n  - How to add comments/notes\n  - Key bd commands for workers","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T09:59:21.138324-08:00","updated_at":"2025-12-15T12:47:03.300281-08:00","closed_at":"2025-12-15T12:47:03.300281-08:00"}
{"id":"cic-aqba","title":"Fix project_path auto to require CLAUDE_TEAM_PROJECT_DIR","description":"When all workers use project_path='auto', the server falls back to Path.cwd() which returns the MCP server's working directory, not the coordinator's project. Fix: require CLAUDE_TEAM_PROJECT_DIR env var (set via project .mcp.json) for auto to work.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-29T12:07:25.446417-08:00","updated_at":"2025-12-29T12:11:46.050584-08:00","closed_at":"2025-12-29T12:11:46.050584-08:00","close_reason":"Closed"}
{"id":"cic-arq","title":"Fix profile window type: use Normal with calculated screen-filling dimensions","description":"Current profile uses Maximized (type 3) which opens in a new Space unexpectedly. Fix: use Normal (type 0) with dynamically calculated columns/rows based on screen resolution to create a near-fullscreen window that stays in the current Space.\n\n## Implementation\n1. Add calculate_screen_dimensions() to profile.py using system_profiler\n2. Change Initial Window Type from 3 to 0 in _build_dynamic_profile_dict()\n3. Add Columns/Rows to the profile based on calculated dimensions\n4. Update the dynamic profile file after code changes\n5. Apply dimensions at spawn_session time via profile_customizations for runtime flexibility\n\n## Formula\n- Get screen resolution via system_profiler SPDisplaysDataType\n- Detect Retina scale factor (2x if Retina)\n- Calculate logical dimensions\n- Subtract margins for window chrome (~20px width, ~100px height)\n- Divide by cell size (Menlo 12pt: ~7.2px wide, ~14px tall)\n\n## Test\n- Spawn a session and verify it opens as a normal window filling the screen\n- Verify it stays in the current Space (not a new Space)","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-12T11:54:45.586448-08:00","updated_at":"2025-12-12T12:00:25.007445-08:00","closed_at":"2025-12-12T12:00:25.007445-08:00"}
{"id":"cic-avg","title":"Add spawn_shell MCP tool","description":"Create new MCP tool spawn_shell() similar to spawn_session but without starting Claude. Parameters: project_path, session_name, command (optional - command to run), layout. Should create iTerm window/pane, cd to project, optionally run initial command.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T09:20:34.630863-08:00","updated_at":"2025-12-16T09:20:34.630863-08:00","dependencies":[{"issue_id":"cic-avg","depends_on_id":"cic-v7e","type":"blocks","created_at":"2025-12-16T09:21:49.653578-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-bcf","title":"Thought experiment: wait_for_completion / wait_for_team","description":"Evaluate whether the existing wait_for_completion tool should be kept, modified, or removed.\n\n**Current state:**\n- wait_for_completion exists with 5 min default timeout, polls every 2 seconds\n- Uses multiple detection methods (markers, git, beads, screen, idle time)\n- Unclear if MCP tool timeouts from Claude Code side would even allow 5 min waits\n\n**Concerns:**\n- MCP tool timeout behavior is undocumented\n- Blocking waits don't let coordinator do other work\n- If one worker is slow/blocked, coordinator is stuck\n\n**Alternative pattern (used in dogfooding):**\n- Non-blocking send_message calls\n- Coordinator polls list_sessions / get_conversation_history\n- Coordinator decides when workers are done\n- Each tool call returns quickly, no timeout issues\n\n**Options:**\n1. Keep wait_for_completion as-is (useful for simple single-worker cases?)\n2. Remove it for clarity - polling pattern is safer\n3. Replace with non-blocking check_completion_status\n4. Add wait_for_team that returns when ANY worker finishes (not all)\n\n**Status:** Thought experiment - consider removing existing implementation for clarity.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-16T20:42:36.631081-08:00","updated_at":"2025-12-16T20:42:36.631081-08:00"}
{"id":"cic-bm7","title":"Restore auto window reuse in spawn_workers","description":"During the tool consolidation refactor, the intelligent window reuse logic from spawn_session was lost.\n\n## Analysis (from Rihanna's investigation)\n\n### Main Branch Architecture\nTwo separate tools:\n- `spawn_session`: Single worker with window reuse (`layout=\"auto\"`)\n- `spawn_team`: Multi-worker, always new window\n\n### How Window Reuse Worked\n\n`layout=\"auto\"` in `spawn_session`:\n1. Calls `find_available_window()` to find claude-team windows with \u003c4 panes\n2. Only considers windows containing managed sessions (won't hijack user terminals)\n3. Incrementally builds quad layout:\n   - 1→2: vertical split\n   - 2→3: horizontal split of LEFT pane (creates TL, BL | right)\n   - 3→4: horizontal split of RIGHT pane (completes 2x2 quad)\n4. Falls back to new window if no room\n\n### Key Code (from main branch spawn_session)\n```python\nif effective_layout == \"auto\":\n    managed_session_ids = {s.iterm_session.session_id for s in registry.list_all()}\n    available = await find_available_window(\n        app, max_panes=MAX_PANES_PER_TAB,\n        managed_session_ids=managed_session_ids if managed_session_ids else None,\n    )\n    if available:\n        window, tab, source_session = available\n        pane_count = count_panes_in_tab(tab)\n        vertical = pane_count \u003c 2  # Vertical for 1→2, horizontal for 2→3, 3→4\n        \n        # Choose split source for proper 2x2 layout:\n        if pane_count == 2:\n            split_source = tab.sessions[0]      # Split left pane\n        elif pane_count == 3:\n            split_source = tab.sessions[-1]     # Split right pane\n        else:\n            split_source = source_session\n        \n        iterm_session = await split_pane(split_source, vertical=vertical, ...)\n    else:\n        window = await create_window(...)  # Fallback\n```\n\n### What's Broken on Feature Branch\n- `find_available_window` exists in iterm_utils.py but is DEAD CODE (never called)\n- `spawn_workers` always creates new window\n- No incremental spawning capability\n\n## Fix\n\nIn the new unified `spawn_workers` API:\n\n```python\nlayout: Literal[\"auto\", \"new\"] = \"auto\"\n```\n\n- `\"auto\"` (default): Restore window reuse behavior\n  - Call `find_available_window()` to find managed windows with \u003c4 panes\n  - Use incremental quad-building split logic\n  - Fall back to new window if no room or spawning ≥4 workers at once\n- `\"new\"`: Always create new window (current behavior)\n\nImplementation steps:\n1. Wire `find_available_window` back into spawn_workers\n2. Add incremental splitting logic for single/few worker spawns\n3. For multi-worker spawns (≥4), use existing batch layout creation\n4. For 1-3 workers with `layout=\"auto\"`, try reuse first, fall back to new window","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-23T09:16:35.892203-08:00","updated_at":"2025-12-29T09:05:11.046093-08:00","closed_at":"2025-12-23T13:47:52.53807-08:00","dependencies":[{"issue_id":"cic-bm7","depends_on_id":"cic-95qb","type":"blocks","created_at":"2025-12-23T11:10:28.186988-08:00","created_by":"daemon"}],"comments":[{"id":19,"issue_id":"cic-bm7","author":"rabsef-bicrym","text":"## Additional Bugs Found (via Rihanna investigation)\n\n### Bug 1: First Spawn Empty Registry\n- `managed_session_ids = set()` (empty) is falsy\n- `managed_session_ids if managed_session_ids else None` → becomes `None`\n- `None` skips the filter entirely → searches ALL iTerm windows\n- **Fix**: Always pass the set. Empty set runs filter, matches nothing, creates new window.\n\n### Bug 2: Window-level vs Tab-level Filter\nCurrent `find_available_window` filters at window-level but returns at tab-level.\n\nScenario:\n- Tab A: has managed sessions, 4 panes (full)\n- Tab B: no managed sessions (user's personal), 2 panes (room)\n\nCurrent behavior: Window passes filter (Tab A), returns Tab B → splits into user's personal tab!\n\n**Fix**: Move filter to tab-level:\n```python\nfor window in app.terminal_windows:\n    for tab in window.tabs:\n        if managed_session_ids is not None:\n            tab_has_managed = any(s.session_id in managed_session_ids for s in tab.sessions)\n            if not tab_has_managed:\n                continue  # Skip this tab\n        if count_panes_in_tab(tab) \u003c max_panes:\n            return (window, tab, tab.current_session)\n```","created_at":"2025-12-29T17:05:11Z"}]}
{"id":"cic-bt3a","title":"Migrate existing code to terminal abstraction","description":"Update existing code in claude_team_mcp to use the new terminal abstraction layer.\n\n## Files to Update\n- server.py - Use TerminalBackend instead of direct iTerm2 connection\n- registry.py - Update ManagedSession to use TerminalHandle\n- tools/*.py - Update all tools to use abstraction\n\n## Migration Strategy\n1. Create TerminalBackend instance in app_lifespan\n2. Update AppContext to hold backend instead of raw connection\n3. Update ensure_connection pattern to work with backend\n4. Migrate iterm_utils.py calls to backend methods\n5. Update ManagedSession to store TerminalHandle instead of iterm_session\n\n## Backwards Compatibility\n- Keep iterm_utils.py as internal implementation detail for now\n- Eventually deprecate direct iterm_utils usage","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-22T20:37:13.825284-08:00","updated_at":"2025-12-22T20:37:13.825284-08:00","dependencies":[{"issue_id":"cic-bt3a","depends_on_id":"cic-xb8j","type":"blocks","created_at":"2025-12-22T20:37:23.286667-08:00","created_by":"rabsef-bicrym"},{"issue_id":"cic-bt3a","depends_on_id":"cic-91ax","type":"blocks","created_at":"2025-12-22T20:37:23.412205-08:00","created_by":"rabsef-bicrym"}]}
{"id":"cic-car","title":"Plugin Distribution","description":"Package claude-team for easy installation via Claude Code plugin system. Based on research from cic-uc7. Includes PyPI publishing, plugin structure, and marketplace hosting.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-16T09:12:18.344966-08:00","updated_at":"2025-12-18T10:56:16.254328-08:00","closed_at":"2025-12-18T10:56:16.254328-08:00","dependencies":[{"issue_id":"cic-car","depends_on_id":"cic-puh","type":"blocks","created_at":"2025-12-16T09:14:24.577921-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-car","depends_on_id":"cic-80w","type":"blocks","created_at":"2025-12-16T09:14:29.715535-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-car","depends_on_id":"cic-r70","type":"blocks","created_at":"2025-12-16T09:14:34.853771-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-car","depends_on_id":"cic-0g8","type":"blocks","created_at":"2025-12-16T09:14:40.005711-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-car","depends_on_id":"cic-ko6","type":"blocks","created_at":"2025-12-16T09:14:45.160912-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-car","depends_on_id":"cic-8j7","type":"blocks","created_at":"2025-12-16T09:14:50.298675-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-car","depends_on_id":"cic-7dx","type":"blocks","created_at":"2025-12-16T09:14:55.435407-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-clx","title":"Integration testing","description":"Create integration tests for the MCP server.\n\nTests to write:\n1. Server startup/shutdown\n2. spawn_session creates working Claude session\n3. send_message delivers prompt and gets response\n4. list_sessions returns accurate status\n5. close_session properly cleans up\n6. Multiple concurrent sessions work correctly\n7. Session survives manager restart (registry persistence?)\n\nCreate: tests/test_integration.py\nUse pytest-asyncio for async tests.\n\nNote: These tests will actually spawn iTerm2 windows - they're integration tests, not unit tests. May want a --slow flag to skip in CI.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T21:57:37.020767-08:00","updated_at":"2025-12-12T10:06:20.448936-08:00","closed_at":"2025-12-12T10:06:20.448936-08:00","dependencies":[{"issue_id":"cic-clx","depends_on_id":"cic-ir7","type":"blocks","created_at":"2025-12-11T22:01:02.452509-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-clx","depends_on_id":"cic-v98","type":"blocks","created_at":"2025-12-11T22:01:07.552437-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-clx","depends_on_id":"cic-3tv","type":"blocks","created_at":"2025-12-11T22:01:12.657375-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-clx","depends_on_id":"cic-f0j","type":"blocks","created_at":"2025-12-11T22:01:17.764995-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-clx","depends_on_id":"cic-o7m","type":"blocks","created_at":"2025-12-11T22:01:22.873545-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-clx","depends_on_id":"cic-kiu","type":"blocks","created_at":"2025-12-11T22:01:27.97972-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-e18u","title":"Define abstract base class (base.py)","description":"Create src/claude_team_mcp/terminal/base.py with TerminalBackend ABC defining minimal interface: create, split, send_text, send_key, read_screen, close, list_terminals, get_self","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T20:36:05.508825-08:00","updated_at":"2025-12-22T20:37:21.566303-08:00","closed_at":"2025-12-22T20:37:21.566303-08:00","close_reason":"Closed"}
{"id":"cic-e5t","title":"Import existing Claude Code sessions into MCP registry","description":"Add ability to discover existing Claude Code sessions running in iTerm2 and import them into the MCP server's session registry for orchestration.\n\nUse cases:\n- User has Claude sessions already running before starting MCP server\n- Reconnect to sessions after MCP server restart\n- Adopt orphaned sessions\n\nImplementation ideas:\n- Scan iTerm2 windows/panes for Claude Code indicators\n- Match to JSONL session files in ~/.claude/projects/\n- Create managed session entries pointing to existing iTerm sessions\n- Tool: import_session(iterm_session_id?) or discover_sessions()","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-11T22:35:58.234202-08:00","updated_at":"2025-12-11T22:45:24.642475-08:00","closed_at":"2025-12-11T22:42:02.06357-08:00"}
{"id":"cic-eir","title":"Improve error messages with actionable recovery instructions","description":"When MCP tools fail, provide actionable instructions for recovery.\n\n## Current Behavior\nErrors like `Session not found: worker-6` provide no guidance on what to do next.\n\n## Desired Behavior\nError messages should include recovery instructions:\n\n### Session not found\n```json\n{\n  \"error\": \"Session not found: worker-6\",\n  \"hint\": \"Session may have been lost during restart. Run discover_sessions to find orphaned Claude sessions, then import_session to re-register them.\"\n}\n```\n\n### Project path does not exist\n```json\n{\n  \"error\": \"Project path does not exist: /path/to/worktree\",\n  \"hint\": \"The worktree may have been removed. Check 'git worktree list' or use a different project_path.\"\n}\n```\n\n### iTerm connection lost\n```json\n{\n  \"error\": \"Failed to connect to iTerm2\",\n  \"hint\": \"Ensure iTerm2 is running and Python API is enabled in Preferences \u003e General \u003e Magic.\"\n}\n```\n\n## Implementation\nAdd a `hint` field to error responses in server.py for common failure modes:\n- Session not found → suggest discover/import\n- Path not found → suggest checking worktrees\n- Connection errors → suggest iTerm2 setup\n- Registry empty → suggest discover_sessions if context implies workers exist","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-12T10:54:25.682985-08:00","updated_at":"2025-12-12T11:39:37.846342-08:00","closed_at":"2025-12-12T11:39:37.846342-08:00"}
{"id":"cic-ej2","title":"Fix stale websocket connection in iTerm2 API","description":"The iTerm2 Python API uses websockets with ping_interval=None, causing connections to go stale. Added ensure_connection() helper that tests and refreshes the connection before spawn/discover operations.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T21:11:02.729569-08:00","updated_at":"2025-12-14T21:11:14.661087-08:00","closed_at":"2025-12-14T21:11:14.661087-08:00"}
{"id":"cic-el6","title":"Project setup with uv","description":"Migrate from pip/requirements.txt to uv for dependency management.\n\nTasks:\n- Remove old venv/ directory and requirements.txt\n- Create pyproject.toml with project metadata\n- Add dependencies: mcp (official Python SDK), iterm2\u003e=2.7\n- Set up uv.lock for reproducible builds\n- Create src/claude_team_mcp/ package structure\n- Add dev dependencies for testing\n\nThe package should be installable via 'uv pip install -e .' for development.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-11T21:55:37.86394-08:00","updated_at":"2025-12-11T22:05:29.36596-08:00","closed_at":"2025-12-11T22:05:29.36596-08:00"}
{"id":"cic-f0j","title":"get_response tool","description":"Implement the get_response MCP tool for async response retrieval.\n\nTool signature:\n  get_response(\n    session_id: str,\n    wait: bool = True,\n    timeout: float = 60.0,\n    since_message_id: Optional[str] = None\n  ) -\u003e dict\n\nBehavior:\n1. Look up session in registry\n2. Parse JSONL file for conversation state\n3. If wait=True and session is busy:\n   - Poll until idle_threshold reached or timeout\n4. Return {\n     status: str (idle/busy),\n     last_response: Optional[str],\n     message_id: str,\n     tool_uses: list[str],  # names of tools Claude used\n     is_complete: bool\n   }\n\nThis allows the manager to check on sessions without blocking.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T21:57:10.914024-08:00","updated_at":"2025-12-11T22:14:45.99241-08:00","closed_at":"2025-12-11T22:14:45.99241-08:00","dependencies":[{"issue_id":"cic-f0j","depends_on_id":"cic-sic","type":"blocks","created_at":"2025-12-11T22:00:31.71265-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-f0j","depends_on_id":"cic-y5n","type":"blocks","created_at":"2025-12-11T22:00:36.848838-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-fbc8","title":"Fix window reuse: keep spawn batches together","description":"Current behavior: layout='auto' tries to reuse windows per-worker, leading to stale pane counts (5 panes in one window) and split batches.\n\nExpected behavior: Reuse a window only if the ENTIRE batch fits. If batch won't fit, create new window for all of them.\n\nFix involves:\n1. Track pane count locally within spawn loop (not re-fetching from iTerm)\n2. Check if batch fits BEFORE starting to place workers\n3. If batch size \u003e available slots, create new window for whole batch\n\nExample: 2 panes existing, spawn 3 → new window (not 2+1 split)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-28T12:31:48.864474-08:00","updated_at":"2025-12-28T12:47:48.708437-08:00","closed_at":"2025-12-28T12:47:48.708437-08:00","close_reason":"Closed"}
{"id":"cic-ga4","title":"Badge text formatting for sessions","description":"Implement badge and tab title formatting for sessions.\n\n## Tab Title Format\n`[session-name] issue-id: short-description`\n\nExamples:\n- `[worker-1] cic-3dj: profile module`\n- `[worker-2] cic-0ed: tab colors`\n- `[quad-top-left] cic-abc: api work`\n- `[worker-1]` (fallback when no issue)\n\n## Badge Text Format\nSame as tab title, or abbreviated if needed:\n- `cic-3dj: profile` (if space limited)\n\n## API\n```python\ndef format_session_title(\n    session_name: str,\n    issue_id: str = None,\n    task_description: str = None,\n) -\u003e str:\n    # Returns: '[worker-1] cic-3dj: profile module'\n    \ndef format_badge_text(\n    issue_id: str = None,\n    task_description: str = None,\n    max_length: int = 25\n) -\u003e str:\n    # Abbreviated version for badge overlay\n```\n\n## Integration\n- spawn_session accepts optional issue_id and task_description params\n- Both tab title and badge use consistent format","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T09:45:56.910913-08:00","updated_at":"2025-12-12T10:40:08.837175-08:00","closed_at":"2025-12-12T10:40:08.837175-08:00"}
{"id":"cic-gpio","title":"Investigate and fix test_colors.py failures","description":"Two tests in tests/test_colors.py are failing with:\n```\nModuleNotFoundError: No module named 'iterm2.color'; 'iterm2' is not a package\n```\n\nFailing tests:\n- test_returns_iterm2_color\n- test_different_indices_produce_different_colors\n\nThe error suggests the import `from iterm2.color import Color` is failing. This may be:\n1. A mocking issue in the test setup\n2. An environment/import path issue\n3. Something with how iterm2 is installed\n\nInvestigate thoroughly:\n- Look at the test file and how it imports/mocks\n- Check how colors.py imports iterm2\n- Check if iterm2 package is properly installed\n- Determine the root cause and fix it","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T11:45:49.044757-08:00","updated_at":"2025-12-23T11:47:37.737595-08:00","closed_at":"2025-12-23T11:47:37.737595-08:00","close_reason":"Closed"}
{"id":"cic-gvm","title":"Add worker hints to send_message/broadcast_message","description":"Append helpful hints to messages sent to workers.\n\nImplementation:\n- Define WORKER_MESSAGE_HINT constant with guidance about bd_help tool\n- Append hint to message content in send_message()\n- Append hint to message content in broadcast_message()\n\nHint content should tell workers:\n- They can call bd_help for beads guidance\n- Remind them to track progress in beads issues","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T09:59:26.661694-08:00","updated_at":"2025-12-15T12:47:03.301654-08:00","closed_at":"2025-12-15T12:47:03.301654-08:00","dependencies":[{"issue_id":"cic-gvm","depends_on_id":"cic-ao3","type":"blocks","created_at":"2025-12-15T10:00:37.856169-08:00","created_by":"phaedrus","metadata":"{}"}],"comments":[{"id":11,"issue_id":"cic-gvm","author":"rabsef-bicrym","text":"Implemented. WORKER_MESSAGE_HINT constant is appended to all messages in send_message() and broadcast_message(). Points workers to bd_help tool.","created_at":"2025-12-19T20:38:11Z"}]}
{"id":"cic-h75","title":"Claude Team TUI Companion App","description":"Add a Textual-based TUI companion app to claude-team for managing workers, viewing session state, and integrating with beads task tracking. Key features: dual transport (stdio+HTTP), real-time session monitoring, worker spawn/kill, beads task assignment, advisory messages to lead session.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-14T17:56:09.65449-08:00","updated_at":"2025-12-22T14:19:12.429955-08:00","dependencies":[{"issue_id":"cic-h75","depends_on_id":"cic-hzx","type":"blocks","created_at":"2025-12-14T17:57:24.952828-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-h75","depends_on_id":"cic-msz","type":"blocks","created_at":"2025-12-14T17:57:30.072336-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-h75","depends_on_id":"cic-0fq","type":"blocks","created_at":"2025-12-14T17:57:35.19651-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-h75","depends_on_id":"cic-9xc","type":"blocks","created_at":"2025-12-14T17:57:40.318257-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-h75","depends_on_id":"cic-2r8","type":"blocks","created_at":"2025-12-14T17:57:45.447801-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-h75","depends_on_id":"cic-jh2","type":"blocks","created_at":"2025-12-14T17:57:50.568965-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-h75","depends_on_id":"cic-vju","type":"blocks","created_at":"2025-12-14T18:15:30.74394-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-hr4","title":"Add get_shell_output MCP tool","description":"Create MCP tool to read terminal output from shell-only sessions. Use iTerm2 screen content API (already have this in get_session_status). Return recent lines of output. May want options for line count, follow mode.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T09:20:50.891408-08:00","updated_at":"2025-12-16T09:20:50.891408-08:00","dependencies":[{"issue_id":"cic-hr4","depends_on_id":"cic-avg","type":"blocks","created_at":"2025-12-16T09:21:59.958568-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-hzk","title":"Claude Desktop configuration","description":"Document and test Claude Desktop integration.\n\nCreate: README.md section on Claude Desktop setup\nCreate: claude_desktop_config.json example\n\nConfiguration example:\n{\n  \"mcpServers\": {\n    \"claude-team\": {\n      \"command\": \"uv\",\n      \"args\": [\"run\", \"--directory\", \"/path/to/claude-iterm-controller\", \"python\", \"-m\", \"claude_team_mcp\"],\n      \"env\": {}\n    }\n  }\n}\n\nTest that:\n1. Claude Desktop can start the server\n2. Tools appear in Claude's tool list\n3. Spawning sessions works from Claude Desktop","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T21:57:44.009288-08:00","updated_at":"2025-12-11T21:59:13.59696-08:00","closed_at":"2025-12-11T21:59:13.59696-08:00"}
{"id":"cic-hzx","title":"Phase 1: Dual Transport Foundation","description":"Enable HTTP server alongside stdio transport in server.py. Create run_http_server() function using FastMCP streamable-http. Spawn HTTP server in background thread from app_lifespan. Share AppContext (registry, iTerm connection) between both transports. Add --http-port CLI argument (default: 8765). Key file: src/claude_team_mcp/server.py","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T17:56:19.475219-08:00","updated_at":"2025-12-14T18:11:11.839307-08:00","closed_at":"2025-12-14T18:11:11.839307-08:00"}
{"id":"cic-i22","title":"Add script to install slash commands to user level","description":"Create a script that copies slash commands from .claude/commands/ to ~/.claude/commands/ so they're available globally.\n\nCurrently the repo has:\n- .claude/commands/spawn-workers.md\n\nThe script should:\n- Copy commands from repo's .claude/commands/ to ~/.claude/commands/\n- Handle existing files (prompt or overwrite)\n- Be runnable via uv run or as standalone script","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T12:52:12.359612-08:00","updated_at":"2025-12-12T12:59:21.357998-08:00","closed_at":"2025-12-12T12:59:21.357998-08:00"}
{"id":"cic-iex","title":"iTerm2 Profile System for claude-team","description":"Create a dedicated iTerm2 profile system for claude-team sessions to provide consistent, visually-organized terminal windows.\n\n## Goals\n- Avoid hijacking user's default profile (which may be full-screen)\n- Provide visual distinction between sessions via dynamic tab colors\n- Show context via badge text (issue ID + task description)\n- Use consistent, legible font sizing\n- Create professional, organized multi-agent workspace\n\n## Key Features\n1. Built-in 'claude-team' profile with controlled window sizing\n2. Dynamic tab colors - each window gets unique, perceptually distinct color\n3. Badge text showing: beads issue + short task description\n4. Source Code Pro font with fallback (Menlo or Monaco)\n5. Reasonable window size (not full-screen)\n\n## Non-Goals\n- Custom backgrounds (keep simple)\n- Complex theming system\n- User-configurable everything (sensible defaults)\n\n## Open Questions\n- Window dimensions and spawn position\n- Light/dark mode handling\n- Profile persistence strategy\n- First-run profile creation","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-12T09:45:13.371557-08:00","updated_at":"2025-12-13T09:32:08.856117-08:00","closed_at":"2025-12-13T09:32:08.856117-08:00","dependencies":[{"issue_id":"cic-iex","depends_on_id":"cic-3dj","type":"blocks","created_at":"2025-12-12T09:46:37.352363-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-iex","depends_on_id":"cic-0ed","type":"blocks","created_at":"2025-12-12T09:46:42.524832-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-iex","depends_on_id":"cic-ga4","type":"blocks","created_at":"2025-12-12T09:46:47.685037-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-iex","depends_on_id":"cic-ntq","type":"blocks","created_at":"2025-12-12T09:46:52.856903-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-iex","depends_on_id":"cic-ms7","type":"blocks","created_at":"2025-12-12T09:46:58.008276-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-ir7","title":"spawn_session tool","description":"Implement the spawn_session MCP tool.\n\nTool signature:\n  spawn_session(\n    project_path: str,\n    session_name: Optional[str] = None,\n    layout: str = 'new_window',  # or 'split_vertical', 'split_horizontal'\n    resume_session: Optional[str] = None\n  ) -\u003e dict\n\nBehavior:\n1. Validate project_path exists\n2. Create iTerm2 window/pane based on layout parameter\n3. Start Claude Code in the new session\n4. Wait for Claude to initialize (with timeout)\n5. Discover Claude session ID from JSONL\n6. Register in SessionRegistry\n7. Return {session_id, project_path, status, claude_session_id}\n\nUse existing primitives: create_window, split_pane, start_claude, find_active_session","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T21:56:50.490822-08:00","updated_at":"2025-12-11T22:14:30.729012-08:00","closed_at":"2025-12-11T22:14:30.729012-08:00","dependencies":[{"issue_id":"cic-ir7","depends_on_id":"cic-sic","type":"blocks","created_at":"2025-12-11T21:59:50.759651-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-ir7","depends_on_id":"cic-y5n","type":"blocks","created_at":"2025-12-11T21:59:55.884867-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-ir7","depends_on_id":"cic-yo7","type":"blocks","created_at":"2025-12-11T22:00:00.999312-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-ivhu","title":"Return immediately on slash command messages","description":"When message_workers receives a message that begins with forward slash (/), return immediately despite wait conditions. Interpret this as an attempt at a slash command which doesn't produce reliable telemetry (no stop hook fires). Include in the return that we detected a slash command and recommend the coordinator read the conversation logs to verify success.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-22T20:33:57.891092-08:00","updated_at":"2025-12-22T20:33:57.891092-08:00"}
{"id":"cic-jh2","title":"Phase 6: Entry Points \u0026 Configuration","description":"Add entry points and configuration. Modify pyproject.toml: add claude-team-tui script entry point, add optional-dependencies [tui] = textual\u003e=0.89.0, httpx\u003e=0.27.0. Environment variables: CLAUDE_TEAM_HTTP_PORT (default 8765), CLAUDE_TEAM_SERVER_URL (default http://127.0.0.1:8765). Update registry.py to add lead_session tracking for advisory messages.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T17:57:13.355622-08:00","updated_at":"2025-12-15T12:49:41.248189-08:00","closed_at":"2025-12-15T12:49:41.248189-08:00","dependencies":[{"issue_id":"cic-jh2","depends_on_id":"cic-9xc","type":"blocks","created_at":"2025-12-14T17:58:22.4333-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-jnrp","title":"Redesign spawn_workers API with unified WorkerConfig","description":"Redesign spawn_workers to use a cleaner array-of-configs API that:\n1. Eliminates awkward projects/layout redundancy\n2. Restores window reuse logic from main branch\n3. Supports beads-integrated workflows (custom branch names, badges)\n4. Allows worktree auto-generation in .worktrees/\n\n## New API\n\n```python\nspawn_workers(\n    workers: list[WorkerConfig],\n    layout: Literal[\"auto\", \"new\"] = \"auto\",\n)\n```\n\n### layout\n- \"auto\" (default): Find claude-team windows with \u003c4 panes, split into them. Falls back to new window.\n- \"new\": Always create new window. Panes arranged by count (1→single, 2→vertical, 3→triple, 4→quad).\n\n### WorkerConfig\n```python\n{\n    \"project_path\": str,       # Path or \"auto\"\n                               # - Path: spawn at this location\n                               # - \"auto\": create .worktrees/\u003cbead\u003e-\u003cdesc\u003e or .worktrees/\u003cname\u003e-\u003cuuid\u003e-\u003cdesc\u003e\n    \"name\": str | None,        # Worker name. None = auto-pick from themed sets.\n    \"bead\": str | None,        # Beads issue ID (for badge, branch naming)\n    \"description\": str | None, # Work description (for badge, branch, annotation)\n    \"prompt\": str | None,      # Custom prompt. None = standard worker prompt.\n    \"skip_permissions\": bool,  # Default false.\n}\n```\n\n### Badge Format\n```\n\u003cbead or name\u003e\n\u003cdescription\u003e\n```\nWith Menlo 10 font, positioned subtly.\n\n### Worktree Path Resolution (project_path=\"auto\")\n1. If bead: .worktrees/\u003cbead\u003e-\u003cdescription\u003e/ → branch \u003cbead\u003e-\u003cdescription\u003e\n2. Else: .worktrees/\u003cname\u003e-\u003cuuid\u003e-\u003cdescription\u003e/ → branch \u003cname\u003e-\u003cuuid\u003e-\u003cdescription\u003e\n3. Description slugified\n4. .worktrees added to .gitignore if not present\n\n## Closes\n- cic-bm7 (window reuse)\n- cic-7j0 (custom branch/worker names)","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-23T10:36:59.413231-08:00","updated_at":"2025-12-23T13:47:52.731887-08:00","closed_at":"2025-12-23T13:47:52.731887-08:00","close_reason":"Closed","dependencies":[{"issue_id":"cic-jnrp","depends_on_id":"cic-bm7","type":"blocks","created_at":"2025-12-23T10:37:04.908764-08:00","created_by":"daemon"},{"issue_id":"cic-jnrp","depends_on_id":"cic-7j0","type":"blocks","created_at":"2025-12-23T10:37:05.001381-08:00","created_by":"daemon"}]}
{"id":"cic-k0m","title":"send_message not submitting - Enter key not sent","description":"When send_message sends a prompt to a session, the text is pasted but Enter is not sent to submit it.\n\n## Reproduction\n1. spawn_team or spawn_session\n2. send_message with any text\n3. Observe: text appears at prompt but isn't submitted\n\n## Expected\nText should be submitted (Enter pressed after paste)\n\n## Actual  \nText sits at prompt, requires manual Enter\n\n## Investigation\n- send_prompt() calls async_send_text(KEYS['enter']) which is \\x0d\n- Manual Python script sending \\x0d works\n- Something in the MCP tool chain is failing\n\n## Workaround\nManually send Enter via direct iTerm2 API call","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-12T11:14:41.490711-08:00","updated_at":"2025-12-12T11:24:45.391533-08:00","closed_at":"2025-12-12T11:24:45.391533-08:00"}
{"id":"cic-kiu","title":"close_session tool","description":"Implement the close_session MCP tool.\n\nTool signature:\n  close_session(\n    session_id: str,\n    force: bool = False\n  ) -\u003e dict\n\nBehavior:\n1. Look up session in registry\n2. If not force and session is busy, return error\n3. Send Ctrl+C to interrupt any running operation\n4. Send '/exit' or Escape to exit Claude\n5. Optionally close the iTerm2 pane/window\n6. Remove from registry\n7. Return {success: bool, final_status: str}\n\nHandle edge cases: session already closed, iTerm2 window closed externally.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T21:57:23.924286-08:00","updated_at":"2025-12-11T22:14:56.166827-08:00","closed_at":"2025-12-11T22:14:56.166827-08:00","dependencies":[{"issue_id":"cic-kiu","depends_on_id":"cic-sic","type":"blocks","created_at":"2025-12-11T22:00:52.233455-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-kiu","depends_on_id":"cic-y5n","type":"blocks","created_at":"2025-12-11T22:00:57.34777-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-ko6","title":"Update .mcp.json for plugin distribution","description":"File: .mcp.json. Change from local path to uvx-based: {mcpServers: {claude-team: {command: uvx, args: [claude-team-mcp]}}}. Requires PyPI publish first.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T09:13:32.701846-08:00","updated_at":"2025-12-18T10:35:46.424967-08:00","closed_at":"2025-12-18T10:35:46.424967-08:00","dependencies":[{"issue_id":"cic-ko6","depends_on_id":"cic-80w","type":"blocks","created_at":"2025-12-16T09:15:23.577477-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-kv2","title":"discover_sessions converts hyphens to slashes in project path","description":"Path detection parses 'claude-iterm-controller' from prompt as 'claude/iterm/controller'. The screen parsing logic incorrectly converts hyphens to directory separators, causing import_session to fail with 'Project path does not exist' when no explicit project_path is provided.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-11T22:50:11.518064-08:00","updated_at":"2025-12-11T22:57:14.842-08:00","closed_at":"2025-12-11T22:57:14.842-08:00"}
{"id":"cic-l8u","title":"Shell-only terminal sessions for long-running processes","description":"Allow claude-team to spawn terminal sessions that do NOT run Claude Code. Useful for long-running shell programs like dev servers (npm run dev), build watchers, database clients, etc. Sessions should be trackable and manageable like Claude sessions but without JSONL/conversation tracking.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-16T09:20:11.113365-08:00","updated_at":"2025-12-16T09:20:11.113365-08:00","dependencies":[{"issue_id":"cic-l8u","depends_on_id":"cic-avg","type":"blocks","created_at":"2025-12-16T09:21:17.258226-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-l8u","depends_on_id":"cic-v7e","type":"blocks","created_at":"2025-12-16T09:21:22.402335-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-l8u","depends_on_id":"cic-q6l","type":"blocks","created_at":"2025-12-16T09:21:27.546817-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-l8u","depends_on_id":"cic-hr4","type":"blocks","created_at":"2025-12-16T09:21:32.679775-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-l8u","depends_on_id":"cic-2q6","type":"blocks","created_at":"2025-12-16T09:21:37.820296-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-l8u","depends_on_id":"cic-7pt","type":"blocks","created_at":"2025-12-16T09:21:42.959352-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-ms7","title":"Profile auto-creation on first use","description":"Automatically create the claude-team profile if it doesn't exist.\n\n## Detection\n- Check if 'claude-team' profile exists in iTerm2\n- Use iterm2.PartialProfile.async_get() or similar\n\n## Profile Properties to Set\n- Name: 'claude-team'\n- Font: Source Code Pro 12pt (fallback: Menlo 12pt)\n- Window style: Maximized (NOT fullscreen)\n- Rows/Columns: Large enough for splitting (e.g., 200x60)\n- Close on exit: automatic\n- Colors: Adapt to system light/dark mode\n\n## Creation Flow\n1. On first spawn_session call, check for profile\n2. If missing, create with all settings\n3. Log: 'Created claude-team iTerm2 profile'\n4. Cache result to avoid repeated checks\n\n## Fallback Strategy\nIf profile creation fails:\n- Log warning\n- Use default profile with LocalWriteOnlyProfile customizations\n- Still apply tab colors and badge\n\n## iTerm2 API\n- iterm2.Profile for reading existing\n- May need to use iTerm2's dynamic profiles or scripting","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T09:46:25.561999-08:00","updated_at":"2025-12-12T11:39:37.845975-08:00","closed_at":"2025-12-12T11:39:37.845975-08:00","dependencies":[{"issue_id":"cic-ms7","depends_on_id":"cic-3dj","type":"blocks","created_at":"2025-12-12T09:47:26.478313-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-msz","title":"Phase 2: REST API Layer","description":"Expose session state and actions via HTTP endpoints. Create new files: src/claude_team_mcp/api/__init__.py, api/routes.py (REST endpoints), api/schemas.py (Pydantic models). Endpoints: GET /api/sessions (list all), GET /api/sessions/{id} (single session), GET /api/sessions/{id}/screen (terminal content), POST /api/actions/spawn (create worker), POST /api/actions/kill/{id} (terminate worker), POST /api/actions/message/{id} (send message). Implement advisory message pattern to notify lead session of TUI actions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T17:56:29.239229-08:00","updated_at":"2025-12-15T12:48:20.936525-08:00","closed_at":"2025-12-15T12:48:20.936525-08:00","dependencies":[{"issue_id":"cic-msz","depends_on_id":"cic-hzx","type":"blocks","created_at":"2025-12-14T17:58:01.944961-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-mz0","title":"Investigate spawn-to-prompt startup latency","description":"Research what takes time between: 1) Opening new shell and starting claude code, 2) Claude code starting to receiving first prompt. Don't make changes, just investigate and report findings.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T07:35:12.277465-08:00","updated_at":"2025-12-16T07:40:10.778421-08:00","closed_at":"2025-12-16T07:38:13.050769-08:00"}
{"id":"cic-ntq","title":"Integrate profile system into spawn_session","description":"Update spawn_session and spawn_team to use the claude-team profile.\n\n## Changes to spawn_session\n- Use claude-team profile instead of default\n- Apply dynamic tab color\n- Set badge text from new optional params\n- New parameters:\n  - issue_id: str = None\n  - task_description: str = None  \n  - tab_color: iterm2.Color = None (override auto-color)\n\n## Changes to spawn_team\n- Each pane gets unique color from sequence\n- Badge shows pane position + issue if provided\n- Optional color_scheme param for future expansion\n\n## Changes to iterm_utils.py\n- Update create_window() to accept profile_customizations\n- Update split functions similarly\n\n## Backwards Compatibility\n- Existing calls work unchanged (colors auto-assigned)\n- New params are optional","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T09:46:11.217176-08:00","updated_at":"2025-12-12T11:39:37.845138-08:00","closed_at":"2025-12-12T11:39:37.845138-08:00","dependencies":[{"issue_id":"cic-ntq","depends_on_id":"cic-3dj","type":"blocks","created_at":"2025-12-12T09:47:10.987043-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-ntq","depends_on_id":"cic-0ed","type":"blocks","created_at":"2025-12-12T09:47:16.157357-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-ntq","depends_on_id":"cic-ga4","type":"blocks","created_at":"2025-12-12T09:47:21.320758-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-o7m","title":"get_session_status tool","description":"Implement the get_session_status MCP tool.\n\nTool signature:\n  get_session_status(session_id: str) -\u003e dict\n\nReturns detailed status:\n{\n  session_id: str,\n  status: str (spawning/ready/busy/closed),\n  project_path: str,\n  is_responsive: bool,  # Can we read screen?\n  last_activity: str,\n  conversation_stats: {\n    total_messages: int,\n    user_messages: int,\n    assistant_messages: int,\n    last_user_prompt: Optional[str],\n    last_assistant_response_preview: Optional[str]\n  },\n  screen_preview: str  # Last few lines of terminal\n}\n\nCombines iTerm2 screen reading with JSONL parsing for full picture.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T21:57:17.40743-08:00","updated_at":"2025-12-11T22:14:51.082816-08:00","closed_at":"2025-12-11T22:14:51.082816-08:00","dependencies":[{"issue_id":"cic-o7m","depends_on_id":"cic-sic","type":"blocks","created_at":"2025-12-11T22:00:41.982891-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-o7m","depends_on_id":"cic-y5n","type":"blocks","created_at":"2025-12-11T22:00:47.114277-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-od2","title":"Cache system_profiler results with TTL","description":"Files: profile.py:129 (SPDisplaysDataType), profile.py:216 (SPFontsDataType), iterm_utils.py:164 (SPDisplaysDataType). Create module-level cache dict with 5-minute TTL. Wrap subprocess.run calls with cache lookup. Key by command, value is (result, timestamp).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T09:12:44.448619-08:00","updated_at":"2025-12-16T09:37:37.487234-08:00","closed_at":"2025-12-16T09:34:57.450083-08:00"}
{"id":"cic-og9","title":"Fix JSONL waiting - marker sent before Claude TUI ready","description":"Bug: wait_for_jsonl_session returns immediately for existing JSONL files (doesn't filter using existing_files set). Even with fix, JSONL file creation happens before TUI is ready. Need to wait for a signal that Claude's input handler is active.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T10:21:33.768055-08:00","updated_at":"2025-12-16T10:25:53.919805-08:00","closed_at":"2025-12-16T10:25:53.919805-08:00"}
{"id":"cic-oz0","title":"Set BEADS_DIR when spawning sessions in worktrees","description":"When spawning Claude sessions in git worktrees, set the BEADS_DIR environment variable to point to the main repo's .beads directory.\n\nBackground: Beads has known worktree limitations (see steveyegge/beads PR #478). The database discovery fails because git rev-parse --show-toplevel returns the worktree path instead of the main repo.\n\nImplementation:\n- Detect if project_path is a worktree (check if .git is a file)\n- If so, resolve main repo path and set BEADS_DIR=/path/to/main/.beads\n- Pass this env var to start_claude_in_session()\n\nWorkarounds that work today:\n- bd --no-db (used by e5t-worker)\n- BEADS_NO_DAEMON=1\n- --sandbox mode","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-11T22:44:31.543033-08:00","updated_at":"2025-12-11T22:57:14.842885-08:00","closed_at":"2025-12-11T22:57:14.842885-08:00"}
{"id":"cic-p5ev","title":"Decouple project_path from worktree creation","description":"Currently project_path='auto' creates worktrees, explicit paths don't. This conflates 'which repo' with 'should I isolate'. Fix: add use_worktree: bool = True to WorkerConfig. Explicit paths with use_worktree=True should create worktrees in \u003crepo\u003e/.worktrees/","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-29T12:17:12.850121-08:00","updated_at":"2025-12-29T12:18:51.415187-08:00","closed_at":"2025-12-29T12:18:51.415187-08:00","close_reason":"Closed"}
{"id":"cic-ptz","title":"Fix window focus - re-activate after spawn completes","description":"Window activation in create_window() happens early, but focus shifts back to coordinator during Claude startup. Fix: re-activate window after all setup is complete.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T10:38:18.002153-08:00","updated_at":"2025-12-16T10:38:30.845614-08:00","closed_at":"2025-12-16T10:38:30.845614-08:00"}
{"id":"cic-puh","title":"Finalize pyproject.toml metadata for PyPI","description":"File: pyproject.toml. Add complete author info, description, keywords, classifiers. Verify entry point: claude-team-mcp = claude_team_mcp:main. Add project URLs (homepage, repository).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T09:13:11.189131-08:00","updated_at":"2025-12-18T06:28:51.168953-08:00","closed_at":"2025-12-18T06:28:51.168953-08:00"}
{"id":"cic-pyez","title":"Create terminal package __init__.py","description":"Create src/claude_team_mcp/terminal/__init__.py with exports and factory function","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T20:36:07.995827-08:00","updated_at":"2025-12-22T20:39:04.705755-08:00","closed_at":"2025-12-22T20:39:04.705755-08:00","close_reason":"Closed","dependencies":[{"issue_id":"cic-pyez","depends_on_id":"cic-e18u","type":"blocks","created_at":"2025-12-22T20:36:17.565743-08:00","created_by":"daemon"}]}
{"id":"cic-q6l","title":"Add send_to_shell MCP tool","description":"Create MCP tool to send commands/input to shell-only sessions. Similar to send_message but for raw shell input. Should handle Enter key properly. May want option to wait for command completion.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T09:20:45.501187-08:00","updated_at":"2025-12-16T09:20:45.501187-08:00","dependencies":[{"issue_id":"cic-q6l","depends_on_id":"cic-avg","type":"blocks","created_at":"2025-12-16T09:21:54.814672-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-qw2l","title":"Terminal Abstraction Layer (Minimal)","description":"Create a minimal terminal abstraction layer that supports both iTerm2 and Zed backends. Focus on clean, simple interfaces - only what's strictly needed.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-22T20:35:50.901659-08:00","updated_at":"2025-12-22T20:39:04.815857-08:00","closed_at":"2025-12-22T20:39:04.815857-08:00","close_reason":"Closed","dependencies":[{"issue_id":"cic-qw2l","depends_on_id":"cic-e18u","type":"blocks","created_at":"2025-12-22T20:36:17.098266-08:00","created_by":"daemon"},{"issue_id":"cic-qw2l","depends_on_id":"cic-x9vj","type":"blocks","created_at":"2025-12-22T20:36:17.217839-08:00","created_by":"daemon"},{"issue_id":"cic-qw2l","depends_on_id":"cic-pyez","type":"blocks","created_at":"2025-12-22T20:36:17.332622-08:00","created_by":"daemon"}]}
{"id":"cic-qzu","title":"Claude Code Team Manager MCP Server","description":"Build an MCP server that allows one Claude Code session to spawn and manage a team of other Claude Code sessions via iTerm2. The server maintains persistent state tracking which iTerm windows/panes correspond to which Claude sessions, enabling coordination between multiple AI coding agents.\n\nKey capabilities:\n- Spawn new Claude Code sessions in iTerm2 windows/panes\n- Send prompts to managed sessions\n- Read responses and conversation state from sessions\n- Check session status (idle, processing, waiting)\n- Coordinate multi-session workflows\n\nTech stack:\n- Python with uv (replacing pip/venv)\n- Official MCP Python SDK (FastMCP)\n- Existing iTerm2 primitives from this project\n- JSONL session parsing for state access","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-11T21:55:24.81561-08:00","updated_at":"2025-12-12T10:06:49.231408-08:00","closed_at":"2025-12-12T10:06:49.231408-08:00","dependencies":[{"issue_id":"cic-qzu","depends_on_id":"cic-el6","type":"blocks","created_at":"2025-12-11T21:58:00.016924-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-qzu","depends_on_id":"cic-sic","type":"blocks","created_at":"2025-12-11T21:58:05.136279-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-qzu","depends_on_id":"cic-y5n","type":"blocks","created_at":"2025-12-11T21:58:10.25382-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-qzu","depends_on_id":"cic-ir7","type":"blocks","created_at":"2025-12-11T21:58:15.370467-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-qzu","depends_on_id":"cic-v98","type":"blocks","created_at":"2025-12-11T21:58:20.494682-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-qzu","depends_on_id":"cic-3tv","type":"blocks","created_at":"2025-12-11T21:58:25.637636-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-qzu","depends_on_id":"cic-f0j","type":"blocks","created_at":"2025-12-11T21:58:30.766309-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-qzu","depends_on_id":"cic-o7m","type":"blocks","created_at":"2025-12-11T21:58:35.890778-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-qzu","depends_on_id":"cic-kiu","type":"blocks","created_at":"2025-12-11T21:58:41.016919-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-qzu","depends_on_id":"cic-yo7","type":"blocks","created_at":"2025-12-11T21:58:46.137259-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-qzu","depends_on_id":"cic-clx","type":"blocks","created_at":"2025-12-11T21:58:51.270767-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-qzu","depends_on_id":"cic-hzk","type":"blocks","created_at":"2025-12-11T21:58:56.405378-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-qzu","depends_on_id":"cic-2rc","type":"blocks","created_at":"2025-12-11T22:01:38.24671-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-r24","title":"Add auto-discovery to get_jsonl_path","description":"Make get_jsonl_path() auto-discover session JSONL file if not already known.\n\nCurrent: Requires claude_session_id to be set in ManagedSession\nNew: If claude_session_id is None, search for matching JSONL file\n\nImplementation in registry.py or session_state.py:\n- List JSONL files for project\n- Find most recently modified file\n- Or use marker correlation if available","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T09:59:43.293126-08:00","updated_at":"2025-12-15T11:08:15.219721-08:00","closed_at":"2025-12-15T10:09:53.229496-08:00"}
{"id":"cic-r70","title":"Create plugin.json for Claude Code plugin","description":"File: .claude-plugin/plugin.json (new). Include: name (claude-team), version (0.1.0), description, author (Josh Lehman), repository URL, license (MIT), keywords [mcp, iterm2, orchestration, multi-agent].","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T09:13:21.932209-08:00","updated_at":"2025-12-18T10:39:19.385248-08:00","closed_at":"2025-12-18T10:39:19.385248-08:00","dependencies":[{"issue_id":"cic-r70","depends_on_id":"cic-80w","type":"blocks","created_at":"2025-12-16T09:15:13.312287-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-sic","title":"Core MCP server skeleton","description":"Create the basic FastMCP server structure with stdio transport.\n\nFiles to create:\n- src/claude_team_mcp/server.py - Main MCP server using FastMCP\n- src/claude_team_mcp/__init__.py - Package init\n- src/claude_team_mcp/__main__.py - Entry point for 'python -m claude_team_mcp'\n\nThe server should:\n- Use FastMCP for simple tool registration\n- Support stdio transport (for Claude Desktop integration)\n- Have a lifespan context manager for managing iTerm2 connection\n- Log startup/shutdown events\n\nReference the MCP Python SDK FastMCP patterns.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-11T21:55:50.916268-08:00","updated_at":"2025-12-11T22:07:27.445469-08:00","closed_at":"2025-12-11T22:07:27.445469-08:00","dependencies":[{"issue_id":"cic-sic","depends_on_id":"cic-el6","type":"blocks","created_at":"2025-12-11T21:59:35.404951-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-stv","title":"Replace 4.0s Claude init sleep with JSONL watching","description":"File: src/claude_team_mcp/iterm_utils.py:450. Instead of asyncio.sleep(4.0), poll for JSONL file creation in ~/.claude/projects/{slug}/. Poll every 200ms, timeout at 10s. Success: JSONL file exists and has content.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T09:12:33.732143-08:00","updated_at":"2025-12-16T09:37:37.487569-08:00","closed_at":"2025-12-16T09:34:55.879954-08:00"}
{"id":"cic-uc7","title":"Research claude-team distribution as Claude plugin","description":"Research best practices for packaging MCP servers and slash commands. Investigate what it would take to distribute claude-team as a Claude plugin or similar distribution mechanism.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T07:35:17.628375-08:00","updated_at":"2025-12-16T07:40:10.779475-08:00","closed_at":"2025-12-16T07:39:26.07322-08:00"}
{"id":"cic-une","title":"Add coordinator messaging - allow workers to send messages back to coordinator","description":"Currently send_message only works FROM coordinator TO workers. Workers have no way to message back to the coordinator because the coordinator doesn't have a session_id in the registry.\n\nProposed solution: Add a 'coordinator inbox' mechanism where:\n1. Workers can call something like send_to_coordinator(message)\n2. Coordinator can poll/read inbox via get_coordinator_messages()\n\nThis would enable async communication patterns without workers writing to temp files.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-14T16:33:52.292079-08:00","updated_at":"2025-12-14T16:33:52.292079-08:00","comments":[{"id":1,"issue_id":"cic-une","author":"rabsef-bicrym","text":"Partial progress: Added get_conversation_history tool (cic-8mk) which allows coordinator to observe worker activity with reverse pagination. This addresses the OBSERVATION part of the problem. The back-channel messaging (workers sending TO coordinator) still needs a queue/inbox system since coordinator isn't in iTerm.","created_at":"2025-12-15T19:38:22Z"}]}
{"id":"cic-uw8","title":"close_session should close iTerm2 pane/window","description":"Currently close_session removes the session from the registry but leaves the iTerm2 pane/window open. It should optionally (or by default) close the actual iTerm2 pane.\n\nConsider:\n- close_pane parameter (default true?)\n- If pane is last in window, close window\n- If pane is last in tab, close tab\n- Handle gracefully if iTerm2 session is already closed","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-11T22:35:52.972446-08:00","updated_at":"2025-12-11T22:56:01.61782-08:00","closed_at":"2025-12-11T22:56:01.61782-08:00"}
{"id":"cic-uwc","title":"Dynamic profile not auto-created on first spawn","description":"When spawning sessions for the first time, the claude-team profile is not automatically created in ~/Library/Application Support/iTerm2/DynamicProfiles/.\n\nThe profile.py code has logic to create the profile file via _create_dynamic_profile_file(), but it's returning INVALID_PROFILE_NAME errors on spawn.\n\nWorkaround: Manually create the profile file.\n\nExpected: Profile should be auto-created on first spawn attempt.\nActual: INVALID_PROFILE_NAME error until manually created.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-12T12:45:59.069201-08:00","updated_at":"2025-12-18T06:14:10.497451-08:00","closed_at":"2025-12-18T06:14:10.497451-08:00"}
{"id":"cic-v6x","title":"send_message does not submit after paste - Enter key not working","description":"When send_message sends a multi-line message, it gets pasted (bracketed paste mode shows '[Pasted text #1 +20 lines]') but the message is not submitted. Short single-line messages work fine.\n\nThe issue appears specific to bracketed paste mode. Possible causes:\n- Claude Code may require a different key sequence after bracketed paste\n- There may be a timing issue needing delay after paste before submission key\n- The submission key after paste might not be Enter (\\x0d)\n\nNote: Single-line messages submit correctly with \\x0d.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-11T22:31:49.11264-08:00","updated_at":"2025-12-12T10:26:33.506541-08:00","closed_at":"2025-12-12T10:26:33.506541-08:00"}
{"id":"cic-v7e","title":"Extend registry for shell-only sessions","description":"Modify SessionRegistry and ManagedSession to track shell-only sessions. Add session_type field (claude vs shell). Shell sessions won't have claude_session_id or JSONL tracking. May need different state machine (no BUSY state based on JSONL).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T09:20:40.108252-08:00","updated_at":"2025-12-19T12:56:57.913713-08:00","closed_at":"2025-12-19T12:56:39.284743-08:00"}
{"id":"cic-v98","title":"list_sessions tool","description":"Implement the list_sessions MCP tool.\n\nTool signature:\n  list_sessions(\n    status_filter: Optional[str] = None  # ready, busy, all\n  ) -\u003e list[dict]\n\nReturns list of:\n{\n  session_id: str,\n  session_name: str,\n  project_path: str,\n  status: str,\n  claude_session_id: Optional[str],\n  last_activity: str (ISO timestamp),\n  message_count: int (from JSONL if available)\n}\n\nShould refresh status for each session before returning (check if Claude is idle or processing).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T21:56:57.538829-08:00","updated_at":"2025-12-11T22:14:35.813415-08:00","closed_at":"2025-12-11T22:14:35.813415-08:00","dependencies":[{"issue_id":"cic-v98","depends_on_id":"cic-sic","type":"blocks","created_at":"2025-12-11T22:00:06.110642-08:00","created_by":"phaedrus","metadata":"{}"},{"issue_id":"cic-v98","depends_on_id":"cic-y5n","type":"blocks","created_at":"2025-12-11T22:00:11.229202-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-vcp","title":"Use internal .worktrees/ directory for worker worktrees","description":"Change worktree creation to use an internal .worktrees/ directory instead of cluttering the parent directory.\n\n## Current Behavior\n- Worktrees created in parent: `../project-cic-123`\n- Clutters parent directory\n- Requires manual cleanup path awareness\n\n## Proposed Behavior\n- Worktrees created in: `.worktrees/cic-123`\n- Self-contained within repo\n- Already gitignored (committed in 57733a8)\n- Easier cleanup (just delete .worktrees/)\n\n## Changes Required\n\n### /spawn-workers command (.claude/commands/spawn-workers.md)\nUpdate worktree creation instruction:\n```bash\n# Before\ngit worktree add ../\u003cproject\u003e-\u003cissue-id\u003e -b \u003cissue-id\u003e/\u003cdesc\u003e\n\n# After  \ngit worktree add .worktrees/\u003cissue-id\u003e -b \u003cissue-id\u003e/\u003cdesc\u003e\n```\n\n### get_worktree_beads_dir() (server.py)\nNo changes needed - already handles internal worktrees correctly.\nThe `git rev-parse --git-common-dir` detection works regardless of worktree location.\n\n### Cleanup commands in /spawn-workers\n```bash\n# Before\ngit worktree remove ../\u003cproject\u003e-\u003cissue-id\u003e\n\n# After\ngit worktree remove .worktrees/\u003cissue-id\u003e\n```\n\n## Benefits\n- Cleaner parent directory\n- All worktrees visible with `ls .worktrees/`\n- Self-documenting structure\n- Simpler paths in commands","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-12T10:14:42.452387-08:00","updated_at":"2025-12-12T10:43:20.775556-08:00","closed_at":"2025-12-12T10:43:20.775556-08:00"}
{"id":"cic-vju","title":"Add HTTP integration tests","description":"Add pytest integration tests for the HTTP API layer. Tests should: 1) Start HTTP server in background fixture, 2) Test health endpoint, 3) Test /api/sessions endpoints with mocked registry (no iTerm2), 4) Test /api/actions endpoints. Use httpx async client. Document manual testing steps for full validation with iTerm2.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T18:15:11.636741-08:00","updated_at":"2025-12-15T12:48:50.678077-08:00","closed_at":"2025-12-15T12:48:50.678077-08:00","dependencies":[{"issue_id":"cic-vju","depends_on_id":"cic-msz","type":"blocks","created_at":"2025-12-14T18:15:25.652727-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-x5t","title":"Thought experiment: close_team / batch session close","description":"Consider adding a close_team() or close_all_sessions() helper for batch closing workers.\n\n**Context from dogfooding:**\nWhen coordinating a team of 4 workers, had to call close_session 4 times sequentially. Minor friction but noticeable.\n\n**Open questions:**\n- Should this close all sessions, or just sessions from a specific spawn_team call?\n- If the latter, need team tracking (see related spike)\n- Is this worth the API surface area or is 4 close calls fine?\n\n**Status:** Thought experiment - not ready to build. Consider independently from main orchestration epic.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-16T20:38:23.214042-08:00","updated_at":"2025-12-16T20:38:23.214042-08:00"}
{"id":"cic-x9vj","title":"Implement iTerm2 backend (iterm.py)","description":"Create src/claude_team_mcp/terminal/iterm.py implementing TerminalBackend using existing iterm_utils.py functions","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T20:36:06.718757-08:00","updated_at":"2025-12-22T20:38:24.513414-08:00","closed_at":"2025-12-22T20:38:24.513414-08:00","close_reason":"Closed","dependencies":[{"issue_id":"cic-x9vj","depends_on_id":"cic-e18u","type":"blocks","created_at":"2025-12-22T20:36:17.449827-08:00","created_by":"daemon"}]}
{"id":"cic-xb8j","title":"Implement base.py abstract terminal interface","description":"Create src/claude_team_mcp/terminal/base.py with comprehensive abstract base classes and types.\n\n## Core Types\n- TerminalHandle - opaque identifier for a terminal\n- TerminalInfo - metadata about a terminal (id, title, cwd, is_idle, is_active)\n- TerminalContent - screen content (lines, cursor position)\n- SplitDirection - Left, Right, Up, Down\n- LayoutMode - TileVertical, TileHorizontal, Consolidate\n- LayoutNode - tree structure for layout introspection\n\n## Event Types (for subscription-capable backends)\n- TerminalEvent (base)\n- NewSessionEvent, KeystrokeEvent, ScreenUpdateEvent\n- PromptEvent, LocationChangeEvent, CustomEscapeEvent\n- TerminateEvent, LayoutChangeEvent, FocusChangeEvent\n\n## Abstract TerminalBackend class\nMethods for all terminal operations with async signatures:\n- identify_self() -\u003e TerminalHandle | None\n- list_terminals() -\u003e list[TerminalInfo]\n- get_info(handle) -\u003e TerminalInfo\n- get_layout() -\u003e LayoutNode\n- set_layout(mode: LayoutMode)\n- create(options) -\u003e TerminalHandle\n- split(handle, direction, options) -\u003e TerminalHandle\n- close(handle, force)\n- send_text(handle, text)\n- send_key(handle, key)\n- read_screen(handle) -\u003e TerminalContent\n- get_cwd(handle) -\u003e str | None\n- is_idle(handle) -\u003e bool\n- focus(handle)\n- set_title(handle, title)\n- move_terminal(source, destination)\n\n## Subscription Protocol (optional capability)\n- subscribe_to_event(event_type, callback, filter)\n- unsubscribe(token)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T20:36:48.564481-08:00","updated_at":"2025-12-22T20:40:38.7446-08:00","closed_at":"2025-12-22T20:40:38.7446-08:00","close_reason":"Closed","comments":[{"id":18,"issue_id":"cic-xb8j","author":"rabsef-bicrym","text":"Implemented comprehensive base.py with:\n- TerminalHandle, TerminalInfo, TerminalContent, TerminalOptions types\n- SplitDirection, LayoutMode, LayoutNode for layout control\n- Full event type hierarchy (9 event types)\n- Capability protocols: SupportsSubscriptions, SupportsCustomEscapeSequences, SupportsLayoutControl, SupportsProfileCustomization\n- Abstract TerminalBackend class with all methods\n- BackendRegistry for multi-backend support\n- Factory functions (get_backend, detect_backend) in __init__.py","created_at":"2025-12-23T17:16:35Z"}]}
{"id":"cic-xdj","title":"Broadcast messaging to multiple sessions","description":"Add ability to send the same message to multiple sessions at once.\n\n## Use Cases\n- 'All workers: run tests before committing'\n- 'All sessions: git pull to get latest changes'\n- 'Frontend team: rebuild and check for errors'\n\n## API Design Options\n1. New tool: broadcast_message(session_ids: list[str], message: str)\n2. Extend send_message with session_ids list parameter\n3. Session groups + broadcast_to_group(group: str, message: str)\n\n## Implementation Considerations\n- Parallel execution (don't wait for each sequentially)\n- Return aggregated results or individual results?\n- Error handling: fail-fast vs collect all errors\n- Option to wait_for_all_responses with combined timeout\n- Consider integration with session tags/groups feature","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-12T08:01:36.801126-08:00","updated_at":"2025-12-12T10:26:33.506898-08:00","closed_at":"2025-12-12T10:26:33.506898-08:00"}
{"id":"cic-y5n","title":"Session registry module","description":"Create a session registry to track all spawned Claude sessions.\n\nFile: src/claude_team_mcp/registry.py\n\nThe SessionRegistry class should track:\n- session_id: str (unique identifier we assign)\n- iterm_session: iterm2.Session object\n- project_path: str (where Claude is running)\n- claude_session_id: Optional[str] (from JSONL file)\n- status: enum (spawning, ready, busy, closed)\n- created_at: datetime\n- last_activity: datetime\n\nMethods:\n- add(session_id, iterm_session, project_path) -\u003e ManagedSession\n- get(session_id) -\u003e Optional[ManagedSession]\n- list_all() -\u003e list[ManagedSession]\n- remove(session_id)\n- update_status(session_id, status)\n\nThis is the core state that makes the MCP server useful - it persists across tool calls.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T21:56:44.224268-08:00","updated_at":"2025-12-11T22:11:38.801878-08:00","closed_at":"2025-12-11T22:11:38.801878-08:00","dependencies":[{"issue_id":"cic-y5n","depends_on_id":"cic-el6","type":"blocks","created_at":"2025-12-11T21:59:40.523402-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-yixs","title":"Add multi-line badge formatting in formatting.py","description":"Add or modify badge formatting to support multi-line badges with smaller font.\n\nRequirements:\n1. Badge format: `\u003cbead or name\u003e\\n\u003cdescription\u003e`\n   - First line: bead ID if provided, otherwise worker name\n   - Second line: description (if provided)\n   - If no description, just show the first line\n\n2. Badge styling (to be applied in spawn_workers):\n   - Font: Menlo 10 (smaller than current)\n   - Positioned subtly in corner\n\nFunction signature suggestion:\n```python\ndef format_badge_text(\n    name: str,\n    bead: str | None = None,\n    description: str | None = None,\n) -\u003e str:\n    \"\"\"Format badge text with bead/name on first line, description on second.\"\"\"\n```\n\nFile: src/claude_team_mcp/formatting.py","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T11:10:49.73716-08:00","updated_at":"2025-12-23T11:18:50.587033-08:00","closed_at":"2025-12-23T11:18:50.587033-08:00","close_reason":"Closed"}
{"id":"cic-ynr","title":"Implement marker-based JSONL correlation","description":"Fix JSONL session discovery to accurately correlate iTerm panes with their JSONL files.\n\nProblem: Multiple Claude sessions in same project share JSONL path prefix, can't tell which pane maps to which file.\n\nSolution:\n1. Send unique marker message to each spawned session\n2. Search all JSONL files for that marker\n3. Use marker presence to correlate pane → file\n\nImplementation:\n- Add marker generation in registry.py\n- Update spawn flow to send marker and wait for response\n- Search JSONL files for marker to find correct file\n- Store discovered claude_session_id in ManagedSession","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T09:59:15.609423-08:00","updated_at":"2025-12-15T12:45:00.175761-08:00","closed_at":"2025-12-15T12:45:00.175761-08:00","comments":[{"id":16,"issue_id":"cic-ynr","author":"rabsef-bicrym","text":"Solved via Stop hook implementation. Pre-generated session IDs are baked into Stop hooks as markers [worker-done:SESSION_ID]. JSONL correlation happens by finding these markers in hookInfos[].command. No separate marker-sending step needed.","created_at":"2025-12-19T20:38:11Z"}]}
{"id":"cic-yo7","title":"Refactor primitives for MCP server","description":"Extract and organize reusable code from existing files for the MCP server.\n\nCreate: src/claude_team_mcp/iterm_utils.py\n- Move key codes, send_text, send_key, send_prompt, read_screen from primitives.py\n- Add proper async context management for iTerm2 connection\n- Add connection pooling/reuse\n\nCreate: src/claude_team_mcp/session_state.py  \n- Move/adapt SessionParser, SessionState, Message from session_parser.py\n- Add caching for parsed sessions\n- Add methods for incremental updates (only parse new lines)\n\nKeep existing files working (they're useful for testing) but have them import from the new modules.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T21:57:30.493975-08:00","updated_at":"2025-12-11T22:09:39.949798-08:00","closed_at":"2025-12-11T22:09:39.949798-08:00","dependencies":[{"issue_id":"cic-yo7","depends_on_id":"cic-el6","type":"blocks","created_at":"2025-12-11T21:59:45.644071-08:00","created_by":"phaedrus","metadata":"{}"}]}
{"id":"cic-z7mp","title":"Add local .worktrees/ support in worktree.py","description":"Modify worktree.py to support creating worktrees in .worktrees/ within the repo (instead of ~/.claude-team/worktrees/).\n\nRequirements:\n1. Add a new function or modify create_worktree to support local worktrees at `.worktrees/\u003cname\u003e/`\n2. Branch naming: `\u003cbead\u003e-\u003cdescription\u003e` or `\u003cname\u003e-\u003cuuid\u003e-\u003cdescription\u003e` (slugified)\n3. Auto-add `.worktrees` to .gitignore if not present\n4. Return the created worktree path\n\nThe caller (spawn_workers) will provide:\n- Base repo path\n- Optional bead ID\n- Optional description  \n- Worker name (for fallback naming)\n\nWorktree path resolution:\n- If bead provided: `.worktrees/\u003cbead\u003e-\u003cdescription\u003e/`\n- Else: `.worktrees/\u003cname\u003e-\u003cuuid\u003e-\u003cdescription\u003e/`\n- Description should be slugified (lowercase, spaces → dashes)\n\nFile: src/claude_team_mcp/worktree.py","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T11:10:40.427371-08:00","updated_at":"2025-12-23T11:18:58.394112-08:00","closed_at":"2025-12-23T11:18:58.394112-08:00","close_reason":"Closed","comments":[{"id":20,"issue_id":"cic-z7mp","author":"rabsef-bicrym","text":"Starting implementation. Will add: 1) slugify helper, 2) ensure_gitignore_entry function, 3) create_local_worktree function","created_at":"2025-12-29T17:05:11Z"},{"id":21,"issue_id":"cic-z7mp","author":"rabsef-bicrym","text":"COMPLETE: Implemented local worktree support in worktree.py. Added:\n- slugify() helper function for URL/filesystem-safe names\n- ensure_gitignore_entry() to auto-add .worktrees to .gitignore\n- create_local_worktree() with bead-based or worker-name-based naming\n- LOCAL_WORKTREE_DIR constant\n\nAll tests pass (2 pre-existing failures in test_colors.py unrelated to changes).","created_at":"2025-12-29T17:05:11Z"}]}
{"id":"cic-zzp","title":"Default spawn_session to auto layout","description":"Change spawn_session default from new_window to auto layout. Also remove redundant auto_layout boolean parameter and fix first-spawn bug where empty managed sessions would search all iTerm windows.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T22:14:32.233897-08:00","updated_at":"2025-12-15T22:16:16.737686-08:00","closed_at":"2025-12-15T22:16:16.737686-08:00"}
