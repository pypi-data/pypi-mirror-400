[package]
name = "dictsqlite"
version = "2.1.0"
edition = "2021"
authors = ["Disnana <support@disnana.com>"]
description = "High-performance DictSQLite v2 with I/O optimizations (300x async, 43x sync speedup) - Buffered writes and batch operations"
license = "MIT"

[lib]
name = "dictsqlite"
crate-type = ["cdylib", "rlib"]

[dependencies]
# Python bindings (v5.1 update: PyO3 0.27 with improved FromPyObject performance)
pyo3 = { version = "0.27.2", features = ["extension-module", "abi3-py39", "experimental-async"] }

# High-performance concurrent data structures (v5.1 update: dashmap 6.1 for better perf)
dashmap = "6.1"          # Lock-free concurrent HashMap
papaya = "0.1"          # Ultra-low latency concurrent hashmap
lru = "0.16.3"          # LRU cache implementation (patched RUSTSEC-2026-0002)

# SQLite backend (keeping 0.31 for r2d2_sqlite compatibility)
rusqlite = { version = "0.31", features = ["bundled", "backup", "blob", "hooks"] }
r2d2 = "0.8"             # Generic connection pool
r2d2_sqlite = "0.24"     # SQLite connection pool adapter

# Async runtime (v5.1 update: tokio 1.42)
tokio = { version = "1.42", features = ["full"] }
async-trait = "0.1"

# Serialization
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
rmp-serde = "1.1"  # MessagePack for JSONB mode
pythonize = "0.27"       # Fast Python <-> Rust JSON conversion (v5.1: pyo3 0.27 compat)

# Compression (v5 optimization)
zstd = "0.13"            # High-speed compression

# Lazy initialization (v5 optimization - shared runtime)
once_cell = "1.19"       # Thread-safe lazy static

# Memory management
crossbeam = "0.8"       # Lock-free data structures
parking_lot = "0.12"    # Fast mutex implementations

# Parallel processing
rayon = "1.8"           # Data parallelism for batch operations

# Hashing
ahash = "0.8"           # Fast non-cryptographic hash

# Cryptography (for v4 security features)
aes-gcm = "0.10"        # AES-256-GCM encryption
argon2 = "0.5"          # Password hashing (PBKDF2 alternative)
pbkdf2 = { version = "0.12", features = ["simple"] }  # PBKDF2 key derivation
sha2 = "0.10"           # SHA-256 hashing
base64 = "0.21"         # Base64 encoding
rand = "0.8"            # Random number generation

# System info
num_cpus = "1.16"       # CPU core detection

# Error handling
thiserror = "1.0"
anyhow = "1.0"

# Logging
tracing = "0.1"
tracing-subscriber = "0.3"

[dev-dependencies]
criterion = { version = "0.5", features = ["html_reports"] }
proptest = "1.4"
tempfile = "3.8"

[profile.release]
opt-level = 3
lto = "fat"
codegen-units = 1
panic = "abort"
strip = true

[profile.bench]
inherits = "release"

[[bench]]
name = "ops_benchmark"
harness = false

[package.metadata.maturin]
# Name used for the Python distribution. Must match the pyo3 module init name
# (#[pymodule] fn <name>) so Python can find the PyInit_<name> symbol in the
# native library. Use `dictsqlite` to keep the top-level project package name.
name = "dictsqlite"
# Location of a long description for PyPI (relative to this Cargo.toml)
long-description-file = "Pypi.md"

# Note: classifiers and requires-python must be set in pyproject.toml (PEP 621)
