# ============================================================================
# TRECO Feature Example: Input Distribution Modes
# ============================================================================
#
# Demonstrates all input distribution modes for race conditions:
# - same: All threads use the same input
# - distribute: Each thread gets a different input value
# - product: Cartesian product of all input combinations
# - random: Random selection from input values
#
# Usage:
#   treco examples/features/input-modes-complete.yaml
#
# ============================================================================

metadata:
  name: "Input Distribution Modes - Complete Guide"
  version: "1.0"
  author: "TRECO Team"
  vulnerability: "N/A - Feature Demo"
  description: |
    Comprehensive demonstration of all input distribution modes for
    race condition attacks with practical examples.

target:
  host: "httpbin.org"
  port: 443
  tls:
    enabled: true

entrypoint:
  state: mode_same_demo

states:
  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  # Mode 1: SAME (All threads use same input)
  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  mode_same_demo:
    description: "Demonstrate SAME mode - all threads use same input"
    
    input:
      endpoint: "/post"
      username: "admin"
      action: "delete_account"
    
    race:
      threads: 3
      input_mode: same  # All threads use same values
      sync_mechanism: barrier
      connection_strategy: multiplexed
    
    request: |
      POST {{ thread.input.endpoint }} HTTP/1.1
      Host: {{ target.host }}
      Content-Type: application/json
      
      {"username": "{{ thread.input.username }}", "action": "{{ thread.input.action }}"}
    
    logger:
      on_state_enter: |
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘  Mode: SAME - All threads use identical input                                â•‘
        â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
        â•‘  Use Case: Attack same endpoint with same payload multiple times             â•‘
        â•‘  Example: Exploit idempotency bugs, race same resource                       â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        Input values:
        â€¢ endpoint: {{ endpoint }}
        â€¢ username: {{ username }}
        â€¢ action: {{ action }}
        
        Expected: All 3 threads send identical requests
      
      on_thread_leave: |
        Thread {{ thread.id }}: {{ thread.input.username }} â†’ {{ thread.input.action }}
      
      on_state_leave: |
        âœ… SAME mode: All threads used identical input
        
        Use cases for SAME mode:
        â€¢ Testing idempotency (same request multiple times)
        â€¢ Resource exhaustion (drain coupon pool)
        â€¢ Concurrency bugs (process same payment twice)
    
    next:
      - goto: mode_distribute_demo

  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  # Mode 2: DISTRIBUTE (Each thread gets different input)
  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  mode_distribute_demo:
    description: "Demonstrate DISTRIBUTE mode - round-robin distribution"
    
    input:
      username:
        - "user1"
        - "user2"
        - "user3"
      password:
        - "pass1"
        - "pass2"
        - "pass3"
    
    race:
      threads: 3
      input_mode: distribute  # Thread 0â†’index 0, Thread 1â†’index 1, etc.
      sync_mechanism: barrier
      connection_strategy: multiplexed
    
    request: |
      POST /post HTTP/1.1
      Host: {{ target.host }}
      Content-Type: application/json
      
      {"username": "{{ thread.input.username }}", "password": "{{ thread.input.password }}"}
    
    logger:
      on_state_enter: |
        
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘  Mode: DISTRIBUTE - Round-robin input distribution                           â•‘
        â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
        â•‘  Use Case: Different payload per thread (e.g., credential stuffing)          â•‘
        â•‘  Distribution: Thread N gets input[N % len(input)]                           â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        Input distribution:
        â€¢ Thread 0: username={{ username[0] }}, password={{ password[0] }}
        â€¢ Thread 1: username={{ username[1] }}, password={{ password[1] }}
        â€¢ Thread 2: username={{ username[2] }}, password={{ password[2] }}
      
      on_thread_leave: |
        Thread {{ thread.id }}: {{ thread.input.username }}:{{ thread.input.password }}
      
      on_state_leave: |
        âœ… DISTRIBUTE mode: Each thread got different input
        
        Use cases for DISTRIBUTE mode:
        â€¢ Credential stuffing (different user:pass per thread)
        â€¢ Multi-target attacks (different endpoints)
        â€¢ A/B testing race conditions
        â€¢ PortSwigger single-endpoint lab (different emails)
    
    next:
      - goto: mode_product_demo

  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  # Mode 3: PRODUCT (Cartesian product of all combinations)
  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  mode_product_demo:
    description: "Demonstrate PRODUCT mode - all combinations"
    
    input:
      username:
        - "admin"
        - "root"
      password:
        - "password123"
        - "admin123"
    
    race:
      threads: 4  # 2 users Ã— 2 passwords = 4 combinations
      input_mode: product  # All combinations
      sync_mechanism: barrier
      connection_strategy: multiplexed
    
    request: |
      POST /post HTTP/1.1
      Host: {{ target.host }}
      Content-Type: application/json
      
      {"username": "{{ thread.input.username }}", "password": "{{ thread.input.password }}"}
    
    logger:
      on_state_enter: |
        
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘  Mode: PRODUCT - Cartesian product of all input combinations                 â•‘
        â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
        â•‘  Use Case: Test all parameter combinations simultaneously                    â•‘
        â•‘  Combinations: {{ username | length }} users Ã— {{ password | length }} passwords = {{ (username | length) * (password | length) }} threads â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        All combinations (4 threads):
        â€¢ Thread 0: admin:password123
        â€¢ Thread 1: admin:admin123
        â€¢ Thread 2: root:password123
        â€¢ Thread 3: root:admin123
      
      on_thread_leave: |
        Thread {{ thread.id }}: {{ thread.input.username }}:{{ thread.input.password }}
      
      on_state_leave: |
        âœ… PRODUCT mode: All 4 combinations tested simultaneously
        
        Use cases for PRODUCT mode:
        â€¢ Brute force attacks (all user:pass combinations)
        â€¢ Parameter fuzzing (all param value combinations)
        â€¢ Multi-dimensional race testing
        â€¢ Finding specific combination that triggers race
    
    next:
      - goto: mode_random_demo

  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  # Mode 4: RANDOM (Random selection from input values)
  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  mode_random_demo:
    description: "Demonstrate RANDOM mode - random input selection"
    
    input:
      username:
        - "alice"
        - "bob"
        - "charlie"
        - "dave"
        - "eve"
      action:
        - "view"
        - "edit"
        - "delete"
        - "share"
    
    race:
      threads: 5
      input_mode: random  # Random selection per thread
      sync_mechanism: barrier
      connection_strategy: multiplexed
    
    request: |
      POST /post HTTP/1.1
      Host: {{ target.host }}
      Content-Type: application/json
      
      {"username": "{{ thread.input.username }}", "action": "{{ thread.input.action }}"}
    
    logger:
      on_state_enter: |
        
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘  Mode: RANDOM - Random input selection per thread                            â•‘
        â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
        â•‘  Use Case: Simulate realistic concurrent user behavior                       â•‘
        â•‘  Selection: Each thread randomly picks from input lists                      â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        Input pools:
        â€¢ Usernames: {{ username | join(', ') }}
        â€¢ Actions: {{ action | join(', ') }}
        
        Each of 5 threads will randomly select from these pools
      
      on_thread_leave: |
        Thread {{ thread.id }}: {{ thread.input.username }} â†’ {{ thread.input.action }}
      
      on_state_leave: |
        âœ… RANDOM mode: Each thread randomly selected input
        
        Use cases for RANDOM mode:
        â€¢ Realistic concurrency simulation
        â€¢ Load testing with varied inputs
        â€¢ Finding edge cases through randomization
        â€¢ Avoiding predictable patterns in tests
    
    next:
      - goto: comparison_summary

  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  # Summary: When to use each mode
  # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  comparison_summary:
    description: "Summary of input modes"
    
    request: |
      GET /get HTTP/1.1
      Host: {{ target.host }}
    
    logger:
      on_state_enter: |
        
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘  ğŸ“Š Input Modes Comparison                                                   â•‘
        â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
        â•‘                                                                              â•‘
        â•‘  SAME MODE                                                                   â•‘
        â•‘  â€¢ All threads: Identical input                                              â•‘
        â•‘  â€¢ Use for: Idempotency bugs, resource exhaustion                            â•‘
        â•‘  â€¢ Example: Redeem same coupon 10x simultaneously                            â•‘
        â•‘                                                                              â•‘
        â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â•‘
        â•‘                                                                              â•‘
        â•‘  DISTRIBUTE MODE                                                             â•‘
        â•‘  â€¢ Each thread: Different input (round-robin)                                â•‘
        â•‘  â€¢ Use for: Credential stuffing, multi-target                                â•‘
        â•‘  â€¢ Example: Thread 0â†’email1, Thread 1â†’email2                                 â•‘
        â•‘                                                                              â•‘
        â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â•‘
        â•‘                                                                              â•‘
        â•‘  PRODUCT MODE                                                                â•‘
        â•‘  â€¢ All combinations: Cartesian product                                       â•‘
        â•‘  â€¢ Use for: Brute force, parameter fuzzing                                   â•‘
        â•‘  â€¢ Example: 3 users Ã— 3 passwords = 9 threads                                â•‘
        â•‘                                                                              â•‘
        â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â•‘
        â•‘                                                                              â•‘
        â•‘  RANDOM MODE                                                                 â•‘
        â•‘  â€¢ Random selection: Simulate real users                                     â•‘
        â•‘  â€¢ Use for: Load testing, realistic concurrency                              â•‘
        â•‘  â€¢ Example: 5 threads, each picks random user+action                         â•‘
        â•‘                                                                              â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        ğŸ¯ Quick Decision Guide:
        
        Q: Same payload, multiple times?
        â†’ Use SAME mode
        
        Q: Different payload per thread?
        â†’ Use DISTRIBUTE mode
        
        Q: Test all combinations?
        â†’ Use PRODUCT mode
        
        Q: Simulate real users?
        â†’ Use RANDOM mode
        
        ğŸ’¡ Pro Tip: For modern attacks, consider THREAD GROUPS instead!
           Thread groups provide cleaner syntax and better organization.
        
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘  âœ… Input Modes Demo Complete!                                               â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•