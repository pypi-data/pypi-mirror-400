const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/tJ-1PvYF.js","../chunks/BNO5OzLn.js","../chunks/BJMC0GYJ.js","../assets/vendor.S5W4ZllZ.css","../chunks/z1BK9_Ow.js","../assets/tables.D_GW5H37.css"])))=>i.map(i=>d[i]);
import{p as _e,F as ve,o as Oe,v as we,l as se,g as e,m as w,H as pe,b as De,i as he,f as g,w as Y,t as f,c as ye,k as y,n as c,e as r,r as d,U as le,z as Le,Z as Ce,G as de,I as K,X as oe,J as X,N as ee,C as Ve,h as We,M as ie,a9 as fe,O as ne,Q as Me}from"../chunks/tJ-1PvYF.js";import{_ as B}from"../chunks/PPVm8Dsz.js";import{B as ze}from"../chunks/DZ5Aek4G.js";import"../chunks/z1BK9_Ow.js";import{P as qe}from"../chunks/Ba3EtZVA.js";import{w as He}from"../chunks/DAWgyOON.js";const Ze=()=>({title:"Reservoir Summary",subtitle:"Reservoir summary and exports for the selected well"}),dt=Object.freeze(Object.defineProperty({__proto__:null,load:Ze},Symbol.toStringTag,{value:"Module"}));var Be=g('<div class="text-sm text-blue-600"> </div>'),Ue=g('<div class="text-sm text-red-500 mb-2"> </div>'),Fe=g('<th class="px-2 py-1 text-xs font-medium"><div class="whitespace-nowrap font-medium"> </div> <div class="mt-1"><input class="dt-filter-input input w-full" type="text"/></div></th>'),Ge=g('<td class="px-2 py-1 text-sm"> </td>'),Qe=g('<tr class="border-t odd:bg-white even:bg-surface"></tr>'),Je=g('<table class="min-w-full table-auto border-collapse"><thead><tr class="bg-muted text-left"></tr></thead><tbody></tbody></table>'),Ye=g('<div class="text-sm text-muted-foreground">No results. Click "Generate Report" to compute reservoir summary for the selected well.</div>'),Ke=g('<div class="bg-panel rounded p-3"><!> <div class="grid grid-cols-2 gap-3 mb-3"><div><label class="text-sm" for="minPhitInput">Min PHIT (cutoff)</label> <input id="minPhitInput" type="number" class="input w-full" placeholder="min phit"/></div> <div><label class="text-sm" for="maxSwtInput">Max SWT (cutoff)</label> <input id="maxSwtInput" type="number" class="input w-full" placeholder="max swt"/></div> <div><label class="text-sm" for="maxVclayInput">Max VCLAY (cutoff)</label> <input id="maxVclayInput" type="number" class="input w-full" placeholder="max vclay"/></div> <div class="flex items-end gap-2"><!></div></div> <div class="overflow-x-auto"><!></div></div>'),Xe=g('<div class="text-sm text-muted-foreground">Select a well to view reservoir summary.</div>'),et=g('<div class="ws-reservoir-summary"><div class="mb-2"><div class="font-semibold">Reservoir Summary</div> <div class="text-sm text-muted-foreground">High-level reservoir summary and exportable reports.</div></div> <!></div>');function tt(te,M){_e(M,!1);const u=w();let b=ve(M,"projectId",8),x=ve(M,"wellName",8);const P="http://localhost:6312";let E=w(!1),p=w(null),$=[],O=w([]),D=w(.01),U=w(.99),F=w(.4),N=w(null),j=null,_=w(null),G=null,L=0,ge=120,k=w(null);const be=1e3;function ue(){if(e(N))try{if(j){try{j.destroy()}catch{}for(;e(N).tBodies.length;)e(N).removeChild(e(N).tBodies[0])}const l=(e(u).length?Object.keys(e(u)[0]):[]).map(t=>({title:t,data:t}));j=e(_)(e(N)).DataTable({data:e(u),columns:l,destroy:!0,paging:!0,searching:!0,dom:"Blfrtip",buttons:[{extend:"csv",text:"Export CSV"},{extend:"colvis",text:"Columns"}],lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],pageLength:10,info:!0,autoWidth:!1,stripeClasses:["odd","even"],rowCallback(t,o,s){return s%2===0?e(_)(t).addClass("even-row"):e(_)(t).addClass("odd-row"),e(_)(t).addClass("hoverable-row"),t}});try{e(_)(e(N)).find("thead").off("input.dt-filter"),e(_)(e(N)).find("thead .dt-filter-input").each(function(t,o){const s=e(_)(o);s.off("keyup.dt-filter change.dt-filter"),s.on("keyup.dt-filter change.dt-filter",function(){const i=this.value||"";j.column(t).search(i).draw()})})}catch{}}catch(a){console.warn("DataTables init error",a)}}Oe(async()=>{r(_,(await B(async()=>{const{default:a}=await import("../chunks/tJ-1PvYF.js").then(l=>l.j);return{default:a}},__vite__mapDeps([0,1,2,3]),import.meta.url)).default),await B(()=>import("../chunks/z1BK9_Ow.js").then(a=>a.d),__vite__mapDeps([4,0,1,2,3,5]),import.meta.url),await B(()=>import("../chunks/z1BK9_Ow.js").then(a=>a.b),__vite__mapDeps([4,0,1,2,3,5]),import.meta.url),await B(()=>import("../chunks/z1BK9_Ow.js").then(a=>a.a),__vite__mapDeps([4,0,1,2,3,5]),import.meta.url),await B(()=>import("../chunks/z1BK9_Ow.js").then(a=>a.c),__vite__mapDeps([4,0,1,2,3,5]),import.meta.url),window.jQuery=e(_),window.$=e(_),ue()}),we(()=>{try{j&&j.destroy(),z()}catch{}j=null});async function xe(){if(!(!b()||!x())){r(E,!0),r(p,null),r(k,null);try{r(k,"Initiating well data loading...");const a=await Ne(),{task_id:l,result:t}=a;let o;t?o=t:(r(k,"Waiting for well data..."),o=await ke(l));const s=o&&o.data?o.data:o;if(!Array.isArray(s))throw new Error("Unexpected data format from backend");$=s}catch(a){console.warn("Failed to load well data",a),r(p,String(a?.message??a))}finally{r(E,!1),r(k,null)}}}async function Ne(){const a=await fetch(`${P}/quick_pp/database/projects/${b()}/wells/${encodeURIComponent(String(x()))}/merged/generate`,{method:"POST"});if(!a.ok)throw new Error(await a.text());const l=await a.json();if(!l.task_id)throw new Error("No task_id returned from server");return{task_id:l.task_id,result:l.result}}function z(){G&&(clearInterval(G),G=null),r(k,null)}async function ke(a){const l=`${P}/quick_pp/database/projects/${b()}/wells/${encodeURIComponent(String(x()))}/merged/result/${a}`;return new Promise((t,o)=>{L=0;const s=async()=>{if(L>=ge){const i="Well data loading timed out after 2 minutes";console.error(i),z(),o(new Error(i));return}try{const i=await fetch(l);if(!i.ok)throw new Error(`Poll failed with status ${i.status}`);const m=await i.json();m.status==="success"?(z(),t(m.result)):m.status==="error"?(z(),o(new Error(m.error||"Task failed with unknown error"))):m.status==="pending"?(r(k,`Loading well data... (${L}s)`),L++):(z(),o(new Error(`Unknown task status: ${m.status}`)))}catch(i){console.error("Poll request failed:",i),r(k,`Retrying... (attempt ${L})`),L++}};s(),G=window.setInterval(s,be)})}function Se(){const a=Array.isArray($)?$:[],l=[];for(const t of a){const o=Number(t.depth??t.tvdss??t.TVD??t.TVDSS??t.DEPTH??NaN),s=Number(t.vclay??t.VCLAY??NaN),i=Number(t.phit??t.PHIT??NaN),m=Number(t.swt??t.SWT??NaN),q=Number(t.perm??t.PERM??t.permeability??NaN);let h=t.zones??t.ZONES??t.zone??t.ZONE??null;h==null||String(h).trim()===""?$.some(R=>{const H=R.zones??R.ZONES??R.zone??R.ZONE;return H!=null&&String(H).trim()!==""})?h="UNKNOWN":h="ALL":h=String(h),!(isNaN(o)||isNaN(s)||isNaN(i)||isNaN(m)||isNaN(q))&&l.push({depth:o,vclay:s,phit:i,swt:m,perm:q,zones:h})}return l}async function Pe(){if(r(p,null),!b()||!x()){r(p,"Select a project and well before generating a report");return}const a=Se(),l=$.length,t=a.length,o=l-t;if(!a.length){r(p,"No valid well rows available to compute reservoir summary (missing required numeric fields)");return}r(E,!0);try{const s={data:a,cut_offs:{}};e(D)!=null&&(s.cut_offs.PHIT=Number(e(D))),e(U)!=null&&(s.cut_offs.SWT=Number(e(U))),e(F)!=null&&(s.cut_offs.VSHALE=Number(e(F)));const i=await fetch(`${P}/quick_pp/ressum`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!i.ok)throw new Error(await i.text());const m=await i.json();r(O,Array.isArray(m)?m:[]),o>0&&(console.warn(`Skipped ${o} / ${l} rows because they lacked required numeric values (depth, vclay, phit, swt, perm).`),r(p,`Report generated. Note: skipped ${o} row(s) with missing numeric values.`))}catch(s){console.warn("Ressum error",s),r(p,String(s?.message??s)),r(O,[])}finally{r(E,!1)}}se(()=>e(O),()=>{r(u,e(O)??[])}),se(()=>(e(u),e(_)),()=>{e(u)&&e(_)&&setTimeout(()=>ue(),0)}),se(()=>(pe(b()),pe(x())),()=>{b()&&x()&&xe()}),De(),he();var ae=et(),Ee=y(c(ae),2);{var Re=a=>{var l=Ke(),t=c(l);{var o=n=>{var v=Be(),I=c(v,!0);d(v),X(()=>ee(I,e(k)?e(k):"Loading well logâ€¦")),f(n,v)},s=n=>{var v=Ve(),I=We(v);{var C=V=>{var S=Ue(),T=c(S);d(S),X(()=>ee(T,`Error: ${e(p)??""}`)),f(V,S)};Y(I,V=>{e(p)&&V(C)},!0)}f(n,v)};Y(t,n=>{e(E)?n(o):n(s,!1)})}var i=y(t,2),m=c(i),q=y(c(m),2);le(q),d(m);var h=y(m,2),re=y(c(h),2);le(re),d(h);var R=y(h,2),H=y(c(R),2);le(H),d(R);var ce=y(R,2),Te=c(ce);{let n=de(()=>e(E)?"opacity:0.6; pointer-events:none;":"");ze(Te,{class:"btn btn-primary",onclick:Pe,get disabled(){return e(E)},get style(){return e(n)},children:(v,I)=>{Le();var C=Ce("Generate Report");f(v,C)},$$slots:{default:!0}})}d(ce),d(i);var me=y(i,2),$e=c(me);{var je=n=>{var v=Je(),I=c(v),C=c(I);ie(C,5,()=>(e(u),K(()=>Object.keys(e(u)[0]))),ne,(S,T)=>{var A=Fe(),Z=c(A),Q=c(Z,!0);d(Z);var W=y(Z,2),J=c(W);d(W),d(A),X(()=>{ee(Q,e(T)),fe(J,"placeholder",`Filter ${e(T)??""}`),fe(J,"data-col",e(T))}),f(S,A)}),d(C),d(I);var V=y(I);ie(V,5,()=>e(u),ne,(S,T)=>{var A=Qe();ie(A,5,()=>(e(u),K(()=>Object.keys(e(u)[0]))),ne,(Z,Q)=>{var W=Ge(),J=c(W,!0);d(W),X(()=>ee(J,(e(T),e(Q),K(()=>e(T)[e(Q)])))),f(Z,W)}),d(A),f(S,A)}),d(V),d(v),Me(v,S=>r(N,S),()=>e(N)),f(n,v)},Ae=n=>{var v=Ye();f(n,v)};Y($e,n=>{e(u),K(()=>e(u)&&e(u).length)?n(je):n(Ae,!1)})}d(me),d(l),oe(q,()=>e(D),n=>r(D,n)),oe(re,()=>e(U),n=>r(U,n)),oe(H,()=>e(F),n=>r(F,n)),f(a,l)},Ie=a=>{var l=Xe();f(a,l)};Y(Ee,a=>{x()?a(Re):a(Ie,!1)})}d(ae),f(te,ae),ye()}var at=g('<div slot="left"><!></div>');function ut(te,M){_e(M,!1);let u=w(null),b=w(null);const x=He.subscribe(P=>{r(u,P?.project??null),r(b,P?.selectedWell??null)});we(()=>x()),he(),qe(te,{get selectedWell(){return e(b)},get project(){return e(u)},$$slots:{left:(P,E)=>{var p=at(),$=c(p);{let O=de(()=>e(u)?.project_id??""),D=de(()=>e(b)?.name??"");tt($,{get projectId(){return e(O)},get wellName(){return e(D)}})}d(p),f(P,p)}}}),ye()}export{ut as component,dt as universal};
