# FiberPath API Reference

The FastAPI service in `fiberpath_api/` exposes thin wrappers around the core planning,
simulation, validation, and streaming engines. All endpoints accept and return JSON and are
designed for headless automation (GUI/HMI integrations, CI pipelines, etc.).

## Planning

```text
POST /plan/from-file
```

Request body:

```json
{ "path": "/absolute/path/to/input.wind" }
```

Response body (fields abbreviated):

```json
{
  "commands": 1234,
  "output": "/absolute/path/to/input.gcode",
  "timeSeconds": 42.5,
  "towMeters": 8.1,
  "layers": [
    {
      "index": 1,
      "wind_type": "helical",
      "commands": 456,
      "time_s": 12.3,
      "tow_m": 1.9
    }
  ]
}
```

## Simulation

```text
POST /simulate/from-file
```

Request:

```json
{ "path": "/absolute/path/to/output.gcode" }
```

Response:

```json
{
  "commands": 789,
  "moves": 300,
  "estimated_time_s": 95.2,
  "total_distance_mm": 1234.5,
  "tow_length_mm": 1234.5,
  "average_feed_rate_mmpm": 7200.0
}
```

## Validation

```text
POST /validate/from-file
```

Request:

```json
{ "path": "/absolute/path/to/input.wind" }
```

Response:

```json
{ "status": "ok", "path": "/absolute/path/to/input.wind" }
```

## Streaming

```text
POST /stream/
```

Request:

```json
{
  "gcode": "; Parameters ...\nG0 X0 Y0\n",
  "port": "COM5",
  "baud_rate": 250000,
  "dry_run": true
}
```

Response:

```json
{
  "commands_streamed": 100,
  "total_commands": 100,
  "dry_run": true
}
```

All endpoints return non-2xx responses (400/404/502) with a `{"detail": "..."}` payload when
validation fails or the underlying engine reports an error. Use FastAPI's autogenerated docs at
`/docs` for interactive exploration.
