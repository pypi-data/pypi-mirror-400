var S=Object.defineProperty;var g=(e,s,n)=>s in e?S(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n;var c=(e,s,n)=>(g(e,typeof s!="symbol"?s+"":s,n),n);import{r as o,aR as b,l as j,j as a,F as l,R as P,C as w,S as v,dL as R,c as d,n as m,h as N,B as f,p as F,E as D,v as T,w as _,dM as $,U as C,aw as z,q as E}from"./index-4cf586ed.js";let O=class extends o.Component{constructor(n){super(n);c(this,"selectRef");c(this,"scans");c(this,"changeSchema",()=>{var t,i;const n=(i=(t=this.selectRef)==null?void 0:t.current)==null?void 0:i.value;this.props.actions.setSchema(""),n&&setTimeout(()=>this.props.actions.setSchema(n),50)});c(this,"onSubmit",(n,t,i)=>i({...n,overwrite:this.props.overwrite}).then(()=>{this.props.onSubmit&&this.props.onSubmit()}));c(this,"onAsyncValidate",n=>{this.setState({asyncAdditional:n.additionalAsync})});console.log("parameteriser",this.props);const t=this.props.ptype??"";this.scans=this.props.config&&t in this.props.config.parametertypes?this.props.config.parametertypes[t]:[],this.state={asyncAdditional:{},type:this.props.ptype},this.selectRef=b.createRef()}componentDidMount(){this.props.ptype!==this.state.type&&this.props.actions.setSchemaType(this.state.type),this.props.initialSchema&&this.selectRef.current&&(this.selectRef.current.value=this.props.initialSchema),this.changeSchema()}render(){const n=j.map(this.scans,r=>a.jsx("option",{value:r.actor,children:r.actor},r.actor)),{schema:t=""}=this.props,i={};return this.props.overwrite&&(i.name={"ui:readonly":!0}),a.jsxs(a.Fragment,{children:[a.jsx(l,{children:a.jsxs(l.Group,{as:P,children:[a.jsx(l.Label,{column:!0,sm:3,children:"Type"}),a.jsx(w,{children:a.jsx(l.Control,{ref:this.selectRef,as:"select",value:this.props.schema,onChange:this.changeSchema,disabled:this.props.overwrite,children:n})})]})}),a.jsx("hr",{}),this.props.schema===""?null:a.jsx(a.Fragment,{children:a.jsx(v,{schema:`${R(t)}Schema`,formData:{...this.props.formData},onSubmit:this.onSubmit,onAsyncValidate:this.onAsyncValidate,submitText:"Save",button:this.props.button,uiSchema:i})})]})}};const k=e=>({config:m.selector("config",e,"parameteriser"),schema:m.selector("form",e).newParametersSchema||"",type:m.selector("form",e).newParametersSchemaType||""}),A=()=>({actions:{setSchema:e=>m.dispatch("SET_FORM",{key:"newParametersSchema",value:e}),setSchemaType:e=>m.dispatch("SET_FORM",{key:"newParametersSchemaType",value:e})}}),B=d(k,A)(O);function p(e){const s=o.useRef(()=>{}),n=o.useRef(!1),t=o.useRef(),i=o.useCallback(()=>{var r;(r=t.current)==null||r.close(),e.onSubmit&&e.onSubmit()},[t,e.onSubmit]);return a.jsx(N,{ref:t,id:`newParameters${e.ptype}${e.prefix??""}`,button:e.button||a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fa fa-plus me-1"}),"New"]}),buttonProps:{disabled:e.disabled,className:e.inset?"":"float-end mb-1",...e.buttonProps},buttons:a.jsx(a.Fragment,{children:a.jsx(f,{onClick:()=>s.current(),disabled:n.current,children:"Save"})}),title:`${e.title||"New"} ${e.ptype}`,children:a.jsx(B,{onSubmit:i,config:e.config,formData:{...e.formData},ptype:e.ptype,initialSchema:e.schema,overwrite:e.overwrite,button:(r,h)=>{n.current=r,s.current=h}})})}function M(e,s,n,t){return a.jsxs(a.Fragment,{children:[a.jsx(p,{ptype:t.ptype,onSubmit:t.onSubmit,formData:{...s.parameters,name:`${s.parameters.name}1`},schema:s.instance_type,button:a.jsx("i",{className:"fa fa-copy"}),buttonProps:{size:"sm",className:"me-1"},inset:!0,title:"Copy",prefix:`copy${s.file_name}`}),a.jsx(p,{ptype:t.ptype,onSubmit:t.onSubmit,formData:{...s.parameters},overwrite:!0,schema:s.instance_type,button:a.jsx("i",{className:"fa fa-search"}),buttonProps:{size:"sm",variant:"info"},inset:!0,title:"Edit",prefix:s.file_name})]})}function I(e,s,n,t){const{name:i,actor:r,component:h,sessionid:G,...y}=s.parameters;return a.jsx("ul",{children:Object.entries(y).map(([u,x])=>a.jsxs("li",{children:[u,": ",x]},u))})}function L(e){const[s,n]=o.useState(!1);o.useEffect(()=>{e.actions.setParams({type:e.type},!0)},[]);const t=()=>{e.actions.fetch()},i=[{dataField:"name",text:"Name"},{dataField:"instance_type",text:"Instance"},{dataField:"file_name",text:"File"},...e.showDetail||s?[{dataField:"",text:"Parameters",formatter:I,formatExtraData:{onSubmit:t,ptype:e.type}}]:[],{dataField:"action",text:"",formatter:M,formatExtraData:{onSubmit:t,ptype:e.type},classes:"text-end text-nowrap"}];return a.jsx(F,{children:a.jsx(D,{children:a.jsxs("div",{className:"object",children:[a.jsxs("h5",{children:[e.type,a.jsx(p,{ptype:e.type,onSubmit:t}),!e.showDetail&&a.jsx(f,{variant:"secondary",className:"float-end me-1",onClick:()=>n(!s),children:a.jsx("i",{className:`fa ${s?"fa-minus":"fa-plus"}`})})]}),a.jsx(T,{keyField:"file_name",data:e.parameters,columns:i,noDataIndication:"No parameters defined",pages:{page:e.page,per_page:e.per_page,total:e.total,setPage:e.actions.setPage,setPageSize:e.actions.setPageSize,setParams:e.actions.setParams,fetch:e.actions.fetch},loading:e.fetching,overlay:!0})]})})})}function V(e,s){const{providers:n}=s,{parameters:t}=n.parameteriser;return{parameters:t.selector("ordered",e),namespace:t.getNamespace(),per_page:t.selector("per_page",e),page:t.selector("page",e),total:t.selector("total",e),fetching:t.selector("fetching",e)}}function U(e,s){const{providers:n}=s,{parameters:t}=n.parameteriser;return{actions:{fetch:()=>t.fetch(),setParams:i=>t.setParams(i,!0),setPage:i=>t.setPage(i),setPageSize:i=>t.setPageSize(i)}}}const q=_({parameteriser:$})(d(V,U)(L));function J(e){const{providers:s,yamlNode:n,paramtype:t,showDetail:i,...r}=e;return C(n,"paramtype",t),z(n,"showDetail",i),E(n,r),a.jsx(q,{providers:s,type:t,showDetail:i})}export{J as default};
