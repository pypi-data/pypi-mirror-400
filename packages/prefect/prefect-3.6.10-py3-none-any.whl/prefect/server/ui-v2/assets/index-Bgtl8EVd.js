import{r as h,t as A,j as e,L as D,l as T,m as B,h as E}from"./vendor-tanstack-BVzzyDEt.js";import{u as I,a as k}from"./use-quick-run-mT_ozfi2.js";import{bL as M,aK as O,aO as z,r as _,s as P,q as Q,I as $,t as V,u as G,v as d,w as L,O as W,P as H,as as U,S as Z,d as q,e as K,f as J,h as j,c2 as X,aQ as Y,c3 as F,c4 as ee}from"./index-BJkJ93Lr.js";import{D as se}from"./delete-confirmation-dialog-Baib9xiM.js";import{S as ae}from"./index-DcdvPWsR.js";import{S as le}from"./index-HTfhyme4.js";import{s as ne,U as te}from"./vendor-date-2jFo9aCm.js";const ie=({row:t,onDelete:s})=>{const{id:l,parameters:o}=t.original,{onQuickRun:m,isPending:i}=I();return l?e.jsx("div",{className:"flex flex-row justify-end",children:e.jsxs(_,{children:[e.jsx(P,{asChild:!0,children:e.jsxs(Q,{variant:"outline",className:"size-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx($,{id:"MoreVertical",className:"size-4"})]})}),e.jsxs(V,{align:"end",children:[e.jsx(G,{children:"Actions"}),e.jsx(d,{disabled:i,onClick:()=>m(l),children:"Quick Run"}),e.jsx(d,{children:e.jsx(D,{to:"/deployments/deployment/$id/run",params:{id:l},search:{parameters:o},children:"Custom Run"})}),e.jsx(d,{onClick:()=>{navigator.clipboard.writeText(l),L.success("ID copied")},children:"Copy ID"}),e.jsx(d,{children:e.jsx(D,{to:"/deployments/deployment/$id/edit",params:{id:l},children:"Edit"})}),e.jsx(d,{onClick:()=>s(t.original),children:"Delete"}),e.jsx(d,{children:e.jsx(D,{to:"/deployments/deployment/$id/duplicate",params:{id:l},children:"Duplicate"})})]})]})}):null},C=8,re=4,oe=({row:t})=>{const[s,l]=h.useState(0),o=M(s,150),m=h.useCallback(r=>{if(!r)return;const x=()=>{const y=r.getBoundingClientRect().width;l(Math.floor(y/(C+re)))};x();const g=new ResizeObserver(x);return g.observe(r),()=>{g.disconnect()}},[]),{data:i}=A(O({deployments:{operator:"and_",id:{any_:[t.original.id]}},sort:"START_TIME_DESC",limit:o||s,offset:0})),{flow:p,...v}=t.original,c=i?.map(r=>({...r,deployment:v,flow:p}))??[];return e.jsx("div",{className:"w-full",ref:m,children:e.jsx(z,{startDate:ne(new Date,te),endDate:new Date,numberOfBars:o||s,barWidth:C,enrichedFlowRuns:c,className:"h-12 w-full",chartId:t.original.id})})},u=E(),ce=({onDelete:t})=>[u.display({id:"name",header:"Deployment",cell:({row:s})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx(D,{to:"/deployments/deployment/$id",params:{id:s.original.id},children:e.jsx("span",{className:"text-sm font-medium truncate",title:s.original.name,children:s.original.name})}),s.original.flow&&e.jsx(F,{flow:s.original.flow,className:"text-xs text-muted-foreground flex items-center gap-1",iconSize:12})]}),size:100}),u.accessor("status",{id:"status",header:"Status",cell:({row:s})=>{const l=s.original.status;return l?e.jsx("div",{className:"min-w-28",children:e.jsx(le,{status:l})}):null},size:50}),u.display({id:"activity",header:"Activity",cell:s=>e.jsx("div",{className:"flex flex-row gap-2 items-center min-w-28",children:e.jsx(oe,{...s})}),size:300}),u.display({id:"tags",header:()=>null,cell:({row:s})=>e.jsx(ee,{tags:s.original.tags??[]})}),u.display({id:"schedules",header:"Schedules",cell:({row:s})=>{const l=s.original.schedules;return!l||l.length===0?null:e.jsx(ae,{schedules:l})},size:150}),u.display({id:"actions",cell:s=>e.jsx(ie,{...s,onDelete:t})})],fe=({deployments:t,currentDeploymentsCount:s,pagination:l,pageCount:o,sort:m,columnFilters:i,onPaginationChange:p,onSortChange:v,onColumnFiltersChange:c})=>{const[r,x]=k(),g=i.find(a=>a.id==="flowOrDeploymentName")?.value??"",y=i.find(a=>a.id==="tags")?.value??[],S=h.useCallback(a=>{const n=i.filter(f=>f.id!=="flowOrDeploymentName");c(a?[...n,{id:"flowOrDeploymentName",value:a}]:n)},[c,i]),w=h.useCallback(a=>{const n=Array.isArray(a)?a:a.target.value,f=i.filter(R=>R.id!=="tags");c(n.length?[...f,{id:"tags",value:n}]:f)},[c,i]),b=h.useCallback(a=>{let n=l;typeof a=="function"?n=a(l):n=a,p(n)},[l,p]),N=T({data:t,columns:ce({onDelete:a=>{const n=a.flow?.name?`${a.flow?.name}/${a.name}`:a.name;x({...a,name:n})}}),getCoreRowModel:B(),pageCount:o,manualPagination:!0,defaultColumn:{maxSize:300},state:{pagination:l},onPaginationChange:b});return e.jsxs("div",{children:[e.jsxs("div",{className:"grid sm:grid-cols-2 md:grid-cols-6 lg:grid-cols-12 gap-2 pb-4 items-center",children:[e.jsx("div",{className:"sm:col-span-2 md:col-span-6 lg:col-span-4 order-last lg:order-first",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s," ",W(s,"Deployment")]})}),e.jsx("div",{className:"sm:col-span-2 md:col-span-2 lg:col-span-3",children:e.jsx(H,{placeholder:"Search deployments",value:g,onChange:a=>S(a.target.value)})}),e.jsx("div",{className:"xs:col-span-1 md:col-span-2 lg:col-span-3",children:e.jsx(U,{placeholder:"Filter by tags",onChange:w,value:y})}),e.jsx("div",{className:"xs:col-span-1 md:col-span-2 lg:col-span-2",children:e.jsxs(Z,{value:m,onValueChange:v,children:[e.jsx(q,{"aria-label":"Deployment sort order",className:"w-full",children:e.jsx(K,{placeholder:"Sort by"})}),e.jsxs(J,{children:[e.jsx(j,{value:"CREATED_DESC",children:"Created"}),e.jsx(j,{value:"UPDATED_DESC",children:"Updated"}),e.jsx(j,{value:"NAME_ASC",children:"A to Z"}),e.jsx(j,{value:"NAME_DESC",children:"Z to A"})]})]})})]}),e.jsx(se,{...r}),e.jsx(X,{children:e.jsx(Y,{table:N})})]})};export{fe as D};
//# sourceMappingURL=index-Bgtl8EVd.js.map
