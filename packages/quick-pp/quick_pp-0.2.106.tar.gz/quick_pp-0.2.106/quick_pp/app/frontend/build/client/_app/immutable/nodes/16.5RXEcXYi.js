import{p as Ie,F as je,e as i,v as qe,l as Y,g as e,m as v,H as M,b as ft,i as Le,f as E,k as g,w as O,t as _,c as Ve,n as f,r as p,J as U,K as ht,M as gt,N as te,I as h,O as _t,z as bt,Z as Pe,G as D,C as Ae,h as Ne,U as ae,Y as wt,P as xt,R as yt,X as ue,Q as Pt}from"../chunks/tJ-1PvYF.js";import{_ as Nt}from"../chunks/PPVm8Dsz.js";import{B as Fe}from"../chunks/DZ5Aek4G.js";import{w as ze,h as Mt,f as Ct}from"../chunks/DAWgyOON.js";import{D as Et}from"../chunks/BRt1D930.js";import{P as kt}from"../chunks/Ba3EtZVA.js";const Rt=()=>({title:"Permeability",subtitle:"Permeability estimations for the selected well"}),Qt=Object.freeze(Object.defineProperty({__proto__:null,load:Rt},Symbol.toStringTag,{value:"Module"}));var Dt=E('<div class="text-sm text-blue-600"> </div>'),$t=E('<div class="text-sm text-red-500 mb-2"> </div>'),St=E("<option> </option>"),Tt=E('<div><label class="text-xs" for="swirr-input">Swirr (irreducible water saturation)</label> <input id="swirr-input" class="input w-full" type="number" step="0.01" min="0" max="1"/></div>'),jt=E('<div class="grid grid-cols-4 gap-2 w-full min-w-0"><div class="flex flex-col col-span-4" style="min-width: 120px; max-width: 180px;"><label class="text-xs" for="choo-A">Choo A</label> <input id="choo-A" class="input font-mono text-right" style="width:100%; min-width:120px; max-width:180px;" type="number" step="any"/></div></div> <div class="grid grid-cols-2 gap-2 w-full min-w-0 mt-2"><div class="min-w-0 flex flex-col"><label class="text-xs" for="choo-B">Choo B</label> <input id="choo-B" class="input w-full min-w-0 max-w-full" style="min-width:0;" type="number" step="any"/></div> <div class="min-w-0 flex flex-col"><label class="text-xs" for="choo-C">Choo C</label> <input id="choo-C" class="input w-full min-w-0 max-w-full" style="min-width:0;" type="number" step="any"/></div></div>',1),At=E('<div class="w-full h-[260px]"></div>'),Ft=E('<div class="flex items-center justify-center h-full text-sm text-gray-500">No permeability data to display. Compute permeability to see the plot.</div>'),It=E("<div><strong>Calculated Perm:</strong> </div>"),qt=E("<div><strong>Calculated Perm:</strong> No data</div>"),Lt=E('<div><strong>Core Perm (CPERM):</strong> <span class="inline-block w-2 h-2 bg-red-600 rounded-full"></span> </div>'),Vt=E('<div class="text-gray-500">No core permeability data (CPERM) found</div>'),zt=E('<div class="bg-panel rounded p-3"><!> <div class="grid grid-cols-3 gap-2 mb-3"><div class="col-span-1 min-w-0"><label class="text-xs" for="perm-method">Permeability method</label> <select id="perm-method" class="input w-full"></select></div> <div class="col-span-2 min-w-0"><!></div></div> <div class="space-y-3"><div><div class="font-medium text-sm mb-1">Permeability</div> <div class="bg-surface rounded p-2"><!> <!> <div class="flex items-center ml-2"><input type="checkbox" id="depth-matching" class="mr-2"/> <label for="depth-matching">Depth Matching</label></div> <div class="h-[260px] w-full overflow-hidden"><!></div></div></div> <div class="text-xs text-muted-foreground space-y-1"><!> <!></div></div></div>'),Wt=E('<div class="text-sm">Select a well to view permeability tools.</div>'),Bt=E('<div class="ws-permeability"><div class="mb-2"><div class="font-semibold">Permeability</div> <div class="text-sm text-muted-foreground">Permeability estimation tools.</div></div> <!> <!></div>');function Ot(me,J){Ie(J,!1);const T=v(),j=v();let $=je(J,"projectId",8),y=je(J,"wellName",8);const G="http://localhost:6312";let L=v({enabled:!1,minDepth:null,maxDepth:null}),Z=v({enabled:!1,zones:[]}),W=v([]),k=v(!1),A=v(null),re=v(!1),le=new Map,ie=v(null),se=null,H=0,We=120,V=v(null);const Be=1e3;let Q=v(!1),ve=null,I=v("choo"),oe=v(.05),pe=v(165e5),fe=v(6),he=v(1.78),K=v(!1),ne=v([]),ce=v([]),C=v([]),S=v([]),ge=null,B=v(null);const _e=[{value:"choo",label:"Choo",requires:["vclay","vsilt","phit"],params:["m","A","B","C"]},{value:"timur",label:"Timur",requires:["phit","swirr"]},{value:"tixier",label:"Tixier",requires:["phit","swirr"]},{value:"coates",label:"Coates",requires:["phit","swirr"]},{value:"kozeny_carman",label:"Kozeny-Carman",requires:["phit","swirr"]}];async function Oe(){if(!$()||!y())return;const t=`${$()}_${y()}`;if(le.has(t)){i(ne,le.get(t)),i(re,!0);return}i(k,!0),i(A,null),i(V,null);try{i(V,"Initiating well data loading...");const l=await Ue(),{task_id:c,result:r}=l;let n;if(r?n=r:(i(V,"Waiting for well data..."),n=await He(c)),!Array.isArray(n))throw new Error("Unexpected data format from backend");i(ne,n),le.set(t,n),i(re,!0)}catch(l){console.warn("Failed to load well data",l),i(A,String(l?.message??l))}finally{i(k,!1),i(V,null)}}async function Ue(){const t=await fetch(`${G}/quick_pp/database/projects/${$()}/wells/${encodeURIComponent(String(y()))}/merged/generate`,{method:"POST"});if(!t.ok)throw new Error(await t.text());const l=await t.json();if(!l.task_id)throw new Error("No task_id returned from server");return{task_id:l.task_id,result:l.result}}function X(){se&&(clearInterval(se),se=null),i(V,null)}async function He(t){const l=`${G}/quick_pp/database/projects/${$()}/wells/${encodeURIComponent(String(y()))}/merged/result/${t}`;return new Promise((c,r)=>{H=0;const n=async()=>{if(H>=We){const m="Well data loading timed out after 2 minutes";console.error(m),X(),r(new Error(m));return}try{const m=await fetch(l);if(!m.ok)throw new Error(`Poll failed with status ${m.status}`);const d=await m.json();d.status==="success"?(X(),c(d.result)):d.status==="error"?(X(),r(new Error(d.error||"Task failed with unknown error"))):d.status==="pending"?(i(V,`Loading well data... (${H}s)`),H++):(X(),r(new Error(`Unknown task status: ${d.status}`)))}catch(m){console.error("Poll request failed:",m),i(V,`Retrying... (attempt ${H})`),H++}};n(),se=window.setInterval(n,Be)})}function Ke(){const t=_e.find(r=>r.value===e(I));if(!t)return[];const l=e(W),c=[];for(const r of l){const n={};let m=!0;for(const d of t.requires){let o;if(d==="swirr"?o=e(oe):d==="vclay"?o=Number(r.vclay??r.VCLAY??r.Vclay??NaN):d==="vsilt"?o=Number(r.vsilt??r.VSILT??r.Vsilt??NaN):d==="phit"?o=Number(r.phit??r.PHIT??r.Phit??NaN):o=Number(r[d]??r[d.toUpperCase()]??NaN),isNaN(o)){m=!1;break}n[d]=o}m&&c.push(n)}return c}function Ye(){const t=e(W),l=[];for(const c of t){const r=Number(c.depth??c.DEPTH??NaN),n=Number(c.cperm??c.CPERM??c.Cperm??c.KPERM??c.kperm??NaN);!isNaN(r)&&!isNaN(n)&&n>0&&l.push({depth:r,CPERM:n})}return l.sort((c,r)=>c.depth-r.depth)}async function Je(){const t=Ke();if(!t.length){i(A,`No valid data available for ${e(I)} permeability calculation`);return}i(k,!0),i(A,null);try{let l={data:t};e(I)==="choo"&&(l={...l,A:e(pe),B:e(fe),C:e(he)});const c=await fetch(`${G}/quick_pp/permeability/${e(I)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!c.ok)throw new Error(await c.text());i(ce,await c.json()),Me()}catch(l){console.warn(`${e(I)} permeability error`,l),i(A,String(l?.message??l))}finally{i(k,!1)}}async function Ge(){if(!$()||!y()){i(A,"Project and well must be selected before saving");return}if(!e(C)||e(C).length===0){i(A,"No permeability results to save");return}i(Q,!0),ve=null,i(A,null);try{const t=e(C).map(m=>({DEPTH:m.depth,PERM:Number(m.PERM)}));if(!t.length)throw new Error("No rows prepared for save");const l={data:t},c=`${G}/quick_pp/database/projects/${$()}/wells/${encodeURIComponent(String(y()))}/data`,r=await fetch(c,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!r.ok)throw new Error(await r.text());const n=await r.json().catch(()=>null);ve=n&&n.message?String(n.message):"Permeability saved";try{window.dispatchEvent(new CustomEvent("qpp:data-updated",{detail:{projectId:$(),wellName:y(),kind:"permeability"}}))}catch{}}catch(t){console.warn("Save permeability error",t),ve=null,i(A,String(t?.message??t))}finally{i(Q,!1)}}function Ze(){const t=[];if(e(C).forEach(z=>{z.PERM&&z.PERM>0&&t.push(z.PERM)}),e(S).forEach(z=>{z.CPERM&&z.CPERM>0&&t.push(z.CPERM)}),t.length===0)return[.001,1e3];const l=Math.min(...t),c=Math.max(...t),r=Math.log10(l),n=Math.log10(c),m=n-r,d=Math.max(.1,m*.1),o=Math.pow(10,r-d),R=Math.pow(10,n+d);return[o,R]}async function Qe(){if(!ge){const t=await Nt(()=>import("../chunks/BJMC0GYJ.js").then(l=>l.p),[],import.meta.url);ge=t?.default??t}return ge}function Me(){const t=e(W),l=[];let c=0;for(const r of t){const n=Number(r.depth??r.DEPTH??NaN);if(isNaN(n))continue;const m=_e.find(o=>o.value===e(I));if(!m)continue;let d=!0;for(const o of m.requires){let R;if(o==="swirr"?R=e(oe):o==="vclay"?R=Number(r.vclay??r.VCLAY??r.Vclay??NaN):o==="vsilt"?R=Number(r.vsilt??r.VSILT??r.Vsilt??NaN):o==="phit"?R=Number(r.phit??r.PHIT??r.Phit??NaN):R=Number(r[o]??r[o.toUpperCase()]??NaN),isNaN(R)){d=!1;break}}if(d){const o=e(ce)[c++]??{PERM:null},R=Math.max(Number(o.PERM??.001),.001);l.push({depth:n,PERM:R})}}l.sort((r,n)=>r.depth-n.depth),i(C,l),i(S,Ye())}async function Xe(){if(!e(B))return;const t=await Qe();if((!e(T)||e(T).length===0)&&(!e(j)||e(j).length===0)){try{t.purge(e(B))}catch{}return}const l=[];e(T)&&e(T).length>0&&l.push({x:e(T).map(o=>o.x),y:e(T).map(o=>o.y),name:"PERM (Log)",mode:"lines",line:{color:"#2563eb",width:2},xaxis:"x",yaxis:"y"}),e(j)&&e(j).length>0&&l.push({x:e(j).map(o=>o.x),y:e(j).map(o=>o.y),name:"CPERM (Core)",mode:"markers",marker:{color:"#dc2626",size:8,line:{color:"white",width:1}},xaxis:e(K)?"x2":"x",yaxis:"y"});const[c,r]=Ze(),n=Math.max(c,1e-12),m=Math.max(r,n*10),d={height:260,margin:{l:60,r:20,t:50,b:80},dragmode:"zoom",xaxis:{title:"Log Depth",titlefont:{color:"#2563eb"},tickfont:{color:"#2563eb"},tickformat:",.0f",side:"bottom"},xaxis2:{title:"Core Depth",titlefont:{color:"#dc2626"},tickfont:{color:"#dc2626"},tickformat:",.0f",overlaying:"x",side:"top",fixedrange:e(K)},yaxis:{title:"Permeability (mD)",type:"log",range:[Math.log10(n),Math.log10(m)]},showlegend:!0,legend:{x:0,y:1,bgcolor:"rgba(255,255,255,0.8)",bordercolor:"rgba(0,0,0,0.2)",borderwidth:1}};try{t.react(e(B),l,d,{responsive:!0})}catch{t.newPlot(e(B),l,d,{responsive:!0})}}const et=ze.subscribe(t=>{t?.depthFilter&&i(L,{...t.depthFilter}),t?.zoneFilter&&i(Z,{...t.zoneFilter})});qe(()=>{et(),X()});let be=v("");Y(()=>e(C),()=>{i(T,e(C).map(t=>({x:t.depth,y:t.PERM})))}),Y(()=>e(S),()=>{i(j,e(S).map(t=>({x:t.depth,y:t.CPERM})))}),Y(()=>(e(ne),e(L),e(Z)),()=>{i(W,(()=>{let t=e(ne)||[];return t=Mt(t,e(L)),t=Ct(t,e(Z)),t})())}),Y(()=>(e(ce),e(W)),()=>{e(ce)&&e(W)&&Me()}),Y(()=>(M($()),M(y()),e(be),e(re)),()=>{const t=`${$()}_${y()}`;$()&&y()&&t!==e(be)&&(i(be,t),(!e(re)||!le.has(t))&&Oe())}),Y(()=>(e(B),e(C),e(S),e(L),e(K),e(ie)),()=>{e(B)&&(e(C)||e(S)||e(L)||e(K)!==void 0)&&(e(ie)&&clearTimeout(e(ie)),i(ie,setTimeout(()=>Xe(),150)))}),ft(),Le();var we=Bt(),Ce=g(f(we),2);Et(Ce,{});var tt=g(Ce,2);{var at=t=>{var l=zt(),c=f(l);{var r=s=>{var a=Dt(),u=f(a,!0);p(a),U(()=>te(u,e(V)?e(V):"Loading well logâ€¦")),_(s,a)},n=s=>{var a=Ae(),u=Ne(a);{var w=b=>{var P=$t(),F=f(P);p(P),U(()=>te(F,`Error: ${e(A)??""}`)),_(b,P)};O(u,b=>{e(A)&&b(w)},!0)}_(s,a)};O(c,s=>{e(k)?s(r):s(n,!1)})}var m=g(c,2),d=f(m),o=g(f(d),2);U(()=>{e(I),ht(()=>{})}),gt(o,5,()=>_e,_t,(s,a)=>{var u=St(),w=f(u,!0);p(u);var b={};U(()=>{te(w,(e(a),h(()=>e(a).label))),b!==(b=(e(a),h(()=>e(a).value)))&&(u.value=(u.__value=(e(a),h(()=>e(a).value)))??"")}),_(s,u)}),p(o),p(d);var R=g(d,2),z=f(R);{var lt=s=>{var a=Tt(),u=g(f(a),2);ae(u),p(a),ue(u,()=>e(oe),w=>i(oe,w)),_(s,a)},it=s=>{var a=jt(),u=Ne(a),w=f(u),b=g(f(w),2);ae(b),p(w),p(u);var P=g(u,2),F=f(P),N=g(f(F),2);ae(N),p(F);var x=g(F,2),q=g(f(x),2);ae(q),p(x),p(P),ue(b,()=>e(pe),ee=>i(pe,ee)),ue(N,()=>e(fe),ee=>i(fe,ee)),ue(q,()=>e(he),ee=>i(he,ee)),_(s,a)};O(z,s=>{e(I)!=="choo"?s(lt):s(it,!1)})}p(R),p(m);var Ee=g(m,2),xe=f(Ee),ke=g(f(xe),2),Re=f(ke);{let s=D(()=>e(k)?"opacity:0.5; pointer-events:none;":"");Fe(Re,{class:"btn btn-primary",onclick:Je,get disabled(){return e(k)},get style(){return e(s)},children:(a,u)=>{bt();var w=Pe("Estimate Permeability");_(a,w)},$$slots:{default:!0}})}var De=g(Re,2);{let s=D(()=>e(k)||e(Q)),a=D(()=>e(k)||e(Q)?"opacity:0.5; pointer-events:none;":"");Fe(De,{class:"btn ml-2 bg-emerald-700",onclick:Ge,get disabled(){return e(s)},get style(){return e(a)},children:(u,w)=>{var b=Ae(),P=Ne(b);{var F=x=>{var q=Pe("Saving...");_(x,q)},N=x=>{var q=Pe("Save Permeability");_(x,q)};O(P,x=>{e(Q)?x(F):x(N,!1)})}_(u,b)},$$slots:{default:!0}})}var ye=g(De,2),de=f(ye);ae(de);var st=g(de,2);p(ye);var $e=g(ye,2),ot=f($e);{var nt=s=>{var a=At();Pt(a,u=>i(B,u),()=>e(B)),_(s,a)},ct=s=>{var a=Ft();_(s,a)};O(ot,s=>{e(C),e(S),h(()=>e(C).length>0||e(S).length>0)?s(nt):s(ct,!1)})}p($e),p(ke),p(xe);var Se=g(xe,2),Te=f(Se);{var dt=s=>{const a=D(()=>(e(C),h(()=>e(C).map(N=>N.PERM)))),u=D(()=>(M(e(a)),h(()=>e(a).reduce((N,x)=>N+x,0)/e(a).length))),w=D(()=>(M(e(a)),h(()=>Math.min(...e(a))))),b=D(()=>(M(e(a)),h(()=>Math.max(...e(a)))));var P=It(),F=g(f(P));p(P),U((N,x,q)=>te(F,` Avg: ${N??""} mD | Min: ${x??""} mD | Max: ${q??""} mD | Count: ${M(e(a)),h(()=>e(a).length)??""}`),[()=>(M(e(u)),h(()=>e(u).toFixed(2))),()=>(M(e(w)),h(()=>e(w).toFixed(3))),()=>(M(e(b)),h(()=>e(b).toFixed(1)))]),_(s,P)},ut=s=>{var a=qt();_(s,a)};O(Te,s=>{e(C),h(()=>e(C).length>0)?s(dt):s(ut,!1)})}var mt=g(Te,2);{var vt=s=>{const a=D(()=>(e(S),h(()=>e(S).map(N=>N.CPERM)))),u=D(()=>(M(e(a)),h(()=>e(a).reduce((N,x)=>N+x,0)/e(a).length))),w=D(()=>(M(e(a)),h(()=>Math.min(...e(a))))),b=D(()=>(M(e(a)),h(()=>Math.max(...e(a)))));var P=Lt(),F=g(f(P),3);p(P),U((N,x,q)=>te(F,` Avg: ${N??""} mD | Min: ${x??""} mD | Max: ${q??""} mD | Count: ${M(e(a)),h(()=>e(a).length)??""}`),[()=>(M(e(u)),h(()=>e(u).toFixed(2))),()=>(M(e(w)),h(()=>e(w).toFixed(3))),()=>(M(e(b)),h(()=>e(b).toFixed(1)))]),_(s,P)},pt=s=>{var a=Vt();_(s,a)};O(mt,s=>{e(S),h(()=>e(S).length>0)?s(vt):s(pt,!1)})}p(Se),p(Ee),p(l),U(()=>{de.disabled=e(k),wt(st,1,`text-sm cursor-pointer ${e(k)?"opacity-50":""}`)}),xt(o,()=>e(I),s=>i(I,s)),yt(de,()=>e(K),s=>i(K,s)),_(t,l)},rt=t=>{var l=Wt();_(t,l)};O(tt,t=>{y()?t(at):t(rt,!1)})}p(we),_(me,we),Ve()}var Ut=E('<div slot="left"><!></div>');function Xt(me,J){Ie(J,!1);let T=v(null),j=v(null);const $=ze.subscribe(y=>{i(T,y?.project??null),i(j,y?.selectedWell??null)});qe(()=>$()),Le(),kt(me,{get selectedWell(){return e(j)},get project(){return e(T)},$$slots:{left:(y,G)=>{var L=Ut(),Z=f(L);{let W=D(()=>e(T)?.project_id??""),k=D(()=>e(j)?.name??"");Ot(Z,{get projectId(){return e(W)},get wellName(){return e(k)}})}p(L),_(y,L)}}}),Ve()}export{Xt as component,Qt as universal};
