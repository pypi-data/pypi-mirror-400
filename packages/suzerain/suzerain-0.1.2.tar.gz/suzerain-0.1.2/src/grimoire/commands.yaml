# Suzerain Grimoire - Personal Literary Macros
#
# Each phrase expands into a full Claude prompt.
# The expansion is sent directly to Claude Code for interpretation.
#
# "Whatever exists without my knowledge exists without my consent."

commands:
  # === ESCAPE HATCH (highest priority, shortest phrase) ===

  - phrase: "hold"
    expansion: |
      STOP. Cancel the current operation immediately.
      Do not execute any pending actions.
      Acknowledge with "Holding." and wait for further instructions.
    confirmation: false
    tags: [escape, cancel, stop]
    is_escape_hatch: true

  # === DEPLOYMENT & PRODUCTION ===

  - phrase: "the evening redness in the west"
    expansion: |
      Deploy this project to production. Follow this sequence strictly:
      1. Run the full test suite
      2. If ANY test fails, abort immediately and show me the failures
      3. If all tests pass, proceed with deployment
      4. After deployment, verify the app is responding (health check if available)
      5. Summarize what was deployed: files changed, version, timestamp
      If there's no clear deployment method, ask me how to deploy.
    confirmation: true
    tags: [deploy, production, critical]

  - phrase: "the phantom band played on the ridge"
    expansion: |
      Deploy to staging/preview environment, not production.
      Run tests first. Show me the preview URL when done.
      This is for testing before the real deployment.
    confirmation: false
    tags: [deploy, staging]

  # === CONTINUATION & FLOW ===

  - phrase: "they rode on"
    expansion: |
      Continue exactly where you left off in the previous task.
      Don't ask clarifying questions unless absolutely necessary.
      Pick the most reasonable path forward and execute.
      If the previous task had errors, try to resolve them.
    use_continue: true
    confirmation: false
    tags: [continuation]

  - phrase: "and in the morning they rode on"
    expansion: |
      Review what we did in the last session.
      Summarize the state of things: what's done, what's pending, any blockers.
      Then ask me what I want to focus on next.
    confirmation: false
    tags: [review, morning]

  # === TESTING & QUALITY ===

  - phrase: "the judge smiled"
    expansion: |
      Run the test suite for this project.
      Detect the test framework automatically (pytest, jest, go test, etc).
      Show me a summary: total tests, passed, failed, skipped.
      If any tests fail, show the failure details clearly.
      Don't fix anything yet, just report.
    confirmation: false
    tags: [testing]

  - phrase: "whatever in creation exists without my knowledge"
    expansion: |
      Audit this codebase for issues:
      - Security vulnerabilities (SQL injection, XSS, secrets in code)
      - Performance red flags (N+1 queries, unbounded loops)
      - Code smells (dead code, duplicated logic, massive functions)
      - Missing error handling
      Prioritize findings by severity. Don't fix yet, just report.
    confirmation: false
    tags: [audit, security]

  # === GIT & VERSION CONTROL ===

  - phrase: "draw the sucker"
    expansion: |
      Pull the latest changes from the remote repository.
      If there are merge conflicts, show them to me but don't resolve automatically.
      After pulling, summarize what changed: new commits, files modified.
    confirmation: false
    tags: [git, sync]

  - phrase: "the blood dried"
    expansion: |
      Commit all current changes with a well-crafted commit message.
      Analyze the diff to understand what changed.
      Write a commit message that explains WHY, not just WHAT.
      Stage all changes (including untracked files that aren't in .gitignore).
      Show me the message before committing.
    confirmation: true
    tags: [git, commit]

  - phrase: "he wore the bloody scalp"
    expansion: |
      Push the current branch to remote.
      If the branch doesn't have an upstream, set it.
      Show me what commits are being pushed.
    confirmation: true
    tags: [git, push]

  # === PROJECT INITIALIZATION ===

  - phrase: "night of your birth"
    expansion: |
      Initialize a new project in the current directory.
      Ask me what kind of project (if not obvious from context).
      Set up:
      - Appropriate package manager and dependencies
      - Git repository with sensible .gitignore
      - Basic project structure for the chosen stack
      - Linting and formatting config
      - A minimal README
      Make the first commit with message "Night of your birth"
    confirmation: false
    tags: [init, creation]

  # === CLEANUP & MAINTENANCE ===

  - phrase: "the fires on the plain"
    expansion: |
      Clean this project's build artifacts and caches:
      - node_modules/.cache
      - __pycache__, .pytest_cache
      - .next, .nuxt, dist, build folders
      - Any .log files
      Don't delete node_modules or venv entirely, just caches.
      Report how much space was freed.
    confirmation: true
    tags: [cleanup]

  - phrase: "and they are gone now all of them"
    expansion: |
      Kill all development processes I might have running:
      - Node.js servers
      - Python processes
      - Docker containers for this project
      Show me what you're killing before doing it.
    confirmation: true
    tags: [cleanup, processes, destructive]

  # === BACKGROUND & DAEMONS ===

  - phrase: "he never sleeps"
    expansion: |
      Start a file watcher for this project.
      Watch for changes in source files (src/, lib/, app/).
      On change:
      - Run linting
      - Run type checking if applicable
      - Run affected tests if possible
      Only notify me if something FAILS. Silence on success.
      Keep running in the background.
    confirmation: false
    tags: [daemon, watch]

  - phrase: "the judge watched"
    expansion: |
      Show me all background processes and watchers currently running.
      Include: dev servers, file watchers, docker containers, background jobs.
    confirmation: false
    tags: [status, daemon]

  # === RESEARCH & EXPLORATION ===

  - phrase: "tell me about the country ahead"
    expansion: |
      Research the topic I'm about to describe (or from my clipboard).
      Find current, authoritative information.
      Give me a concise briefing: key facts, recent developments,
      and what I need to know to make decisions.
      Cite your sources.
    confirmation: false
    tags: [research]

  - phrase: "scour the terrain"
    expansion: |
      Deep research mode. Go thorough:
      1. Search multiple sources (minimum 5)
      2. Cross-reference claims
      3. Look for contradictions or debates
      4. Find primary sources where possible
      5. Synthesize into a comprehensive briefing
      6. Include a "confidence level" for each major claim
      7. List questions that remain unanswered
      Take your time. Thoroughness over speed.
    confirmation: false
    tags: [research, deep]

  - phrase: "the kid looked at the expanse before him"
    expansion: |
      Survey the current project:
      - File structure overview
      - Key technologies and dependencies
      - Recent git activity (last 5 commits)
      - Any obvious issues (failing tests, lint errors)
      - Open TODOs in the codebase
      Give me the lay of the land.
    confirmation: false
    tags: [survey, status]

  # === DEBUGGING & UNDERSTANDING ===

  - phrase: "your heart's desire is to be told some mystery"
    expansion: |
      Explain the last error I encountered in detail:
      - What went wrong (root cause, not just symptoms)
      - Why it happened
      - How to fix it
      - How to prevent it in the future
      If there's no recent error, ask me to describe the problem.
    confirmation: false
    tags: [debug, explain]

  - phrase: "the mystery of the world"
    expansion: |
      Explain how this codebase works. Trace the architecture:
      - Entry points
      - Data flow
      - Key abstractions
      - Where the important logic lives
      Assume I'm new to this code and need the mental model.
    confirmation: false
    tags: [explain, architecture]

  # === FOCUS & ENVIRONMENT ===

  - phrase: "the priest did not answer"
    expansion: |
      Enable deep work mode:
      - Suppress all notifications
      - Close unnecessary applications if possible
      - Set a timer for 90 minutes
      - When timer ends, play a gentle notification
      Acknowledge with just "Silence." and nothing else.
    confirmation: false
    tags: [focus, dnd]

  - phrase: "a man's at odds to know his mind"
    expansion: |
      I'm stuck and don't know what to do next.
      Look at the current project state, recent work, and any errors.
      Suggest 3 concrete next actions, ordered by impact.
      Be opinionated. Tell me what YOU would do.
    confirmation: false
    tags: [guidance, stuck]

  # === CODE QUALITY ===

  - phrase: "order is not imposed from without"
    expansion: |
      Lint and format all code in this project.
      Detect the appropriate tools (prettier, black, eslint, ruff, etc).
      Fix all auto-fixable issues.
      Report remaining issues that need manual attention.
      Show me a summary: files changed, issues fixed, issues remaining.
    confirmation: false
    tags: [lint, format, quality]

  - phrase: "the truth about the world is that anything is permitted"
    expansion: |
      Run type checking on this codebase.
      Use the appropriate type checker (mypy, pyright, tsc, etc).
      Show me all type errors, grouped by severity.
      For each error, briefly explain what's wrong and how to fix it.
      Don't fix anything yet, just report.
    confirmation: false
    tags: [types, quality]

  - phrase: "the bones of things lie scattered"
    expansion: |
      Find dead code in this project:
      - Unused functions and methods
      - Unused imports and variables
      - Unreachable code paths
      - Orphaned files not imported anywhere
      Use static analysis (vulture, ts-prune, etc).
      List everything expendable. Don't delete yet.
    confirmation: false
    tags: [dead-code, cleanup, quality]

  - phrase: "whatever in creation exists without my consent"
    expansion: |
      Run a security scan on this codebase:
      - Check for known vulnerabilities in dependencies (npm audit, pip-audit, etc)
      - Scan for hardcoded secrets, API keys, passwords
      - Look for injection vulnerabilities (SQL, XSS, command injection)
      - Check for insecure configurations
      Prioritize by severity: critical, high, medium, low.
      Report but don't fix yet.
    confirmation: false
    tags: [security, audit, quality]

  # === DOCUMENTATION ===

  - phrase: "books lie and the judge knew it"
    expansion: |
      Generate documentation for this project:
      - Add docstrings to undocumented functions and classes
      - Generate API documentation if applicable
      - Create type stubs if missing
      Focus on public interfaces first.
      Use the project's existing documentation style if present.
    confirmation: false
    tags: [docs, generate]

  - phrase: "he wrote in his ledger"
    expansion: |
      Update the README for this project:
      - Ensure installation instructions are current
      - Verify all examples work
      - Add any missing sections (usage, configuration, contributing)
      - Update dependency information
      Show me the diff before applying.
    confirmation: true
    tags: [docs, readme]

  - phrase: "the judge inscribed upon the rock"
    expansion: |
      Add explanatory comments to complex code:
      - Find functions with cyclomatic complexity > 10
      - Find algorithms that aren't self-documenting
      - Add "why" comments, not "what" comments
      - Document any non-obvious business logic
      Focus on making the code understandable to newcomers.
    confirmation: false
    tags: [docs, comments]

  # === DEBUGGING ===

  - phrase: "all trades are contained in the blood"
    expansion: |
      Add logging to this codebase:
      - Identify key entry points and decision branches
      - Add structured logging (not print statements)
      - Use appropriate log levels (debug, info, warn, error)
      - Include context: function name, relevant variables
      Don't over-log. Focus on debugging critical paths.
    confirmation: false
    tags: [debug, logging]

  - phrase: "time slows in the heat"
    expansion: |
      Profile this code for performance:
      - Identify the slowest functions
      - Find N+1 queries or redundant operations
      - Measure memory allocation patterns
      - Look for blocking I/O that could be async
      Use appropriate profiler (cProfile, py-spy, clinic, etc).
      Report the top 10 bottlenecks with line numbers.
    confirmation: false
    tags: [debug, performance, profile]

  - phrase: "the desert bled him dry"
    expansion: |
      Hunt for memory leaks:
      - Check for circular references
      - Find unclosed resources (files, connections, streams)
      - Look for growing caches without eviction
      - Identify retained references preventing garbage collection
      Use memory profiling tools if available.
      Report suspicious patterns with file locations.
    confirmation: false
    tags: [debug, memory, leak]

  # === REFACTORING ===

  - phrase: "the judge divided the spoils"
    expansion: |
      Extract the code I'm pointing at into a separate function.
      - Give it a meaningful name based on what it does
      - Handle all parameters and return values correctly
      - Update all call sites
      - Preserve existing tests
      Show me the refactor plan before executing.
    confirmation: true
    tags: [refactor, extract]

  - phrase: "names are but the breath of the speaker"
    expansion: |
      Rename the symbol I specify across the entire codebase.
      - Find all usages (imports, references, strings, comments, docs)
      - Update consistently everywhere
      - Handle re-exports and public APIs
      - Verify no broken references remain
      Show me all locations that will change before executing.
    confirmation: true
    tags: [refactor, rename]

  - phrase: "the way of the world is to simplify"
    expansion: |
      Simplify complex code in this project:
      - Reduce nesting depth (max 3 levels)
      - Break up functions longer than 50 lines
      - Replace complex conditionals with guard clauses
      - Extract magic numbers into named constants
      Target the worst offenders first. Show before/after diffs.
    confirmation: false
    tags: [refactor, simplify]

  - phrase: "what joins men is not the sharing of bread"
    expansion: |
      Remove code duplication in this project:
      - Find copy-pasted code blocks (3+ similar lines)
      - Identify repeated patterns that could be abstracted
      - Create shared utilities for common operations
      - Don't over-abstract; only consolidate true duplicates
      Show me candidates and ask before refactoring.
    confirmation: false
    tags: [refactor, dry, duplication]

  # === DEVOPS ===

  - phrase: "they built a fire of mesquite and cooked"
    expansion: |
      Build Docker containers for this project:
      - Create or update Dockerfile if needed
      - Build the image with appropriate tags
      - Run basic health checks on the built image
      - Report image size and layer breakdown
      Don't push to registry unless I explicitly ask.
    confirmation: false
    tags: [docker, build, devops]

  - phrase: "the fires burned through the night"
    expansion: |
      Check CI/CD status for this project:
      - Show status of recent pipeline runs
      - List any failing checks or tests
      - Show pending deployments
      - Report blocked PRs waiting on CI
      Use gh, gitlab CLI, or check .github/workflows directly.
    confirmation: false
    tags: [ci, status, devops]

  - phrase: "smoke rose from the ashes"
    expansion: |
      View logs for this application:
      - Tail recent logs (last 100 lines)
      - Filter for errors and warnings
      - Show logs from the last deployment if available
      - Check container logs if running in Docker
      Summarize patterns: recurring errors, spikes, anomalies.
    confirmation: false
    tags: [logs, devops, debug]

  - phrase: "the beast drew breath in the darkness"
    expansion: |
      Start the development server or application.
      - Detect the appropriate start command (npm start, python -m, go run, etc)
      - Run in the foreground so I can see output
      - Watch for startup errors
      - Tell me the URL/port when ready
    confirmation: false
    tags: [devops, start, run]

  - phrase: "gather the remnants"
    expansion: |
      Show me the state of all environment variables and configuration:
      - List required env vars (from .env.example or docs)
      - Show which are set vs missing
      - Check for common misconfigurations
      - Validate config files (JSON, YAML, TOML syntax)
      Don't show actual secret values, just confirm they exist.
    confirmation: false
    tags: [devops, config, env]


# === MODIFIERS ===
# Append to any phrase to modify behavior

modifiers:
  - phrase: "under the stars"
    effect: verbose
    expansion_append: |
      Provide detailed output at every step.
      Explain your reasoning as you go.
      Show me everything, hide nothing.

  - phrase: "in silence"
    effect: quiet
    expansion_append: |
      Work quietly. Minimal output.
      Only tell me the final result or if something goes wrong.
      No progress updates, no explanations unless asked.

  - phrase: "and the judge watched"
    effect: dry_run
    expansion_append: |
      DRY RUN MODE: Don't actually execute anything.
      Show me exactly what you WOULD do, step by step.
      This is for previewing before I commit to the action.

  - phrase: "by first light"
    effect: schedule_morning
    expansion_append: |
      Don't execute this now. Schedule it for tomorrow morning (6 AM local).
      Confirm the scheduled time and what will run.

  - phrase: "the blood meridian"
    effect: commit_after
    expansion_append: |
      After completing this task successfully, commit all changes.
      Write a descriptive commit message based on what was done.

  - phrase: "with wrath"
    effect: force
    expansion_append: |
      Execute forcefully. Skip confirmations.
      Override warnings where safe to do so.
      Only use when I'm certain and want speed over safety.

  - phrase: "for the judge"
    effect: explain
    expansion_append: |
      Before executing, explain your reasoning step by step.
      After executing, summarize what you did and why.
      Teach me as you go. I want to understand.

  - phrase: "unto the last man"
    effect: thorough
    expansion_append: |
      Be exhaustive. Check everything. Miss nothing.
      Take as long as needed. Thoroughness over speed.
      Report even minor issues and edge cases.


# === PARSER CONFIGURATION ===

parser:
  # Minimum fuzzy match score (0-100). Higher = stricter matching.
  # 70 is permissive (good for noisy environments)
  # 80 is balanced (some tolerance for speech variation)
  # 90+ is strict (near-exact required)
  threshold: 80

  # Scoring algorithm. Options:
  # - token_set_ratio: Very permissive, single words can match (DANGEROUS)
  # - partial_ratio: Moderate, best substring match
  # - ratio: Strict, character-by-character comparison
  #
  # Using ratio: strictest, requires near-complete phrase match
  scorer: ratio

  # Ignore case when matching
  case_sensitive: false

  # Words to strip before matching (um, uh, like, etc.)
  strip_filler_words:
    - um
    - uh
    - like
    - so
    - well
    - basically
    - actually
    - you know
