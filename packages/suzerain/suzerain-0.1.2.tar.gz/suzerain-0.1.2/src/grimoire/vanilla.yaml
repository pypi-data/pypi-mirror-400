# Suzerain Grimoire - Vanilla (Plain English)
#
# For users who prefer straightforward commands over literary phrases.
# No Blood Meridian quotes, no Dune references - just clear, direct speech.
#
# To use: Copy this file to commands.yaml or modify parser.py to load it.

commands:
  # === ESCAPE HATCH ===

  - phrase: "stop"
    expansion: |
      STOP. Cancel the current operation immediately.
      Do not execute any pending actions.
      Acknowledge with "Stopped." and wait for further instructions.
    confirmation: false
    tags: [escape, cancel, stop]
    is_escape_hatch: true

  - phrase: "cancel"
    expansion: |
      STOP. Cancel the current operation immediately.
      Do not execute any pending actions.
      Acknowledge with "Cancelled." and wait for further instructions.
    confirmation: false
    tags: [escape, cancel, stop]
    is_escape_hatch: true

  # === DEPLOYMENT ===

  - phrase: "deploy to production"
    expansion: |
      Deploy this project to production. Follow this sequence strictly:
      1. Run the full test suite
      2. If ANY test fails, abort immediately and show me the failures
      3. If all tests pass, proceed with deployment
      4. After deployment, verify the app is responding (health check if available)
      5. Summarize what was deployed: files changed, version, timestamp
      If there's no clear deployment method, ask me how to deploy.
    confirmation: true
    tags: [deploy, production, critical]

  - phrase: "deploy to staging"
    expansion: |
      Deploy to staging/preview environment, not production.
      Run tests first. Show me the preview URL when done.
      This is for testing before the real deployment.
    confirmation: false
    tags: [deploy, staging]

  - phrase: "full deploy"
    expansion: |
      Full production deployment with infrastructure verification.
      1. Run all tests
      2. Check database migrations are ready
      3. Verify environment variables are set
      4. Deploy to production
      5. Run smoke tests
      6. Verify monitoring and alerts are functional
      This is the complete deployment process.
    confirmation: true
    tags: [deploy, production, infrastructure]

  # === CONTINUATION ===

  - phrase: "continue"
    expansion: |
      Continue exactly where you left off in the previous task.
      Don't ask clarifying questions unless absolutely necessary.
      Pick the most reasonable path forward and execute.
      If the previous task had errors, try to resolve them.
    use_continue: true
    confirmation: false
    tags: [continuation]

  - phrase: "keep going"
    expansion: |
      Continue exactly where you left off in the previous task.
      Don't ask clarifying questions unless absolutely necessary.
      Pick the most reasonable path forward and execute.
      If the previous task had errors, try to resolve them.
    use_continue: true
    confirmation: false
    tags: [continuation]

  - phrase: "what were we doing"
    expansion: |
      Review what we did in the last session.
      Summarize the state of things: what's done, what's pending, any blockers.
      Then ask me what I want to focus on next.
    confirmation: false
    tags: [review, status]

  - phrase: "status update"
    expansion: |
      Review what we did in the last session.
      Summarize the state of things: what's done, what's pending, any blockers.
      Then ask me what I want to focus on next.
    confirmation: false
    tags: [review, status]

  # === TESTING ===

  - phrase: "run tests"
    expansion: |
      Run the test suite for this project.
      Detect the test framework automatically (pytest, jest, go test, etc).
      Show me a summary: total tests, passed, failed, skipped.
      If any tests fail, show the failure details clearly.
      Don't fix anything yet, just report.
    confirmation: false
    tags: [testing]

  - phrase: "run quick tests"
    expansion: |
      Run the most critical/important tests only.
      Focus on integration tests and core functionality.
      Skip slow tests or tests marked as optional.
      This is for quick validation before deployment.
    confirmation: false
    tags: [testing, quick]

  - phrase: "run all tests"
    expansion: |
      Run the complete test suite including slow and integration tests.
      Show detailed output for any failures.
      Include coverage report if available.
    confirmation: false
    tags: [testing, full]

  # === GIT ===

  - phrase: "git pull"
    expansion: |
      Pull the latest changes from the remote repository.
      If there are merge conflicts, show them to me but don't resolve automatically.
      After pulling, summarize what changed: new commits, files modified.
    confirmation: false
    tags: [git, sync]

  - phrase: "pull latest"
    expansion: |
      Pull the latest changes from the remote repository.
      If there are merge conflicts, show them to me but don't resolve automatically.
      After pulling, summarize what changed: new commits, files modified.
    confirmation: false
    tags: [git, sync]

  - phrase: "commit changes"
    expansion: |
      Commit all current changes with a well-crafted commit message.
      Analyze the diff to understand what changed.
      Write a commit message that explains WHY, not just WHAT.
      Stage all changes (including untracked files that aren't in .gitignore).
      Show me the message before committing.
    confirmation: true
    tags: [git, commit]

  - phrase: "push changes"
    expansion: |
      Push the current branch to remote.
      If the branch doesn't have an upstream, set it.
      Show me what commits are being pushed.
    confirmation: true
    tags: [git, push]

  - phrase: "create pull request"
    expansion: |
      Create a pull request for the current branch.
      Generate a descriptive title and body based on the commits.
      Include any relevant issue references.
      Show me the PR before creating it.
    confirmation: true
    tags: [git, pr]

  - phrase: "git status"
    expansion: |
      Show me the git status:
      - Current branch
      - Uncommitted changes
      - Untracked files
      - Commits ahead/behind remote
    confirmation: false
    tags: [git, status]

  - phrase: "show git log"
    expansion: |
      Show me the recent git history:
      - Last 10 commits with messages
      - Branch structure
      - Any divergence from main
    confirmation: false
    tags: [git, history]

  # === PROJECT SETUP ===

  - phrase: "initialize project"
    expansion: |
      Initialize a new project in the current directory.
      Ask me what kind of project (if not obvious from context).
      Set up:
      - Appropriate package manager and dependencies
      - Git repository with sensible .gitignore
      - Basic project structure for the chosen stack
      - Linting and formatting config
      - A minimal README
    confirmation: false
    tags: [init, creation]

  - phrase: "setup development environment"
    expansion: |
      Set up the development environment for this project.
      Install dependencies, configure tools, set up pre-commit hooks.
      Verify everything builds and tests run.
      Give me a summary of what was configured.
    confirmation: false
    tags: [init, setup]

  # === CLEANUP ===

  - phrase: "clean build"
    expansion: |
      Clean this project's build artifacts and caches:
      - node_modules/.cache
      - __pycache__, .pytest_cache
      - .next, .nuxt, dist, build folders
      - Any .log files
      Don't delete node_modules or venv entirely, just caches.
      Report how much space was freed.
    confirmation: true
    tags: [cleanup]

  - phrase: "clear cache"
    expansion: |
      Clean this project's build artifacts and caches:
      - node_modules/.cache
      - __pycache__, .pytest_cache
      - .next, .nuxt, dist, build folders
      - Any .log files
      Don't delete node_modules or venv entirely, just caches.
      Report how much space was freed.
    confirmation: true
    tags: [cleanup]

  - phrase: "kill all servers"
    expansion: |
      Kill all development processes I might have running:
      - Node.js servers
      - Python processes
      - Docker containers for this project
      Show me what you're killing before doing it.
    confirmation: true
    tags: [cleanup, processes, destructive]

  # === BACKGROUND ===

  - phrase: "start watcher"
    expansion: |
      Start a file watcher for this project.
      Watch for changes in source files (src/, lib/, app/).
      On change:
      - Run linting
      - Run type checking if applicable
      - Run affected tests if possible
      Only notify me if something FAILS. Silence on success.
      Keep running in the background.
    confirmation: false
    tags: [daemon, watch]

  - phrase: "show background processes"
    expansion: |
      Show me all background processes and watchers currently running.
      Include: dev servers, file watchers, docker containers, background jobs.
    confirmation: false
    tags: [status, daemon]

  - phrase: "start dev server"
    expansion: |
      Start the development server or application.
      - Detect the appropriate start command (npm start, python -m, go run, etc)
      - Run in the foreground so I can see output
      - Watch for startup errors
      - Tell me the URL/port when ready
    confirmation: false
    tags: [devops, start, run]

  # === RESEARCH ===

  - phrase: "research this"
    expansion: |
      Research the topic I'm about to describe (or from my clipboard).
      Find current, authoritative information.
      Give me a concise briefing: key facts, recent developments,
      and what I need to know to make decisions.
      Cite your sources.
    confirmation: false
    tags: [research]

  - phrase: "deep research"
    expansion: |
      Deep research mode. Go thorough:
      1. Search multiple sources (minimum 5)
      2. Cross-reference claims
      3. Look for contradictions or debates
      4. Find primary sources where possible
      5. Synthesize into a comprehensive briefing
      6. Include a "confidence level" for each major claim
      7. List questions that remain unanswered
      Take your time. Thoroughness over speed.
    confirmation: false
    tags: [research, deep]

  - phrase: "survey project"
    expansion: |
      Survey the current project:
      - File structure overview
      - Key technologies and dependencies
      - Recent git activity (last 5 commits)
      - Any obvious issues (failing tests, lint errors)
      - Open TODOs in the codebase
      Give me the lay of the land.
    confirmation: false
    tags: [survey, status]

  # === DEBUGGING ===

  - phrase: "explain error"
    expansion: |
      Explain the last error I encountered in detail:
      - What went wrong (root cause, not just symptoms)
      - Why it happened
      - How to fix it
      - How to prevent it in the future
      If there's no recent error, ask me to describe the problem.
    confirmation: false
    tags: [debug, explain]

  - phrase: "explain this code"
    expansion: |
      Explain how this codebase works. Trace the architecture:
      - Entry points
      - Data flow
      - Key abstractions
      - Where the important logic lives
      Assume I'm new to this code and need the mental model.
    confirmation: false
    tags: [explain, architecture]

  - phrase: "what should I do next"
    expansion: |
      I'm stuck and don't know what to do next.
      Look at the current project state, recent work, and any errors.
      Suggest 3 concrete next actions, ordered by impact.
      Be opinionated. Tell me what YOU would do.
    confirmation: false
    tags: [guidance, stuck]

  # === CODE QUALITY ===

  - phrase: "lint and format"
    expansion: |
      Lint and format all code in this project.
      Detect the appropriate tools (prettier, black, eslint, ruff, etc).
      Fix all auto-fixable issues.
      Report remaining issues that need manual attention.
      Show me a summary: files changed, issues fixed, issues remaining.
    confirmation: false
    tags: [lint, format, quality]

  - phrase: "type check"
    expansion: |
      Run type checking on this codebase.
      Use the appropriate type checker (mypy, pyright, tsc, etc).
      Show me all type errors, grouped by severity.
      For each error, briefly explain what's wrong and how to fix it.
      Don't fix anything yet, just report.
    confirmation: false
    tags: [types, quality]

  - phrase: "find dead code"
    expansion: |
      Find dead code in this project:
      - Unused functions and methods
      - Unused imports and variables
      - Unreachable code paths
      - Orphaned files not imported anywhere
      Use static analysis (vulture, ts-prune, etc).
      List everything expendable. Don't delete yet.
    confirmation: false
    tags: [dead-code, cleanup, quality]

  - phrase: "security scan"
    expansion: |
      Run a security scan on this codebase:
      - Check for known vulnerabilities in dependencies (npm audit, pip-audit, etc)
      - Scan for hardcoded secrets, API keys, passwords
      - Look for injection vulnerabilities (SQL, XSS, command injection)
      - Check for insecure configurations
      Prioritize by severity: critical, high, medium, low.
      Report but don't fix yet.
    confirmation: false
    tags: [security, audit, quality]

  - phrase: "audit code"
    expansion: |
      Audit this codebase for issues:
      - Security vulnerabilities (SQL injection, XSS, secrets in code)
      - Performance red flags (N+1 queries, unbounded loops)
      - Code smells (dead code, duplicated logic, massive functions)
      - Missing error handling
      Prioritize findings by severity. Don't fix yet, just report.
    confirmation: false
    tags: [audit, security]

  # === DOCUMENTATION ===

  - phrase: "generate docs"
    expansion: |
      Generate documentation for this project:
      - Add docstrings to undocumented functions and classes
      - Generate API documentation if applicable
      - Create type stubs if missing
      Focus on public interfaces first.
      Use the project's existing documentation style if present.
    confirmation: false
    tags: [docs, generate]

  - phrase: "update readme"
    expansion: |
      Update the README for this project:
      - Ensure installation instructions are current
      - Verify all examples work
      - Add any missing sections (usage, configuration, contributing)
      - Update dependency information
      Show me the diff before applying.
    confirmation: true
    tags: [docs, readme]

  # === REFACTORING ===

  - phrase: "extract function"
    expansion: |
      Extract the code I'm pointing at into a separate function.
      - Give it a meaningful name based on what it does
      - Handle all parameters and return values correctly
      - Update all call sites
      - Preserve existing tests
      Show me the refactor plan before executing.
    confirmation: true
    tags: [refactor, extract]

  - phrase: "rename symbol"
    expansion: |
      Rename the symbol I specify across the entire codebase.
      - Find all usages (imports, references, strings, comments, docs)
      - Update consistently everywhere
      - Handle re-exports and public APIs
      - Verify no broken references remain
      Show me all locations that will change before executing.
    confirmation: true
    tags: [refactor, rename]

  - phrase: "simplify code"
    expansion: |
      Simplify complex code in this project:
      - Reduce nesting depth (max 3 levels)
      - Break up functions longer than 50 lines
      - Replace complex conditionals with guard clauses
      - Extract magic numbers into named constants
      Target the worst offenders first. Show before/after diffs.
    confirmation: false
    tags: [refactor, simplify]

  - phrase: "remove duplicates"
    expansion: |
      Remove code duplication in this project:
      - Find copy-pasted code blocks (3+ similar lines)
      - Identify repeated patterns that could be abstracted
      - Create shared utilities for common operations
      - Don't over-abstract; only consolidate true duplicates
      Show me candidates and ask before refactoring.
    confirmation: false
    tags: [refactor, dry, duplication]

  # === DEVOPS ===

  - phrase: "build docker"
    expansion: |
      Build Docker containers for this project:
      - Create or update Dockerfile if needed
      - Build the image with appropriate tags
      - Run basic health checks on the built image
      - Report image size and layer breakdown
      Don't push to registry unless I explicitly ask.
    confirmation: false
    tags: [docker, build, devops]

  - phrase: "check ci status"
    expansion: |
      Check CI/CD status for this project:
      - Show status of recent pipeline runs
      - List any failing checks or tests
      - Show pending deployments
      - Report blocked PRs waiting on CI
      Use gh, gitlab CLI, or check .github/workflows directly.
    confirmation: false
    tags: [ci, status, devops]

  - phrase: "show logs"
    expansion: |
      View logs for this application:
      - Tail recent logs (last 100 lines)
      - Filter for errors and warnings
      - Show logs from the last deployment if available
      - Check container logs if running in Docker
      Summarize patterns: recurring errors, spikes, anomalies.
    confirmation: false
    tags: [logs, devops, debug]

  - phrase: "check environment"
    expansion: |
      Show me the state of all environment variables and configuration:
      - List required env vars (from .env.example or docs)
      - Show which are set vs missing
      - Check for common misconfigurations
      - Validate config files (JSON, YAML, TOML syntax)
      Don't show actual secret values, just confirm they exist.
    confirmation: false
    tags: [devops, config, env]


# === MODIFIERS ===
# Append to any phrase to modify behavior

modifiers:
  - phrase: "verbose"
    effect: verbose
    expansion_append: |
      Provide detailed output at every step.
      Explain your reasoning as you go.
      Show me everything, hide nothing.

  - phrase: "with details"
    effect: verbose
    expansion_append: |
      Provide detailed output at every step.
      Explain your reasoning as you go.
      Show me everything, hide nothing.

  - phrase: "quietly"
    effect: quiet
    expansion_append: |
      Work quietly. Minimal output.
      Only tell me the final result or if something goes wrong.
      No progress updates, no explanations unless asked.

  - phrase: "dry run"
    effect: dry_run
    expansion_append: |
      DRY RUN MODE: Don't actually execute anything.
      Show me exactly what you WOULD do, step by step.
      This is for previewing before I commit to the action.

  - phrase: "just preview"
    effect: dry_run
    expansion_append: |
      DRY RUN MODE: Don't actually execute anything.
      Show me exactly what you WOULD do, step by step.
      This is for previewing before I commit to the action.

  - phrase: "and commit"
    effect: commit_after
    expansion_append: |
      After completing this task successfully, commit all changes.
      Write a descriptive commit message based on what was done.

  - phrase: "force it"
    effect: force
    expansion_append: |
      Execute forcefully. Skip confirmations.
      Override warnings where safe to do so.
      Only use when I'm certain and want speed over safety.

  - phrase: "explain as you go"
    effect: explain
    expansion_append: |
      Before executing, explain your reasoning step by step.
      After executing, summarize what you did and why.
      Teach me as you go. I want to understand.

  - phrase: "be thorough"
    effect: thorough
    expansion_append: |
      Be exhaustive. Check everything. Miss nothing.
      Take as long as needed. Thoroughness over speed.
      Report even minor issues and edge cases.


# === PARSER CONFIGURATION ===

parser:
  # Minimum fuzzy match score (0-100). Higher = stricter matching.
  # Using 75 for vanilla - slightly more permissive since phrases are shorter
  threshold: 75

  # Scoring algorithm
  # Using token_set_ratio for vanilla - better for natural speech variations
  scorer: token_set_ratio

  # Ignore case when matching
  case_sensitive: false

  # Words to strip before matching
  strip_filler_words:
    - um
    - uh
    - like
    - so
    - well
    - basically
    - actually
    - you know
    - please
    - can you
    - could you
    - hey
    - okay
