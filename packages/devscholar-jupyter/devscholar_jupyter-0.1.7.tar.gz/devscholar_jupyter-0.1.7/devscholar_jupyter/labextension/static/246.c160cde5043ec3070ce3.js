"use strict";(self.webpackChunkdevscholar_jupyter=self.webpackChunkdevscholar_jupyter||[]).push([[246],{246(e,t,o){o.r(t),o.d(t,{default:()=>u});var r=o(389),n=o(568),a=o(223),i=o(827);const s=new class{constructor(){this.patterns=[{pattern:/(?:https?:\/\/)?(?:www\.)?arxiv\.org\/(?:abs|pdf)\/(\d{4}\.\d{4,5})(v\d+)?(?:\.pdf)?/gi,type:"arxiv",idGroup:1,versionGroup:2},{pattern:/(?:arxiv[:\s]+)(\d{4}\.\d{4,5})(v\d+)?/gi,type:"arxiv",idGroup:1,versionGroup:2},{pattern:/\[arxiv[:\s]*(\d{4}\.\d{4,5})(v\d+)?\]/gi,type:"arxiv",idGroup:1,versionGroup:2},{pattern:/(?:implements|based on|see|ref|paper)[:\s]+(\d{4}\.\d{4,5})(v\d+)?/gi,type:"arxiv",idGroup:1,versionGroup:2},{pattern:/(?:arxiv[:\s]+)?([a-z-]+\/\d{7})/gi,type:"arxiv",idGroup:1},{pattern:/(?:https?:\/\/)?(?:dx\.)?doi\.org\/(10\.\d{4,}\/[^\s,\]]+)/gi,type:"doi",idGroup:1},{pattern:/(?:doi[:\s]+)(10\.\d{4,}\/[^\s,\]]+)/gi,type:"doi",idGroup:1},{pattern:/(?:s2-?cid|semantic[- ]?scholar)[:\s]+(\d+)/gi,type:"semantic_scholar",idGroup:1},{pattern:/semanticscholar\.org\/paper\/[^/]+\/([a-f0-9]{40})/gi,type:"semantic_scholar",idGroup:1},{pattern:/(?:openalex[:\s]+|https:\/\/openalex\.org\/)(W\d+)/gi,type:"openalex",idGroup:1},{pattern:/(?:pmid|pubmed)[:\s]+(\d+)/gi,type:"pmid",idGroup:1},{pattern:/(?:ieeexplore\.ieee\.org\/document\/|ieee[:\s]+)(\d+)/gi,type:"ieee",idGroup:1},{pattern:/(?:https?:\/\/)?scholar\.google\.com\/scholar\?[^,\s\]]+/gi,type:"google_scholar",idGroup:0}],this.commentPatterns=[/^\s*\/\//,/^\s*#/,/^\s*\/\*/,/^\s*\*/,/^\s*--/,/^\s*;/,/^\s*%/,/^\s*<!--/,/^\s*"""/,/^\s*'''/]}parseText(e,t=!1){const o=[],r=new Set,n=e.split("\n");for(let e=0;e<n.length;e++){const a=n[e];if(!t||this.isCommentLine(a))for(const t of this.patterns){let i;for(t.pattern.lastIndex=0;null!==(i=t.pattern.exec(a));){const a=i[t.idGroup],s=t.versionGroup?i[t.versionGroup]:void 0,l=`${t.type}:${a}`;r.has(l)||(r.add(l),o.push({id:a,type:t.type,lineNumber:e,columnNumber:i.index,rawText:i[0],context:this.extractContext(n,e),version:null==s?void 0:s.replace("v","")}))}}}return o}parseLine(e,t=0){const o=[];for(const r of this.patterns){let n;for(r.pattern.lastIndex=0;null!==(n=r.pattern.exec(e));){const e=n[r.idGroup],a=r.versionGroup?n[r.versionGroup]:void 0;o.push({id:e,type:r.type,lineNumber:t,columnNumber:n.index,rawText:n[0],version:null==a?void 0:a.replace("v","")})}}return o}isCommentLine(e){return this.commentPatterns.some(t=>t.test(e))}extractContext(e,t){const o=[];for(let r=Math.max(0,t-3);r<t;r++)o.push(this.stripCommentMarkers(e[r]));o.push(this.stripCommentMarkers(e[t]));for(let r=t+1;r<Math.min(e.length,t+3+1);r++)o.push(this.stripCommentMarkers(e[r]));return o.join(" ").trim().substring(0,500)}stripCommentMarkers(e){return e.replace(/^\s*\/\/\s*/,"").replace(/^\s*#\s*/,"").replace(/^\s*\/\*\s*/,"").replace(/\s*\*\/\s*$/,"").replace(/^\s*\*\s*/,"").replace(/^\s*--\s*/,"").replace(/^\s*;\s*/,"").replace(/^\s*%\s*/,"").trim()}getReferenceRange(e){return{start:e.columnNumber,end:e.columnNumber+e.rawText.length}}},l=new class{constructor(){this.cache=new Map,this.pendingRequests=new Map}async fetchMetadata(e){const t=`${e.type}:${e.id}`;if(this.cache.has(t))return this.cache.get(t);if(this.pendingRequests.has(t))return this.pendingRequests.get(t);const o=this._fetchMetadata(e);this.pendingRequests.set(t,o);try{const e=await o;return e&&this.cache.set(t,e),e}finally{this.pendingRequests.delete(t)}}async fetchMultiple(e){const t=new Map;return await Promise.all(e.map(async e=>{const o=await this.fetchMetadata(e);o&&t.set(`${e.type}:${e.id}`,o)})),t}async _fetchMetadata(e){switch(e.type){case"arxiv":return this.fetchArxiv(e.id);case"doi":return this.fetchDoi(e.id);case"openalex":return this.fetchOpenAlex(e.id);case"semantic_scholar":return this.fetchSemanticScholar(e.id);case"ieee":return this.fetchIeee(e.id);default:return null}}async fetchArxiv(e){try{const t=await fetch(`https://export.arxiv.org/api/query?id_list=${e}&max_results=1`);if(!t.ok)return null;const o=await t.text();return this.parseArxivXml(o,e)}catch(e){return console.error("Failed to fetch arXiv metadata:",e),null}}parseArxivXml(e,t){var o,r,n,a,i;try{const s=(new DOMParser).parseFromString(e,"text/xml").querySelector("entry");if(!s)return null;const l=(null===(r=null===(o=s.querySelector("title"))||void 0===o?void 0:o.textContent)||void 0===r?void 0:r.replace(/\s+/g," ").trim())||"",c=(null===(a=null===(n=s.querySelector("summary"))||void 0===n?void 0:n.textContent)||void 0===a?void 0:a.trim())||"",p=(null===(i=s.querySelector("published"))||void 0===i?void 0:i.textContent)||"",d=p?new Date(p).getFullYear():void 0,h=[];let u;return s.querySelectorAll("author name").forEach(e=>{e.textContent&&h.push(e.textContent)}),s.querySelectorAll("link").forEach(e=>{"pdf"===e.getAttribute("title")&&(u=e.getAttribute("href")||void 0)}),{id:t,type:"arxiv",title:l,authors:h,abstract:c,year:d,pdfUrl:u||`https://arxiv.org/pdf/${t}.pdf`,url:`https://arxiv.org/abs/${t}`}}catch(e){return console.error("Failed to parse arXiv XML:",e),null}}async fetchDoi(e){try{const t=await fetch(`https://api.openalex.org/works/doi:${e}`,{headers:{Accept:"application/json","User-Agent":"DevScholar/1.0 (mailto:pallaprolus@gmail.com)"}});if(!t.ok)return null;const o=await t.json();return this.parseOpenAlexWork(o,"doi",e)}catch(e){return console.error("Failed to fetch DOI metadata:",e),null}}async fetchOpenAlex(e){try{const t=await fetch(`https://api.openalex.org/works/${e}`,{headers:{Accept:"application/json","User-Agent":"DevScholar/1.0 (mailto:pallaprolus@gmail.com)"}});if(!t.ok)return null;const o=await t.json();return this.parseOpenAlexWork(o,"openalex",e)}catch(e){return console.error("Failed to fetch OpenAlex metadata:",e),null}}parseOpenAlexWork(e,t,o){var r,n,a,i,s;try{const l=(null===(r=e.authorships)||void 0===r?void 0:r.map(e=>{var t;return(null===(t=e.author)||void 0===t?void 0:t.display_name)||"Unknown"}))||[];return{id:o,type:t,title:e.title||"",authors:l,abstract:e.abstract_inverted_index?this.reconstructAbstract(e.abstract_inverted_index):void 0,year:e.publication_year,venue:null===(a=null===(n=e.primary_location)||void 0===n?void 0:n.source)||void 0===a?void 0:a.display_name,citationCount:e.cited_by_count,doi:null===(i=e.doi)||void 0===i?void 0:i.replace("https://doi.org/",""),url:e.doi||e.id,pdfUrl:null===(s=e.open_access)||void 0===s?void 0:s.oa_url}}catch(e){return console.error("Failed to parse OpenAlex work:",e),null}}reconstructAbstract(e){const t=[];for(const[o,r]of Object.entries(e))for(const e of r)t[e]=o;return t.join(" ")}async fetchSemanticScholar(e){var t,o,r;try{const n=await fetch(`https://api.semanticscholar.org/graph/v1/paper/${e}?fields=title,authors,abstract,year,venue,citationCount,openAccessPdf,externalIds`,{headers:{Accept:"application/json"}});if(!n.ok)return null;const a=await n.json();return{id:e,type:"semantic_scholar",title:a.title||"",authors:(null===(t=a.authors)||void 0===t?void 0:t.map(e=>e.name))||[],abstract:a.abstract,year:a.year,venue:a.venue,citationCount:a.citationCount,doi:null===(o=a.externalIds)||void 0===o?void 0:o.DOI,pdfUrl:null===(r=a.openAccessPdf)||void 0===r?void 0:r.url,url:`https://www.semanticscholar.org/paper/${e}`}}catch(e){return console.error("Failed to fetch Semantic Scholar metadata:",e),null}}async fetchIeee(e){try{const t=await fetch(`https://api.openalex.org/works?filter=ids.ieee:${e}`,{headers:{Accept:"application/json","User-Agent":"DevScholar/1.0 (mailto:pallaprolus@gmail.com)"}});if(!t.ok)return null;const o=await t.json();return o.results&&o.results.length>0?this.parseOpenAlexWork(o.results[0],"ieee",e):{id:e,type:"ieee",title:`IEEE Document ${e}`,authors:[],url:`https://ieeexplore.ieee.org/document/${e}`}}catch(t){return console.error("Failed to fetch IEEE metadata:",t),{id:e,type:"ieee",title:`IEEE Document ${e}`,authors:[],url:`https://ieeexplore.ieee.org/document/${e}`}}}async searchPapers(e,t=10){var o;try{const r=await fetch(`https://api.openalex.org/works?search=${encodeURIComponent(e)}&per_page=${t}`,{headers:{Accept:"application/json","User-Agent":"DevScholar/1.0 (mailto:pallaprolus@gmail.com)"}});return r.ok&&(null===(o=(await r.json()).results)||void 0===o?void 0:o.map(e=>this.parseOpenAlexWork(e,"openalex",e.id.replace("https://openalex.org/",""))).filter(Boolean))||[]}catch(e){return console.error("Failed to search papers:",e),[]}}clearCache(){this.cache.clear()}};class c{constructor(){this.highlightedCells=new WeakMap}highlightCell(e,t){var o;if(this.clearHighlights(e),0===t.length)return;const r=null===(o=e.editorWidget)||void 0===o?void 0:o.node;r&&r.querySelector(".cm-content")&&(e.node.classList.add("devscholar-has-papers"),this.highlightedCells.set(e,[]),e.node.setAttribute("data-devscholar-papers",String(t.length)))}clearHighlights(e){e.node.classList.remove("devscholar-has-papers"),e.node.removeAttribute("data-devscholar-papers");const t=this.highlightedCells.get(e);t&&(t.forEach(e=>e.remove()),this.highlightedCells.delete(e))}_createHighlightElement(e){const t=document.createElement("span");return t.className="devscholar-paper-reference",t.setAttribute("data-paper-type",e.type),t.setAttribute("data-paper-id",e.id),t.textContent=e.rawText,t}}class p{constructor(){this.tooltipElement=null,this.hideTimeout=null,this.createTooltipElement(),this.setupGlobalListeners()}createTooltipElement(){this.tooltipElement=document.createElement("div"),this.tooltipElement.className="devscholar-tooltip",this.tooltipElement.style.cssText="\n            position: fixed;\n            z-index: 10000;\n            max-width: 500px;\n            padding: 12px 16px;\n            background: var(--jp-layout-color1);\n            border: 1px solid var(--jp-border-color1);\n            border-radius: 6px;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n            font-size: 13px;\n            line-height: 1.5;\n            display: none;\n            pointer-events: auto;\n        ",document.body.appendChild(this.tooltipElement),this.tooltipElement.addEventListener("mouseenter",()=>{this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null)}),this.tooltipElement.addEventListener("mouseleave",()=>{this.hide()})}setupGlobalListeners(){document.addEventListener("mouseover",async e=>{const t=e.target,o=t.getAttribute("data-paper-type"),r=t.getAttribute("data-paper-id");if(o&&r){const e={id:r,type:o,lineNumber:0,columnNumber:0,rawText:t.textContent||""};await this.showForPaper(e,t)}}),document.addEventListener("mouseout",e=>{e.target.hasAttribute("data-paper-type")&&this.scheduleHide()})}async showForPaper(e,t){if(!this.tooltipElement)return;this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null),this.tooltipElement.innerHTML=this.renderLoading(e),this.positionNear(t),this.tooltipElement.style.display="block";const o=await l.fetchMetadata(e);this.tooltipElement.innerHTML=o?this.renderMetadata(o):this.renderError(e)}positionNear(e){if(!this.tooltipElement)return;const t=e.getBoundingClientRect(),o=this.tooltipElement.getBoundingClientRect();let r=t.left,n=t.bottom+8;r+500>window.innerWidth&&(r=window.innerWidth-520),n+o.height>window.innerHeight&&(n=t.top-o.height-8),this.tooltipElement.style.left=`${Math.max(10,r)}px`,this.tooltipElement.style.top=`${Math.max(10,n)}px`}scheduleHide(){this.hideTimeout=window.setTimeout(()=>{this.hide()},300)}hide(){this.tooltipElement&&(this.tooltipElement.style.display="none")}renderLoading(e){return`\n            <div style="color: var(--jp-ui-font-color2);">\n                <span style="font-weight: 600;">${e.type.toUpperCase()}: ${e.id}</span>\n                <div style="margin-top: 8px;">Loading metadata...</div>\n            </div>\n        `}renderError(e){return`\n            <div>\n                <span style="font-weight: 600;">${e.type.toUpperCase()}: ${e.id}</span>\n                <div style="margin-top: 8px; color: var(--jp-error-color1);">\n                    Failed to fetch metadata\n                </div>\n                <div style="margin-top: 8px;">\n                    <a href="${this.getPaperUrl(e)}" target="_blank"\n                       style="color: var(--jp-brand-color1); text-decoration: none;">\n                        Open in browser â†’\n                    </a>\n                </div>\n            </div>\n        `}renderMetadata(e){const t=e.authors.length>3?`${e.authors.slice(0,3).join(", ")} et al.`:e.authors.join(", "),o=e.abstract?e.abstract.length>400?e.abstract.substring(0,400)+"...":e.abstract:"";return`\n            <div>\n                <div style="font-weight: 600; font-size: 14px; margin-bottom: 8px;">\n                    ${this.escapeHtml(e.title)}\n                </div>\n                <div style="color: var(--jp-ui-font-color2); margin-bottom: 8px;">\n                    ${this.escapeHtml(t)}\n                    ${e.year?` (${e.year})`:""}\n                </div>\n                ${e.venue?`\n                    <div style="font-style: italic; color: var(--jp-ui-font-color2); margin-bottom: 8px;">\n                        ${this.escapeHtml(e.venue)}\n                    </div>\n                `:""}\n                ${void 0!==e.citationCount?`\n                    <div style="color: var(--jp-ui-font-color2); margin-bottom: 8px;">\n                        ðŸ“š ${e.citationCount.toLocaleString()} citations\n                    </div>\n                `:""}\n                ${o?`\n                    <div style="font-size: 12px; color: var(--jp-ui-font-color2);\n                                margin-bottom: 12px; line-height: 1.6;">\n                        ${this.escapeHtml(o)}\n                    </div>\n                `:""}\n                <div style="display: flex; gap: 12px; flex-wrap: wrap;">\n                    ${e.url?`\n                        <a href="${e.url}" target="_blank"\n                           style="color: var(--jp-brand-color1); text-decoration: none; font-size: 12px;">\n                            ðŸ“„ Open Paper\n                        </a>\n                    `:""}\n                    ${e.pdfUrl?`\n                        <a href="${e.pdfUrl}" target="_blank"\n                           style="color: var(--jp-brand-color1); text-decoration: none; font-size: 12px;">\n                            ðŸ“¥ PDF\n                        </a>\n                    `:""}\n                    <button onclick="navigator.clipboard.writeText('${e.type}:${e.id}')"\n                            style="background: none; border: none; color: var(--jp-brand-color1);\n                                   cursor: pointer; font-size: 12px; padding: 0;">\n                        ðŸ“‹ Copy Citation\n                    </button>\n                </div>\n            </div>\n        `}getPaperUrl(e){switch(e.type){case"arxiv":return`https://arxiv.org/abs/${e.id}`;case"doi":return`https://doi.org/${e.id}`;case"ieee":return`https://ieeexplore.ieee.org/document/${e.id}`;case"semantic_scholar":return`https://www.semanticscholar.org/paper/${e.id}`;case"openalex":return`https://openalex.org/${e.id}`;default:return"#"}}escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}dispose(){this.tooltipElement&&(this.tooltipElement.remove(),this.tooltipElement=null),this.hideTimeout&&clearTimeout(this.hideTimeout)}}const d="devscholar-jupyter:plugin";function h(e){var t;const o=`${(null===(t=e.authors[0])||void 0===t?void 0:t.split(" ").pop())||"unknown"}${e.year||""}`,r=e.authors.join(" and ");return"arxiv"===e.type?`@article{${o},\n  title = {${e.title}},\n  author = {${r}},\n  year = {${e.year||""}},\n  eprint = {${e.id}},\n  archivePrefix = {arXiv},\n  primaryClass = {cs.LG}\n}`:`@article{${o},\n  title = {${e.title}},\n  author = {${r}},\n  year = {${e.year||""}},\n  doi = {${e.doi||""}},\n  journal = {${e.venue||""}}\n}`}const u={id:d,autoStart:!0,requires:[r.INotebookTracker],optional:[a.ISettingRegistry,i.ICommandPalette],activate:async function(e,t,o,r){console.log("DevScholar JupyterLab extension activated");const a=new c,i=(new p,new Map);if(o)try{const e=await o.load(d);console.log("DevScholar settings loaded:",e.composite)}catch(e){console.warn("Failed to load DevScholar settings:",e)}function u(e){const t=e.model.sharedModel.getSource();return e instanceof n.CodeCell?s.parseText(t,!0):e instanceof n.MarkdownCell?s.parseText(t,!1):[]}async function m(e){const t=e.content,o=new Map;t.widgets.forEach((e,t)=>{const r=u(e);r.length>0&&(o.set(e.model.id,r),a.highlightCell(e,r),r.forEach(e=>{l.fetchMetadata(e).catch(()=>{})}))}),i.set(e,o);const r=Array.from(o.values()).flat().length;r>0&&console.log(`DevScholar: Found ${r} paper reference(s)`)}function v(e){e.context.ready.then(()=>{var t;m(e);const o=e.content;o.activeCellChanged.connect((t,o)=>{o&&function(e,t){const o=u(t),r=i.get(e)||new Map;o.length>0?(r.set(t.model.id,o),a.highlightCell(t,o),o.forEach(e=>{l.fetchMetadata(e).catch(()=>{})})):(r.delete(t.model.id),a.clearHighlights(t)),i.set(e,r)}(e,o)}),null===(t=o.model)||void 0===t||t.cells.changed.connect(()=>{m(e)})}),e.disposed.connect(()=>{i.delete(e)})}t.forEach(v),t.widgetAdded.connect((e,t)=>{v(t)});const g="devscholar:show-papers";e.commands.addCommand(g,{label:"Show All Paper References",execute:async()=>{const e=t.currentWidget;if(!e)return void console.log("No active notebook");const o=i.get(e);if(!o||0===o.size)return void console.log("No paper references found");const r=Array.from(o.values()).flat();console.log(`Found ${r.length} paper references:`);for(const e of r){const t=await l.fetchMetadata(e);t?console.log(`- ${t.title} (${e.type}:${e.id})`):console.log(`- ${e.type}:${e.id}`)}}});const f="devscholar:search-papers";e.commands.addCommand(f,{label:"Search & Cite Paper",execute:async()=>{console.log("Search papers command executed")}});const y="devscholar:export-bibliography";e.commands.addCommand(y,{label:"Export Bibliography (BibTeX)",execute:async()=>{const e=t.currentWidget;if(!e)return;const o=i.get(e);if(!o||0===o.size)return void console.log("No paper references to export");const r=Array.from(o.values()).flat(),n=[];for(const e of r){const t=await l.fetchMetadata(e);t&&n.push(h(t))}const a=n.join("\n\n");await navigator.clipboard.writeText(a),console.log("Bibliography copied to clipboard!")}}),r&&(r.addItem({command:g,category:"DevScholar"}),r.addItem({command:f,category:"DevScholar"}),r.addItem({command:y,category:"DevScholar"})),console.log("DevScholar: Commands registered")}}}}]);