[build-system]
requires = ["maturin>=1.0,<2.0"]
build-backend = "maturin"

[project]
name = "romcal"
version = "4.0.0-beta.5"
description = "Liturgical calendar library for calculating Catholic liturgical dates and calendars"
readme = "README.md"
license = { text = "Apache-2.0" }
authors = [{ name = "Ã‰tienne Magnier", email = "etienne.magnier@gmail.com" }]
requires-python = ">=3.11"
keywords = ["liturgical", "calendar", "catholic", "roman-rite", "church"]
classifiers = [
  "Development Status :: 4 - Beta",
  "Intended Audience :: Developers",
  "License :: OSI Approved :: Apache Software License",
  "Programming Language :: Python :: 3",
  "Programming Language :: Python :: 3.11",
  "Programming Language :: Python :: 3.12",
  "Programming Language :: Python :: 3.13",
  "Programming Language :: Python :: 3.14",
  "Programming Language :: Rust",
  "Topic :: Religion",
  "Topic :: Software Development :: Libraries :: Python Modules",
]
dependencies = ["pydantic>=2.0"]

[project.optional-dependencies]
dev = ["pytest>=8.0", "taskipy>=1.13", "ruff>=0.8", "mypy>=1.13"]

[project.urls]
Homepage = "https://github.com/emagnier/romcal"
Repository = "https://github.com/emagnier/romcal"
Documentation = "https://github.com/emagnier/romcal#readme"

[tool.maturin]
bindings = "uniffi"
python-source = "src"
module-name = "romcal._uniffi"
manifest-path = "bindings/uniffi/Cargo.toml"

[tool.pytest.ini_options]
testpaths = ["tests"]
pythonpath = ["src"]

[tool.ruff]
line-length = 100
target-version = "py311"
exclude = [
  "src/romcal/types.py",      # Generated by datamodel-codegen
  "src/romcal/_uniffi/*.py",  # Generated by uniffi-bindgen
  "src/romcal/_uniffi/*.pyi", # Generated by stubgen
]

[tool.ruff.lint]
select = [
  "E",   # pycodestyle errors
  "W",   # pycodestyle warnings
  "F",   # Pyflakes
  "I",   # isort
  "UP",  # pyupgrade
  "B",   # flake8-bugbear
  "SIM", # flake8-simplify
  "C4",  # flake8-comprehensions
  "DTZ", # flake8-datetimez
  "T10", # flake8-debugger
  "EM",  # flake8-errmsg
  "PIE", # flake8-pie
  "PT",  # flake8-pytest-style
  "RET", # flake8-return
  "RUF", # Ruff-specific rules
  "TCH", # flake8-type-checking
  "TID", # flake8-tidy-imports
]
ignore = [
  "E501", # line too long (handled by formatter)
]

[tool.ruff.lint.isort]
known-first-party = ["romcal"]

[tool.ruff.format]
quote-style = "double"
indent-style = "space"
docstring-code-format = true

[tool.mypy]
python_version = "3.11"
strict = true

[[tool.mypy.overrides]]
module = [
  "romcal.types",    # Generated by datamodel-codegen
  "romcal._uniffi.*" # Generated by uniffi-bindgen
]
ignore_errors = true

[[tool.mypy.overrides]]
module = "romcal"
# FFI module uses "module as type" pattern which mypy doesn't understand
disable_error_code = ["no-any-return", "attr-defined", "valid-type"]

[tool.taskipy.tasks]
build = "maturin build --release"
develop = "maturin develop && task generate-stubs"
generate-stubs = "stubgen src/romcal/_uniffi/romcal_uniffi.py -o src/"
generate-types = "datamodel-codegen --input ../../schemas/all_types.json --output src/romcal/types.py --target-python-version 3.10 --use-standard-collections --output-model-type pydantic_v2.BaseModel --field-constraints --use-annotated --base-class pydantic.BaseModel --enum-field-as-literal one --disable-timestamp --use-schema-description --use-field-description && ruff format src/romcal/types.py"
test = "pytest tests/ -v"
test-run = "pytest tests/"
format = "ruff format ."
format-check = "ruff format --check ."
lint = "ruff check ."
lint-fix = "ruff check --fix ."
typecheck = "mypy src/"

[dependency-groups]
dev = [
    "datamodel-code-generator>=0.50.0",
]
