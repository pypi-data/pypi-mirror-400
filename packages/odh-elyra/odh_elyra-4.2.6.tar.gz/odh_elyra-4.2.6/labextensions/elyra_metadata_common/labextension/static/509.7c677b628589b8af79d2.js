"use strict";(self.webpackChunk_elyra_metadata_common=self.webpackChunk_elyra_metadata_common||[]).push([[509,453,55],{21411:(e,t,a)=>{a.d(t,{A:()=>o});var n=a(36758),r=a.n(n),i=a(40935),s=a.n(i)()(r());s.push([e.id,'/*\n * Copyright 2018-2023 Elyra Authors\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* MetadataWidget CSS */\n.elyra-metadata {\n  color: var(--jp-ui-font-color1);\n  background: var(--jp-layout-color1);\n}\n\n.elyra-metadata a,\n.elyra-metadataEditor a {\n  color: var(--jp-content-link-color);\n}\n\n.elyra-metadataHeader {\n  font-weight: bold;\n  padding: 2px 6px 2px 12px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.elyra-metadataHeader p {\n  font-weight: bold;\n}\n\nbutton.elyra-metadataHeader-button {\n  border: none;\n  margin: 5px 0;\n  padding: 5px;\n  background: none;\n}\n\n.elyra-metadataHeader-buttons {\n  display: flex;\n  align-items: center;\n}\n\n.elyra-metadataHeader-buttonDivider {\n  width: 0.05em;\n  height: 1.5em;\n  position: relative;\n  background-color: var(--jp-border-color1);\n}\n\n.elyra-metadataHeader-popper button {\n  border: none;\n  width: max-content;\n  padding: 7px 9px;\n  background: none;\n  cursor: pointer;\n}\n\n.elyra-metadataHeader-popper button:hover {\n  background-color: var(--jp-border-color3);\n}\n\n.elyra-metadataHeader-popper {\n  z-index: 100;\n  background-color: var(--jp-cell-editor-active-background);\n  border-radius: 10%;\n  border-radius: 8px;\n  border: 1px solid var(--jp-border-color2);\n}\n\n.elyra-metadataHeader-button:hover {\n  background-color: var(--jp-layout-color2);\n  cursor: pointer;\n}\n\n.elyra-metadataHeader [fill] {\n  fill: var(--jp-ui-font-color1);\n}\n\n.elyra-metadataHeader + div:first-of-type {\n  overflow-y: auto;\n  height: calc(100vh - 95px);\n}\n\n.elyra-metadata-item {\n  border-bottom: var(--jp-border-width) solid var(--jp-border-color2);\n  display: flex;\n  flex-direction: column;\n  margin: 0;\n  padding: 0;\n}\n\n.elyra-metadata-item .elyra-expandableContainer-details-visible {\n  background-color: var(--jp-cell-editor-background);\n  resize: vertical;\n}\n\n.elyra-metadata-item .CodeMirror.cm-s-jupyter {\n  background-color: inherit;\n  border: none;\n  font-family: var(--jp-code-font-family);\n  font-size: var(--jp-code-font-size);\n  line-height: var(--jp-code-line-height);\n}\n\n.elyra-metadata-item .cm-s-jupyter li .cm-string {\n  word-break: normal;\n}\n\n/* Metadata Editor CSS (a lot of the style for the metadata editor is in\n * the ui-components package under formeditor.css\n */\n.elyra-metadataEditor {\n  padding: 20px;\n  display: flex;\n  flex-wrap: wrap;\n  height: 100%;\n  align-content: flex-start;\n  align-items: flex-start;\n  justify-content: flex-start;\n  color: var(--jp-ui-font-color1);\n}\n\n/* Code Snippet Filter CSS */\n.elyra-searchbar {\n  margin: 0px 8px;\n}\n\n.elyra-filterTools {\n  border-bottom: var(--jp-border-width) solid var(--jp-border-color1);\n}\n\nmark.elyra-search-bolding {\n  background-color: transparent;\n  font-weight: bold;\n  color: var(--jp-ui-font-color0);\n}\n\n.elyra-filter {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  margin: 10px 10px 0 10px;\n}\n\n.elyra-filter .elyra-filter-btn {\n  align-self: flex-end;\n  padding: 0px;\n  margin-bottom: 5px;\n  border-radius: 5px;\n  border: none;\n  background: none;\n  cursor: pointer;\n}\n\n.elyra-filter .elyra-filter-btn:hover {\n  background-color: var(--jp-layout-color2);\n}\n\n.elyra-filter-btn svg {\n  display: block;\n  width: 30px;\n  height: 22px;\n}\n\n.elyra-filter-arrow-up.idle,\n.elyra-filter-option.idle {\n  display: none;\n}\n\n.elyra-filter-arrow-up {\n  position: absolute;\n  margin-top: 16px;\n  margin-right: 38px;\n  align-self: flex-end;\n  background-color: var(--jp-layout-color0);\n}\n\n.elyra-filter-option {\n  border: var(--jp-border-width) solid var(--jp-border-color1);\n  height: 140px;\n  width: 100%;\n  margin-bottom: 10px;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow: auto;\n}\n\n.elyra-filter-tags {\n  margin: 8px 8px;\n}\n\n.elyra-filter-tag {\n  margin-left: 3px;\n  margin-right: 3px;\n}\n\nbutton.elyra-filter-tag {\n  height: 24px;\n  padding: 0 12px;\n  cursor: pointer;\n  color: var(--jp-ui-font-color2);\n  font-size: var(--jp-ui-font-size1);\n}\n\nbutton.elyra-filter-tag .elyra-filter-tag-label {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\nbutton.elyra-filter-tag span,\nbutton.elyra-filter-tag svg {\n  pointer-events: none;\n}\n\n.elyra-filter-empty {\n  font-size: var(--jp-ui-font-size1);\n}\n\n.elyra-tools {\n  border-bottom: var(--jp-border-width) solid var(--jp-border-color1);\n}\n\n.elyra-metadataEditor-saveButton button {\n  background: none;\n  border: 1px solid var(--jp-border-color1);\n  border-radius: 3px;\n  padding: 10px;\n  font-size: var(--jp-content-font-size2);\n  width: fit-content;\n  color: var(--jp-content-font-color0);\n  cursor: pointer;\n}\n\n.elyra-metadataEditor-saveButton button:hover {\n  background: var(--jp-border-color3);\n}\n\n.elyra-metadataEditor-saveButton.errorForm {\n  color: var(--jp-content-font-color3);\n}\n\n.elyra-metadataEditor-saveButton.errorForm button {\n  border-color: var(--jp-content-font-color3);\n  cursor: not-allowed;\n}\n\n.elyra-no-metadata-msg {\n  padding-left: 8px;\n}\n',""]);const o=s},40935:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var a="",n=void 0!==t[5];return t[4]&&(a+="@supports (".concat(t[4],") {")),t[2]&&(a+="@media ".concat(t[2]," {")),n&&(a+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),a+=e(t),n&&(a+="}"),t[2]&&(a+="}"),t[4]&&(a+="}"),a})).join("")},t.i=function(e,a,n,r,i){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(n)for(var o=0;o<this.length;o++){var l=this[o][0];null!=l&&(s[l]=!0)}for(var d=0;d<e.length;d++){var c=[].concat(e[d]);n&&s[c[0]]||(void 0!==i&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=i),a&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=a):c[2]=a),r&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=r):c[4]="".concat(r)),t.push(c))}},t}},36758:e=>{e.exports=function(e){return e[1]}},13453:(e,t,a)=>{a.r(t),a.d(t,{default:()=>v});var n=a(72591),r=a.n(n),i=a(1740),s=a.n(i),o=a(88128),l=a.n(o),d=a(30855),c=a.n(d),p=a(93051),h=a.n(p),u=a(73656),m=a.n(u),f=a(21411),g={};g.styleTagTransform=m(),g.setAttributes=c(),g.insert=l().bind(null,"head"),g.domAPI=s(),g.insertStyleElement=h(),r()(f.A,g);const v=f.A&&f.A.locals?f.A.locals:void 0},72591:e=>{var t=[];function a(e){for(var a=-1,n=0;n<t.length;n++)if(t[n].identifier===e){a=n;break}return a}function n(e,n){for(var i={},s=[],o=0;o<e.length;o++){var l=e[o],d=n.base?l[0]+n.base:l[0],c=i[d]||0,p="".concat(d," ").concat(c);i[d]=c+1;var h=a(p),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(u);else{var m=r(u,n);n.byIndex=o,t.splice(o,0,{identifier:p,updater:m,references:1})}s.push(p)}return s}function r(e,t){var a=t.domAPI(t);return a.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;a.update(e=t)}else a.remove()}}e.exports=function(e,r){var i=n(e=e||[],r=r||{});return function(e){e=e||[];for(var s=0;s<i.length;s++){var o=a(i[s]);t[o].references--}for(var l=n(e,r),d=0;d<i.length;d++){var c=a(i[d]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}i=l}}},88128:e=>{var t={};e.exports=function(e,a){var n=function(e){if(void 0===t[e]){var a=document.querySelector(e);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(e){a=null}t[e]=a}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(a)}},93051:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},30855:(e,t,a)=>{e.exports=function(e){var t=a.nc;t&&e.setAttribute("nonce",t)}},1740:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(a){!function(e,t,a){var n="";a.supports&&(n+="@supports (".concat(a.supports,") {")),a.media&&(n+="@media ".concat(a.media," {"));var r=void 0!==a.layer;r&&(n+="@layer".concat(a.layer.length>0?" ".concat(a.layer):""," {")),n+=a.css,r&&(n+="}"),a.media&&(n+="}"),a.supports&&(n+="}");var i=a.sourceMap;i&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,a)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},73656:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},14120:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FilterTools=void 0;const r=a(17151),i=a(87460),s=n(a(93345)),o="elyra-filter-option",l="elyra-filter-tags",d="elyra-filter-tag",c="elyra-filter-tag-label";class p extends s.default.Component{constructor(e){super(e),this.handleSearch=e=>{this.setState({searchValue:e.target.value},this.filterMetadata)},this.state={selectedTags:[],searchValue:""},this.createFilterBox=this.createFilterBox.bind(this),this.renderFilterOption=this.renderFilterOption.bind(this),this.renderTags=this.renderTags.bind(this),this.renderAppliedTag=this.renderAppliedTag.bind(this),this.renderUnappliedTag=this.renderUnappliedTag.bind(this),this.handleClick=this.handleClick.bind(this),this.filterMetadata=this.filterMetadata.bind(this)}componentDidMount(){this.setState({selectedTags:[],searchValue:""})}componentDidUpdate(e){e!==this.props&&this.setState((e=>({selectedTags:e.selectedTags.filter((e=>this.props.tags.includes(e))).sort()})))}createFilterBox(){const e=document.querySelector(`#${this.props.schemaspace} .${o}`);null==e||e.classList.toggle("idle"),this.filterMetadata()}renderTags(){return this.props.tags.length?s.default.createElement("div",{className:l},this.props.tags.sort().map(((e,t)=>this.state.selectedTags.includes(e)?this.renderAppliedTag(e,t.toString()):this.renderUnappliedTag(e,t.toString())))):s.default.createElement("div",{className:l},s.default.createElement("p",{className:"elyra-filter-empty"},"No tags defined"))}renderAppliedTag(e,t){return s.default.createElement("button",{className:`${d} jp-CellTags-Tag jp-CellTags-Applied`,id:"filter-"+e+"-"+t,key:"filter-"+e+"-"+t,title:e,onClick:this.handleClick},s.default.createElement("span",{className:c},e),s.default.createElement(i.checkIcon.react,{className:"elyra-filter-check",tag:"span",elementPosition:"center",height:"18px",width:"18px",marginLeft:"5px",marginRight:"-3px"}))}renderUnappliedTag(e,t){return s.default.createElement("button",{className:`${d} jp-CellTags-Tag jp-CellTags-Unapplied`,id:"filter-"+e+"-"+t,key:"filter-"+e+"-"+t,title:e,onClick:this.handleClick},s.default.createElement("span",{className:c},e))}handleClick(e){var t;const a=e.target,n=null!==(t=a.textContent)&&void 0!==t?t:"";this.setState((e=>({selectedTags:this.updateTagsCss(a,e.selectedTags,n)})),this.filterMetadata)}updateTagsCss(e,t,a){if(e.classList.contains("jp-CellTags-Unapplied"))e.classList.replace("jp-CellTags-Unapplied","jp-CellTags-Applied"),t.splice(-1,0,a);else if(e.classList.contains("jp-CellTags-Applied")){e.classList.replace("jp-CellTags-Applied","jp-CellTags-Unapplied");const n=t.indexOf(a);t.splice(n,1)}return t.sort()}filterMetadata(){var e;const t=null===(e=document.querySelector(`#${this.props.schemaspace} .${o}`))||void 0===e?void 0:e.classList.contains("idle");this.props.onFilter(this.state.searchValue,t?[]:this.state.selectedTags)}renderFilterOption(){return s.default.createElement("div",{className:`${o} idle`},this.renderTags())}render(){return s.default.createElement("div",{className:"elyra-filterTools"},s.default.createElement("div",{className:"elyra-searchbar"},s.default.createElement(i.InputGroup,{className:"elyra-searchwrapper",type:"text",placeholder:"Search...",onChange:this.handleSearch,rightIcon:"ui-components:search",value:this.state.searchValue})),this.props.omitTags?s.default.createElement("div",{style:{height:"4px"}}):s.default.createElement("div",{className:"elyra-filter",id:this.props.schemaspace},s.default.createElement("button",{title:"Filter by tag",className:"elyra-filter-btn",onClick:this.createFilterBox},s.default.createElement(r.tagIcon.react,null)),this.renderFilterOption()))}}t.FilterTools=p},46626:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataCommonService=void 0;const n=a(20133);t.MetadataCommonService=class{static duplicateMetadataInstance(e,t,a){let r=t.display_name;null!==t.display_name.match(/-Copy\d+$/)&&(r=r.replace(/-Copy\d+$/,""));let i=1;for(;void 0!==a.find((e=>e.display_name===`${r}-Copy${i}`));)i+=1;const s=JSON.parse(JSON.stringify(t));return s.display_name=`${r}-Copy${i}`,delete s.name,n.MetadataService.postMetadata(e,JSON.stringify(s))}}},66281:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataEditor=void 0;const s=a(20133),o=a(17151),l=i(a(93345));t.MetadataEditor=({editorServices:e,schemaspace:t,onSave:a,schemaName:n,schemaTop:r,initialMetadata:i,translator:d,name:c,setDirty:p,close:h,allTags:u,componentRegistry:m,getDefaultChoices:f,titleContext:g})=>{var v,y;const[b,E]=l.useState(void 0===c),M=r.properties.metadata,[C,_]=l.useState(i),T=null===(v=null==i?void 0:i._noCategory)||void 0===v?void 0:v.display_name,x=null===(y=r.uihints)||void 0===y?void 0:y.reference_url,S=()=>{var e;if(b)return;const r={schema_name:n,display_name:null===(e=null==C?void 0:C._noCategory)||void 0===e?void 0:e.display_name,metadata:j(C)};c?s.MetadataService.putMetadata(t,c,JSON.stringify(r)).then((e=>{p(!1),a(),h()})).catch((e=>o.RequestErrors.serverError(e))):s.MetadataService.postMetadata(t,JSON.stringify(r)).then((e=>{p(!1),a(),h()})).catch((e=>o.RequestErrors.serverError(e)))};let w=`Edit "${T}"`;T||(w=`Add new ${r.title} ${null!=g?g:""}`);const j=e=>{const t={};for(const a in e)for(const n in e[a])t[n]=e[a][n];return t};return l.createElement("div",{onKeyPress:e=>{const t=e.nativeEvent.target;"Enter"===e.key&&"TEXTAREA"!==(null==t?void 0:t.tagName)&&S()},className:"elyra-metadataEditor"},l.createElement("h3",null," ",w," "),l.createElement("p",{style:{width:"100%",marginBottom:"10px"}},d.__("All fields marked with an asterisk are required."),"Â ",x?l.createElement("a",{href:x,target:"_blank",rel:"noreferrer noopener"},d.__("[Learn more ...]")):null),l.createElement(o.FormEditor,{schema:M,onChange:(e,t)=>{_(e),E(t),p(!0)},componentRegistry:m,translator:d,editorServices:e,originalData:C,allTags:u,languageOptions:f("language")}),l.createElement("div",{className:"elyra-metadataEditor-formInput elyra-metadataEditor-saveButton "+(b?"errorForm":""),key:"SaveButton"},b?l.createElement("p",{className:"formError"},d.__("Cannot save invalid form.")):l.createElement("div",null),l.createElement("button",{onClick:()=>{S()}},d.__("Save & Close"))))}},301:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},s=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function o(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataEditorWidget=void 0;const o=a(20133),l=a(17151),d=a(12200),c=a(64053),p=i(a(93345)),h=a(66281),u="jp-mod-dirty";class m extends d.ReactWidget{constructor(e){var t;super(),this.schema={},this.metadata={},this.loading=!0,this.dirty=!1,this.allTags=[],this.props=e,this.widgetClass=`elyra-metadataEditor-${null!==(t=e.name)&&void 0!==t?t:"new"}`,this.addClass(this.widgetClass),this.getDefaultChoices=this.getDefaultChoices.bind(this),this.handleDirtyState=this.handleDirtyState.bind(this),this.close=this.close.bind(this),this.loadSchemaAndMetadata()}loadSchemaAndMetadata(){var e,t,a,n,r,i,d;return s(this,void 0,void 0,(function*(){try{const s=yield o.MetadataService.getSchema(this.props.schemaspace),l=this.allMetadata=yield o.MetadataService.getMetadata(this.props.schemaspace);this.allTags=l.reduce(((e,t)=>(t.metadata.tags&&e.push(...t.metadata.tags.filter((t=>!e.includes(t)))),e)),[]);const c=null!==(e=s.find((e=>e.name===this.props.schemaName)))&&void 0!==e?e:{},p=c.properties.metadata.properties;for(const e in p)(null===(t=p[e].uihints)||void 0===t?void 0:t.hidden)?delete p[e]:void 0!==p[e].const&&(p[e].default=p[e].const,p[e].uihints={"ui:readonly":!0});const h=l.find((e=>e.name===this.props.name)),u={},m={_noCategory:{type:"object",title:" ",properties:{display_name:{title:this.props.translator.__("Display Name"),description:this.props.translator.__("Name used to identify an instance of metadata."),type:"string"}},required:["display_name"]}},f=[];for(const e in c.properties.metadata.properties){const t=c.properties.metadata.properties[e],s=null!==(a=t.uihints&&t.uihints.category)&&void 0!==a?a:"_noCategory";u[s]||(u[s]={}),u[s][e]=null!==(r=null===(n=null==h?void 0:h.metadata)||void 0===n?void 0:n[e])&&void 0!==r?r:t.default,"code"===e&&this.props.code&&(u[s][e]=this.props.code),m[s]||(m[s]={type:"object",properties:{},required:[]}),(null===(i=c.properties.metadata.required)||void 0===i?void 0:i.includes(e))&&(m[s].required.push(e),f.includes(s)||f.push(s)),m[s].properties[e]=t}u._noCategory&&(u._noCategory.display_name=null==h?void 0:h.display_name),this.schema=c,this.schema.properties.metadata.properties=m,this.schema.properties.metadata.required=f,this.metadata=u,this.title.label=null!==(d=null==h?void 0:h.display_name)&&void 0!==d?d:`New ${this.schema.title}`,this.loading=!1,this.update()}catch(e){l.RequestErrors.serverError(e)}}))}setFormFocus(){var e;if(!(null===(e=document.querySelector(`.${this.widgetClass}`))||void 0===e?void 0:e.contains(document.activeElement))){const e=document.querySelector(`.${this.widgetClass} .display_nameField input`);e&&(e.focus(),e.setSelectionRange(e.value.length,e.value.length))}}onAfterShow(e){this.setFormFocus()}onUpdateRequest(e){super.onUpdateRequest(e),this.setFormFocus()}handleDirtyState(e){this.dirty=e,e&&!this.clearDirty?this.clearDirty=this.props.status.setDirty():!e&&this.clearDirty&&(this.clearDirty.dispose(),this.clearDirty=null),e&&!this.title.className.includes(u)?this.title.className+=u:e||(this.title.className=this.title.className.replace(u,""))}onCloseRequest(e){this.dirty?(0,d.showDialog)({title:this.props.translator.__("Close without saving?"),body:p.createElement("p",null,"Metadata has unsaved changes, close without saving?"),buttons:[d.Dialog.cancelButton(),d.Dialog.okButton()]}).then((t=>{t.button.accept&&(this.dispose(),super.onCloseRequest(e))})):(this.dispose(),super.onCloseRequest(e))}getDefaultChoices(e){var t;const a=this.schema.properties.metadata;for(const n in a.properties){const r=a.properties[n].properties[e];if(!r)continue;const i=Object.assign([],r.uihints.default_choices)||[];for(const a of this.allMetadata)a!==(null===(t=this.metadata)||void 0===t?void 0:t.metadata)&&a.metadata[e]&&!(0,c.find)(i,(t=>t.toLowerCase()===a.metadata[e].toLowerCase()))&&i.push(a.metadata[e]);return i}return[]}render(){return this.loading?p.createElement("p",null,"Loading..."):p.createElement(h.MetadataEditor,Object.assign({},this.props,{schemaTop:this.schema,initialMetadata:this.metadata,setDirty:this.handleDirtyState,close:this.close,allTags:this.allTags,getDefaultChoices:this.getDefaultChoices}))}}t.MetadataEditorWidget=m},21656:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function o(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,o)}l((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataWidget=t.MetadataDisplay=t.METADATA_ITEM=t.METADATA_HEADER_CLASS=t.METADATA_CLASS=void 0;const i=a(20133),s=a(17151),o=a(12200),l=a(87460),d=a(74602),c=r(a(93345)),p=a(14120),h=a(46626);t.METADATA_CLASS="elyra-metadata",t.METADATA_HEADER_CLASS="elyra-metadataHeader",t.METADATA_ITEM="elyra-metadata-item";const u="elyra-metadataHeader-button";class m extends c.default.Component{constructor(e){super(e),this.deleteMetadata=e=>(0,o.showDialog)({title:`Delete ${this.props.labelName?this.props.labelName(e):""} ${this.props.titleContext||""} '${e.display_name}'?`,buttons:[o.Dialog.cancelButton(),o.Dialog.okButton()]}).then((t=>{t.button.accept&&i.MetadataService.deleteMetadata(this.props.schemaspace,e.name).catch((e=>s.RequestErrors.serverError(e)))})),this.renderMetadata=e=>c.default.createElement("div",{key:e.name,className:t.METADATA_ITEM,style:this.state.metadata.includes(e)?{}:{display:"none"}},c.default.createElement(s.ExpandableComponent,{displayName:e.display_name,tooltip:e.metadata.description,actionButtons:this.actionButtons(e)},c.default.createElement("div",{id:e.name},this.renderExpandableContent(e)))),this.filteredMetadata=(e,t)=>{let a=this.props.metadata.filter(((t,a,n)=>t.name.toLowerCase().includes(e.toLowerCase())||t.display_name.toLowerCase().includes(e.toLowerCase())));0!==t.length&&(a=a.filter((e=>t.some((t=>!!e.metadata.tags&&e.metadata.tags.includes(t)))))),this.setState({metadata:a,searchValue:e,filterTags:t})},this.state={metadata:e.metadata,searchValue:"",filterTags:[],matchesSearch:this.matchesSearch.bind(this),matchesTags:this.matchesTags.bind(this)}}actionButtons(e){return[{title:"Edit",icon:l.editIcon,onClick:()=>{this.props.openMetadataEditor({onSave:this.props.updateMetadata,schemaspace:this.props.schemaspace,schema:e.schema_name,name:e.name})}},{title:"Duplicate",icon:l.copyIcon,onClick:()=>{h.MetadataCommonService.duplicateMetadataInstance(this.props.schemaspace,e,this.props.metadata).then((e=>{this.props.updateMetadata()})).catch((e=>s.RequestErrors.serverError(e)))}},{title:"Delete",icon:s.trashIcon,onClick:()=>{this.deleteMetadata(e).then((e=>{this.props.updateMetadata()}))}}]}renderExpandableContent(e){const t=e.metadata;return delete t.tags,c.default.createElement("div",{className:"jp-RenderedJSON CodeMirror cm-s-jupyter"},c.default.createElement(s.JSONComponent,{json:t}))}sortMetadata(){this.props.metadata.sort(((e,t)=>e.display_name.localeCompare(t.display_name)))}getActiveTags(){const e=[];for(const t of this.props.metadata)if(t.metadata.tags)for(const a of t.metadata.tags)e.includes(a)||e.push(a);return e}matchesTags(e,t){return 0===e.size||t.metadata.tags&&t.metadata.tags.some((t=>e.has(t)))}matchesSearch(e,t){return e=e.toLowerCase(),t.name.toLowerCase().includes(e)||t.display_name.toLowerCase().includes(e)}static getDerivedStateFromProps(e,t){if(""===t.searchValue&&0===t.filterTags.length)return{metadata:e.metadata,searchValue:"",filterTags:[],matchesSearch:t.matchesSearch,matchesTags:t.matchesTags};if(""!==t.searchValue||0!==t.filterTags.length){const a=new Set(t.filterTags),n=t.searchValue.toLowerCase().trim();return{metadata:e.metadata.filter((e=>t.matchesSearch(n,e)&&t.matchesTags(a,e))),searchValue:t.searchValue,filterTags:t.filterTags,matchesSearch:t.matchesSearch,matchesTags:t.matchesTags}}return t}render(){return this.props.sortMetadata&&this.sortMetadata(),c.default.createElement("div",{id:"elyra-metadata",className:this.props.className},c.default.createElement(p.FilterTools,{onFilter:this.filteredMetadata,tags:this.getActiveTags(),omitTags:this.props.omitTags,schemaspace:`${this.props.schemaspace}`}),c.default.createElement("div",null,this.props.metadata.map(this.renderMetadata)))}}t.MetadataDisplay=m;class f extends o.ReactWidget{constructor(e){super(),this.openMetadataEditor=e=>{this.props.app.commands.execute("elyra-metadata-editor:open",e)},this.addClass("elyra-metadata"),this.props=e,this.renderSignal=new d.Signal(this),this.titleContext=e.titleContext,this.addLabel=e.addLabel,this.fetchMetadata=this.fetchMetadata.bind(this),this.getSchemas=this.getSchemas.bind(this),this.updateMetadata=this.updateMetadata.bind(this),this.refreshMetadata=this.refreshMetadata.bind(this),this.openMetadataEditor=this.openMetadataEditor.bind(this),this.renderDisplay=this.renderDisplay.bind(this),this.addMetadata=this.addMetadata.bind(this),this.getSchemas()}getSchemas(){var e,t;return n(this,void 0,void 0,(function*(){try{this.schemas=yield i.MetadataService.getSchema(this.props.schemaspace);const a=null!==(t=null===(e=this.schemas)||void 0===e?void 0:e.sort(((e,t)=>e.title.localeCompare(t.title))))&&void 0!==t?t:[];if(a.length>1)for(const e of a)this.props.app.contextMenu.addItem({selector:`#${this.props.schemaspace} .elyra-metadataHeader-addButton`,command:"elyra-metadata-editor:open",args:{onSave:this.updateMetadata,schemaspace:this.props.schemaspace,schema:e.name,title:e.title,titleContext:this.props.titleContext,addLabel:this.props.addLabel,appendToTitle:this.props.appendToTitle}});this.update()}catch(e){s.RequestErrors.serverError(e)}}))}addMetadata(e,t){this.openMetadataEditor({onSave:this.updateMetadata,schemaspace:this.props.schemaspace,schema:e,titleContext:t})}fetchMetadata(){return n(this,void 0,void 0,(function*(){try{return yield i.MetadataService.getMetadata(this.props.schemaspace)}catch(e){return s.RequestErrors.serverError(e)}}))}updateMetadata(){this.fetchMetadata().then((e=>{this.renderSignal.emit(e)}))}refreshMetadata(){this.updateMetadata()}onAfterShow(e){this.updateMetadata()}omitTags(){var e,t,a,n;for(const r of null!==(e=this.schemas)&&void 0!==e?e:[])if(null===(n=null===(a=null===(t=r.properties)||void 0===t?void 0:t.metadata)||void 0===a?void 0:a.properties)||void 0===n?void 0:n.tags)return!1;return!0}renderDisplay(e){return Array.isArray(e)&&!e.length?c.default.createElement("div",null,c.default.createElement("br",null),c.default.createElement("h6",{className:"elyra-no-metadata-msg"},"Click the + button to add ",this.props.display_name.toLowerCase())):c.default.createElement(m,{metadata:e,updateMetadata:this.updateMetadata,openMetadataEditor:this.openMetadataEditor,schemaspace:this.props.schemaspace,sortMetadata:!0,className:`${t.METADATA_CLASS}-${this.props.schemaspace}`,omitTags:this.omitTags(),titleContext:this.props.titleContext})}render(){var e,a;const n=1===(null===(e=this.schemas)||void 0===e?void 0:e.length);return c.default.createElement("div",{id:this.props.schemaspace,className:t.METADATA_CLASS},c.default.createElement("header",{className:t.METADATA_HEADER_CLASS},c.default.createElement("div",{style:{display:"flex"}},c.default.createElement(this.props.icon.react,{tag:"span",width:"auto",height:"24px",verticalAlign:"middle",marginRight:"5px"}),c.default.createElement("p",null," ",this.props.display_name," ")),c.default.createElement("div",{className:"elyra-metadataHeader-buttons"},c.default.createElement("button",{className:u,onClick:()=>{this.refreshMetadata()},title:null!==(a=this.refreshButtonTooltip)&&void 0!==a?a:"Refresh list"},c.default.createElement(l.refreshIcon.react,{tag:"span",elementPosition:"center",width:"16px"})),c.default.createElement("div",{className:"elyra-metadataHeader-buttonDivider"}),c.default.createElement("button",{className:`${u} elyra-metadataHeader-addButton`,onClick:n?()=>{var e;return this.addMetadata(null===(e=this.schemas)||void 0===e?void 0:e[0].name,this.titleContext)}:e=>{this.props.app.contextMenu.open(e)},title:`Create new ${this.addLabel}`},c.default.createElement(l.addIcon.react,{tag:"span",elementPosition:"center",width:"16px"})))),c.default.createElement(o.UseSignal,{signal:this.renderSignal,initialArgs:[]},((e,t)=>this.renderDisplay(t))))}}t.MetadataWidget=f},8509:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__exportStar||function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||n(t,e,a)};Object.defineProperty(t,"__esModule",{value:!0}),a(13453),r(a(66281),t),r(a(21656),t),r(a(46626),t),r(a(301),t)}}]);