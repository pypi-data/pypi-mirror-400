var ee=Object.defineProperty;var te=(t,e,r)=>e in t?ee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var v=(t,e,r)=>(te(t,typeof e!="symbol"?e+"":e,r),r);import{bV as se,bg as K,r as n,j as i,ac as T,ax as I,b8 as re,aR as ne,l as oe,aj as ie,B as Y}from"./index-4cf586ed.js";import{B as L,C as j,g as ae,Y as O,T as ce}from"./index-19c84627.js";import{q as ue,o as le,v as V,L as de}from"./hooks-e7539055.js";function w(t,e){return typeof t=="function"?t(e):t}function fe(t,e){const[r,s]=se(()=>e?e(w(t)):t),o=K(e);return[r,n.useCallback(a=>{o.current?s(u=>{var l;return(l=o.current)==null?void 0:l.call(o,w(a,u))}):s(a)},[])]}function he(t=0,e,r){const[s,o]=fe(t,u=>(e!==void 0&&(u=Math.min(e,u)),r!==void 0&&(u=Math.max(r,u)),u)),a=K(s);return[s,n.useMemo(()=>({get:()=>a.current,set:o,dec:(u=1)=>{o(l=>l-w(u,l))},inc:(u=1)=>{o(l=>l+w(u,l))},reset:(u=t)=>{o(l=>w(u,l))}}),[t,o,a])]}function ge(){return i.jsx("div",{className:"separator"})}function we(t){const e=t.spacing??.2,s={center:"center",left:"flex-start",right:"flex-end"}[t.align??"left"];return i.jsx("div",{className:"toolbar",style:{justifyContent:s,gap:`${e}em`,...t.style},children:t.children})}const Ce=n.forwardRef((t,e)=>{const{onVisViewpointChange:r}=t,s=T(f=>f.camera),o=T(f=>f.invalidate),a=ue(),u=le(),[l,{inc:x}]=he(),b=n.useRef(0),R=n.useRef({center:new I,scale:new I});return n.useLayoutEffect(o,[l,o]),n.useImperativeHandle(e,()=>({getCameraViewpoint:()=>u(),updateCameraViewpoint:f=>{const{position:h,scale:d}=a(f);(!V(s.position,h,1e-10,1e-10)||!V(s.scale,d,1e-10,1e-10))&&(s.position.copy(h),s.scale.copy(d),s.updateMatrixWorld(),x())},setScale:f=>{s.scale.x=f,s.scale.y=f,s.updateMatrixWorld(),x()},isZoomed:()=>s.scale.x<1||s.scale.y<1,resetZoom:()=>{s.scale.x=1,s.scale.y=1,s.position.x=0,s.position.y=0,s.updateMatrixWorld(),x()}})),re(()=>{if(b.current!==l){b.current=l;return}if(r!==void 0){const{center:f,scale:h}=u(),d=R.current;R.current={center:f,scale:h},(!V(d.center,f,1e-10,1e-10)||!V(d.scale,h,1e-10,1e-10))&&r(f,h)}}),null});class pe{constructor(e,r){v(this,"counter");v(this,"hoveredRois");v(this,"currentUid");v(this,"topUid");v(this,"disabled");v(this,"onMouseInteractionOverlayChanged");v(this,"setCursor");this.counter=1,this.currentUid=void 0,this.hoveredRois={},this.onMouseInteractionOverlayChanged=e,this.setCursor=r,this.disabled=!1}setDisabled(e){this.disabled=e,e&&this.currentUid&&this.release(this.currentUid),this.updateTopUid()}register(e,r,s,o){const a=`interaction_${this.counter++}`;return this.hoveredRois[a]={priority:e,pointer:r,onEnter:s,onLeave:o},this.updateTopUid(),a}unregister(e){var s;const r=this.hoveredRois[e];r!==void 0&&(delete this.hoveredRois[e],this.topUid===e&&((s=r.onLeave)==null||s.call(r),this.topUid=void 0),this.updateTopUid())}setCurrent(e){this.currentUid=e,this.updateCursor()}updateTopUid(){var r,s,o;const e=this.disabled?void 0:this.computeTopUid();if(this.topUid!==e){if(this.currentUid===void 0&&this.topUid!==void 0){const a=this.hoveredRois[this.topUid];(r=a.onLeave)==null||r.call(a)}if(this.topUid=e,this.currentUid===void 0&&this.topUid!==void 0){const a=this.hoveredRois[this.topUid];(s=a.onEnter)==null||s.call(a)}}(o=this.onMouseInteractionOverlayChanged)==null||o.call(this,e),this.updateCursor()}updateCursor(){var r,s;const e=this.currentUid??this.topUid;if(e===void 0)(r=this.setCursor)==null||r.call(this,void 0);else{const o=this.hoveredRois[e];(s=this.setCursor)==null||s.call(this,o.pointer)}}isCurrent(e){return this.currentUid===void 0?!1:this.currentUid===e}computeTopUid(){let e,r;for(const[s,o]of Object.entries(this.hoveredRois))(r===void 0||o.priority>r)&&(e=s,r=o.priority);return e}capture(e){return this.disabled||this.currentUid!==void 0||this.topUid!==e?!1:(this.setCurrent(e),!0)}release(e){this.setCurrent(void 0)}}function me(t){return t.zoomMode?i.jsxs(i.Fragment,{children:[i.jsx(L,{disabled:t.disabled,button:j.Middle}),i.jsx(ae,{disabled:t.disabled}),i.jsx(O,{})]}):t.panMode?i.jsxs(i.Fragment,{children:[i.jsx(L,{disabled:t.disabled,button:[j.Left,j.Middle]}),i.jsx(O,{})]}):i.jsxs(i.Fragment,{children:[i.jsx(L,{disabled:t.disabled,button:j.Middle}),i.jsx(O,{})]})}function ve(t){const{cursor:e}=t,r=T(s=>s.gl.domElement);return n.useEffect(()=>{r.style.cursor=e},[r,e]),i.jsx(i.Fragment,{})}const W=n.createContext(null);function Re(){try{const t=n.useContext(W);if(t===null){console.error("LinearVisCanvasContext not found");return}return t}catch{console.error("LinearVisCanvasContext not found");return}}function Ue(t){const{className:e,title:r,children:s,mouseMode:o="zoom",onMouseInteractionOverlayChanged:a,plotRef:u,showAxes:l,abscissaConfig:x,ordinateConfig:b,style:R,...f}=t,h=n.useMemo(()=>({zoom:"crosshair",pan:"all-scroll",...t.cursors}),[t.cursors]),d=n.useRef(null),[z,D]=n.useState(),[m,$]=n.useState();n.useEffect(()=>{const c=h[o];D(c)},[h,o]);const G=n.useCallback(c=>{a==null||a(c)},[a]),U=n.useRef(new pe(G,$)),H=n.useMemo(()=>{function c(){return!(x.flip!==b.flip)||m===void 0?m:{"nesw-resize":"nwse-resize","nwse-resize":"nesw-resize"}[m]??m}return c()??z??"default"},[z,m,x.flip,b.flip]),[k,S,C]=t.undoableViewpoint??[void 0,void 0,void 0],[N,Z]=n.useState(!1);n.useLayoutEffect(()=>{if(!S||!d.current||!N)return;d.current.resetZoom();const{center:c,scale:p}=d.current.getCameraViewpoint();C==null||C.reset(),C==null||C.resetInitialState({centerX:c.x,centerY:c.y,scale:p.x}),C==null||C.reset(),Z(!1)},[d.current,N]);const P=n.useCallback(()=>{Z(!0)},[]),X=n.useCallback(()=>{d.current&&d.current.resetZoom()},[]),J=n.useCallback(()=>d.current?d.current.isZoomed():!1,[]),q=n.useCallback(c=>{d.current&&d.current.setScale(c)},[]),_=n.useCallback(()=>{U.current.setDisabled(!0)},[]),Q=n.useCallback(()=>{U.current.setDisabled(!1)},[]),F=n.useRef({clearLater:P,resetZoom:X,isZoomed:J,setScale:q,setMouseInteractionCursor:D,captureMouseInteraction:_,releaseMouseInteraction:Q}),y=n.useRef(null);ne.useEffect(()=>{if(t.onKeyDown===void 0||y.current===null)return()=>{};function c(p){var g;p instanceof KeyboardEvent&&((g=t.onKeyDown)==null||g.call(t,p))}return y.current.addEventListener("keydown",c),()=>{y.current!==null&&y.current.removeEventListener("keydown",c)}},[y.current,t.onKeyDown]),n.useImperativeHandle(u,()=>({actions:F.current,mouseInteractionOverlay:U.current}),[]);const M=n.useRef({userInteraction:!1,ignoreNextCallback:!1}),B=n.useCallback(oe.debounce(c=>{S!==void 0&&(M.current.userInteraction=!0,S({centerX:c.center.x,centerY:c.center.y,scale:c.scale.x}),M.current.userInteraction=!1)},500,{maxWait:3e3,trailing:!0}),[]),A=n.useCallback((c,p)=>{if(M.current.ignoreNextCallback){M.current.ignoreNextCallback=!1;return}B({center:c,scale:p})},[B]);return n.useEffect(()=>{var c;if(!M.current.userInteraction&&k!==void 0){const{centerX:p,centerY:g,scale:E}=k;(c=d.current)==null||c.updateCameraViewpoint({center:new I(p,g,0),scale:new I(E,E,1)}),M.current.ignoreNextCallback=!0}},[k]),i.jsx("figure",{ref:y,style:R,className:`linearviscanvas ${l?"show-axes":""} ${e}`,tabIndex:t.tabIndex,"aria-label":r,"data-keep-canvas-colors":!0,children:i.jsx(ce,{title:r,showAxes:l,abscissaConfig:x,ordinateConfig:b,...f,children:i.jsxs(W.Provider,{value:{overlayCursor:m,mouseMode:o,mouseInteractionOverlay:U.current,actions:F.current},children:[i.jsx(ve,{cursor:H}),i.jsx(Ce,{ref:d,onVisViewpointChange:A}),i.jsx(me,{zoomMode:o==="zoom",panMode:o==="pan",disabled:m!==void 0||o!=="pan"&&o!=="zoom"}),i.jsx(de,{children:s})]})})})}function je(t){const{mouseModeInteraction:e}=t,{mouseMode:r,setMouseMode:s}=e;return i.jsxs(ie,{children:[i.jsx(Y,{variant:r==="zoom"?"primary":"secondary",title:"Zoom on the scene and edit the ROIs",onClick:()=>{s("zoom")},children:i.jsx("i",{className:"fa fa-search fa-fw fa-lg"})}),i.jsx(Y,{variant:r==="pan"?"primary":"secondary",title:"Pan on the scene and edit the ROIs",onClick:()=>{s("pan")},children:i.jsx("i",{className:"fa fa-arrows fa-fw fa-lg"})})]})}function Ve(t){const[e,r]=n.useState(t),[s,o]=n.useState("zoom");n.useEffect(()=>{(e==="pan"||e==="zoom")&&o(e)},[e,o]);const a=n.useCallback(()=>{r(s)},[s]),u=n.useCallback(l=>{r(l!==e?l:s)},[e,s,r]);return{mouseMode:e,setMouseMode:r,resetMouseMode:a,setOrResetMouseMode:u,defaultMouseMode:s,setDefaultMouseMode:o}}export{je as D,Ue as L,ge as S,we as T,Ce as V,me as a,Re as b,Ve as u};
