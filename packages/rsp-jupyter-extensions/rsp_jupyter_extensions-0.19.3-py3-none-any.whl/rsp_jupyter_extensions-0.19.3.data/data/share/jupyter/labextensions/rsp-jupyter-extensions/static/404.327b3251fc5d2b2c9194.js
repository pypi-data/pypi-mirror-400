"use strict";(self.webpackChunkrsp_jupyter_extensions=self.webpackChunkrsp_jupyter_extensions||[]).push([[404],{404:(e,t,o)=>{o.r(t),o.d(t,{default:()=>_});var n=o(67),r=o(684),i=o(125),s=o(389),a=o(292),u=o(907);function l(e,t,o){return u.ServerConnection.makeRequest(e,t,o).then((e=>200!==e.status?e.json().then((t=>{throw new u.ServerConnection.ResponseError(e,t.message)})):e.json()))}var c=o(345),d=o(827);function h(e){return c.createElement(n.TextItem,{source:`${e.source}`,title:`${e.title}`})}class p extends d.VDomRenderer{constructor(e){super(new d.VDomModel),this.props=e}render(){return this.props?c.createElement(h,{source:this.props.source,title:this.props.title}):null}dispose(){super.dispose()}}const m=p;var g;function E(e,t=null,o,...n){e===g.DEBUG&&t&&t.DEBUG||e===g.INFO?console.log(o,...n):e===g.WARNING?console.warn(o,...n):e===g.ERROR&&console.error(o,...n)}!function(e){e.DEBUG="debug",e.INFO="info",e.WARNING="warning",e.ERROR="error"}(g||(g={}));const f="rsp-jupyterlab",b=`${f}:plugin`,y=`${f}:displayversion`;var T;async function R(e){await(0,d.showDialog)({title:"PDF Conversion Error",body:e,buttons:[d.Dialog.warnButton({label:"OK"})]})}n.IStatusBar,function(e){e.pdfExport="pdfexport:pdfexport"}(T||(T={})),r.IMainMenu,i.IDocumentManager,s.INotebookTracker;var v,w,N,I,O,D=o(247),S=o(441);class B{constructor(e){this.globalTooltip=null,this.tooltipHideTimeout=null,this.tooltipShowTimeout=null,this.currentHoveredJobref=null,this.queryDataMap=e}attachToMenu(e){const t=e.node;t&&(t.addEventListener("mouseenter",(e=>{const t=e.target;if(!t)return;const o=t.closest('[data-command^="q-"]');if(!o)return;const n=o.getAttribute("data-command");if(!n||!n.startsWith("q-"))return;const r=n.substring(2),i=this.queryDataMap.get(r);i&&this.currentHoveredJobref!==r&&(this.tooltipHideTimeout&&(clearTimeout(this.tooltipHideTimeout),this.tooltipHideTimeout=null),this.tooltipShowTimeout&&(clearTimeout(this.tooltipShowTimeout),this.tooltipShowTimeout=null),this.currentHoveredJobref=r,this.tooltipShowTimeout=window.setTimeout((()=>{this.showTooltip(e,i.sqlText,i.jobref)}),150))}),!0),t.addEventListener("mouseleave",(e=>{const t=e.target;if(!t)return;const o=t.closest('[data-command^="q-"]');if(!o)return;const n=o.getAttribute("data-command");if(!n||!n.startsWith("q-"))return;const r=n.substring(2);this.currentHoveredJobref===r&&(this.tooltipHideTimeout&&(clearTimeout(this.tooltipHideTimeout),this.tooltipHideTimeout=null),this.tooltipHideTimeout=window.setTimeout((()=>{this.hideTooltip(),this.currentHoveredJobref=null}),300))}),!0),t.addEventListener("click",(e=>{const t=e.target;if(!t)return;const o=t.closest('[data-command^="q-"]');if(!o)return;const n=o.getAttribute("data-command");n&&n.startsWith("q-")&&(this.hideTooltip(),this.currentHoveredJobref=null)}),!0))}showTooltip(e,t,o){this.globalTooltip&&this.hideTooltip(),this.globalTooltip=document.createElement("div"),this.globalTooltip.className="sql-hover-tooltip",this.globalTooltip.style.cssText="\n      position: fixed;\n      z-index: 10000;\n      background: #ffffff;\n      border: 1px solid #e1e4e8;\n      border-radius: 8px;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n      padding: 16px;\n      min-width: 500px;\n      max-width: 700px;\n      min-height: 200px;\n      max-height: 500px;\n      overflow: hidden;\n      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\n      font-size: 12px;\n      line-height: 1.4;\n      cursor: text;\n      user-select: text;\n    ";const n=document.createElement("div");n.textContent=`Query: ${o}`,n.style.cssText="\n      font-weight: 600;\n      color: #24292e;\n      margin-bottom: 8px;\n      font-size: 13px;\n    ";const r=document.createElement("div");r.style.cssText="\n      margin: 0;\n      background: #f6f8fa;\n      border: 1px solid #e1e4e8;\n      border-radius: 4px;\n      overflow: auto;\n      max-height: 450px;\n    ";const i=document.createElement("pre");i.style.cssText="\n      margin: 0;\n      padding: 12px;\n      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\n      font-size: 12px;\n      line-height: 1.5;\n      white-space: pre-wrap;\n      word-wrap: break-word;\n      color: #24292e;\n    ";const s=this.formatSQLQuery(t);i.innerHTML=this.highlightSQLBasic(s),r.appendChild(i),this.globalTooltip.appendChild(n),this.globalTooltip.appendChild(r),document.body.appendChild(this.globalTooltip);const a=e.target.getBoundingClientRect(),u=this.globalTooltip.getBoundingClientRect();let l=a.right-10,c=a.top-5;l+u.width>window.innerWidth&&(l=a.left-u.width+10),c+u.height>window.innerHeight&&(c=window.innerHeight-u.height-10),c<10&&(c=10),this.globalTooltip.style.left=`${l}px`,this.globalTooltip.style.top=`${c}px`,this.globalTooltip.addEventListener("mouseenter",(()=>{this.tooltipHideTimeout&&(clearTimeout(this.tooltipHideTimeout),this.tooltipHideTimeout=null)})),this.globalTooltip.addEventListener("mouseleave",(()=>{this.tooltipHideTimeout&&clearTimeout(this.tooltipHideTimeout),this.tooltipHideTimeout=window.setTimeout((()=>{this.hideTooltip(),this.currentHoveredJobref=null}),100)}))}hideTooltip(){this.tooltipHideTimeout&&(clearTimeout(this.tooltipHideTimeout),this.tooltipHideTimeout=null),this.tooltipShowTimeout&&(clearTimeout(this.tooltipShowTimeout),this.tooltipShowTimeout=null),this.globalTooltip&&(this.globalTooltip.remove(),this.globalTooltip=null)}static createSQLCard(e,t){const o=document.createElement("div");if(o.className="sql-card",o.style.cssText="\n      background: #ffffff;\n      border: 1px solid #e1e4e8;\n      border-radius: 8px;\n      padding: 16px;\n      margin: 8px 0;\n      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\n      font-size: 13px;\n      line-height: 1.5;\n    ",t){const e=document.createElement("div");e.className="sql-card-title",e.style.cssText="\n        font-weight: 600;\n        color: #24292e;\n        margin-bottom: 8px;\n        font-size: 14px;\n      ",e.textContent=t,o.appendChild(e)}const n=document.createElement("pre");n.className="sql-card-content",n.style.cssText="\n      margin: 0;\n      white-space: pre-wrap;\n      word-wrap: break-word;\n      color: #24292e;\n      background: #f6f8fa;\n      padding: 12px;\n      border-radius: 4px;\n      border: 1px solid #e1e4e8;\n    ";const r=B.formatSQLQueryStatic(e);return n.innerHTML=B.highlightSQLBasicStatic(r),o.appendChild(n),o}formatSQLQuery(e){return B.formatSQLQueryStatic(e)}static formatSQLQueryStatic(e){try{return(0,S.format)(e,{language:"sql",tabWidth:2,keywordCase:"upper",dataTypeCase:"upper",functionCase:"upper",identifierCase:"preserve",indentStyle:"standard",logicalOperatorNewline:"before",expressionWidth:50,linesBetweenQueries:2})}catch(t){return console.warn("SQL formatting failed:",t),e}}highlightSQLBasic(e){return B.highlightSQLBasicStatic(e)}static highlightSQLBasicStatic(e){let t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");return["SELECT","FROM","WHERE","ORDER","BY","GROUP","HAVING","JOIN","INNER","LEFT","RIGHT","OUTER","ON","AS","AND","OR","NOT","IN","EXISTS","BETWEEN","LIKE","IS","NULL","DISTINCT","LIMIT","INSERT","UPDATE","DELETE","CREATE","DROP","ALTER","TABLE","INDEX","VIEW","PROCEDURE","FUNCTION","TRIGGER","DATABASE","SCHEMA","UNION","ALL","CASE","WHEN","THEN","ELSE","END","IF","WHILE","FOR","LOOP","BEGIN","COMMIT","ROLLBACK","TRANSACTION","GRANT","REVOKE","PRIMARY","KEY","FOREIGN","REFERENCES","CONSTRAINT","CHECK","DEFAULT","AUTO_INCREMENT","VARCHAR","INT","BIGINT","SMALLINT","TINYINT","DECIMAL","FLOAT","DOUBLE","CHAR","TEXT","DATE","TIME","DATETIME","TIMESTAMP","BOOLEAN","BLOB","JSON"].forEach((e=>{const o=new RegExp(`\\b${e}\\b`,"gi");t=t.replace(o,`<span style="color: #cf222e; font-weight: bold;">${e.toUpperCase()}</span>`)})),t=t.replace(/(&#39;)((?:\\.|(?!\1)[^\\])*?)\1/g,'<span style="color: #0a3069;">$1$2$1</span>'),t=t.replace(/(&quot;)((?:\\.|(?!\1)[^\\])*?)\1/g,'<span style="color: #0a3069;">$1$2$1</span>'),t=t.replace(/\b\d+(\.\d+)?\b/g,'<span style="color: #0a3069; font-weight: bold;">$&</span>'),t=t.replace(/--.*$/gm,'<span style="color: #6a737d; font-style: italic;">$&</span>'),t=t.replace(/\/\*[\s\S]*?\*\//g,'<span style="color: #6a737d; font-style: italic;">$&</span>'),t}}!function(e){e.rubinqueryitem="rubinqueryitem",e.rubinhistory="rubinhistory",e.rubinquerynb="rubinquerynb",e.rubinqueryrefresh="rubinqueryrefresh"}(v||(v={}));class ${constructor(e){this.jobref=e.jobref,this.text=e.text}}async function U(e,t,o,n,r){const{commands:i}=e;i.hasCommand(v.rubinqueryitem)||i.addCommand(v.rubinqueryitem,{label:"Open from your query history...",caption:"Open notebook from supplied query jobref ID, dataset:id, or URL",execute:()=>{!async function(e,t,o,n,r){try{const i=await async function(e){const t={title:"Query Jobref ID or URL",body:new x,focusNodeSelector:"input",buttons:[d.Dialog.cancelButton(),d.Dialog.okButton({label:"CREATE"})]};try{const o=await(0,d.showDialog)(t);return o?(E(g.DEBUG,e,`Result from queryDialog: ${o}`),o.value?o.button?"CREATE"===o.button.label?(E(g.DEBUG,e,`Got result ${o.value} from queryDialog: CREATE`),o.value):void E(g.DEBUG,e,"Did not get queryDialog: CREATE"):void E(g.DEBUG,e,"No result.button from queryDialog"):void E(g.DEBUG,e,"No result.value from queryDialog")):void E(g.DEBUG,e,"No result from queryDialog")}catch(e){throw console.error(`Error showing overwrite dialog ${e}`),new Error(`Failed to show overwrite dialog: ${e}`)}}(n);if(E(g.DEBUG,n,`Query URL / ID is ${i}`),!i)return void E(g.WARNING,n,"Query URL was null'");await q(e,t,o,n,i,r)}catch(e){throw E(g.ERROR,n,`Error performing query ${e}`),new Error(`Failed to perform query: ${e}`)}}(e,t,o,n,r)}}),i.hasCommand(v.rubinquerynb)||i.addCommand(v.rubinquerynb,{label:"All queries",caption:"Open notebook requesting all query history",execute:()=>{!async function(e,t,o,n){const r=a.PageConfig.getBaseUrl()+"rubin/query/tap/notebooks/query_all",i={method:"GET"};E(g.INFO,n,"Opening query-all notebook");const s=o.serverSettings;try{const e=(await l(r,i,s)).path;t.open(e)}catch(e){throw E(g.ERROR,n,`Error opening query-all notebook: ${e}`),new Error(`Failed to open query-all notebook: ${e}`)}}(0,t,o,n)}}),i.hasCommand(v.rubinqueryrefresh)||i.addCommand(v.rubinqueryrefresh,{label:"Refresh query history",caption:"Refresh query history",execute:async()=>{await U(e,t,o,n,r)}}),r.clearItems();const s={command:v.rubinqueryitem},u={command:v.rubinquerynb},c={command:v.rubinqueryrefresh};r.insertItem(10,s),E(g.DEBUG,n,"inserted query dialog menu"),r.insertItem(20,{type:"separator"}),r.insertItem(30,u),E(g.DEBUG,n,"inserted all-query notebook generator"),r.insertItem(40,{type:"separator"});try{const i=await async function(e,t,o,n,r){E(g.INFO,n,"Retrieving recent query menu");const{commands:i}=e,s=new D.Menu({commands:i});s.title.label="Recent Queries";const u=new Map;try{const c=await async function(e,t){const o=a.PageConfig.getBaseUrl()+"rubin/query/tap/history/5",n={method:"GET"};E(g.INFO,t,`About to query TAP history at ${o}`);const r=e.serverSettings,i=[];try{const e=await l(o,n,r);E(g.DEBUG,t,`Got query response ${JSON.stringify(e,void 0,2)}`),e.forEach((e=>{const o=new $(e);o.text=e.text,E(g.DEBUG,t,`query menu entry ${JSON.stringify(o,void 0,2)}`),i.push(o)}))}catch(e){throw console.error(`Error showing overwrite dialog ${e}`),new Error(`Failed to show overwrite dialog: ${e}`)}return E(g.DEBUG,t,`rubinqueryrecent history return: ${JSON.stringify(i,void 0,2)}`),i}(o,n);E(g.DEBUG,n,`Recent queries: ${JSON.stringify(c,void 0,2)}`);let d=10;c.forEach((a=>{const l=`q-${a.jobref}`;i.hasCommand(l)||i.addCommand(l,{label:a.jobref,caption:a.text,execute:async()=>{await q(e,t,o,n,a.jobref,r)}}),u.set(a.jobref,{sqlText:a.text,jobref:a.jobref}),s.insertItem(d,{type:"command",command:l}),E(g.DEBUG,n,`Added ${l} to submenu for ${a.jobref}`),d+=10})),new B(u).attachToMenu(s)}catch(e){throw E(g.ERROR,n,`Error performing recent query history ${e}`),new Error(`Failed to query recent history: ${e}`)}return s}(e,t,o,n,r);E(g.DEBUG,n,"recent query menu retrieved"),E(g.DEBUG,n,"inserting recent querymenu..."),r.insertItem(50,{type:"submenu",submenu:i})}catch(e){throw console.error(`Error getting recent query menu ${e}`),new Error(`Failed to get recent query menu: ${e}`)}E(g.DEBUG,n,"...inserted recent query menu"),r.insertItem(60,{type:"separator"}),r.insertItem(70,c),E(g.DEBUG,n,"inserted query refresh")}class x extends D.Widget{constructor(){super({node:w.createQueryNode()}),this.addClass("rubin-qh")}get inputNode(){return this.node.getElementsByTagName("input")[0]}getValue(){return this.inputNode.value}}async function q(e,t,o,n,r,i){E(g.INFO,n,`Opening query for ${r}`);const s=JSON.stringify({type:"tap",value:r}),u=a.PageConfig.getBaseUrl()+"rubin/query",c={method:"POST",body:s},d=o.serverSettings;try{const r=(await l(u,c,d)).path;t.open(r),U(e,t,o,n,i).catch((e=>{E(g.WARNING,n,`Background menu refresh failed: ${e}`)}))}catch(e){throw E(g.ERROR,n,`Error opening query from jobref: ${e}`),new Error(`Failed to open query from jobref: ${e}`)}}function G(e,t,o,n,r){C(r);const i=Promise.resolve(function(e,t,o,n){const r=[];for(const o of e.shell.widgets("main"))if(o){const e=t.contextForWidget(o);e?(E(g.DEBUG,n,`Saving context for widget: ${{id:o.id}}`),r.push(e.save())):E(g.WARNING,n,`No context for widget: ${{id:o.id}}`)}E(g.DEBUG,n,"Waiting for all save-document promises to resolve.");let i=Promise.resolve(1);return r&&(Promise.all(r),i=r[0]),i}(e,t,0,r));return i.then((t=>A(e,0,0,n,r))),i.catch((e=>{E(g.WARNING,r,`savequit: saveAll failed: ${e.message}`)})),E(g.INFO,r,"savequit: Save and Quit complete."),i}function A(e,t,o,n,r){C(r);let i=`${r.EXTERNAL_INSTANCE_URL}`;return n&&(i+="/logout"),Promise.resolve(function(e,t){const o=e.serviceManager.serverSettings,n=a.PageConfig.getBaseUrl()+"rubin/hub";return E(g.DEBUG,t,`savequit: hubRequest URL: ${n} | Settings: ${o}`),u.ServerConnection.makeRequest(n,{method:"DELETE"},o)}(e,r).then((()=>{E(g.INFO,r,"Quit complete.")})).then((()=>{window.location.replace(i)})))}function C(e){const t={title:"Redirecting to landing page",body:"JupyterLab cleaning up and redirecting to landing page.",buttons:[d.Dialog.okButton({label:"Got it!"})]};return(0,d.showDialog)(t).then((()=>{E(g.DEBUG,e,"Info dialog panel displayed")}))}r.IMainMenu,i.IDocumentManager,function(e){e.createQueryNode=function(){const e=document.createElement("div"),t=document.createElement("label");t.textContent="Enter Query Jobref ID or URL";const o=document.createElement("input");return e.appendChild(t),e.appendChild(o),e}}(w||(w={})),function(e){e.justQuit="justquit:justquit",e.saveQuit="savequit:savequit",e.saveLogout="savelogout:savelogout"}(N||(N={})),r.IMainMenu,i.IDocumentManager,function(e){e.COPY="copy",e.FETCH="fetch"}(I||(I={})),function(e){e.PROMPT="prompt",e.OVERWRITE="overwrite",e.ABORT="abort"}(O||(O={}));class M{constructor(e){this.menu_name=e.menu_name,this.action=e.action,this.disposition=e.disposition,this.parent=e.parent,this.src=e.src,this.dest=e.dest}}class L{constructor(e,t=null,o=null){if(this.entries=null,this.subhierarchies=null,this.env=null,null===t&&(t="<unnamed>"),this.env=o,E(g.INFO,this.env,`Building hierarchy ${t}`),null!==e.entries)for(const o in e.entries){E(g.DEBUG,this.env,`${t} -> entry ${o}`);const n=e.entries[o];null!==n?(null===this.entries&&(this.entries={}),E(g.DEBUG,this.env,`adding entry ${o}: ${JSON.stringify(n,void 0,2)}`),this.entries[o]=new M(n)):E(g.DEBUG,this.env,`skipping null entry ${o}`)}if(null!==e.subhierarchies){const n=Object.keys(e.subhierarchies);E(g.DEBUG,this.env,`Subhierarchies: ${n}`);for(const r of n){if(null===e.subhierarchies){E(g.WARNING,this.env,`Somehow, subhierarchies is null at ${t}`);continue}E(g.DEBUG,this.env,`${t} -> subhierarchy ${r}`);const n=e.subhierarchies[r];null!==n?(null===this.subhierarchies&&(this.subhierarchies={}),E(g.DEBUG,o,`recurse: new subhierarchy of ${t} ${r}`),this.subhierarchies[r]=new L(n,r)):E(g.DEBUG,this.env,`skipping null subhierarchy ${r}`)}}E(g.DEBUG,o,`hierarchy ${t} built`)}}async function F(e,t,o,n){E(g.DEBUG,n,`Sending POST to tutorials endpoint with data ${JSON.stringify(o,void 0,2)}`);try{const r=await u.ServerConnection.makeRequest(a.PageConfig.getBaseUrl()+"rubin/tutorials",{method:"POST",body:JSON.stringify(o)},e);if(409===r.status)try{const r=await async function(e,t,o){const n={title:"Target file exists",body:`Overwrite file '${e}' ?`,buttons:[d.Dialog.cancelButton(),d.Dialog.okButton({label:"OVERWRITE"})]};try{E(g.DEBUG,o,"Showing overwrite dialog");const e=await(0,d.showDialog)(n);return e?(E(g.DEBUG,o,"Result from overwriteDialog: ",e),e.button?"OVERWRITE"===e.button.label?(E(g.DEBUG,o,`Got result ${e.button.label} from overwriteDialog`),e.button.label):void E(g.DEBUG,o,"Did not get overwriteDialog: OVERWRITE"):void E(g.DEBUG,o,"No result.button from overwriteDialog")):void E(g.DEBUG,o,"No result from queryDialog")}catch(e){throw console.error(`Error showing overwrite dialog ${e}`),new Error(`Failed to show overwrite dialog: ${e}`)}}(o.dest,0,n);if(E(g.DEBUG,n,`Dialog result was ${r}`),"OVERWRITE"!==r)return;const i={menu_name:o.menu_name,action:o.action,disposition:O.OVERWRITE,parent:o.parent,src:o.src,dest:o.dest},s=new M(i);await F(e,t,s,n)}catch(e){E(g.ERROR,n,`Error in overwrite dialog: ${e}`)}else 307===r.status||200===r.status?(E(g.DEBUG,n,`Opening file ${o.dest}`),t.openOrReveal(o.dest)):E(g.WARNING,n,`Unexpected response status ${r.status}`)}catch(e){E(g.ERROR,n,`Error in tutorials POST request: ${e}`)}}function P(e,t,o,n){E(g.INFO,n,"rsp-tutorials: loading...");const r=e.serviceManager.serverSettings;function i(n,s,a,u){if(E(g.DEBUG,u,`building tutorials menu for ${n}`),null===a){const{commands:o}=e,n=new D.Menu({commands:o});n.title.label="Tutorials",a=n,E(g.DEBUG,u,"set up top level Tutorials menu"),t.addMenu(n)}else E(g.DEBUG,u,`supplied parent menu=${a.title.label}`);const l=a.title.label;if(E(g.DEBUG,u,`building tutorials menu ${n}, parent=${l}`),null!==s.subhierarchies)for(const t in s.subhierarchies){const o=s.subhierarchies[t];if(null===o){E(g.DEBUG,u,`skipping empty hierarchy ${t}`);continue}if(null===o.entries&&null===o.subhierarchies){E(g.DEBUG,u,`Skipping hierarchy ${t} with no entries or subhierarchies`);continue}E(g.DEBUG,u,`adding submenu ${t} to ${l}`);const{commands:n}=e,r=new D.Menu({commands:n});r.title.label=t,a.addItem({submenu:r,type:"submenu"}),E(g.DEBUG,u,`recurse: hierarchy ${t}`),i(t,o,r,u),E(g.DEBUG,u,`recursion done; emerged from ${t}`)}if(E(g.DEBUG,u,`done with subhierarchies for ${n}`),null!==s.entries){a.addItem({type:"separator"});for(const t in s.entries){const{commands:n}=e,i=s.entries[t],c=`${i.parent}/${i.menu_name}`;E(g.DEBUG,u,`creating command ${c} for entry ${JSON.stringify(t,void 0,2)}`),n.addCommand(c,{label:t,execute:()=>{F(r,o,i,u)}}),E(g.DEBUG,u,`adding item ${c} to ${l}`),a.addItem({command:c,type:"command"})}}E(g.DEBUG,u,`done with ${n}`)}(async()=>{try{const e=await async function(e,t){const o=await l(a.PageConfig.getBaseUrl()+"rubin/tutorials",{method:"GET"},e);E(g.DEBUG,t,`Tutorial endpoint response: ${JSON.stringify(o,void 0,2)}`);const n=new L(o);return E(g.DEBUG,t,"Created TutorialsHierarchy from response"),E(g.DEBUG,t,"=============================="),n}(r,n);e&&i("root",e,null,n)}catch(e){E(g.ERROR,n,`Error loading tutorials hierarchy: ${e}`)}})(),E(g.INFO,n,"rsp-tutorials: ...loaded.")}function k(e){let t=-1;e.ABNORMAL_STARTUP_ERRNO&&(t=parseInt(e.ABNORMAL_STARTUP_ERRNO));let o="EUNKNOWN";e.ABNORMAL_STARTUP_ERRORCODE&&(o=e.ABNORMAL_STARTUP_ERRORCODE);let n="unknown error";e.ABNORMAL_STARTUP_STRERROR&&(n=e.ABNORMAL_STARTUP_STRERROR);let r="???";e.ABNORMAL_STARTUP_MESSAGE&&(r=e.ABNORMAL_STARTUP_MESSAGE);let i=function(e){const t=" This Lab should not be trusted for work you want to keep.",o=" Try deleting unneeded .user_env directories and no-longer relevant large files, then shut down and restart the Lab.",n="You have run out of filesystem space."+o,r="You have exceeded your filesystem quota."+o,i="You do not have permission to write. Ask your RSP site administrator to check ownership and permissions on your directories."+t,s="Please open an issue with your RSP site administrator with the error number, description, and message shown above."+t,a="You are missing environment variables necessary for RSP operation. "+s;switch(e){case"EACCES":case"EROFS":return i;case"ENOSPC":return n;case"EDQUOT":return r;case"EBADENV":return a;default:return s}}(o);return i=i+"\n\n"+`JupyterLab started in an abnormal state: error # ${t} (${o}) [${n}] "${r}"`,i}r.IMainMenu,i.IDocumentManager;const _={activate:function(e,t,o,n,r){E(g.INFO,null,"getting server environment..."),function(e){return l(a.PageConfig.getBaseUrl()+"rubin/environment",{method:"GET"},e.serviceManager.serverSettings).then((e=>e))}(e).then((async i=>{if(E(g.DEBUG,i,`...env: ${JSON.stringify(i,void 0,2)}...`),E(g.INFO,i,"...got server environment"),E(g.INFO,i,"rsp-lab-extension: loading..."),E(g.INFO,i,"...activating savequit extension..."),function(e,t,o,n){E(g.INFO,null,"rsp-savequit: loading...");e.serviceManager;const{commands:r}=e;r.addCommand(N.justQuit,{label:"Exit Without Saving",caption:"Destroy container",execute:()=>{A(e,0,0,!1,n)}}),r.addCommand(N.saveQuit,{label:"Save All and Exit",caption:"Save open notebooks and destroy container",execute:()=>{G(e,o,0,!1,n)}}),r.addCommand(N.saveLogout,{label:"Save All, Exit, and Log Out",caption:"Save open notebooks, destroy container, and log out",execute:()=>{G(e,o,0,!0,n)}});const i=[{command:N.justQuit},{command:N.saveQuit},{command:N.saveLogout}];t.fileMenu.addGroup(i,150),E(g.INFO,n,"rsp-savequit: ...loaded.")}(e,t,o,i),E(g.INFO,i,"...checking for abnormal startup..."),"TRUE"===i.ABNORMAL_STARTUP)try{await async function(e){const t={title:"Abnormal Lab Start",body:k(e),focusNodeSelector:"input",buttons:[d.Dialog.warnButton({label:"OK"})]};try{const o=await(0,d.showDialog)(t);return o?(E(g.DEBUG,e,`Result from queryDialog: ${o}`),o.value?o.button?void 0:void E(g.DEBUG,e,"No result.button from queryDialog"):void E(g.DEBUG,e,"No result.value from queryDialog")):void E(g.DEBUG,e,"No result from queryDialog")}catch(e){throw console.error(`Error showing abnormal startup dialog ${e}`),new Error(`Failed to show abnormal startup dialog: ${e}`)}}(i)}catch(e){E(g.ERROR,i,`Error showing abnormal dialog: ${e}`)}E(g.INFO,i,"...activating displayversion extension..."),function(e,t,o){E(g.INFO,o,"rsp-displayversion: loading...");const n=o.IMAGE_DESCRIPTION||"",r=o.IMAGE_DIGEST,i=o.JUPYTER_IMAGE_SPEC,s=" "+new URL(o.EXTERNAL_INSTANCE_URL||"").hostname,a=o.CONTAINER_SIZE||"";let u="";u=""===a?" ("+o.CPU_LIMIT+" CPU, "+o.MEM_LIMIT+" B)":" "+a;let l="",c="";if(i){const e=i.split("/"),o=e[e.length-1],a=o.split("@");2===a.length?(l=" ["+a[1].substring(7,15)+"...]",c=" ("+a[0]+")"):c=" ("+o+")",""===l&&r&&(l=" ["+r.substring(0,8)+"...]");const d=new m({source:n+l+c+u+s,title:n});t.registerStatusItem(y,{item:d,align:"left",rank:80,isActive:()=>!0})}E(g.INFO,o,"rsp-displayversion: ... loaded")}(0,n,i),E(g.INFO,i,"...activated..."),E(g.INFO,i,"...activating pdfexport extension...");try{(function(e,t,o,n,r){E(g.INFO,null,"rsp-pdfexport: loading...");const i=e.serviceManager,{commands:s}=e;s.addCommand(T.pdfExport,{label:"Export current notebook to PDF (typst)",caption:"Export current notebook to PDF via typst",execute:()=>{!async function(e,t,o,n,r){if(!r)return void E(g.WARNING,n,"Tracker is undefined");const i=r.currentWidget;if(!i)return void E(g.DEBUG,n,"No current notebook");const{context:s}=i;s.model.dirty&&!s.model.readOnly&&await s.save();const u=i.context.path,c=a.PageConfig.getBaseUrl()+"rubin/pdfexport",d={method:"POST",body:JSON.stringify({path:u})},h=o.serverSettings;try{const e=await l(c,d,h),o=e.path,r=e.error;E(g.DEBUG,n,`Got query response ${JSON.stringify(e,void 0,2)}`),o?t.open(o):r?await R(r):await R("unknown error")}catch(e){throw E(g.ERROR,n,`Error converting ${u} to PDF: ${e}`),new Error(`Failed to convert ${u} to PDF: ${e}`)}}(0,o,i,n,r)}});const u=[{command:T.pdfExport}];t.fileMenu.addGroup(u,140),E(g.INFO,n,"rsp-pdfexport: ...loaded.")})(e,t,o,i,r),E(g.INFO,i,"...activated...")}catch(e){E(g.ERROR,i,`Error activating pdfexport extension: ${e}`)}if(E(g.INFO,i,"...activating query extension..."),"science"===i.RSP_SITE_TYPE||"staff"===i.RSP_SITE_TYPE)try{await async function(e,t,o,n){E(g.INFO,n,"rsp-query...loading");const r=e.serviceManager,{commands:i}=e,s=new D.Menu({commands:i});t.addMenu(s),s.title.label="Rubin",await U(e,o,r,n,s),E(g.INFO,n,"rsp-query...loaded")}(e,t,o,i),E(g.INFO,i,"...activated...")}catch(e){E(g.ERROR,i,`Error activating query extension: ${e}`)}else E(g.INFO,i,`...skipping query extension: site type is '${i.RSP_SITE_TYPE}'...`);E(g.INFO,i,"...activated..."),E(g.INFO,i,"...activating tutorials extension..."),"science"===i.RSP_SITE_TYPE?(P(e,t,o,i),E(g.INFO,i,"...activated...")):E(g.INFO,i,`...skipping tutorials extension because site type is '${i.RSP_SITE_TYPE}'...`),E(g.INFO,i,"...loaded rsp-lab-extension.")}))},id:b,requires:[r.IMainMenu,i.IDocumentManager,n.IStatusBar,s.INotebookTracker],autoStart:!0}}}]);