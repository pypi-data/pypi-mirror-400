# DO NOT EDIT: This file is automatically generated by scripts/generate_models.sh
# Generated from: openapi/gateway.json

# generated by datamodel-codegen:
#   filename:  gateway.json

from __future__ import annotations

from typing import Any, Literal
from uuid import UUID

from pydantic import AwareDatetime, BaseModel, Field, conint, constr


class GatewayServicesListResponse(BaseModel):
    """
    DTO de réponse pour la liste des services du gateway.

    Fournit un aperçu complet de l'état des services disponibles
    dans l'architecture microservices, avec métriques de santé.

    Attributes:
        services: Liste détaillée des services avec leur statut
        endpoints: Mapping nom->URL des services
        healthy_services: Liste des noms des services en bonne santé
        total_count: Nombre total de services
        healthy_count: Nombre de services opérationnels
        timestamp: Horodatage de la réponse

    Examples:
        Voir model_config pour exemples JSON
    """

    services: list[dict[str, Any]] | None = Field(None, title="Services")
    """
    Informations des services disponibles
    """
    endpoints: dict[str, str] | None = Field(None, title="Endpoints")
    """
    Endpoints des services
    """
    healthy_services: list[str] | None = Field(None, title="Healthy Services")
    """
    Liste des services en bonne santé
    """
    total_count: int | None = Field(None, title="Total Count")
    """
    Nombre total de services
    """
    healthy_count: int | None = Field(None, title="Healthy Count")
    """
    Nombre de services en bonne santé
    """
    timestamp: str | None = Field(None, title="Timestamp")
    """
    Horodatage de la réponse
    """


class HealthCheckResponse(BaseModel):
    """
    DTO de réponse pour les vérifications de santé du service.

    Fournit un état détaillé de la santé du service incluant les dépendances
    externes (base de données, cache, etc.) et métriques de performance.

    Attributes:
        status: Statut global de santé ('healthy', 'unhealthy', 'unknown')
        service: Nom du service vérifié
        timestamp: Horodatage de la vérification (ISO 8601)
        version: Version actuelle du service (optionnel)
        uptime: Temps écoulé depuis le démarrage (optionnel)
        checks: Détails des vérifications individuelles (optionnel)
    """

    status: str | None = Field(None, title="Status")
    """
    Statut de santé (healthy, unhealthy, unknown)
    """
    service: str | None = Field(None, title="Service")
    """
    Nom du service
    """
    timestamp: str | None = Field(None, title="Timestamp")
    """
    Horodatage de la vérification
    """
    version: str | None = Field(None, title="Version")
    """
    Version du service
    """
    uptime: str | None = Field(None, title="Uptime")
    """
    Temps de fonctionnement
    """
    checks: dict[str, Any] | None = Field(None, title="Checks")
    """
    Détails des vérifications
    """


class KrakenApiKeyGenerationRequest(BaseModel):
    """
    DTO de requête pour générer une nouvelle clé API Kraken.

    Requête vide car la génération est automatique basée sur l'utilisateur
    authentifié.

    Note:
        La clé API sera générée automatiquement avec le préfixe 'kraken_'
        suivi d'une chaîne aléatoire sécurisée.
    """


class UserResponse(BaseModel):
    """
    DTO de réponse contenant les informations d'un utilisateur.

    Utilisé pour retourner les détails d'un utilisateur dans les réponses
    d'authentification et de gestion des utilisateurs.

    Attributes:
        id: Identifiant unique de l'utilisateur
        username: Nom d'utilisateur unique
        is_active: Indique si l'utilisateur est actif
        is_admin: Indique si l'utilisateur a des privilèges administrateur
        created_at: Date de création de l'utilisateur (ISO 8601)
        updated_at: Date de dernière mise à jour (ISO 8601)
    """

    id: str | None = Field(None, title="Id")
    """
    Identifiant unique de l'utilisateur
    """
    username: str | None = Field(None, title="Username")
    """
    Nom d'utilisateur
    """
    is_active: bool = Field(True, title="Is Active")
    """
    Statut actif
    """
    is_admin: bool = Field(False, title="Is Admin")
    """
    Privilèges administrateur
    """
    created_at: str | None = Field(None, title="Created At")
    """
    Date de création
    """
    updated_at: str | None = Field(None, title="Updated At")
    """
    Date de mise à jour
    """


class ValidationError(BaseModel):
    loc: list[str | int] | None = Field(None, title="Location")
    msg: str | None = Field(None, title="Message")
    type: str | None = Field(None, title="Error Type")


class AnnotationFieldModel(BaseModel):
    """
    Modèle pour définir un champ à annoter dans un schéma d'annotation.

    Représente un champ spécifique à extraire d'un document,
    avec ses caractéristiques et instructions d'extraction.

    Attributes:
        class_name: Nom du champ/propriété à extraire
        type: Type de données attendu (str, int, CATALOG, etc.)
        prompt: Instruction naturelle pour guider l'extraction
        catalog_values: Liste de valeurs autorisées (pour type CATALOG)
    """

    class_name: str | None = Field(None, title="Class Name")
    """
    Nom de la classe/propriété du champ
    """
    type: str | None = Field(None, title="Type")
    """
    Type de données du champ
    """
    prompt: str | None = Field(None, title="Prompt")
    """
    Instruction pour l'extraction de ce champ
    """
    catalog_values: list[str] | None = Field(None, title="Catalog Values")
    """
    Valeurs autorisées pour les champs CATALOG
    """


class AnnotationSchemaModel(BaseModel):
    """
    Schéma d'annotation pour une entité spécifique.

    Définit la structure d'une entité à extraire, avec ses champs
    et règles d'extraction associées.

    Attributes:
        general_prompt: Description générale de l'entité
        is_list: Si l'entité peut avoir plusieurs instances
        is_optional: Si l'entité est optionnelle dans le document
        table_fields: Liste des champs à extraire pour cette entité
    """

    general_prompt: str | None = Field(None, title="General Prompt")
    """
    Description générale de l'entité à extraire
    """
    is_list: bool | None = Field(None, title="Is List")
    """
    Indique si cette entité peut avoir plusieurs instances
    """
    is_optional: bool | None = Field(None, title="Is Optional")
    """
    Indique si cette entité est optionnelle
    """
    table_fields: list[AnnotationFieldModel] | None = Field(None, title="Table Fields")
    """
    Liste des champs à extraire pour cette entité
    """


class ApiKeyDeleteResponse(BaseModel):
    """
    DTO de réponse pour la suppression d'une clé API.

    Confirme la suppression réussie d'une clé API
    et fournit un message de confirmation.

    Attributes:
        message: Message de confirmation de suppression

    Examples:
        Voir model_config pour exemples JSON
    """

    message: str | None = Field(None, title="Message")
    """
    Message de confirmation de suppression
    """


class ApiKeyResponse(BaseModel):
    """
    DTO de réponse pour une clé API provider.

    Représente une clé API enregistrée avec informations masquées
    pour la sécurité (aperçu seulement, pas la clé complète).

    Attributes:
        id: Identifiant unique de la clé
        user_id: Propriétaire de la clé
        provider: Provider IA associé
        api_key_preview: Aperçu masqué (ex: sk-***123)
        description: Description de la clé
        is_active: Statut actif de la clé
        created_at: Date de création
        updated_at: Date de dernière modification
    """

    id: str | None = Field(None, title="Id")
    """
    Identifiant unique de la clé API
    """
    user_id: str | None = Field(None, title="User Id")
    """
    Identifiant de l'utilisateur propriétaire
    """
    provider: str | None = Field(None, title="Provider")
    """
    Provider IA
    """
    api_key_preview: str | None = Field(None, title="Api Key Preview")
    """
    Aperçu masqué de la clé API (ex: sk-***123)
    """
    description: str | None = Field(None, title="Description")
    """
    Description de la clé
    """
    is_active: bool = Field(True, title="Is Active")
    """
    Statut actif de la clé
    """
    created_at: str | None = Field(None, title="Created At")
    """
    Date de création
    """
    updated_at: str | None = Field(None, title="Updated At")
    """
    Date de mise à jour
    """


class BenchmarkResponse(BaseModel):
    """
    Réponse détaillée d'un benchmark.
    """

    id: str | None = Field(None, title="Id")
    user_id: str | None = Field(None, title="User Id")
    job_id: str | None = Field(None, title="Job Id")
    source_expected_pairs: list[dict[str, str]] | None = Field(
        None, title="Source Expected Pairs"
    )
    benchmark_type: str | None = Field(None, title="Benchmark Type")
    providers: list[dict[str, Any]] | None = Field(None, title="Providers")
    status: str | None = Field(None, title="Status")
    config: dict[str, Any] | None = Field(None, title="Config")
    created_at: AwareDatetime | None = Field(None, title="Created At")
    completed_at: AwareDatetime | None = Field(None, title="Completed At")
    source_id: str | None = Field(None, title="Source Id")
    expected_result_id: str | None = Field(None, title="Expected Result Id")


class BodyUploadExpectedResultApiV1BenchmarksExpectedResultsUploadPost(BaseModel):
    file: bytes | None = Field(None, title="File")
    source_id: str | None = Field(None, title="Source Id")
    result_type: constr(pattern=r"^(extraction|annotation)$") | None = Field(
        None, title="Result Type"
    )
    format: constr(pattern=r"^(json|text)$") | None = Field(None, title="Format")
    description: str | None = Field(None, title="Description")


class BodyUploadSourceApiV1SourcesUploadPost(BaseModel):
    file: bytes | None = Field(None, title="File")
    """
    Fichier source à uploader
    """
    name: str | None = Field(None, title="Name")
    """
    Nom personnalisé pour la source
    """


class BulkProcessResponse(BaseModel):
    """
    DTO de réponse après soumission d'un bulk job.

    Attributes:
        success: Indique si la soumission a réussi
        job_id: UUID du job créé
        status: Statut initial (toujours PENDING)
        submitted_at: Timestamp ISO 8601
        message: Message descriptif
        tasks_count: Nombre de tâches créées (= len(source_ids))
        sources_count: Nombre de sources (= len(source_ids))
    """

    success: bool | None = Field(None, title="Success")
    job_id: str | None = Field(None, title="Job Id")
    status: str | None = Field(None, title="Status")
    submitted_at: str | None = Field(None, title="Submitted At")
    message: str | None = Field(None, title="Message")
    tasks_count: int | None = Field(None, title="Tasks Count")
    sources_count: int | None = Field(None, title="Sources Count")


class CreateApiKeyRequest(BaseModel):
    """
    DTO de requête pour créer une nouvelle clé API provider.

    Utilisé pour enregistrer une clé API d'un provider IA
    (OpenAI, Mistral, etc.) dans le système.

    Attributes:
        provider: Type de provider IA
        api_key: Clé API en clair (sera chiffrée)
        description: Description optionnelle de la clé

    Examples:
        Voir model_config pour exemples JSON
    """

    provider: str | None = Field(None, title="Provider")
    """
    Provider IA (validation contextuelle)
    """
    api_key: constr(min_length=1) | None = Field(None, title="Api Key")
    """
    Clé API en clair
    """
    description: constr(max_length=500) | None = Field(None, title="Description")
    """
    Description optionnelle
    """


class CreateExpectedResultRequest(BaseModel):
    """
    Requête de création d'un expected result.
    """

    source_id: str | None = Field(None, title="Source Id")
    result_type: constr(pattern=r"^(extraction|annotation)$") | None = Field(
        None, title="Result Type"
    )
    format: constr(pattern=r"^(json|text)$") | None = Field(None, title="Format")
    content: str | None = Field(None, title="Content")
    """
    Contenu brut (texte ou JSON stringifié)
    """
    description: str | None = Field(None, title="Description")
    metadata: dict[str, Any] | None = Field(None, title="Metadata")


class ExpectedResultResponse(BaseModel):
    """
    Détail d'un expected result.
    """

    id: str | None = Field(None, title="Id")
    source_id: str | None = Field(None, title="Source Id")
    result_type: str | None = Field(None, title="Result Type")
    format: str | None = Field(None, title="Format")
    content_hash: str | None = Field(None, title="Content Hash")
    storage_path: str | None = Field(None, title="Storage Path")
    description: str | None = Field(None, title="Description")
    created_at: AwareDatetime | None = Field(None, title="Created At")


class ExtractionTaskConfig(BaseModel):
    """
    Configuration pour tâche d'extraction (sans source_id).
    """

    task_type: str | None = Field(None, title="Task Type")
    """
    Type de tâche à effectuer
    """
    ai_provider: str | None = Field(None, title="Ai Provider")
    """
    Provider IA utilisé
    """
    provider_model: str | None = Field(None, title="Provider Model")
    """
    Modèle du provider
    """
    parameters: dict[str, Any] | None = Field(None, title="Parameters")
    """
    Paramètres additionnels
    """
    max_retries: conint(ge=0, le=10) = Field(3, title="Max Retries")
    """
    Nombre maximum de tentatives
    """


class ExtractionTaskRequest(BaseModel):
    """
    DTO de requête pour créer une tâche d'extraction de texte (avec source_id).
    """

    task_type: str | None = Field(None, title="Task Type")
    """
    Type de tâche à effectuer
    """
    ai_provider: str | None = Field(None, title="Ai Provider")
    """
    Provider IA utilisé
    """
    provider_model: str | None = Field(None, title="Provider Model")
    """
    Modèle du provider
    """
    parameters: dict[str, Any] | None = Field(None, title="Parameters")
    """
    Paramètres additionnels
    """
    max_retries: conint(ge=0, le=10) = Field(3, title="Max Retries")
    """
    Nombre maximum de tentatives
    """
    source_id: str | None = Field(None, title="Source Id")
    """
    UUID de la source à traiter
    """


class FieldAnalysisResponse(BaseModel):
    """
    Analyse des champs problématiques.
    """

    perfect_fields: list[str] | None = Field(None, title="Perfect Fields")
    problematic_fields: list[dict[str, Any]] | None = Field(
        None, title="Problematic Fields"
    )


class JobSummary(BaseModel):
    """
    DTO de résumé léger d'un job (pour listes).

    Version allégée de JobStatusResponse, sans détails des tâches.

    Attributes:
        id: UUID du job
        user_id: UUID de l'utilisateur créateur
        status: Statut d'exécution
        submitted_at: Timestamp de soumission (ISO 8601)
        completed_at: Timestamp de complétion (ISO 8601, optionnel)
        progress: Statistiques de progression

    Notes:
        - Layer API : réponse HTTP optimisée pour listes
        - Exclut les détails de tâches (performance)
        - Factory method from_job_entity
    """

    id: str | None = Field(None, title="Id")
    """
    Identifiant unique du job
    """
    user_id: str | None = Field(None, title="User Id")
    """
    Identifiant de l'utilisateur
    """
    status: str | None = Field(None, title="Status")
    """
    Statut d'exécution du job
    """
    submitted_at: str | None = Field(None, title="Submitted At")
    """
    Date/heure de soumission du job
    """
    completed_at: str | None = Field(None, title="Completed At")
    """
    Date/heure de fin d'exécution
    """
    progress: dict[str, Any] | None = Field(None, title="Progress")
    """
    Informations de progression
    """


class JobsListResponse(BaseModel):
    """
    DTO de réponse pour une liste de jobs.

    Contient une liste de résumés de jobs pour un utilisateur.

    Attributes:
        jobs: Liste des résumés de jobs
        total_count: Nombre total de jobs
        user_id: ID de l'utilisateur
        timestamp: Horodatage de la réponse
    """

    jobs: list[JobSummary] | None = Field(None, title="Jobs")
    """
    Liste des jobs
    """
    total_count: int | None = Field(None, title="Total Count")
    """
    Nombre total de jobs
    """
    user_id: str | None = Field(None, title="User Id")
    """
    Identifiant de l'utilisateur
    """
    timestamp: str | None = Field(None, title="Timestamp")
    """
    Horodatage de la réponse
    """


class ModelInfo(BaseModel):
    """
    Informations détaillées sur un modèle d'IA disponible.

    Décrit les capacités, performances et configuration d'un modèle
    IA pour aider au choix du modèle approprié selon la tâche.

    Attributes:
        model_id: Identifiant complet (provider.model)
        provider: Nom du provider (openai, mistral, etc.)
        model_name: Nom spécifique du modèle
        reasoning: Score de raisonnement (1-10)
        speed: Score de vitesse (1-10)
        input_formats: Formats d'entrée supportés
        output_formats: Formats de sortie supportés
        context_length: Longueur maximale de contexte
        pricing: Informations de tarification
        notes: Notes complémentaires sur le modèle

    Examples:
        Voir model_config pour exemples JSON
    """

    model_id: str | None = Field(None, title="Model Id")
    """
    Identifiant complet (provider.model)
    """
    provider: str | None = Field(None, title="Provider")
    """
    Nom du provider
    """
    model_name: str | None = Field(None, title="Model Name")
    """
    Nom du modèle
    """
    reasoning: int | None = Field(None, title="Reasoning")
    """
    Niveau de raisonnement (1-10)
    """
    speed: int | None = Field(None, title="Speed")
    """
    Vitesse de traitement (1-10)
    """
    input_formats: list[str] | None = Field(None, title="Input Formats")
    """
    Formats d'entrée supportés
    """
    output_formats: list[str] | None = Field(None, title="Output Formats")
    """
    Formats de sortie supportés
    """
    context_length: int | None = Field(None, title="Context Length")
    """
    Longueur de contexte
    """
    pricing: dict[str, Any] | None = Field(None, title="Pricing")
    """
    Informations de tarification
    """
    notes: str | None = Field(None, title="Notes")
    """
    Notes sur le modèle
    """


class MultiTaskProcessResponse(BaseModel):
    """
    DTO de réponse après soumission d'un job MultiTask.

    Attributes:
        success: Indique si la soumission a réussi
        job_id: UUID du job créé
        multitask_id: UUID du MultiTask créé
        status: Statut initial (PENDING)
        submitted_at: Timestamp ISO 8601
        message: Message descriptif
        tasks_count: Nombre de tâches créées
        config_count: Nombre de configurations fournies
        task_ids: Liste des IDs de tâches créées
    """

    success: bool | None = Field(None, title="Success")
    job_id: str | None = Field(None, title="Job Id")
    multitask_id: str | None = Field(None, title="Multitask Id")
    status: str | None = Field(None, title="Status")
    submitted_at: str | None = Field(None, title="Submitted At")
    message: str | None = Field(None, title="Message")
    tasks_count: int | None = Field(None, title="Tasks Count")
    config_count: int | None = Field(None, title="Config Count")
    task_ids: list[str] | None = Field(None, title="Task Ids")


class ProcessResponse(BaseModel):
    """
    DTO de réponse après soumission d'un job de traitement.

    Confirme la création du job avec métadonnées (ID, statut initial, timestamp).

    ⚠️ ATOMICITÉ : 1 job = 1 task = 1 source (tasks_count et sources_count toujours = 1).

    Attributes:
        success: Indique si la soumission a réussi
        job_id: UUID du job créé
        status: Statut initial (toujours PENDING après création)
        submitted_at: Timestamp ISO 8601 de soumission
        message: Message descriptif pour l'utilisateur
        tasks_count: Nombre de tâches créées (toujours 1)
        sources_count: Nombre de sources à traiter (toujours 1)

    Notes:
        - Layer API : réponse HTTP uniquement
        - Factory method from_job_creation pour construction simplifiée
    """

    success: bool | None = Field(None, title="Success")
    """
    Indique si le traitement a réussi
    """
    job_id: str | None = Field(None, title="Job Id")
    """
    Identifiant unique du job créé
    """
    status: str | None = Field(None, title="Status")
    """
    Statut initial du job
    """
    submitted_at: str | None = Field(None, title="Submitted At")
    """
    Date/heure de soumission du job
    """
    message: str | None = Field(None, title="Message")
    """
    Message descriptif
    """
    tasks_count: int | None = Field(None, title="Tasks Count")
    """
    Nombre de tâches créées (toujours 1)
    """
    sources_count: int | None = Field(None, title="Sources Count")
    """
    Nombre de sources traitées (toujours 1)
    """


class ProviderConfig(BaseModel):
    """
    Configuration d'un provider avec son modèle optionnel.
    """

    name: str | None = Field(None, title="Name")
    """
    Nom du provider (openai, mistral, etc.)
    """
    model: str | None = Field(None, title="Model")
    """
    Modèle spécifique (si None, utilise le défaut)
    """


class ProviderFieldResultResponse(BaseModel):
    """
    Résultat d'un provider sur un champ.
    """

    value: Any | None = Field(None, title="Value")
    score: float | None = Field(None, title="Score")
    error: str | None = Field(None, title="Error")


class ProviderScoreResponse(BaseModel):
    """
    Score détaillé d'un provider.
    """

    provider: str | None = Field(None, title="Provider")
    model: str | None = Field(None, title="Model")
    rank: int | None = Field(None, title="Rank")
    overall_score: float | None = Field(None, title="Overall Score")
    precision: float | None = Field(None, title="Precision")
    recall: float | None = Field(None, title="Recall")
    f1_score: float | None = Field(None, title="F1 Score")
    field_scores: dict[str, Any] | None = Field(None, title="Field Scores")
    """
    Champs NON matchés avec détails {score, actual, expected}
    """
    true_positives: int | None = Field(None, title="True Positives")
    """
    Nombre de correspondances exactes
    """
    false_positives: int | None = Field(None, title="False Positives")
    """
    Nombre de champs en trop
    """
    false_negatives: int | None = Field(None, title="False Negatives")
    """
    Nombre de champs manquants
    """
    total_fields: int | None = Field(None, title="Total Fields")
    """
    Nombre total de champs comparés
    """
    matched_fields: int | None = Field(None, title="Matched Fields")
    """
    Nombre de champs parfaits (score=1.0)
    """
    processing_time_ms: int | None = Field(None, title="Processing Time Ms")
    """
    Temps de traitement en ms
    """
    cost_estimate: float | None = Field(None, title="Cost Estimate")
    """
    Estimation du coût
    """


class ServiceCapabilities(BaseModel):
    """
    Capacités et limitations d'un microservice.

    Définit les fonctionnalités supportées et les contraintes
    d'un service dans l'architecture Kraken.

    Attributes:
        supported_task_types: Types de tâches que le service peut traiter
        max_sources_per_job: Nombre maximum de sources par job
        max_tasks_per_job: Nombre maximum de tâches par job
        max_file_size_mb: Taille maximale de fichier acceptée
        async_execution: Support de l'exécution asynchrone
        task_workers: Nombre de workers dédiés aux tâches
    """

    supported_task_types: list[str] | None = Field(None, title="Supported Task Types")
    """
    Types de tâches supportés
    """
    max_sources_per_job: int | None = Field(None, title="Max Sources Per Job")
    """
    Nombre maximum de sources par job
    """
    max_tasks_per_job: int | None = Field(None, title="Max Tasks Per Job")
    """
    Nombre maximum de tâches par job
    """
    max_file_size_mb: int | None = Field(None, title="Max File Size Mb")
    """
    Taille maximum de fichier en MB
    """
    async_execution: bool | None = Field(None, title="Async Execution")
    """
    Support de l'exécution asynchrone
    """
    task_workers: int | None = Field(None, title="Task Workers")
    """
    Nombre de workers de tâches
    """


class ServiceEndpoints(BaseModel):
    """
    Endpoints disponibles dans un microservice.

    Liste des routes principales exposées par un service,
    utilisées pour la découverte et la documentation automatique.

    Attributes:
        process: Endpoint de soumission de tâches
        jobs: Endpoint de liste des jobs
        job_status: Endpoint de consultation du statut d'un job
        health: Endpoint de vérification de santé
        info: Endpoint d'informations générales
    """

    process: str | None = Field(None, title="Process")
    """
    Endpoint de traitement
    """
    jobs: str | None = Field(None, title="Jobs")
    """
    Endpoint de liste des jobs
    """
    job_status: str | None = Field(None, title="Job Status")
    """
    Endpoint de statut de job
    """
    health: str | None = Field(None, title="Health")
    """
    Endpoint de santé
    """
    info: str | None = Field(None, title="Info")
    """
    Endpoint d'informations
    """


class ServiceInfoResponse(BaseModel):
    """
    DTO de réponse pour les informations d'un microservice.

    Fournit une vue d'ensemble complète d'un service : ses capacités,
    endpoints disponibles et métadonnées générales.

    Attributes:
        service: Nom du service
        version: Version actuelle du service
        description: Description fonctionnelle
        capabilities: Capacités et limitations du service
        endpoints: Routes disponibles
        timestamp: Horodatage de la réponse
    """

    service: str | None = Field(None, title="Service")
    """
    Nom du service
    """
    version: str | None = Field(None, title="Version")
    """
    Version du service
    """
    description: str | None = Field(None, title="Description")
    """
    Description du service
    """
    capabilities: ServiceCapabilities | None = None
    """
    Capacités du service
    """
    endpoints: ServiceEndpoints | None = None
    """
    Endpoints disponibles
    """
    timestamp: str | None = Field(None, title="Timestamp")
    """
    Horodatage de la réponse
    """


class SourceExpectedPairRequest(BaseModel):
    """
    Paire source/expected result pour la création de benchmark.
    """

    source_id: str | None = Field(None, title="Source Id")
    """
    ID de la source à traiter
    """
    expected_result_id: str | None = Field(None, title="Expected Result Id")
    """
    ID du résultat attendu correspondant
    """


class TaskConfig(BaseModel):
    """
    Configuration de base d'une tâche (sans source_id).

    Utilisé pour les configurations partagées (ex: Bulk) ou comme base
    pour les requêtes atomiques.

    Attributes:
        task_type: Type de traitement à effectuer
        ai_provider: Provider IA à utiliser
        provider_model: Modèle spécifique du provider
        parameters: Paramètres additionnels spécifiques à la tâche
        max_retries: Nombre maximum de tentatives en cas d'échec
    """

    task_type: str | None = Field(None, title="Task Type")
    """
    Type de tâche à effectuer
    """
    ai_provider: str | None = Field(None, title="Ai Provider")
    """
    Provider IA utilisé
    """
    provider_model: str | None = Field(None, title="Provider Model")
    """
    Modèle du provider
    """
    parameters: dict[str, Any] | None = Field(None, title="Parameters")
    """
    Paramètres additionnels
    """
    max_retries: conint(ge=0, le=10) = Field(3, title="Max Retries")
    """
    Nombre maximum de tentatives
    """


class TaskCreationRequest(BaseModel):
    """
    DTO de requête pour créer une nouvelle tâche atomique.

    Ajoute source_id à la configuration de base.
    ⚠️ ATOMICITÉ : 1 task = 1 source (source_id obligatoire).

    Attributes:
        source_id: UUID de la source à traiter (obligatoire)
    """

    task_type: str | None = Field(None, title="Task Type")
    """
    Type de tâche à effectuer
    """
    ai_provider: str | None = Field(None, title="Ai Provider")
    """
    Provider IA utilisé
    """
    provider_model: str | None = Field(None, title="Provider Model")
    """
    Modèle du provider
    """
    parameters: dict[str, Any] | None = Field(None, title="Parameters")
    """
    Paramètres additionnels
    """
    max_retries: conint(ge=0, le=10) = Field(3, title="Max Retries")
    """
    Nombre maximum de tentatives
    """
    source_id: str | None = Field(None, title="Source Id")
    """
    UUID de la source à traiter
    """


class TaskDetail(BaseModel):
    """
    DTO de réponse pour une tâche avec métadonnées et résultat optionnel.

    Représente l'état complet d'une tâche, incluant sa configuration,
    son statut d'exécution et son résultat quand disponible.

    Le champ `result` est optionnel et vaut `None` pour les tâches
    en cours ou échouées. Seules les tâches COMPLETED ont un résultat.

    Attributes:
        id: Identifiant unique de la tâche
        job_id: Job parent de la tâche
        source_id: Source de données associée à la tâche
        task_type: Type de traitement effectué
        ai_provider: Provider IA utilisé
        provider_model: Modèle spécifique utilisé
        status: Statut d'exécution (PENDING, RUNNING, COMPLETED, FAILED)
        parameters: Paramètres de configuration
        max_retries: Nombre maximum de tentatives
        retry_count: Nombre de tentatives déjà effectuées
        created_at: Date de création (ISO 8601)
        started_at: Date de début d'exécution (ISO 8601, optionnel)
        completed_at: Date de fin d'exécution (ISO 8601, optionnel)
        result: Résultat de l'exécution (optionnel, disponible si COMPLETED)

    Examples:
        ```python
        # Tâche en cours (sans résultat)
        task = TaskDetail(
            id="abc123", job_id="job456", source_id="src789",
            task_type="extraction", ai_provider="openai",
            provider_model="gpt-4.1", status="RUNNING",
            parameters={}, max_retries=3, retry_count=0,
            created_at="2025-11-08T10:00:00Z",
            result=None  # Pas encore de résultat
        )

        # Tâche terminée (avec résultat)
        task = TaskDetail(
            id="abc123", job_id="job456", source_id="src789",
            task_type="extraction", ai_provider="openai",
            provider_model="gpt-4.1", status="COMPLETED",
            parameters={}, max_retries=3, retry_count=0,
            created_at="2025-11-08T10:00:00Z",
            completed_at="2025-11-08T10:02:30Z",
            result={"extracted_text": "..."}  # Résultat disponible
        )
        ```
    """

    id: str | None = Field(None, title="Id")
    """
    Identifiant unique de la tâche
    """
    job_id: str | None = Field(None, title="Job Id")
    """
    Identifiant du job parent
    """
    source_id: str | None = Field(None, title="Source Id")
    """
    Identifiant de la source de données
    """
    task_type: str | None = Field(None, title="Task Type")
    """
    Type de tâche
    """
    ai_provider: str | None = Field(None, title="Ai Provider")
    """
    Provider IA utilisé
    """
    provider_model: str | None = Field(None, title="Provider Model")
    """
    Modèle du provider
    """
    status: str | None = Field(None, title="Status")
    """
    Statut d'exécution
    """
    parameters: dict[str, Any] | None = Field(None, title="Parameters")
    """
    Paramètres de configuration
    """
    max_retries: int = Field(3, title="Max Retries")
    """
    Nombre maximum de tentatives
    """
    retry_count: int = Field(0, title="Retry Count")
    """
    Nombre de tentatives effectuées
    """
    created_at: str | None = Field(None, title="Created At")
    """
    Date de création (ISO 8601)
    """
    started_at: str | None = Field(None, title="Started At")
    """
    Date de début d'exécution (ISO 8601)
    """
    completed_at: str | None = Field(None, title="Completed At")
    """
    Date de fin d'exécution (ISO 8601)
    """
    result: dict[str, Any] | None = Field(None, title="Result")
    """
    Résultat de l'exécution (disponible si status=COMPLETED)
    """


class TaskInfo(BaseModel):
    """
    Informations détaillées sur un type de tâche disponible.

    Décrit une tâche que le système peut exécuter, avec ses paramètres
    et modèles compatibles.

    Attributes:
        task_type: Type technique de la tâche (extraction, annotation)
        name: Nom affiché de la tâche
        description: Description fonctionnelle
        enabled: Si la tâche est activée dans le système
        parameters: Configuration de la tâche
        available_models: Liste des modèles compatibles

    Examples:
        Voir model_config pour exemples JSON
    """

    task_type: str | None = Field(None, title="Task Type")
    """
    Type de tâche
    """
    name: str | None = Field(None, title="Name")
    """
    Nom affiché
    """
    description: str | None = Field(None, title="Description")
    """
    Description de la tâche
    """
    enabled: bool | None = Field(None, title="Enabled")
    """
    Tâche activée
    """
    parameters: dict[str, Any] | None = Field(None, title="Parameters")
    """
    Paramètres de la tâche
    """
    available_models: list[ModelInfo] | None = Field(None, title="Available Models")
    """
    Modèles compatibles
    """


class TasksInfoResponse(BaseModel):
    """
    DTO de réponse pour la liste des tâches disponibles.

    Fournit un aperçu complet des tâches configurées dans le système,
    avec statistiques sur les modèles disponibles.

    Attributes:
        tasks: Liste détaillée des tâches
        total_tasks: Nombre total de tâches
        total_models: Nombre total de modèles sur toutes les tâches
        timestamp: Horodatage de la réponse

    Examples:
        Voir model_config pour exemples JSON
    """

    tasks: list[TaskInfo] | None = Field(None, title="Tasks")
    """
    Liste des tâches disponibles
    """
    total_tasks: int | None = Field(None, title="Total Tasks")
    """
    Nombre total de tâches
    """
    total_models: int | None = Field(None, title="Total Models")
    """
    Nombre total de modèles disponibles
    """
    timestamp: str | None = Field(None, title="Timestamp")
    """
    Horodatage de la réponse
    """


class UpdateApiKeyRequest(BaseModel):
    """
    DTO de requête pour mettre à jour une clé API existante.

    Permet de modifier la clé API, sa description ou son statut actif.
    Tous les champs sont optionnels pour permettre des mises à jour partielles.

    Attributes:
        api_key: Nouvelle clé API (sera chiffrée si fournie)
        description: Nouvelle description
        is_active: Nouveau statut actif/inactif

    Examples:
        Voir model_config pour exemples JSON
    """

    api_key: constr(min_length=1) | None = Field(None, title="Api Key")
    """
    Nouvelle clé API en clair
    """
    description: constr(max_length=500) | None = Field(None, title="Description")
    """
    Nouvelle description
    """
    is_active: bool | None = Field(None, title="Is Active")
    """
    Statut actif de la clé
    """


class UploadResponse(BaseModel):
    """
    DTO de réponse après upload de fichier source réussi.

    Retourne les métadonnées complètes du fichier uploadé avec informations
    sur la déduplication (si le fichier existait déjà via content_hash).

    Architecture Layer: API
    Pattern: DTO (Data Transfer Object) - Response serialization

    Attributes:
        id: UUID unique de la source
        name: Nom du fichier
        type: Type de source (pdf, image, text, etc.)
        size_bytes: Taille en octets
        content_hash: Hash SHA-256 du contenu
        page_count: Nombre de pages (pour documents multi-pages)
        format: Format détecté (ex: "PDF 1.7", "PNG", "UTF-8")
        character_count: Nombre de caractères (pour fichiers texte)
        encoding: Encodage détecté (pour fichiers texte)
        created_at: Date de création ISO 8601
        deduplicated: True si le fichier existait déjà (économie de stockage)

    Factory Methods:
        - from_source_entity(): Depuis SourceEntity (domain)
        - from_storage_result(): Depuis dict de StorageBusinessService

    Example:
        >>> entity = SourceEntity(id=..., name="doc.pdf", ...)
        >>> response = UploadResponse.from_source_entity(entity, deduplicated=False)
        >>> return response  # FastAPI serialize automatiquement

    Note:
        deduplicated=True signifie que l'upload a été évité (fichier existait déjà).
        Le client peut utiliser cette info pour optimiser les uploads futurs.
    """

    id: str | None = Field(None, title="Id")
    """
    UUID unique de la source uploadée
    """
    name: str | None = Field(None, title="Name")
    """
    Nom du fichier
    """
    type: str | None = Field(None, title="Type")
    """
    Type de source (pdf, image, text)
    """
    size_bytes: int | None = Field(None, title="Size Bytes")
    """
    Taille en octets
    """
    content_hash: str | None = Field(None, title="Content Hash")
    """
    Hash SHA-256 du contenu
    """
    page_count: int | None = Field(None, title="Page Count")
    """
    Nombre de pages (pour documents)
    """
    format: str | None = Field(None, title="Format")
    """
    Format détecté du fichier
    """
    character_count: int | None = Field(None, title="Character Count")
    """
    Nombre de caractères (texte)
    """
    encoding: str | None = Field(None, title="Encoding")
    """
    Encodage détecté (texte)
    """
    created_at: str | None = Field(None, title="Created At")
    """
    Date de création ISO
    """
    deduplicated: bool | None = Field(None, title="Deduplicated")
    """
    True si la source existait déjà (dédupliquée)
    """


class UserApiKeysResponse(BaseModel):
    """
    DTO de réponse pour la liste des clés API d'un utilisateur.

    Fournit un aperçu complet des clés API enregistrées par un utilisateur,
    avec statistiques sur le nombre total et actif de clés.

    Attributes:
        user_id: Identifiant de l'utilisateur
        api_keys: Liste détaillée des clés API
        total_count: Nombre total de clés
        active_count: Nombre de clés actives
    """

    user_id: UUID | None = Field(None, title="User Id")
    """
    Identifiant de l'utilisateur
    """
    api_keys: list[ApiKeyResponse] | None = Field(None, title="Api Keys")
    """
    Liste des clés API
    """
    total_count: int | None = Field(None, title="Total Count")
    """
    Nombre total de clés API
    """
    active_count: int | None = Field(None, title="Active Count")
    """
    Nombre de clés API actives
    """


class HTTPValidationError(BaseModel):
    detail: list[ValidationError] | None = Field(None, title="Detail")


class KrakenApiKeyResponse(BaseModel):
    """
    DTO de réponse pour une clé API Kraken nouvellement générée.

    Contient la clé API générée, les informations de l'utilisateur associé,
    et un message d'avertissement sur la sécurité.

    Important:
        La clé API n'est retournée qu'une seule fois lors de la génération.
        Elle doit être stockée de manière sécurisée par le client.

    Attributes:
        api_key: Clé API générée avec préfixe 'kraken_'
        user: Informations de l'utilisateur propriétaire de la clé
        message: Message d'information sur la sécurité
    """

    api_key: str | None = Field(None, title="Api Key")
    """
    Clé API générée (format: kraken_xxxxx)
    """
    user: UserResponse | None = None
    """
    Informations utilisateur
    """
    message: str = Field(
        "Clé API générée avec succès. Conservez-la précieusement, elle ne sera plus"
        " affichée.",
        title="Message",
    )
    """
    Message d'information
    """


class AnnotationConfigModel(BaseModel):
    """
    Configuration complète pour une tâche d'annotation structurée.

    Définit le schéma d'extraction, le format de sortie et les règles
    de validation pour les tâches d'annotation de documents.

    Attributes:
        annotation_schema: Dictionnaire des entités à annoter
        output_format: Format de sortie souhaité (json, xml, etc.)
        validation_rules: Règles de validation supplémentaires
        max_annotations: Nombre maximum d'annotations par document
        context: Texte additionnel à fournir au modèle pour l'annotation.
            Peut être utilisé seul (annotation de texte brut) ou en complément
            d'un fichier source (PDF/image) pour enrichir le contexte.

    Examples:
        Voir model_config pour exemples JSON
    """

    annotation_schema: dict[str, AnnotationSchemaModel] | None = Field(
        None, title="Annotation Schema"
    )
    """
    Dictionnaire des entités à annoter avec leurs configurations
    """
    output_format: str = Field("json", title="Output Format")
    """
    Format de sortie souhaité
    """
    validation_rules: dict[str, Any] | None = Field(None, title="Validation Rules")
    """
    Règles de validation supplémentaires
    """
    max_annotations: int | None = Field(None, title="Max Annotations")
    """
    Nombre maximum d'annotations par document
    """
    context: str | None = Field(None, title="Context")
    """
    Texte additionnel à fournir au modèle pour l'annotation. Peut être utilisé seul (sans fichier source) ou en complément d'un fichier.
    """


class AnnotationTaskConfig(BaseModel):
    """
    Configuration pour tâche d'annotation (sans source_id).
    """

    task_type: str | None = Field(None, title="Task Type")
    """
    Type de tâche à effectuer
    """
    ai_provider: str | None = Field(None, title="Ai Provider")
    """
    Provider IA utilisé
    """
    provider_model: str | None = Field(None, title="Provider Model")
    """
    Modèle du provider
    """
    parameters: dict[str, Any] | None = Field(None, title="Parameters")
    """
    Paramètres additionnels
    """
    max_retries: conint(ge=0, le=10) = Field(3, title="Max Retries")
    """
    Nombre maximum de tentatives
    """
    annotation_config: AnnotationConfigModel | None = None
    """
    Configuration obligatoire pour les tâches d'annotation
    """


class AnnotationTaskRequest(BaseModel):
    """
    DTO de requête pour créer une tâche d'annotation structurée (avec source_id).

    Spécialisation de TaskCreationRequest pour les tâches
    d'annotation avec extraction de données structurées selon un schéma.

    Attributes:
        annotation_config: Configuration obligatoire du schéma d'annotation

    Hérite de tous les attributs de TaskCreationRequest (incluant source_id).

    Examples:
        Voir model_config pour exemples JSON
    """

    task_type: str | None = Field(None, title="Task Type")
    """
    Type de tâche à effectuer
    """
    ai_provider: str | None = Field(None, title="Ai Provider")
    """
    Provider IA utilisé
    """
    provider_model: str | None = Field(None, title="Provider Model")
    """
    Modèle du provider
    """
    parameters: dict[str, Any] | None = Field(None, title="Parameters")
    """
    Paramètres additionnels
    """
    max_retries: conint(ge=0, le=10) = Field(3, title="Max Retries")
    """
    Nombre maximum de tentatives
    """
    source_id: str | None = Field(None, title="Source Id")
    """
    UUID de la source à traiter
    """
    annotation_config: AnnotationConfigModel | None = None
    """
    Configuration obligatoire pour les tâches d'annotation
    """


class ApiKeyCreatedResponse(BaseModel):
    """
    DTO de réponse pour la création d'une clé API.

    Confirmé la création réussie d'une nouvelle clé API
    et retourne les informations de la clé créée.

    Attributes:
        api_key: Informations de la clé API créée
        message: Message de confirmation
    """

    api_key: ApiKeyResponse | None = None
    """
    Clé API créée
    """
    message: str | None = Field(None, title="Message")
    """
    Message de confirmation
    """


class BulkProcessRequest(BaseModel):
    """
    DTO pour requête de traitement bulk (1 config → N sources).

    Attributes:
        task_config: Configuration de tâche commune (sans source_id)
        source_ids: Liste des IDs de sources à traiter

    Notes:
        - Layer API : validation entrée HTTP uniquement
        - Validation automatique des UUID sources
        - Pattern Bulk Job[Task] : 1 config, N tâches créées
    """

    task_config: ExtractionTaskConfig | AnnotationTaskConfig | TaskConfig | None = (
        Field(None, title="Task Config")
    )
    """
    Configuration de tâche commune à toutes les sources (sans source_id)
    """
    source_ids: list[str] | None = Field(
        None, max_length=100, min_length=1, title="Source Ids"
    )
    """
    Liste des IDs de sources à traiter en bulk
    """
    mode: Literal["bulk"] = Field("bulk", title="Mode")
    """
    Type de traitement demandé (single/bulk/multitask)
    """


class CreateBenchmarkRequest(BaseModel):
    """
    Requête de création de benchmark unifié (1 à N sources).

    Les providers peuvent être spécifiés de deux façons:
    - Liste de strings: ["openai", "mistral"] (utilise les modèles par défaut)
    - Liste d'objets: [{"name": "openai", "model": "gpt-4.1"}, ...]
    """

    source_expected_pairs: list[SourceExpectedPairRequest] | None = Field(
        None, min_length=1, title="Source Expected Pairs"
    )
    """
    Liste des paires source/expected result
    """
    benchmark_type: constr(pattern=r"^(extraction|annotation)$") | None = Field(
        None, title="Benchmark Type"
    )
    providers: list[ProviderConfig] | None = Field(
        None, min_length=1, title="Providers"
    )
    config: dict[str, Any] | None = Field(None, title="Config")


class FieldDiffResponse(BaseModel):
    """
    Différence détaillée sur un champ.
    """

    field: str | None = Field(None, title="Field")
    expected: Any | None = Field(None, title="Expected")
    results: dict[str, ProviderFieldResultResponse] | None = Field(
        None, title="Results"
    )


class JobTasksResponse(BaseModel):
    """
    DTO de réponse pour les tâches d'un job.

    Contient les détails de toutes les tâches d'un job avec leurs résultats.

    Attributes:
        job_id: ID du job
        tasks: Liste détaillée des tâches
        total_tasks: Nombre total de tâches
        completed_tasks: Nombre de tâches terminées
        timestamp: Horodatage de la réponse
    """

    job_id: str | None = Field(None, title="Job Id")
    """
    Identifiant du job
    """
    tasks: list[TaskDetail] | None = Field(None, title="Tasks")
    """
    Détails des tâches avec résultats
    """
    total_tasks: int | None = Field(None, title="Total Tasks")
    """
    Nombre total de tâches
    """
    completed_tasks: int | None = Field(None, title="Completed Tasks")
    """
    Nombre de tâches terminées
    """
    timestamp: str | None = Field(None, title="Timestamp")
    """
    Horodatage de la réponse
    """


class MultiTaskProcessRequest(BaseModel):
    """
    DTO de requête pour lancer un traitement MultiTask.

    MultiTask = 1 source × N configs → N tasks

    Attributes:
        source_id: UUID de la source unique partagée
        task_configs: Liste des configurations de tâches (2 à 10)

    Notes:
        - Minimum 2 configs (sinon utiliser /process standard)
        - Maximum 10 configs (limite de sécurité)
    """

    source_id: str | None = Field(None, title="Source Id")
    """
    UUID de la source unique à traiter avec plusieurs configs
    """
    task_configs: (
        list[ExtractionTaskConfig | AnnotationTaskConfig | TaskConfig] | None
    ) = Field(None, max_length=10, min_length=2, title="Task Configs")
    """
    Liste des configurations de tâches (2 à 10)
    """
    mode: Literal["multitask"] = Field("multitask", title="Mode")
    """
    Type de traitement demandé (single/bulk/multitask)
    """


class ProcessRequest(BaseModel):
    """
    DTO de requête pour lancer un traitement (job + tâche).

    ⚠️ ATOMICITÉ : 1 requête = 1 job = 1 task = 1 source.

    La configuration de la tâche inclut directement le source_id,
    garantissant une unité de travail atomique et traçable.

    Attributes:
        task: Configuration de la tâche à exécuter (contient source_id)

    Notes:
        - Validation automatique du source_id dans la task (format UUID)
        - Validation de la tâche (type, provider, model obligatoires)
        - Layer API : validation entrée HTTP uniquement
        - Pattern simple Job[Task] : 1 task par requête
    """

    task: ExtractionTaskRequest | AnnotationTaskRequest | TaskCreationRequest | None = (
        Field(None, title="Task")
    )
    """
    Configuration de la tâche à exécuter (inclut source_id)
    """
    mode: Literal["single"] = Field("single", title="Mode")
    """
    Type de traitement demandé (single/bulk/multitask)
    """


class BenchmarkReportResponse(BaseModel):
    """
    Rapport complet de benchmark.
    """

    benchmark_id: str | None = Field(None, title="Benchmark Id")
    source_id: str | None = Field(None, title="Source Id")
    source_name: str | None = Field(None, title="Source Name")
    """
    Nom du fichier source
    """
    benchmark_type: str | None = Field(None, title="Benchmark Type")
    winner: str | None = Field(None, title="Winner")
    summary: str | None = Field(None, title="Summary")
    statistics: dict[str, Any] | None = Field(None, title="Statistics")
    provider_scores: list[ProviderScoreResponse] | None = Field(
        None, title="Provider Scores"
    )
    field_diffs: list[FieldDiffResponse] | None = Field(None, title="Field Diffs")
    created_at: AwareDatetime | None = Field(None, title="Created At")


class AggregatedBenchmarkReportResponse(BaseModel):
    """
    Rapport agrégé pour benchmark multi-sources.
    """

    benchmark_id: str | None = Field(None, title="Benchmark Id")
    report_type: str = Field("aggregated", title="Report Type")
    summary: str | None = Field(None, title="Summary")
    global_ranking: list[dict[str, Any]] | None = Field(None, title="Global Ranking")
    aggregate_scores: dict[str, dict[str, float]] | None = Field(
        None, title="Aggregate Scores"
    )
    statistics: dict[str, Any] | None = Field(None, title="Statistics")
    individual_reports: list[BenchmarkReportResponse] | None = Field(
        None, title="Individual Reports"
    )
    field_analysis: FieldAnalysisResponse | None = None
    created_at: AwareDatetime | None = Field(None, title="Created At")
