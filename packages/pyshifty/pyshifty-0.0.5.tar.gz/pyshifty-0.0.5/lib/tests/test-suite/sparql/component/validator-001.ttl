@prefix ex: <http://datashapes.org/sh/tests/sparql/component/validator-001.test#> .
@prefix mf: <http://www.w3.org/2001/sw/DataAccess/tests/test-manifest#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix sht: <http://www.w3.org/ns/shacl-test#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

ex:ConstraintComponent a rdfs:Class ;
    rdfs:label "Constraint component" ;
    rdfs:subClassOf sh:ConstraintComponent .

<http://datashapes.org/sh/tests/sparql/component/validator-001.test> owl:imports <http://datashapes.org/dash> .

ex:SPARQLAskValidator rdfs:subClassOf sh:SPARQLAskValidator .

ex:TestConstraintComponent a ex:ConstraintComponent ;
    rdfs:label "Test constraint component" ;
    rdfs:comment """A simple test component with two parameters, which flags all values as invalid unless they are the concatenation of the two parameters.

Part of this test is to also use various subclasses of the system classes.""" ;
    sh:parameter ex:TestParameter1,
        ex:TestParameter2 ;
    sh:validator [ a ex:SPARQLAskValidator ;
            sh:ask """
ASK { FILTER (?value = CONCAT($test1, $test2)) }
     """ ] .

ex:TestParameter1 a sh:Parameter ;
    sh:datatype xsd:string ;
    sh:path ex:test1 .

ex:TestParameter2 a sh:Parameter ;
    sh:datatype xsd:string ;
    sh:path ex:test2 .

ex:TestShape a sh:NodeShape ;
    rdfs:label "Test shape" ;
    ex:test1 "Hello " ;
    ex:test2 "World" ;
    sh:targetNode "Hallo Welt",
        "Hello World" .

<urn:validator-001> a sht:Validate ;
    rdfs:label "Test of sh:validator 001" ;
    mf:action [ sht:dataGraph <urn:validator-001.ttl> ;
            sht:shapesGraph <urn:validator-001.ttl> ] ;
    mf:result [ a sh:ValidationReport ;
            sh:conforms false ;
            sh:result [ a sh:ValidationResult ;
                    sh:focusNode "Hallo Welt" ;
                    sh:resultSeverity sh:Violation ;
                    sh:sourceConstraintComponent ex:TestConstraintComponent ;
                    sh:sourceShape ex:TestShape ;
                    sh:value "Hallo Welt" ] ] ;
    mf:status sht:approved .

<urn:validator-001.ttl> a mf:Manifest ;
    mf:entries ( <urn:validator-001> ) .

