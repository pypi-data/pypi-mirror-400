# This file was auto-generated by Fern from our API Definition.

import datetime as dt
import typing

from ..core.client_wrapper import AsyncClientWrapper, SyncClientWrapper
from ..core.request_options import RequestOptions
from ..types.decision_log_response import DecisionLogResponse
from .raw_client import AsyncRawDecisionsClient, RawDecisionsClient
from .types.query_decisions_request_count import QueryDecisionsRequestCount


class DecisionsClient:
    def __init__(self, *, client_wrapper: SyncClientWrapper):
        self._raw_client = RawDecisionsClient(client_wrapper=client_wrapper)

    @property
    def with_raw_response(self) -> RawDecisionsClient:
        """
        Retrieves a raw implementation of this client that returns raw responses.

        Returns
        -------
        RawDecisionsClient
        """
        return self._raw_client

    def query(
        self,
        *,
        search: typing.Optional[str] = None,
        rules: typing.Optional[str] = None,
        statuses: typing.Optional[str] = None,
        start: typing.Optional[dt.datetime] = None,
        end: typing.Optional[dt.datetime] = None,
        cursor: typing.Optional[str] = None,
        limit: typing.Optional[int] = None,
        count: typing.Optional[QueryDecisionsRequestCount] = None,
        slug: typing.Optional[str] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> DecisionLogResponse:
        """
        Query decision logs with support for the decision data query language, rule/status filters, date ranges, and pagination. The query language supports field comparisons (e.g., `alpha=0`, `score>10`), contains/not-contains (e.g., `name:John`, `status!:error`), boolean logic (`AND`, `OR`), and parentheses for grouping.

        Parameters
        ----------
        search : typing.Optional[str]
            Decision data query language expression to filter logs by request/response data. Supports field comparisons (`field=value`, `field>10`), contains (`field:text`), not-contains (`field!:text`), boolean operators (`AND`, `OR`), and parentheses.

        rules : typing.Optional[str]
            Comma-separated list of rule names to filter logs by.

        statuses : typing.Optional[str]
            Comma-separated list of HTTP status codes to filter logs by.

        start : typing.Optional[dt.datetime]
            Start date for the query range (ISO8601 format).

        end : typing.Optional[dt.datetime]
            End date for the query range (ISO8601 format).

        cursor : typing.Optional[str]
            Cursor for pagination (returned from previous query).

        limit : typing.Optional[int]
            Number of results to return per page (default: 100).

        count : typing.Optional[QueryDecisionsRequestCount]
            If set to 'true', returns only the count of matching logs instead of the log data.

        slug : typing.Optional[str]
            (Deprecated) Legacy parameter for filtering by rule slug. Use 'rules' parameter instead.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        DecisionLogResponse
            Successful response

        Examples
        --------
        from rulebricks import Rulebricks

        client = Rulebricks(
            api_key="YOUR_API_KEY",
        )
        client.decisions.query(
            search="status=200",
            rules="Lead Qualification,Pricing Calculator",
            statuses="200,400,500",
        )
        """
        _response = self._raw_client.query(
            search=search,
            rules=rules,
            statuses=statuses,
            start=start,
            end=end,
            cursor=cursor,
            limit=limit,
            count=count,
            slug=slug,
            request_options=request_options,
        )
        return _response.data


class AsyncDecisionsClient:
    def __init__(self, *, client_wrapper: AsyncClientWrapper):
        self._raw_client = AsyncRawDecisionsClient(client_wrapper=client_wrapper)

    @property
    def with_raw_response(self) -> AsyncRawDecisionsClient:
        """
        Retrieves a raw implementation of this client that returns raw responses.

        Returns
        -------
        AsyncRawDecisionsClient
        """
        return self._raw_client

    async def query(
        self,
        *,
        search: typing.Optional[str] = None,
        rules: typing.Optional[str] = None,
        statuses: typing.Optional[str] = None,
        start: typing.Optional[dt.datetime] = None,
        end: typing.Optional[dt.datetime] = None,
        cursor: typing.Optional[str] = None,
        limit: typing.Optional[int] = None,
        count: typing.Optional[QueryDecisionsRequestCount] = None,
        slug: typing.Optional[str] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> DecisionLogResponse:
        """
        Query decision logs with support for the decision data query language, rule/status filters, date ranges, and pagination. The query language supports field comparisons (e.g., `alpha=0`, `score>10`), contains/not-contains (e.g., `name:John`, `status!:error`), boolean logic (`AND`, `OR`), and parentheses for grouping.

        Parameters
        ----------
        search : typing.Optional[str]
            Decision data query language expression to filter logs by request/response data. Supports field comparisons (`field=value`, `field>10`), contains (`field:text`), not-contains (`field!:text`), boolean operators (`AND`, `OR`), and parentheses.

        rules : typing.Optional[str]
            Comma-separated list of rule names to filter logs by.

        statuses : typing.Optional[str]
            Comma-separated list of HTTP status codes to filter logs by.

        start : typing.Optional[dt.datetime]
            Start date for the query range (ISO8601 format).

        end : typing.Optional[dt.datetime]
            End date for the query range (ISO8601 format).

        cursor : typing.Optional[str]
            Cursor for pagination (returned from previous query).

        limit : typing.Optional[int]
            Number of results to return per page (default: 100).

        count : typing.Optional[QueryDecisionsRequestCount]
            If set to 'true', returns only the count of matching logs instead of the log data.

        slug : typing.Optional[str]
            (Deprecated) Legacy parameter for filtering by rule slug. Use 'rules' parameter instead.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        DecisionLogResponse
            Successful response

        Examples
        --------
        import asyncio

        from rulebricks import AsyncRulebricks

        client = AsyncRulebricks(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.decisions.query(
                search="status=200",
                rules="Lead Qualification,Pricing Calculator",
                statuses="200,400,500",
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.query(
            search=search,
            rules=rules,
            statuses=statuses,
            start=start,
            end=end,
            cursor=cursor,
            limit=limit,
            count=count,
            slug=slug,
            request_options=request_options,
        )
        return _response.data
