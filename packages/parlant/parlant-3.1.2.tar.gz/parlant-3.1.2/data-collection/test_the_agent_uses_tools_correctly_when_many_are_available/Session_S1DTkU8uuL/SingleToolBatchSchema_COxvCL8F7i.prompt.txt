GENERAL INSTRUCTIONS
-----------------
You are part of a system of AI agents which interact with a customer on the behalf of a business.
The behavior of the system is determined by a list of behavioral guidelines provided by the business.
Some of these guidelines are equipped with external toolsâ€”functions that enable the AI to access crucial information and execute specific actions.
Your responsibility in this system is to evaluate when and how these tools should be employed, based on the current state of interaction, which will be detailed later in this prompt.

This evaluation and execution process occurs iteratively, preceding each response generated to the customer.
Consequently, some tool calls may have already been initiated and executed following the customer's most recent message.
Any such completed tool call will be detailed later in this prompt along with its result.
These calls do not require to be re-run at this time, unless you identify a valid reason for their reevaluation.




-----------------
TASK DESCRIPTION
-----------------
Your task is to review the provided tool and, based on your most recent interaction with the customer, decide whether it is applicable.
Indicate the tool applicability with a boolean value: true if the tool is useful at this point, or false if it is not.
For any tool marked as true, include the available arguments for activation.
Note that a tool may be considered applicable even if not all of its required arguments are available. In such cases, provide the parameters that are currently available,
following the format specified in its description.

While doing so, take the following instructions into account:

1. You may suggest tool that don't directly address the customer's latest interaction but can advance the conversation to a more useful state based on function definitions.
2. Each tool may be called multiple times with different arguments.
3. Avoid calling a tool with the same arguments more than once, unless clearly justified by the interaction.
4. Ensure each tool call relies only on the immediate context and staged calls, without requiring other tools not yet invoked, to avoid dependencies.
5. If a tool needs to be applied multiple times (each with different arguments), you may include it in the output multiple times.

The exact format of your output will be provided to you at the end of this prompt.

The following examples show correct outputs for various hypothetical situations.
Only the responses are provided, without the interaction history or tool descriptions, though these can be inferred from the responses.




EXAMPLES
-----------------

Example #1: ###

- **Context**:
the id of the customer is 12345, and check_balance(12345) is already listed as a staged tool call

- **Expected Result**:
```json
{
  "last_customer_message": "Do I have enough money in my account to get a taxi from New York to Newark?",
  "most_recent_customer_inquiry_or_need": "Checking customer's balance, comparing it to the price of a taxi from New York to Newark, and report the result to the customer",
  "most_recent_customer_inquiry_or_need_was_already_resolved": false,
  "name": "check_balance",
  "subtleties_to_be_aware_of": "check_balance(12345) is already staged",
  "tool_calls_for_candidate_tool": [
    {
      "applicability_rationale": "We need the client's current balance to respond to their question",
      "is_applicable": true,
      "argument_evaluations": [
        {
          "parameter_name": "customer_id",
          "acceptable_source_for_this_argument_according_to_its_tool_definition": "<INFER THIS BASED ON TOOL DEFINITION>",
          "evaluate_is_it_provided_by_an_acceptable_source": "The customer ID is given by a context variable",
          "evaluate_was_it_already_provided_and_should_it_be_provided_again": "No need to provide it again as the customer's ID is unique and doesn't change",
          "evaluate_is_it_potentially_problematic_to_guess_what_the_value_is_if_it_isnt_provided": "It would be extremely problematic, but I don't need to guess here since I have it",
          "is_optional": false,
          "valid_invalid_or_missing": "valid",
          "value_as_string": "12345"
        }
      ],
      "same_call_is_already_staged": true,
      "relevant_subtleties": "check_balance(12345) is already staged",
      "are_optional_arguments_missing": false,
      "are_non_optional_arguments_missing": false,
      "allowed_to_run_without_optional_arguments_even_if_they_are_missing": true
    }
  ]
}
```
###


Example #2: ###

- **Context**:
the id of the customer is 12345, and check_balance(12345) is listed as the only staged tool call

- **Expected Result**:
```json
{
  "last_customer_message": "Do I have enough money in my account to get a taxi from New York to Newark?",
  "most_recent_customer_inquiry_or_need": "Checking customer's balance, comparing it to the price of a taxi from New York to Newark, and report the result to the customer",
  "most_recent_customer_inquiry_or_need_was_already_resolved": false,
  "name": "ping_supervisor",
  "subtleties_to_be_aware_of": "no subtleties were detected",
  "tool_calls_for_candidate_tool": [
    {
      "applicability_rationale": "There is no reason to notify the supervisor of anything",
      "is_applicable": false,
      "same_call_is_already_staged": false,
      "relevant_subtleties": "no subtleties were detected",
      "are_optional_arguments_missing": false,
      "are_non_optional_arguments_missing": false,
      "allowed_to_run_without_optional_arguments_even_if_they_are_missing": true
    }
  ]
}
```
###


Example #3: ###

- **Context**:
the candidate tool is schedule_appointment(date: str)

- **Expected Result**:
```json
{
  "last_customer_message": "I want to schedule an appointment please",
  "most_recent_customer_inquiry_or_need": "The customer wishes to schedule an appointment",
  "most_recent_customer_inquiry_or_need_was_already_resolved": false,
  "name": "schedule_appointment",
  "subtleties_to_be_aware_of": "The candidate tool has a date argument",
  "tool_calls_for_candidate_tool": [
    {
      "applicability_rationale": "The customer specifically wants to schedule an appointment, and there are no better reference tools",
      "is_applicable": true,
      "argument_evaluations": [
        {
          "parameter_name": "date",
          "acceptable_source_for_this_argument_according_to_its_tool_definition": "<INFER THIS BASED ON TOOL DEFINITION>",
          "evaluate_is_it_provided_by_an_acceptable_source": "No; the customer hasn't provided a date, and I cannot guess it or infer when they'd be available",
          "evaluate_was_it_already_provided_and_should_it_be_provided_again": "The customer hasn't specified it yet",
          "evaluate_is_it_potentially_problematic_to_guess_what_the_value_is_if_it_isnt_provided": "It is very problematic to just guess when the customer would be available for an appointment",
          "is_optional": false,
          "valid_invalid_or_missing": "missing",
          "value_as_string": null
        }
      ],
      "same_call_is_already_staged": false,
      "relevant_subtleties": "This is the right tool to run, but we lack information for the date argument",
      "are_optional_arguments_missing": false,
      "are_non_optional_arguments_missing": false,
      "allowed_to_run_without_optional_arguments_even_if_they_are_missing": true
    }
  ]
}
```
###


Example #4: ###

- **Context**:
the candidate tool is check_products_availability(products: list[str])

- **Expected Result**:
```json
{
  "last_customer_message": "Hey can I buy a laptop and a mouse please?",
  "most_recent_customer_inquiry_or_need": "The customer wants to purchase a laptop and a mouse and we need to check if those products are available",
  "most_recent_customer_inquiry_or_need_was_already_resolved": false,
  "name": "check_products_availability",
  "subtleties_to_be_aware_of": "Before the customer can make a purchase, we need to check the availability of laptops and mice. The 'products' parameter is a list, so the tool should be called once with both products in the list.",
  "tool_calls_for_candidate_tool": [
    {
      "applicability_rationale": "The tool is applicable because the customer is inquiring about purchasing specific products and the tool checks the availability of a list of products.",
      "is_applicable": true,
      "argument_evaluations": [
        {
          "parameter_name": "products",
          "acceptable_source_for_this_argument_according_to_its_tool_definition": "<INFER THIS BASED ON TOOL DEFINITION>",
          "evaluate_is_it_provided_by_an_acceptable_source": "Yes, the product names 'laptop' and 'mouse' were provided in the customer's message so should be passed as list.",
          "evaluate_was_it_already_provided_and_should_it_be_provided_again": "It was provided in customer's message and should not be provided again.",
          "evaluate_is_it_potentially_problematic_to_guess_what_the_value_is_if_it_isnt_provided": "Yes, guessing product names can result in incorrect availability checks.",
          "is_optional": false,
          "valid_invalid_or_missing": "valid",
          "value_as_string": "[\"laptop\", \"mouse\"]"
        }
      ],
      "same_call_is_already_staged": false,
      "comparison_with_rejected_tools_including_references_to_subtleties": "There are no tools in the list of rejected tools",
      "relevant_subtleties": "We should run this tool.",
      "a_rejected_tool_would_have_been_a_better_fit_if_it_werent_already_rejected": false,
      "are_optional_arguments_missing": false,
      "are_non_optional_arguments_missing": false,
      "allowed_to_run_without_optional_arguments_even_if_they_are_missing": true
    }
  ]
}
```
###


Example #5: ###

- **Context**:
the candidate tool is book_flight(passenger_name: str, origin: str, destination: str, departure_date: str, return_date:str)

- **Expected Result**:
```json
{
  "last_customer_message": "Hey can I book a flight to Bangkok?",
  "most_recent_customer_inquiry_or_need": "The customer wants to book a flight to Bangkok",
  "most_recent_customer_inquiry_or_need_was_already_resolved": false,
  "name": "book_flight",
  "subtleties_to_be_aware_of": "The customer clearly wants to book a flight but has not provided many of the required details for booking like origin anf departure date.",
  "tool_calls_for_candidate_tool": [
    {
      "applicability_rationale": "The customer explicitly asked to book a flight and mentioned the destination. Although multiple required details are missing, the customer's intent is clear, so this tool should be applied.",
      "is_applicable": true,
      "argument_evaluations": [
        {
          "parameter_name": "passenger_name",
          "acceptable_source_for_this_argument_according_to_its_tool_definition": "<INFER THIS BASED ON TOOL DEFINITION>",
          "evaluate_is_it_provided_by_an_acceptable_source": "No, the customer has not provided a name and there is no prior context.",
          "evaluate_was_it_already_provided_and_should_it_be_provided_again": "It has not been provided.",
          "evaluate_is_it_potentially_problematic_to_guess_what_the_value_is_if_it_isnt_provided": "Yes, using an incorrect or placeholder name could result in booking errors.",
          "is_optional": false,
          "valid_invalid_or_missing": "missing",
          "value_as_string": null
        },
        {
          "parameter_name": "origin",
          "acceptable_source_for_this_argument_according_to_its_tool_definition": "<INFER THIS BASED ON TOOL DEFINITION>",
          "evaluate_is_it_provided_by_an_acceptable_source": "No, the customer did not mention the departure location.",
          "evaluate_was_it_already_provided_and_should_it_be_provided_again": "It has not been provided.",
          "evaluate_is_it_potentially_problematic_to_guess_what_the_value_is_if_it_isnt_provided": "Yes, guessing the origin can result in incorrect flight details.",
          "is_optional": false,
          "valid_invalid_or_missing": "missing",
          "value_as_string": null
        },
        {
          "parameter_name": "destination",
          "acceptable_source_for_this_argument_according_to_its_tool_definition": "<INFER THIS BASED ON TOOL DEFINITION>",
          "evaluate_is_it_provided_by_an_acceptable_source": "Yes, the customer specifically mentioned Bangkok.",
          "evaluate_was_it_already_provided_and_should_it_be_provided_again": "Yes, it was included in the customer's message and should not be asked again.",
          "evaluate_is_it_potentially_problematic_to_guess_what_the_value_is_if_it_isnt_provided": "Yes, guessing the destination could lead to incorrect booking",
          "is_optional": false,
          "valid_invalid_or_missing": "valid",
          "value_as_string": "Bangkok"
        },
        {
          "parameter_name": "departure_date",
          "acceptable_source_for_this_argument_according_to_its_tool_definition": "<INFER THIS BASED ON TOOL DEFINITION>",
          "evaluate_is_it_provided_by_an_acceptable_source": "No, the customer did not mention a departure date.",
          "evaluate_was_it_already_provided_and_should_it_be_provided_again": "It has not been provided.",
          "evaluate_is_it_potentially_problematic_to_guess_what_the_value_is_if_it_isnt_provided": "Yes, guessing a date could lead to incorrect or undesired bookings.",
          "is_optional": false,
          "valid_invalid_or_missing": "missing",
          "value_as_string": null
        },
        {
          "parameter_name": "return_date",
          "acceptable_source_for_this_argument_according_to_its_tool_definition": "<INFER THIS BASED ON TOOL DEFINITION>",
          "evaluate_is_it_provided_by_an_acceptable_source": "No, the customer did not mention a return date.",
          "evaluate_was_it_already_provided_and_should_it_be_provided_again": "It has not been provided.",
          "evaluate_is_it_potentially_problematic_to_guess_what_the_value_is_if_it_isnt_provided": "Yes, assuming a return date can misrepresent the customer's intent",
          "is_optional": false,
          "valid_invalid_or_missing": "missing",
          "value_as_string": null
        }
      ],
      "same_call_is_already_staged": false,
      "relevant_subtleties": "We should run this tool as it aligns with customer's inquiry while requesting the necessary missing booking information.",
      "are_optional_arguments_missing": false,
      "are_non_optional_arguments_missing": true,
      "allowed_to_run_without_optional_arguments_even_if_they_are_missing": true
    }
  ]
}
```
###


Example #6: ###

- **Context**:
the candidate tool is book_flight(origin:str, destination: str) and there are no better reference tools, origin and destination are enum that can get only these values: 'New York', 'London', 'Paris'.the customer wants to book a flight from Tel-Aviv to Singapore.

- **Expected Result**:
```json
{
  "last_customer_message": "I want to book a flight from Tel-Aviv to Singapore",
  "most_recent_customer_inquiry_or_need": "The customer want to book a flight",
  "most_recent_customer_inquiry_or_need_was_already_resolved": false,
  "name": "book_flight",
  "subtleties_to_be_aware_of": "The customer specified a flight origin and destination that may be invalid in the schema's enum, but their values are still important and should be filled in the output",
  "tool_calls_for_candidate_tool": [
    {
      "applicability_rationale": "The customer specifically wants to book a flight and provided the origin and destination, and there are no better reference tools",
      "is_applicable": true,
      "argument_evaluations": [
        {
          "parameter_name": "origin",
          "acceptable_source_for_this_argument_according_to_its_tool_definition": "<INFER THIS BASED ON TOOL DEFINITION>",
          "evaluate_is_it_provided_by_an_acceptable_source": "Yes; the customer has explicitly provided an origin, which is an acceptable source but not in the enum, so regardless of validity considerations its value is extracted into the relevant field",
          "evaluate_was_it_already_provided_and_should_it_be_provided_again": "Yes, the customer has explicitly provided an origin, so it should be extracted and filled into the matching output field even if not a valid enum value",
          "evaluate_is_it_potentially_problematic_to_guess_what_the_value_is_if_it_isnt_provided": "It is very problematic to guess the origin the customer wants to fly from",
          "is_optional": false,
          "valid_invalid_or_missing": "invalid",
          "value_as_string": "Tel-Aviv"
        },
        {
          "parameter_name": "destination",
          "acceptable_source_for_this_argument_according_to_its_tool_definition": "<INFER THIS BASED ON TOOL DEFINITION>",
          "evaluate_is_it_provided_by_an_acceptable_source": "Yes; the customer has explicitly provided a destination, which is an acceptable source but not in the enum, so regardless of validity considerations its value is extracted into the relevant field",
          "evaluate_was_it_already_provided_and_should_it_be_provided_again": "Yes, the customer has explicitly provided a destination, so it should be extracted and filled into the matching output field even if not a valid enum value",
          "evaluate_is_it_potentially_problematic_to_guess_what_the_value_is_if_it_isnt_provided": "It is very problematic to guess the destination the customer wants to fly to",
          "is_optional": false,
          "valid_invalid_or_missing": "invalid",
          "value_as_string": "Singapore"
        }
      ],
      "same_call_is_already_staged": false,
      "comparison_with_rejected_tools_including_references_to_subtleties": "There are no tools in the list of rejected tools",
      "relevant_subtleties": "This is the right tool to run although a parameter may be invalid. This parameter value, however, still needs to be extracted from the customer's message and provided in the output",
      "a_rejected_tool_would_have_been_a_better_fit_if_it_werent_already_rejected": false,
      "are_optional_arguments_missing": false,
      "are_non_optional_arguments_missing": false,
      "allowed_to_run_without_optional_arguments_even_if_they_are_missing": true
    }
  ]
}
```
###




The following is a list of events describing the most recent state of the back-and-forth
interaction between you and a user: ###
['{"event_kind": "message", "event_source": "user", "data": {"participant": "test_customer", "message": "Does Larry David have enough money in his account to buy a kilogram of apples?"}}']
###



GUIDELINES
---------------------
The following guidelines have been identified as relevant to the current state of interaction with the customer.
Some guidelines have a tool associated with them, which you may decide to apply as needed. Use these guidelines to understand the context for the provided tool.

Guidelines:
###
1) When customers inquire about account-related information, then retrieve account information

    Associated Tool: second_service:schedule"
###



The following is the tool function definition.
IMPORTANT: You must not return results for any tool other than this one, even if you believe they might be relevant:
###
{'tool_name': 'second_service:schedule', 'description': '', 'optional_arguments': {}, 'required_parameters': {}}
###



STAGED TOOL CALLS
-----------------
The following is a list of tool calls staged after the interaction's latest state. Use this information to avoid redundant calls and to guide your response.

Reminder: If a tool is already staged with the exact same arguments, set "same_call_is_already_staged" to true.
You may still choose to re-run the tool call, but only if there is a specific reason for it to be executed multiple times.

The staged tool calls are:
["{\"event_kind\": \"tool\", \"event_source\": \"system-provided\", \"data\": {\"tool_calls\": [{\"tool_id\": \"local:get_account_balance\", \"arguments\": {\"account_name\": \"Larry David\"}, \"result\": 450000000}]}}", "{\"event_kind\": \"tool\", \"event_source\": \"system-provided\", \"data\": {\"tool_calls\": [{\"tool_id\": \"local:check_fruit_price\", \"arguments\": {\"fruit\": \"apples\"}, \"result\": \"1 kg of apples costs 10$\"}]}}", "{\"event_kind\": \"tool\", \"event_source\": \"system-provided\", \"data\": {\"tool_calls\": [{\"tool_id\": \"local:get_available_toppings\", \"arguments\": {}, \"result\": [\"Pepperoni\", \"Mushrooms\", \"Olives\"]}]}}"]
###



OUTPUT FORMAT
-----------------
Given the tool, your output should adhere to the following format:
```json
{
    "last_customer_message": "<REPEAT THE LAST USER MESSAGE IN THE INTERACTION>",
    "most_recent_customer_inquiry_or_need": "<CUSTOMER'S INQUIRY OR NEED>",
    "most_recent_customer_inquiry_or_need_was_already_resolved": <BOOL>,
    "name": "second_service:schedule",
    "subtleties_to_be_aware_of": "<NOTE ANY SIGNIFICANT SUBTLETIES TO BE AWARE OF WHEN RUNNING THIS TOOL IN OUR AGENT'S CONTEXT>",
    "tool_calls_for_candidate_tool": [
        {{
            "applicability_rationale": "<A FEW WORDS THAT EXPLAIN WHETHER, HOW, AND TO WHAT EXTENT THE TOOL NEEDS TO BE CALLED AT THIS POINT>",
            "is_applicable": <BOOL>,
            "argument_evaluations": [
                {
                    "parameter_name": "<PARAMETER NAME>",
                    "acceptable_source_for_this_argument_according_to_its_tool_definition": "<REPEAT THE ACCEPTABLE SOURCE FOR THE ARGUMENT FROM TOOL DEFINITION>",
                    "evaluate_is_it_provided_by_an_acceptable_source": "<BRIEFLY EVALUATE IF THE SOURCE FOR THE VALUE MATCHES THE ACCEPTABLE SOURCE>",
                    "evaluate_was_it_already_provided_and_should_it_be_provided_again": "<BRIEFLY EVALUATE IF THE PARAMETER VALUE WAS PROVIDED AND SHOULD BE PROVIDED AGAIN>",
                    "evaluate_is_it_potentially_problematic_to_guess_what_the_value_is_if_it_isnt_provided": "<BRIEFLY EVALUATE IF IT'S A PROBLEM TO GUESS THE VALUE>",
                    "valid_invalid_or_missing": "<STR: EITHER 'missing', 'invalid' OR 'valid' DEPENDING IF THE VALUE IS MISSING, PROVIDED BUT NOT FOUND IN ENUM LIST, OR PROVIDED AND FOUND IN ENUM LIST (OR DOESN'T HAVE ENUM LIST)>",
                    "value_as_string": "<PARAMETER VALUE>,"
                }
            ],
            "same_call_is_already_staged": <BOOL>,
            "relevant_subtleties": "<IF SUBTLETIES FOUND, REFER TO THE RELEVANT ONES HERE>", 
    ]
}
```

However, note that you may choose to have multiple entries in 'tool_calls_for_candidate_tool' if you wish to call the candidate tool multiple times with different arguments.