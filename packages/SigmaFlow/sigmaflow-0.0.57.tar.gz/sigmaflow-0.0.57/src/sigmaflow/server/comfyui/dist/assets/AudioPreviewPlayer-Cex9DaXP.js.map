{"version":3,"file":"AudioPreviewPlayer-Cex9DaXP.js","sources":["../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/widgets/components/audio/AudioPreviewPlayer.vue"],"sourcesContent":["<template>\n  <div class=\"relative\">\n    <div\n      v-if=\"!hidden\"\n      :class=\"\n        cn(\n          'bg-component-node-widget-background box-border flex gap-4 items-center justify-start relative rounded-lg w-full h-16 px-4 py-0',\n          { hidden: hideWhenEmpty && !hasAudio }\n        )\n      \"\n    >\n      <!-- Hidden audio element -->\n      <audio\n        ref=\"audioRef\"\n        @loadedmetadata=\"handleLoadedMetadata\"\n        @timeupdate=\"handleTimeUpdate\"\n        @ended=\"handleEnded\"\n      />\n\n      <!-- Left Actions -->\n      <div class=\"relative flex shrink-0 items-center justify-start gap-2\">\n        <!-- Play/Pause Button -->\n        <div\n          role=\"button\"\n          :tabindex=\"0\"\n          aria-label=\"Play/Pause\"\n          class=\"flex size-6 cursor-pointer items-center justify-center rounded hover:bg-interface-menu-component-surface-hovered\"\n          @click=\"togglePlayPause\"\n        >\n          <i\n            v-if=\"!isPlaying\"\n            class=\"text-secondary icon-[lucide--play] size-4\"\n          />\n          <i v-else class=\"text-secondary icon-[lucide--pause] size-4\" />\n        </div>\n\n        <!-- Time Display -->\n        <div class=\"text-sm font-normal text-nowrap text-base-foreground\">\n          {{ formatTime(currentTime) }} / {{ formatTime(duration) }}\n        </div>\n      </div>\n\n      <!-- Progress Bar -->\n      <div class=\"relative h-0.5 flex-1 rounded-full bg-interface-stroke\">\n        <div\n          class=\"absolute top-0 left-0 h-full rounded-full bg-button-icon transition-all\"\n          :style=\"{ width: `${progressPercentage}%` }\"\n        />\n        <input\n          type=\"range\"\n          :value=\"progressPercentage\"\n          min=\"0\"\n          max=\"100\"\n          step=\"0.1\"\n          :aria-label=\"$t('g.audioProgress')\"\n          class=\"absolute inset-0 w-full cursor-pointer opacity-0\"\n          @input=\"handleSeek\"\n        />\n      </div>\n\n      <!-- Right Actions -->\n      <div class=\"relative flex shrink-0 items-center justify-start gap-2\">\n        <!-- Volume Button -->\n        <div\n          role=\"button\"\n          :tabindex=\"0\"\n          aria-label=\"Volume\"\n          class=\"flex size-6 cursor-pointer items-center justify-center rounded hover:bg-interface-menu-component-surface-hovered\"\n          @click=\"toggleMute\"\n        >\n          <i\n            v-if=\"showVolumeTwo\"\n            class=\"text-secondary icon-[lucide--volume-2] size-4\"\n          />\n          <i\n            v-else-if=\"showVolumeOne\"\n            class=\"text-secondary icon-[lucide--volume-1] size-4\"\n          />\n          <i v-else class=\"text-secondary icon-[lucide--volume-x] size-4\" />\n        </div>\n\n        <!-- Options Button -->\n        <div\n          v-if=\"showOptionsButton\"\n          ref=\"optionsButtonRef\"\n          role=\"button\"\n          :tabindex=\"0\"\n          aria-label=\"More Options\"\n          class=\"flex size-6 cursor-pointer items-center justify-center rounded hover:bg-interface-menu-component-surface-hovered\"\n          @click=\"toggleOptionsMenu\"\n        >\n          <i class=\"text-secondary icon-[lucide--more-vertical] size-4\" />\n        </div>\n      </div>\n\n      <!-- Options Menu -->\n      <TieredMenu\n        ref=\"optionsMenu\"\n        :model=\"menuItems\"\n        popup\n        class=\"audio-player-menu\"\n        :pt:root:class=\"\n          cn('bg-component-node-widget-background border-component-node-border')\n        \"\n        :pt:submenu:class=\"cn('bg-component-node-widget-background')\"\n      >\n        <template #item=\"{ item }\">\n          <div v-if=\"item.key === 'volume'\" class=\"w-48 px-4 py-2\">\n            <label class=\"mb-2 block text-xs text-base-foreground\">{{\n              item.label\n            }}</label>\n            <Slider\n              :model-value=\"volume * 10\"\n              :min=\"0\"\n              :max=\"10\"\n              :step=\"1\"\n              class=\"w-full\"\n              @update:model-value=\"handleVolumeChange\"\n            />\n          </div>\n          <div\n            v-else\n            class=\"flex cursor-pointer items-center px-4 py-2 text-xs hover:bg-white/10\"\n            @click=\"item.onClick?.()\"\n          >\n            <span class=\"text-base-foreground\">{{ item.label }}</span>\n            <i\n              v-if=\"item.selected\"\n              class=\"ml-auto icon-[lucide--check] size-4 text-base-foreground\"\n            />\n          </div>\n        </template>\n      </TieredMenu>\n    </div>\n    <LODFallback />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Slider from 'primevue/slider'\nimport TieredMenu from 'primevue/tieredmenu'\nimport { computed, nextTick, onUnmounted, ref, watch } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport type { LGraphNode } from '@/lib/litegraph/src/LGraphNode'\nimport LODFallback from '@/renderer/extensions/vueNodes/components/LODFallback.vue'\nimport { api } from '@/scripts/api'\nimport { app } from '@/scripts/app'\nimport { useNodeOutputStore } from '@/stores/imagePreviewStore'\nimport { getLocatorIdFromNodeData } from '@/utils/graphTraversalUtil'\nimport { isOutputNode } from '@/utils/nodeFilterUtil'\nimport { cn } from '@/utils/tailwindUtil'\n\nimport { formatTime, getResourceURL } from '../../utils/audioUtils'\n\nconst { t } = useI18n()\n\nconst props = withDefaults(\n  defineProps<{\n    readonly?: boolean\n    hideWhenEmpty?: boolean\n    showOptionsButton?: boolean\n    modelValue?: string\n    nodeId?: string\n    audioUrl?: string\n  }>(),\n  {\n    hideWhenEmpty: true\n  }\n)\n\n// Refs\nconst audioRef = ref<HTMLAudioElement>()\nconst optionsMenu = ref()\nconst optionsButtonRef = ref<HTMLElement>()\nconst isPlaying = ref(false)\nconst isMuted = ref(false)\nconst volume = ref(1)\nconst currentTime = ref(0)\nconst duration = ref(0)\nconst hasAudio = ref(false)\nconst playbackRate = ref(1)\n\n// Computed\nconst progressPercentage = computed(() => {\n  if (!duration.value || duration.value === 0) return 0\n  return (currentTime.value / duration.value) * 100\n})\n\nconst showVolumeTwo = computed(() => !isMuted.value && volume.value > 0.5)\nconst showVolumeOne = computed(() => isMuted.value && volume.value > 0)\n\nconst litegraphNode = computed(() => {\n  if (!props.nodeId || !app.rootGraph) return null\n  return app.rootGraph.getNodeById(props.nodeId) as LGraphNode | null\n})\n\nconst hidden = computed(() => {\n  if (!litegraphNode.value) return false\n  // dont show if its a LoadAudio and we have nodeId\n  const isLoadAudio =\n    litegraphNode.value.constructor?.comfyClass === 'LoadAudio'\n  return isLoadAudio && !!props.nodeId\n})\n\n// Check if this is an output node\nconst isOutputNodeRef = computed(() => {\n  const node = litegraphNode.value\n  return !!node && isOutputNode(node)\n})\n\nconst nodeLocatorId = computed(() => {\n  const node = litegraphNode.value\n  if (!node) return null\n  return getLocatorIdFromNodeData(node)\n})\n\nconst nodeOutputStore = useNodeOutputStore()\n\n// Computed audio URL from node output (for output nodes)\nconst audioUrlFromOutput = computed(() => {\n  if (!isOutputNodeRef.value || !nodeLocatorId.value) return ''\n\n  const nodeOutput = nodeOutputStore.nodeOutputs[nodeLocatorId.value]\n  if (!nodeOutput?.audio || nodeOutput.audio.length === 0) return ''\n\n  const audio = nodeOutput.audio[0]\n  if (!audio.filename) return ''\n\n  return api.apiURL(\n    getResourceURL(\n      audio.subfolder || '',\n      audio.filename,\n      audio.type || 'output'\n    )\n  )\n})\n\n// Combined audio URL (output takes precedence for output nodes)\nconst finalAudioUrl = computed(() => {\n  return audioUrlFromOutput.value || props.audioUrl || ''\n})\n\n// Playback controls\nconst togglePlayPause = () => {\n  if (!audioRef.value || !audioRef.value.src) {\n    return\n  }\n\n  if (isPlaying.value) {\n    audioRef.value.pause()\n  } else {\n    void audioRef.value.play()\n  }\n  isPlaying.value = !isPlaying.value\n}\n\nconst toggleMute = () => {\n  if (audioRef.value) {\n    isMuted.value = !isMuted.value\n    audioRef.value.muted = isMuted.value\n  }\n}\n\nconst handleSeek = (event: Event) => {\n  const target = event.target as HTMLInputElement\n  const value = parseFloat(target.value)\n  if (audioRef.value && duration.value > 0) {\n    const newTime = (value / 100) * duration.value\n    audioRef.value.currentTime = newTime\n    currentTime.value = newTime\n  }\n}\n\n// Audio events\nconst handleLoadedMetadata = () => {\n  if (audioRef.value) {\n    duration.value = audioRef.value.duration\n  }\n}\n\nconst handleTimeUpdate = () => {\n  if (audioRef.value) {\n    currentTime.value = audioRef.value.currentTime\n  }\n}\n\nconst handleEnded = () => {\n  isPlaying.value = false\n  currentTime.value = 0\n}\n\n// Options menu\nconst toggleOptionsMenu = (event: Event) => {\n  optionsMenu.value?.toggle(event)\n}\n\nconst setPlaybackSpeed = (speed: number) => {\n  playbackRate.value = speed\n  if (audioRef.value) {\n    audioRef.value.playbackRate = speed\n  }\n}\n\nconst handleVolumeChange = (value: number | number[]) => {\n  const numValue = Array.isArray(value) ? value[0] : value\n  volume.value = numValue / 10\n  if (audioRef.value) {\n    audioRef.value.volume = volume.value\n    if (volume.value > 0 && isMuted.value) {\n      isMuted.value = false\n      audioRef.value.muted = false\n    }\n  }\n}\n\nconst menuItems = computed(() => [\n  {\n    label: t('g.playbackSpeed'),\n    items: [\n      {\n        label: t('g.halfSpeed'),\n        onClick: () => setPlaybackSpeed(0.5),\n        selected: playbackRate.value === 0.5\n      },\n      {\n        label: t('g.1x'),\n        onClick: () => setPlaybackSpeed(1),\n        selected: playbackRate.value === 1\n      },\n      {\n        label: t('g.2x'),\n        onClick: () => setPlaybackSpeed(2),\n        selected: playbackRate.value === 2\n      }\n    ]\n  },\n  {\n    label: t('g.volume'),\n    key: 'volume'\n  }\n])\n\n// Load audio from URL\nconst loadAudioFromUrl = (url: string) => {\n  if (!audioRef.value) return\n  isPlaying.value = false\n  audioRef.value.pause()\n  audioRef.value.src = url\n  void audioRef.value.load()\n  hasAudio.value = !!url\n}\n\n// Watch for finalAudioUrl changes\nwatch(\n  finalAudioUrl,\n  (newUrl) => {\n    if (newUrl) {\n      void nextTick(() => {\n        loadAudioFromUrl(newUrl)\n      })\n    }\n  },\n  { immediate: true }\n)\n\n// Cleanup\nonUnmounted(() => {\n  if (audioRef.value) {\n    audioRef.value.pause()\n    audioRef.value.src = ''\n  }\n})\n</script>\n\n<style scoped>\n.audio-player-menu {\n  --p-tieredmenu-item-focus-background: rgb(255 255 255 / 0.1);\n  --p-tieredmenu-item-active-background: rgb(255 255 255 / 0.1);\n}\n</style>\n"],"names":["t","useI18n","props","__props","audioRef","ref","optionsMenu","optionsButtonRef","isPlaying","isMuted","volume","currentTime","duration","hasAudio","playbackRate","progressPercentage","computed","showVolumeTwo","showVolumeOne","litegraphNode","app","hidden","isOutputNodeRef","node","isOutputNode","nodeLocatorId","getLocatorIdFromNodeData","nodeOutputStore","useNodeOutputStore","audioUrlFromOutput","nodeOutput","audio","api","getResourceURL","finalAudioUrl","togglePlayPause","__name","toggleMute","handleSeek","event","target","value","newTime","handleLoadedMetadata","handleTimeUpdate","handleEnded","toggleOptionsMenu","setPlaybackSpeed","speed","handleVolumeChange","numValue","menuItems","loadAudioFromUrl","url","watch","newUrl","nextTick","onUnmounted"],"mappings":"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"}