import{r as b,j as e}from"./jsx-runtime-BiXka7E7.js";import{c as h,u as E,w as p,B as d,t as i}from"./index-BwWm0JV9.js";import{B as U,D as M,b as S,E as T,d as _,e as y}from"./date-utils-CPa5qVN4.js";import{L as R}from"./components-CZmywKMH.js";import{L as B}from"./loader-circle-BRNhzI2j.js";/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],A=h("copy",I);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],z=h("download",F);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],V=h("pencil",O);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],C=h("printer",H);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Z=h("shield-check",G);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]],J=h("shield-off",q);function ee({doc:u,allowEdit:g=!0,shareBaseUrl:w,showVisibilityToggle:f=!0}){const{basePath:n}=E(),[m,l]=b.useState(!1),[o,x]=b.useState(u),[j,k]=b.useState(!1),v=!1;b.useEffect(()=>{x(u)},[u]);const D=s=>{const a=typeof window<"u"?window.location.origin:"";if(!a)return n?`${n}/s/${s}`:`/s/${s}`;const c=n?n.replace(/^\/+|\/+$/g,""):"",t=c?`/${c}/s/${s}`:`/s/${s}`;return`${a}${t}`},$=async()=>{k(!0);try{const s=new FormData;s.append("slug",o.slug);const a=await fetch(p("/api/toggle-public",n),{method:"post",body:s}),c=await a.json().catch(()=>({}));if(!a.ok||!c?.meta)throw new Error("Failed to update visibility.");const t={...o,...c.meta};x(t),typeof window<"u"&&window.dispatchEvent(new CustomEvent("md-studio-docs-updated",{detail:{slug:t.slug,patch:{isPublic:t.isPublic,publicId:t.publicId}}})),i.success(t.isPublic?"Document is now public.":"Document is now private.")}catch(s){const a=s instanceof Error?s.message:"Failed to update visibility.";i.error(a)}finally{k(!1)}},L=async()=>{l(!0);try{let s=o.publicId;if(!o.isPublic){const c=await fetch(p("/api/toggle-public",n),{method:"POST",body:new URLSearchParams({slug:o.slug})}),t=await c.json();if(!c.ok||!t.success)throw new Error(t.error||"Unable to make document public.");s=t.meta?.publicId??s;const r={...o,...t.meta,isPublic:!0};x(r),typeof window<"u"&&window.dispatchEvent(new CustomEvent("md-studio-docs-updated",{detail:{slug:r.slug,patch:{isPublic:r.isPublic,publicId:r.publicId}}}))}if(!s){i.error("Share link unavailable for this document."),l(!1);return}const a=D(s);await navigator.clipboard.writeText(a),i.success("Share link copied to clipboard."),o.isPublic||i.success("Document is now public.")}catch(s){const a=s instanceof Error?s.message:"Unable to copy link. Please copy it manually.";i.error(a)}finally{l(!1)}},P=async()=>{l(!0);try{const a=await(await fetch(p("/api/export",n),{method:"POST",body:new URLSearchParams({slug:o.slug})})).json();if(!a.success)throw new Error(a.error||"Export failed");const c=new Blob([a.content],{type:"text/markdown"}),t=URL.createObjectURL(c),r=document.createElement("a");r.href=t,r.download=a.filename,r.click(),URL.revokeObjectURL(t),i.success("Download started.")}catch(s){const a=s instanceof Error?s.message:"Failed to download markdown.";i.error(a)}finally{l(!1)}},N=()=>{window.print()};return e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-lg border border-border bg-card p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{variant:o.isPublic?"default":"secondary",children:o.isPublic?"Public":"Private"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Updated"," ",new Date(o.updatedAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",timeZone:"UTC"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[g?e.jsx(R,{to:p(`/doc/${o.slug}/edit`,n),children:e.jsxs(d,{variant:"outline",size:"sm",children:[e.jsx(V,{className:"mr-2 size-4"}),"Edit"]})}):null,f?e.jsx(d,{variant:o.isPublic?"secondary":"default",size:"sm",onClick:$,disabled:m||j,children:j?e.jsx(B,{className:"mr-2 size-4 animate-spin"}):o.isPublic?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"mr-2 size-4"}),"Make private"]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"mr-2 size-4"}),"Make public"]})}):null,g?e.jsxs(M,{children:[e.jsx(S,{asChild:!0,children:e.jsx(d,{variant:"outline",size:"icon",children:e.jsx(T,{className:"size-4"})})}),e.jsxs(_,{align:"end",children:[e.jsxs(y,{onClick:P,disabled:m||v,children:[e.jsx(z,{className:"mr-2 size-4"}),"Download markdown"]}),e.jsxs(y,{onClick:N,children:[e.jsx(C,{className:"mr-2 size-4"}),"Print"]}),e.jsxs(y,{onClick:L,disabled:m,children:[e.jsx(A,{className:"mr-2 size-4"}),"Copy share link"]})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(d,{variant:"outline",size:"sm",type:"button",onClick:P,disabled:m||v,children:[e.jsx(z,{className:"mr-2 size-4"}),"Download"]}),e.jsxs(d,{variant:"outline",size:"sm",type:"button",onClick:N,children:[e.jsx(C,{className:"mr-2 size-4"}),"Print"]})]})]})]})}function se({images:u,shareBaseUrl:g}){if(!u.length)return null;const w=g.replace(/\/$/,"");return e.jsxs("section",{className:"flex flex-col gap-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Attached images"}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:u.map(f=>{const n=p(f),m=`![image](${n})`,l=w&&w.length?`${w}${n}`:typeof window<"u"?`${window.location.origin}${n}`:n;return e.jsxs("div",{className:"flex flex-col gap-3 rounded-lg border border-border p-3",children:[e.jsx("div",{className:"relative h-40 overflow-hidden rounded-md border bg-muted",children:e.jsx("img",{src:n,alt:"Attached image",className:"size-full object-cover"})}),e.jsx(d,{type:"button",variant:"outline",size:"sm",className:"w-full",onClick:async()=>{try{await navigator.clipboard.writeText(m),i.success("Markdown copied.")}catch{i.error("Unable to copy markdown.")}},children:"Copy markdown"}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",className:"w-full",onClick:async()=>{try{await navigator.clipboard.writeText(l),i.success("Image URL copied.")}catch{i.error("Unable to copy URL.")}},children:"Copy image URL"})]},f)})})]})}export{se as A,ee as T};
