import{a as e,n as t,r as n,t as r}from"./map-D3rdFka2.js";import{o as i}from"./_initCloneObject-w666mXAM.js";import{i as a,n as o,o as s,r as c,s as l}from"./_baseUniq-C1ih6t5I.js";import{t as u}from"./_baseClone-BEd4hvTE.js";import{i as d,n as f,r as p}from"./_baseEach-BN0HOvWa.js";import{a as m,i as h,n as ee}from"./isArrayLikeObject-CPqL_9mx.js";import{t as g}from"./merge-CBnaWh74.js";import{t as te}from"./now-ByUdnbf_.js";import{a as ne,i as re,n as ie,o as _,r as ae,s as oe,t as v}from"./min-4CMQhUj4.js";import{t as y}from"./graphlib-IDQiNJ1z.js";import{Bn as se,Cn as ce,Dn as le,In as ue,Lt as b,Pn as x,Rn as S,Zt as de,cn as fe,dn as pe,jn as me,kn as he,mn as ge,sn as C,vn as _e,zn as w,zt as T}from"./index-EnPYNmIz.js";var ve=RegExp(`[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]`);function ye(e){return ve.test(e)}var be=ye,xe=1,Se=4;function Ce(e){return u(e,xe|Se)}var we=Ce;function Te(e,t){return e==null?e:ee(e,l(t),i)}var Ee=Te;function De(e,t){return e&&f(e,l(t))}var Oe=De;function ke(e,t){return e>t}var Ae=ke;function je(e,t){var n={};return t=p(t,3),f(e,function(e,r,i){me(n,r,t(e,r,i))}),n}var E=je;function Me(e){return e&&e.length?ie(e,ue,Ae):void 0}var D=Me;function Ne(e,t){return e&&e.length?ie(e,p(t,2),ae):void 0}var O=Ne;function Pe(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}var Fe=Pe;function Ie(e,t){if(e!==t){var n=e!==void 0,r=e===null,i=e===e,a=se(e),o=t!==void 0,s=t===null,c=t===t,l=se(t);if(!s&&!l&&!a&&e>t||a&&o&&c&&!s&&!l||r&&o&&c||!n&&c||!i)return 1;if(!r&&!a&&!l&&e<t||l&&n&&i&&!r&&!a||s&&n&&i||!o&&i||!c)return-1}return 0}var Le=Ie;function Re(e,t,n){for(var r=-1,i=e.criteria,a=t.criteria,o=i.length,s=n.length;++r<o;){var c=Le(i[r],a[r]);if(c){if(r>=s)return c;var l=n[r];return c*(l==`desc`?-1:1)}}return e.index-t.index}var ze=Re;function Be(e,n,r){n=n.length?w(n,function(e){return S(e)?function(t){return pe(t,e.length===1?e[0]:e)}:e}):[ue];var i=-1;n=w(n,ce(p));var a=t(e,function(e,t,r){return{criteria:w(n,function(t){return t(e)}),index:++i,value:e}});return Fe(a,function(e,t){return ze(e,t,r)})}var Ve=Be,He=d(`length`),Ue=`\\ud800-\\udfff`,We=`\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff`,Ge=`\\ufe0e\\ufe0f`,Ke=`[`+Ue+`]`,k=`[`+We+`]`,A=`\\ud83c[\\udffb-\\udfff]`,qe=`(?:`+k+`|`+A+`)`,Je=`[^`+Ue+`]`,Ye=`(?:\\ud83c[\\udde6-\\uddff]){2}`,Xe=`[\\ud800-\\udbff][\\udc00-\\udfff]`,Ze=`\\u200d`,Qe=qe+`?`,$e=`[`+Ge+`]?`,et=`(?:`+Ze+`(?:`+[Je,Ye,Xe].join(`|`)+`)`+$e+Qe+`)*`,tt=$e+Qe+et,nt=`(?:`+[Je+k+`?`,k,Ye,Xe,Ke].join(`|`)+`)`,rt=RegExp(A+`(?=`+A+`)|`+nt+tt,`g`);function it(e){for(var t=rt.lastIndex=0;rt.test(e);)++t;return t}var at=it;function ot(e){return be(e)?at(e):He(e)}var st=ot,ct=Math.ceil,lt=Math.max;function ut(e,t,n,r){for(var i=-1,a=lt(ct((t-e)/(n||1)),0),o=Array(a);a--;)o[r?a:++i]=e,e+=n;return o}var dt=ut;function ft(t){return function(n,r,i){return i&&typeof i!=`number`&&h(n,r,i)&&(r=i=void 0),n=e(n),r===void 0?(r=n,n=0):r=e(r),i=i===void 0?n<r?1:-1:e(i),dt(n,r,i,t)}}var j=ft(),pt=`[object Map]`,mt=`[object Set]`;function ht(e){if(e==null)return 0;if(le(e))return re(e)?st(e):e.length;var t=de(e);return t==pt||t==mt?e.size:_e(e).length}var gt=ht,M=m(function(e,t){if(e==null)return[];var n=t.length;return n>1&&h(e,t[0],t[1])?t=[]:n>2&&h(t[0],t[1],t[2])&&(t=[t[0]]),Ve(e,fe(t,1),[])}),_t=0;function vt(e){var t=++_t;return ge(e)+t}var N=vt;function yt(e,t,n){for(var r=-1,i=e.length,a=t.length,o={};++r<i;){var s=r<a?t[r]:void 0;n(o,e[r],s)}return o}var bt=yt;function xt(e,t){return bt(e||[],t||[],he)}var St=xt,Ct=class{constructor(){var e={};e._next=e._prev=e,this._sentinel=e}dequeue(){var e=this._sentinel,t=e._prev;if(t!==e)return wt(t),t}enqueue(e){var t=this._sentinel;e._prev&&e._next&&wt(e),e._next=t._next,t._next._prev=e,t._next=e,e._prev=t}toString(){for(var e=[],t=this._sentinel,n=t._prev;n!==t;)e.push(JSON.stringify(n,Tt)),n=n._prev;return`[`+e.join(`, `)+`]`}};function wt(e){e._prev._next=e._next,e._next._prev=e._prev,delete e._next,delete e._prev}function Tt(e,t){if(e!==`_next`&&e!==`_prev`)return t}var Et=x(1);function Dt(e,t){if(e.nodeCount()<=1)return[];var n=kt(e,t||Et),i=Ot(n.graph,n.buckets,n.zeroIdx);return C(r(i,function(t){return e.outEdges(t.v,t.w)}))}function Ot(e,t,n){for(var r=[],i=t[t.length-1],a=t[0],o;e.nodeCount();){for(;o=a.dequeue();)P(e,t,n,o);for(;o=i.dequeue();)P(e,t,n,o);if(e.nodeCount()){for(var s=t.length-2;s>0;--s)if(o=t[s].dequeue(),o){r=r.concat(P(e,t,n,o,!0));break}}}return r}function P(e,t,n,r,i){var a=i?[]:void 0;return s(e.inEdges(r.v),function(r){var o=e.edge(r),s=e.node(r.v);i&&a.push({v:r.v,w:r.w}),s.out-=o,F(t,n,s)}),s(e.outEdges(r.v),function(r){var i=e.edge(r),a=r.w,o=e.node(a);o.in-=i,F(t,n,o)}),e.removeNode(r.v),a}function kt(e,t){var n=new y,r=0,i=0;s(e.nodes(),function(e){n.setNode(e,{v:e,in:0,out:0})}),s(e.edges(),function(e){var a=n.edge(e.v,e.w)||0,o=t(e),s=a+o;n.setEdge(e.v,e.w,s),i=Math.max(i,n.node(e.v).out+=o),r=Math.max(r,n.node(e.w).in+=o)});var a=j(i+r+3).map(function(){return new Ct}),o=r+1;return s(n.nodes(),function(e){F(a,o,n.node(e))}),{graph:n,buckets:a,zeroIdx:o}}function F(e,t,n){n.out?n.in?e[n.out-n.in+t].enqueue(n):e[e.length-1].enqueue(n):e[0].enqueue(n)}function At(e){var t=e.graph().acyclicer===`greedy`?Dt(e,n(e)):jt(e);s(t,function(t){var n=e.edge(t);e.removeEdge(t),n.forwardName=t.name,n.reversed=!0,e.setEdge(t.w,t.v,n,N(`rev`))});function n(e){return function(t){return e.edge(t).weight}}}function jt(e){var t=[],n={},r={};function i(a){Object.prototype.hasOwnProperty.call(r,a)||(r[a]=!0,n[a]=!0,s(e.outEdges(a),function(e){Object.prototype.hasOwnProperty.call(n,e.w)?t.push(e):i(e.w)}),delete n[a])}return s(e.nodes(),i),t}function Mt(e){s(e.edges(),function(t){var n=e.edge(t);if(n.reversed){e.removeEdge(t);var r=n.forwardName;delete n.reversed,delete n.forwardName,e.setEdge(t.w,t.v,n,r)}})}function I(e,t,n,r){var i;do i=N(r);while(e.hasNode(i));return n.dummy=t,e.setNode(i,n),i}function Nt(e){var t=new y().setGraph(e.graph());return s(e.nodes(),function(n){t.setNode(n,e.node(n))}),s(e.edges(),function(n){var r=t.edge(n.v,n.w)||{weight:0,minlen:1},i=e.edge(n);t.setEdge(n.v,n.w,{weight:r.weight+i.weight,minlen:Math.max(r.minlen,i.minlen)})}),t}function L(e){var t=new y({multigraph:e.isMultigraph()}).setGraph(e.graph());return s(e.nodes(),function(n){e.children(n).length||t.setNode(n,e.node(n))}),s(e.edges(),function(n){t.setEdge(n,e.edge(n))}),t}function R(e,t){var n=e.x,r=e.y,i=t.x-n,a=t.y-r,o=e.width/2,s=e.height/2;if(!i&&!a)throw Error(`Not possible to find intersection inside of the rectangle`);var c,l;return Math.abs(a)*o>Math.abs(i)*s?(a<0&&(s=-s),c=s*i/a,l=s):(i<0&&(o=-o),c=o,l=o*a/i),{x:n+c,y:r+l}}function z(e){var t=r(j(V(e)+1),function(){return[]});return s(e.nodes(),function(n){var r=e.node(n),i=r.rank;T(i)||(t[i][r.order]=n)}),t}function Pt(e){var t=v(r(e.nodes(),function(t){return e.node(t).rank}));s(e.nodes(),function(n){var r=e.node(n);ne(r,`rank`)&&(r.rank-=t)})}function Ft(e){var t=v(r(e.nodes(),function(t){return e.node(t).rank})),n=[];s(e.nodes(),function(r){var i=e.node(r).rank-t;n[i]||(n[i]=[]),n[i].push(r)});var i=0,a=e.graph().nodeRankFactor;s(n,function(t,n){T(t)&&n%a!==0?--i:i&&s(t,function(t){e.node(t).rank+=i})})}function B(e,t,n,r){var i={width:0,height:0};return arguments.length>=4&&(i.rank=n,i.order=r),I(e,`border`,i,t)}function V(e){return D(r(e.nodes(),function(t){var n=e.node(t).rank;if(!T(n))return n}))}function It(e,t){var n={lhs:[],rhs:[]};return s(e,function(e){t(e)?n.lhs.push(e):n.rhs.push(e)}),n}function Lt(e,t){var n=te();try{return t()}finally{console.log(e+` time: `+(te()-n)+`ms`)}}function Rt(e,t){return t()}function zt(e){function t(n){var r=e.children(n),i=e.node(n);if(r.length&&s(r,t),Object.prototype.hasOwnProperty.call(i,`minRank`)){i.borderLeft=[],i.borderRight=[];for(var a=i.minRank,o=i.maxRank+1;a<o;++a)H(e,`borderLeft`,`_bl`,n,i,a),H(e,`borderRight`,`_br`,n,i,a)}}s(e.children(),t)}function H(e,t,n,r,i,a){var o={width:0,height:0,rank:a,borderType:t},s=i[t][a-1],c=I(e,`border`,o,n);i[t][a]=c,e.setParent(c,r),s&&e.setEdge(s,c,{weight:1})}function Bt(e){var t=e.graph().rankdir.toLowerCase();(t===`lr`||t===`rl`)&&U(e)}function Vt(e){var t=e.graph().rankdir.toLowerCase();(t===`bt`||t===`rl`)&&Ut(e),(t===`lr`||t===`rl`)&&(Wt(e),U(e))}function U(e){s(e.nodes(),function(t){Ht(e.node(t))}),s(e.edges(),function(t){Ht(e.edge(t))})}function Ht(e){var t=e.width;e.width=e.height,e.height=t}function Ut(e){s(e.nodes(),function(t){W(e.node(t))}),s(e.edges(),function(t){var n=e.edge(t);s(n.points,W),Object.prototype.hasOwnProperty.call(n,`y`)&&W(n)})}function W(e){e.y=-e.y}function Wt(e){s(e.nodes(),function(t){G(e.node(t))}),s(e.edges(),function(t){var n=e.edge(t);s(n.points,G),Object.prototype.hasOwnProperty.call(n,`x`)&&G(n)})}function G(e){var t=e.x;e.x=e.y,e.y=t}function Gt(e){e.graph().dummyChains=[],s(e.edges(),function(t){Kt(e,t)})}function Kt(e,t){var n=t.v,r=e.node(n).rank,i=t.w,a=e.node(i).rank,o=t.name,s=e.edge(t),c=s.labelRank;if(a!==r+1){e.removeEdge(t);var l=void 0,u,d;for(d=0,++r;r<a;++d,++r)s.points=[],l={width:0,height:0,edgeLabel:s,edgeObj:t,rank:r},u=I(e,`edge`,l,`_d`),r===c&&(l.width=s.width,l.height=s.height,l.dummy=`edge-label`,l.labelpos=s.labelpos),e.setEdge(n,u,{weight:s.weight},o),d===0&&e.graph().dummyChains.push(u),n=u;e.setEdge(n,i,{weight:s.weight},o)}}function qt(e){s(e.graph().dummyChains,function(t){var n=e.node(t),r=n.edgeLabel,i;for(e.setEdge(n.edgeObj,r);n.dummy;)i=e.successors(t)[0],e.removeNode(t),r.points.push({x:n.x,y:n.y}),n.dummy===`edge-label`&&(r.x=n.x,r.y=n.y,r.width=n.width,r.height=n.height),t=i,n=e.node(t)})}function K(e){var t={};function n(i){var a=e.node(i);if(Object.prototype.hasOwnProperty.call(t,i))return a.rank;t[i]=!0;var o=v(r(e.outEdges(i),function(t){return n(t.w)-e.edge(t).minlen}));return(o===1/0||o==null)&&(o=0),a.rank=o}s(e.sources(),n)}function q(e,t){return e.node(t.w).rank-e.node(t.v).rank-e.edge(t).minlen}function Jt(e){var t=new y({directed:!1}),n=e.nodes()[0],r=e.nodeCount();t.setNode(n,{});for(var i,a;Yt(t,e)<r;)i=Xt(t,e),a=t.hasNode(i.v)?q(e,i):-q(e,i),Zt(t,e,a);return t}function Yt(e,t){function n(r){s(t.nodeEdges(r),function(i){var a=i.v,o=r===a?i.w:a;!e.hasNode(o)&&!q(t,i)&&(e.setNode(o,{}),e.setEdge(r,o,{}),n(o))})}return s(e.nodes(),n),e.nodeCount()}function Xt(e,t){return O(t.edges(),function(n){if(e.hasNode(n.v)!==e.hasNode(n.w))return q(t,n)})}function Zt(e,t,n){s(e.nodes(),function(e){t.node(e).rank+=n})}x(1),x(1),Qt.CycleException=J;function Qt(e){var t={},n={},r=[];function i(a){if(Object.prototype.hasOwnProperty.call(n,a))throw new J;Object.prototype.hasOwnProperty.call(t,a)||(n[a]=!0,t[a]=!0,s(e.predecessors(a),i),delete n[a],r.push(a))}if(s(e.sinks(),i),gt(t)!==e.nodeCount())throw new J;return r}function J(){}J.prototype=Error();function $t(e,t,n){S(t)||(t=[t]);var r=(e.isDirected()?e.successors:e.neighbors).bind(e),i=[],a={};return s(t,function(t){if(!e.hasNode(t))throw Error(`Graph does not have node: `+t);en(e,t,n===`post`,a,r,i)}),i}function en(e,t,n,r,i,a){Object.prototype.hasOwnProperty.call(r,t)||(r[t]=!0,n||a.push(t),s(i(t),function(t){en(e,t,n,r,i,a)}),n&&a.push(t))}function tn(e,t){return $t(e,t,`post`)}function nn(e,t){return $t(e,t,`pre`)}Y.initLowLimValues=Z,Y.initCutValues=X,Y.calcCutValue=an,Y.leaveEdge=sn,Y.enterEdge=cn,Y.exchangeEdges=ln;function Y(e){e=Nt(e),K(e);var t=Jt(e);Z(t),X(t,e);for(var n,r;n=sn(t);)r=cn(t,e,n),ln(t,e,n,r)}function X(e,t){var n=tn(e,e.nodes());n=n.slice(0,n.length-1),s(n,function(n){rn(e,t,n)})}function rn(e,t,n){var r=e.node(n).parent;e.edge(n,r).cutvalue=an(e,t,n)}function an(e,t,n){var r=e.node(n).parent,i=!0,a=t.edge(n,r),o=0;return a||=(i=!1,t.edge(r,n)),o=a.weight,s(t.nodeEdges(n),function(a){var s=a.v===n,c=s?a.w:a.v;if(c!==r){var l=s===i,u=t.edge(a).weight;if(o+=l?u:-u,dn(e,n,c)){var d=e.edge(n,c).cutvalue;o+=l?-d:d}}}),o}function Z(e,t){arguments.length<2&&(t=e.nodes()[0]),on(e,{},1,t)}function on(e,t,n,r,i){var a=n,o=e.node(r);return t[r]=!0,s(e.neighbors(r),function(i){Object.prototype.hasOwnProperty.call(t,i)||(n=on(e,t,n,i,r))}),o.low=a,o.lim=n++,i?o.parent=i:delete o.parent,n}function sn(e){return _(e.edges(),function(t){return e.edge(t).cutvalue<0})}function cn(e,t,n){var r=n.v,i=n.w;t.hasEdge(r,i)||(r=n.w,i=n.v);var o=e.node(r),s=e.node(i),c=o,l=!1;o.lim>s.lim&&(c=s,l=!0);var u=a(t.edges(),function(t){return l===fn(e,e.node(t.v),c)&&l!==fn(e,e.node(t.w),c)});return O(u,function(e){return q(t,e)})}function ln(e,t,n,r){var i=n.v,a=n.w;e.removeEdge(i,a),e.setEdge(r.v,r.w,{}),Z(e),X(e,t),un(e,t)}function un(e,t){var n=_(e.nodes(),function(e){return!t.node(e).parent}),r=nn(e,n);r=r.slice(1),s(r,function(n){var r=e.node(n).parent,i=t.edge(n,r),a=!1;i||(i=t.edge(r,n),a=!0),t.node(n).rank=t.node(r).rank+(a?i.minlen:-i.minlen)})}function dn(e,t,n){return e.hasEdge(t,n)}function fn(e,t,n){return n.low<=t.lim&&t.lim<=n.lim}function pn(e){switch(e.graph().ranker){case`network-simplex`:gn(e);break;case`tight-tree`:hn(e);break;case`longest-path`:mn(e);break;default:gn(e)}}var mn=K;function hn(e){K(e),Jt(e)}function gn(e){Y(e)}function _n(e){var t=I(e,`root`,{},`_root`),n=yn(e),r=D(c(n))-1,i=2*r+1;e.graph().nestingRoot=t,s(e.edges(),function(t){e.edge(t).minlen*=i});var a=bn(e)+1;s(e.children(),function(o){vn(e,t,i,a,r,n,o)}),e.graph().nodeRankFactor=i}function vn(e,t,n,r,i,a,o){var c=e.children(o);if(!c.length){o!==t&&e.setEdge(t,o,{weight:0,minlen:n});return}var l=B(e,`_bt`),u=B(e,`_bb`),d=e.node(o);e.setParent(l,o),d.borderTop=l,e.setParent(u,o),d.borderBottom=u,s(c,function(s){vn(e,t,n,r,i,a,s);var c=e.node(s),d=c.borderTop?c.borderTop:s,f=c.borderBottom?c.borderBottom:s,p=c.borderTop?r:2*r,m=d===f?i-a[o]+1:1;e.setEdge(l,d,{weight:p,minlen:m,nestingEdge:!0}),e.setEdge(f,u,{weight:p,minlen:m,nestingEdge:!0})}),e.parent(o)||e.setEdge(t,l,{weight:0,minlen:i+a[o]})}function yn(e){var t={};function n(r,i){var a=e.children(r);a&&a.length&&s(a,function(e){n(e,i+1)}),t[r]=i}return s(e.children(),function(e){n(e,1)}),t}function bn(e){return o(e.edges(),function(t,n){return t+e.edge(n).weight},0)}function xn(e){var t=e.graph();e.removeNode(t.nestingRoot),delete t.nestingRoot,s(e.edges(),function(t){e.edge(t).nestingEdge&&e.removeEdge(t)})}function Sn(e,t,n){var r={},i;s(n,function(n){for(var a=e.parent(n),o,s;a;){if(o=e.parent(a),o?(s=r[o],r[o]=a):(s=i,i=a),s&&s!==a){t.setEdge(s,a);return}a=o}})}function Cn(e,t,n){var r=wn(e),i=new y({compound:!0}).setGraph({root:r}).setDefaultNodeLabel(function(t){return e.node(t)});return s(e.nodes(),function(a){var o=e.node(a),c=e.parent(a);(o.rank===t||o.minRank<=t&&t<=o.maxRank)&&(i.setNode(a),i.setParent(a,c||r),s(e[n](a),function(t){var n=t.v===a?t.w:t.v,r=i.edge(n,a),o=T(r)?0:r.weight;i.setEdge(n,a,{weight:e.edge(t).weight+o})}),Object.prototype.hasOwnProperty.call(o,`minRank`)&&i.setNode(a,{borderLeft:o.borderLeft[t],borderRight:o.borderRight[t]}))}),i}function wn(e){for(var t;e.hasNode(t=N(`_root`)););return t}function Tn(e,t){for(var n=0,r=1;r<t.length;++r)n+=En(e,t[r-1],t[r]);return n}function En(e,t,n){for(var i=St(n,r(n,function(e,t){return t})),a=C(r(t,function(t){return M(r(e.outEdges(t),function(t){return{pos:i[t.w],weight:e.edge(t).weight}}),`pos`)})),o=1;o<n.length;)o<<=1;var c=2*o-1;--o;var l=r(Array(c),function(){return 0}),u=0;return s(a.forEach(function(e){var t=e.pos+o;l[t]+=e.weight;for(var n=0;t>0;)t%2&&(n+=l[t+1]),t=t-1>>1,l[t]+=e.weight;u+=e.weight*n})),u}function Dn(e){var t={},n=a(e.nodes(),function(t){return!e.children(t).length}),i=D(r(n,function(t){return e.node(t).rank})),o=r(j(i+1),function(){return[]});function c(n){if(!ne(t,n)){t[n]=!0;var r=e.node(n);o[r.rank].push(n),s(e.successors(n),c)}}var l=M(n,function(t){return e.node(t).rank});return s(l,c),o}function On(e,t){return r(t,function(t){var n=e.inEdges(t);if(n.length){var r=o(n,function(t,n){var r=e.edge(n),i=e.node(n.v);return{sum:t.sum+r.weight*i.order,weight:t.weight+r.weight}},{sum:0,weight:0});return{v:t,barycenter:r.sum/r.weight,weight:r.weight}}else return{v:t}})}function kn(e,t){var n={};s(e,function(e,t){var r=n[e.v]={indegree:0,in:[],out:[],vs:[e.v],i:t};T(e.barycenter)||(r.barycenter=e.barycenter,r.weight=e.weight)}),s(t.edges(),function(e){var t=n[e.v],r=n[e.w];!T(t)&&!T(r)&&(r.indegree++,t.out.push(n[e.w]))});var r=a(n,function(e){return!e.indegree});return An(r)}function An(e){var t=[];function n(e){return function(t){t.merged||(T(t.barycenter)||T(e.barycenter)||t.barycenter>=e.barycenter)&&jn(e,t)}}function i(t){return function(n){n.in.push(t),--n.indegree===0&&e.push(n)}}for(;e.length;){var o=e.pop();t.push(o),s(o.in.reverse(),n(o)),s(o.out,i(o))}return r(a(t,function(e){return!e.merged}),function(e){return b(e,[`vs`,`i`,`barycenter`,`weight`])})}function jn(e,t){var n=0,r=0;e.weight&&(n+=e.barycenter*e.weight,r+=e.weight),t.weight&&(n+=t.barycenter*t.weight,r+=t.weight),e.vs=t.vs.concat(e.vs),e.barycenter=n/r,e.weight=r,e.i=Math.min(t.i,e.i),t.merged=!0}function Mn(e,t){var n=It(e,function(e){return Object.prototype.hasOwnProperty.call(e,`barycenter`)}),r=n.lhs,i=M(n.rhs,function(e){return-e.i}),a=[],o=0,c=0,l=0;r.sort(Pn(!!t)),l=Nn(a,i,l),s(r,function(e){l+=e.vs.length,a.push(e.vs),o+=e.barycenter*e.weight,c+=e.weight,l=Nn(a,i,l)});var u={vs:C(a)};return c&&(u.barycenter=o/c,u.weight=c),u}function Nn(e,t,r){for(var i;t.length&&(i=n(t)).i<=r;)t.pop(),e.push(i.vs),r++;return r}function Pn(e){return function(t,n){return t.barycenter<n.barycenter?-1:t.barycenter>n.barycenter?1:e?n.i-t.i:t.i-n.i}}function Fn(e,t,n,r){var i=e.children(t),o=e.node(t),c=o?o.borderLeft:void 0,l=o?o.borderRight:void 0,u={};c&&(i=a(i,function(e){return e!==c&&e!==l}));var d=On(e,i);s(d,function(t){if(e.children(t.v).length){var i=Fn(e,t.v,n,r);u[t.v]=i,Object.prototype.hasOwnProperty.call(i,`barycenter`)&&Ln(t,i)}});var f=kn(d,n);In(f,u);var p=Mn(f,r);if(c&&(p.vs=C([c,p.vs,l]),e.predecessors(c).length)){var m=e.node(e.predecessors(c)[0]),h=e.node(e.predecessors(l)[0]);Object.prototype.hasOwnProperty.call(p,`barycenter`)||(p.barycenter=0,p.weight=0),p.barycenter=(p.barycenter*p.weight+m.order+h.order)/(p.weight+2),p.weight+=2}return p}function In(e,t){s(e,function(e){e.vs=C(e.vs.map(function(e){return t[e]?t[e].vs:e}))})}function Ln(e,t){T(e.barycenter)?(e.barycenter=t.barycenter,e.weight=t.weight):(e.barycenter=(e.barycenter*e.weight+t.barycenter*t.weight)/(e.weight+t.weight),e.weight+=t.weight)}function Rn(e){var t=V(e),n=zn(e,j(1,t+1),`inEdges`),r=zn(e,j(t-1,-1,-1),`outEdges`),i=Dn(e);Vn(e,i);for(var a=1/0,o,s=0,c=0;c<4;++s,++c){Bn(s%2?n:r,s%4>=2),i=z(e);var l=Tn(e,i);l<a&&(c=0,o=we(i),a=l)}Vn(e,o)}function zn(e,t,n){return r(t,function(t){return Cn(e,t,n)})}function Bn(e,t){var n=new y;s(e,function(e){var r=e.graph().root,i=Fn(e,r,n,t);s(i.vs,function(t,n){e.node(t).order=n}),Sn(e,n,i.vs)})}function Vn(e,t){s(t,function(t){s(t,function(t,n){e.node(t).order=n})})}function Hn(e){var t=Wn(e);s(e.graph().dummyChains,function(n){for(var r=e.node(n),i=r.edgeObj,a=Un(e,t,i.v,i.w),o=a.path,s=a.lca,c=0,l=o[c],u=!0;n!==i.w;){if(r=e.node(n),u){for(;(l=o[c])!==s&&e.node(l).maxRank<r.rank;)c++;l===s&&(u=!1)}if(!u){for(;c<o.length-1&&e.node(l=o[c+1]).minRank<=r.rank;)c++;l=o[c]}e.setParent(n,l),n=e.successors(n)[0]}})}function Un(e,t,n,r){var i=[],a=[],o=Math.min(t[n].low,t[r].low),s=Math.max(t[n].lim,t[r].lim),c=n,l;do c=e.parent(c),i.push(c);while(c&&(t[c].low>o||s>t[c].lim));for(l=c,c=r;(c=e.parent(c))!==l;)a.push(c);return{path:i.concat(a.reverse()),lca:l}}function Wn(e){var t={},n=0;function r(i){var a=n;s(e.children(i),r),t[i]={low:a,lim:n++}}return s(e.children(),r),t}function Gn(e,t){var r={};function i(t,i){var a=0,o=0,c=t.length,l=n(i);return s(i,function(t,n){var u=qn(e,t),d=u?e.node(u).order:c;(u||t===l)&&(s(i.slice(o,n+1),function(t){s(e.predecessors(t),function(n){var i=e.node(n),o=i.order;(o<a||d<o)&&!(i.dummy&&e.node(t).dummy)&&Jn(r,n,t)})}),o=n+1,a=d)}),i}return o(t,i),r}function Kn(e,t){var n={};function r(t,r,i,a,o){var c;s(j(r,i),function(r){c=t[r],e.node(c).dummy&&s(e.predecessors(c),function(t){var r=e.node(t);r.dummy&&(r.order<a||r.order>o)&&Jn(n,t,c)})})}function i(t,n){var i=-1,a,o=0;return s(n,function(s,c){if(e.node(s).dummy===`border`){var l=e.predecessors(s);l.length&&(a=e.node(l[0]).order,r(n,o,c,i,a),o=c,i=a)}r(n,o,n.length,a,t.length)}),n}return o(t,i),n}function qn(e,t){if(e.node(t).dummy)return _(e.predecessors(t),function(t){return e.node(t).dummy})}function Jn(e,t,n){if(t>n){var r=t;t=n,n=r}Object.prototype.hasOwnProperty.call(e,t)||Object.defineProperty(e,t,{enumerable:!0,configurable:!0,value:{},writable:!0});var i=e[t];Object.defineProperty(i,n,{enumerable:!0,configurable:!0,value:!0,writable:!0})}function Yn(e,t,n){if(t>n){var r=t;t=n,n=r}return!!e[t]&&Object.prototype.hasOwnProperty.call(e[t],n)}function Xn(e,t,n,r){var i={},a={},o={};return s(t,function(e){s(e,function(e,t){i[e]=e,a[e]=e,o[e]=t})}),s(t,function(e){var t=-1;s(e,function(e){var s=r(e);if(s.length){s=M(s,function(e){return o[e]});for(var c=(s.length-1)/2,l=Math.floor(c),u=Math.ceil(c);l<=u;++l){var d=s[l];a[e]===e&&t<o[d]&&!Yn(n,e,d)&&(a[d]=e,a[e]=i[e]=i[d],t=o[d])}}})}),{root:i,align:a}}function Zn(e,t,n,r,i){var a={},o=Qn(e,t,n,i),c=i?`borderLeft`:`borderRight`;function l(e,t){for(var n=o.nodes(),r=n.pop(),i={};r;)i[r]?e(r):(i[r]=!0,n.push(r),n=n.concat(t(r))),r=n.pop()}function u(e){a[e]=o.inEdges(e).reduce(function(e,t){return Math.max(e,a[t.v]+o.edge(t))},0)}function d(t){var n=o.outEdges(t).reduce(function(e,t){return Math.min(e,a[t.w]-o.edge(t))},1/0),r=e.node(t);n!==1/0&&r.borderType!==c&&(a[t]=Math.max(a[t],n))}return l(u,o.predecessors.bind(o)),l(d,o.successors.bind(o)),s(r,function(e){a[e]=a[n[e]]}),a}function Qn(e,t,n,r){var i=new y,a=e.graph(),o=rr(a.nodesep,a.edgesep,r);return s(t,function(t){var r;s(t,function(t){var a=n[t];if(i.setNode(a),r){var s=n[r],c=i.edge(s,a);i.setEdge(s,a,Math.max(o(e,t,r),c||0))}r=t})}),i}function $n(e,t){return O(c(t),function(t){var n=-1/0,r=1/0;return Ee(t,function(t,i){var a=ir(e,i)/2;n=Math.max(t+a,n),r=Math.min(t-a,r)}),n-r})}function er(e,t){var n=c(t),r=v(n),i=D(n);s([`u`,`d`],function(n){s([`l`,`r`],function(a){var o=n+a,s=e[o],l;if(s!==t){var u=c(s);l=a===`l`?r-v(u):i-D(u),l&&(e[o]=E(s,function(e){return e+l}))}})})}function tr(e,t){return E(e.ul,function(n,i){if(t)return e[t.toLowerCase()][i];var a=M(r(e,i));return(a[1]+a[2])/2})}function nr(e){var t=z(e),n=g(Gn(e,t),Kn(e,t)),i={},a;s([`u`,`d`],function(o){a=o===`u`?t:c(t).reverse(),s([`l`,`r`],function(t){t===`r`&&(a=r(a,function(e){return c(e).reverse()}));var s=(o===`u`?e.predecessors:e.successors).bind(e),l=Xn(e,a,n,s),u=Zn(e,a,l.root,l.align,t===`r`);t===`r`&&(u=E(u,function(e){return-e})),i[o+t]=u})});var o=$n(e,i);return er(i,o),tr(i,e.graph().align)}function rr(e,t,n){return function(r,i,a){var o=r.node(i),s=r.node(a),c=0,l;if(c+=o.width/2,Object.prototype.hasOwnProperty.call(o,`labelpos`))switch(o.labelpos.toLowerCase()){case`l`:l=-o.width/2;break;case`r`:l=o.width/2;break}if(l&&(c+=n?l:-l),l=0,c+=(o.dummy?t:e)/2,c+=(s.dummy?t:e)/2,c+=s.width/2,Object.prototype.hasOwnProperty.call(s,`labelpos`))switch(s.labelpos.toLowerCase()){case`l`:l=s.width/2;break;case`r`:l=-s.width/2;break}return l&&(c+=n?l:-l),l=0,c}}function ir(e,t){return e.node(t).width}function ar(e){e=L(e),or(e),Oe(nr(e),function(t,n){e.node(n).x=t})}function or(e){var t=z(e),n=e.graph().ranksep,i=0;s(t,function(t){var a=D(r(t,function(t){return e.node(t).height}));s(t,function(t){e.node(t).y=i+a/2}),i+=a+n})}function sr(e,t){var n=t&&t.debugTiming?Lt:Rt;n(`layout`,()=>{var t=n(`  buildLayoutGraph`,()=>vr(e));n(`  runLayout`,()=>cr(t,n)),n(`  updateInputGraph`,()=>lr(e,t))})}function cr(e,t){t(`    makeSpaceForEdgeLabels`,()=>yr(e)),t(`    removeSelfEdges`,()=>Or(e)),t(`    acyclic`,()=>At(e)),t(`    nestingGraph.run`,()=>_n(e)),t(`    rank`,()=>pn(L(e))),t(`    injectEdgeLabelProxies`,()=>br(e)),t(`    removeEmptyRanks`,()=>Ft(e)),t(`    nestingGraph.cleanup`,()=>xn(e)),t(`    normalizeRanks`,()=>Pt(e)),t(`    assignRankMinMax`,()=>xr(e)),t(`    removeEdgeLabelProxies`,()=>Sr(e)),t(`    normalize.run`,()=>Gt(e)),t(`    parentDummyChains`,()=>Hn(e)),t(`    addBorderSegments`,()=>zt(e)),t(`    order`,()=>Rn(e)),t(`    insertSelfEdges`,()=>kr(e)),t(`    adjustCoordinateSystem`,()=>Bt(e)),t(`    position`,()=>ar(e)),t(`    positionSelfEdges`,()=>Ar(e)),t(`    removeBorderNodes`,()=>Dr(e)),t(`    normalize.undo`,()=>qt(e)),t(`    fixupEdgeLabelCoords`,()=>Tr(e)),t(`    undoCoordinateSystem`,()=>Vt(e)),t(`    translateGraph`,()=>Cr(e)),t(`    assignNodeIntersects`,()=>wr(e)),t(`    reversePoints`,()=>Er(e)),t(`    acyclic.undo`,()=>Mt(e))}function lr(e,t){s(e.nodes(),function(n){var r=e.node(n),i=t.node(n);r&&(r.x=i.x,r.y=i.y,t.children(n).length&&(r.width=i.width,r.height=i.height))}),s(e.edges(),function(n){var r=e.edge(n),i=t.edge(n);r.points=i.points,Object.prototype.hasOwnProperty.call(i,`x`)&&(r.x=i.x,r.y=i.y)}),e.graph().width=t.graph().width,e.graph().height=t.graph().height}var ur=[`nodesep`,`edgesep`,`ranksep`,`marginx`,`marginy`],dr={ranksep:50,edgesep:20,nodesep:50,rankdir:`tb`},fr=[`acyclicer`,`ranker`,`rankdir`,`align`],pr=[`width`,`height`],mr={width:0,height:0},hr=[`minlen`,`weight`,`width`,`height`,`labeloffset`],gr={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:`r`},_r=[`labelpos`];function vr(e){var t=new y({multigraph:!0,compound:!0}),n=$(e.graph());return t.setGraph(g({},dr,Q(n,ur),b(n,fr))),s(e.nodes(),function(n){var r=$(e.node(n));t.setNode(n,oe(Q(r,pr),mr)),t.setParent(n,e.parent(n))}),s(e.edges(),function(n){var r=$(e.edge(n));t.setEdge(n,g({},gr,Q(r,hr),b(r,_r)))}),t}function yr(e){var t=e.graph();t.ranksep/=2,s(e.edges(),function(n){var r=e.edge(n);r.minlen*=2,r.labelpos.toLowerCase()!==`c`&&(t.rankdir===`TB`||t.rankdir===`BT`?r.width+=r.labeloffset:r.height+=r.labeloffset)})}function br(e){s(e.edges(),function(t){var n=e.edge(t);if(n.width&&n.height){var r=e.node(t.v),i={rank:(e.node(t.w).rank-r.rank)/2+r.rank,e:t};I(e,`edge-proxy`,i,`_ep`)}})}function xr(e){var t=0;s(e.nodes(),function(n){var r=e.node(n);r.borderTop&&(r.minRank=e.node(r.borderTop).rank,r.maxRank=e.node(r.borderBottom).rank,t=D(t,r.maxRank))}),e.graph().maxRank=t}function Sr(e){s(e.nodes(),function(t){var n=e.node(t);n.dummy===`edge-proxy`&&(e.edge(n.e).labelRank=n.rank,e.removeNode(t))})}function Cr(e){var t=1/0,n=0,r=1/0,i=0,a=e.graph(),o=a.marginx||0,c=a.marginy||0;function l(e){var a=e.x,o=e.y,s=e.width,c=e.height;t=Math.min(t,a-s/2),n=Math.max(n,a+s/2),r=Math.min(r,o-c/2),i=Math.max(i,o+c/2)}s(e.nodes(),function(t){l(e.node(t))}),s(e.edges(),function(t){var n=e.edge(t);Object.prototype.hasOwnProperty.call(n,`x`)&&l(n)}),t-=o,r-=c,s(e.nodes(),function(n){var i=e.node(n);i.x-=t,i.y-=r}),s(e.edges(),function(n){var i=e.edge(n);s(i.points,function(e){e.x-=t,e.y-=r}),Object.prototype.hasOwnProperty.call(i,`x`)&&(i.x-=t),Object.prototype.hasOwnProperty.call(i,`y`)&&(i.y-=r)}),a.width=n-t+o,a.height=i-r+c}function wr(e){s(e.edges(),function(t){var n=e.edge(t),r=e.node(t.v),i=e.node(t.w),a,o;n.points?(a=n.points[0],o=n.points[n.points.length-1]):(n.points=[],a=i,o=r),n.points.unshift(R(r,a)),n.points.push(R(i,o))})}function Tr(e){s(e.edges(),function(t){var n=e.edge(t);if(Object.prototype.hasOwnProperty.call(n,`x`))switch((n.labelpos===`l`||n.labelpos===`r`)&&(n.width-=n.labeloffset),n.labelpos){case`l`:n.x-=n.width/2+n.labeloffset;break;case`r`:n.x+=n.width/2+n.labeloffset;break}})}function Er(e){s(e.edges(),function(t){var n=e.edge(t);n.reversed&&n.points.reverse()})}function Dr(e){s(e.nodes(),function(t){if(e.children(t).length){var r=e.node(t),i=e.node(r.borderTop),a=e.node(r.borderBottom),o=e.node(n(r.borderLeft)),s=e.node(n(r.borderRight));r.width=Math.abs(s.x-o.x),r.height=Math.abs(a.y-i.y),r.x=o.x+r.width/2,r.y=i.y+r.height/2}}),s(e.nodes(),function(t){e.node(t).dummy===`border`&&e.removeNode(t)})}function Or(e){s(e.edges(),function(t){if(t.v===t.w){var n=e.node(t.v);n.selfEdges||=[],n.selfEdges.push({e:t,label:e.edge(t)}),e.removeEdge(t)}})}function kr(e){var t=z(e);s(t,function(t){var n=0;s(t,function(t,r){var i=e.node(t);i.order=r+n,s(i.selfEdges,function(t){I(e,`selfedge`,{width:t.label.width,height:t.label.height,rank:i.rank,order:r+ ++n,e:t.e,label:t.label},`_se`)}),delete i.selfEdges})})}function Ar(e){s(e.nodes(),function(t){var n=e.node(t);if(n.dummy===`selfedge`){var r=e.node(n.e.v),i=r.x+r.width/2,a=r.y,o=n.x-i,s=r.height/2;e.setEdge(n.e,n.label),e.removeNode(t),n.label.points=[{x:i+2*o/3,y:a-s},{x:i+5*o/6,y:a-s},{x:i+o,y:a},{x:i+5*o/6,y:a+s},{x:i+2*o/3,y:a+s}],n.label.x=n.x,n.label.y=n.y}})}function Q(e,t){return E(b(e,t),Number)}function $(e){var t={};return s(e,function(e,n){t[n.toLowerCase()]=e}),t}export{sr as t};