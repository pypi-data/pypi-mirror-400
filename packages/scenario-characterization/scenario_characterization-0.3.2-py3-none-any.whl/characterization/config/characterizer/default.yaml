processor:
    config:
      return_criterion: ${return_criterion} # Can be 'critical', 'average', or 'none'
      scenario_type: ${scenario_type}

      batch_size: ${batch_size}
      num_workers: ${num_workers}
      shuffle: ${shuffle}

      save: ${save}
      overwrite: ${overwrite}
      update: ${update}
      output_path: ${paths.output_paths.feature_cache_path}
      feature_path: ${paths.output_paths.feature_cache_path}

      features:
        - speed
        - speed_limit_diff
        - acceleration
        - deceleration
        - jerk
        - waiting_period
        - trajectory_type
        - kalman_difficulty
        - separation
        - intersection
        - collision
        - mttcp
        - thw
        - ttc
        - drac

characterizer:
  config:
    feature_type: ${feature_type}

    # Individual feature categorization files
    vehicle_categorization_file: ./meta/type_vehicle_feature_percentiles.json
    cyclist_categorization_file: ./meta/type_cyclist_feature_percentiles.json
    pedestrian_categorization_file: ./meta/type_pedestrian_feature_percentiles.json

    # Interaction feature categorization files
    vehicle_vehicle_categorization_file: ./meta/type_vehicle_vehicle_feature_percentiles.json
    vehicle_pedestrian_categorization_file: ./meta/type_vehicle_pedestrian_feature_percentiles.json
    vehicle_cyclist_categorization_file: ./meta/type_vehicle_cyclist_feature_percentiles.json
    pedestrian_pedestrian_categorization_file: ./meta/type_pedestrian_pedestrian_feature_percentiles.json
    pedestrian_cyclist_categorization_file: ./meta/type_pedestrian_cyclist_feature_percentiles.json
    cyclist_cyclist_categorization_file: ./meta/type_cyclist_cyclist_feature_percentiles.json

    # Scoring parameters
    vru_priority_weight: ${vru_priority_weight} # Weight for VRU priority in scoring
    categorize_scores: ${categorize_scores} # Whether to categorize scores
    score_weighting_method: ${score_weighting_method} # Method for weighting scores ('uniform', 'wrt_ego', 'wrt_relevant')
    reduce_distance_penalty: ${reduce_distance_penalty} # Whether to reduce distance penalty
    aggregated_score_weight: ${aggregated_score_weight} # Weight for aggregated score in final score computation
    individual_score_function: simple
    individual_categorization_file: ./meta/${scenario_type}_${return_criterion}_${feature_type}_individual.json
    interaction_score_function: simple
    interaction_categorization_file: ./meta/${scenario_type}_${return_criterion}_${feature_type}_interaction.json
    score_clip:
      min: 0.0
      max: 200.0

    # NOTE: if weights are not specified here, will use default values from FeatureWeights in schemas/detections.py.
    weights:
      # Individual features
      speed: 1.0
      speed_limit_diff: 1.0
      acceleration: 1.0
      deceleration: 1.0
      jerk: 0.1
      waiting_period: 1.0

      # Individual features from Unitraj
      trajectory_type: 0.1
      kalman_difficulty: 1.0

      # Interaction features
      collision: 4.0
      mttcp: 2.0
      thw: 2.0
      ttc: 2.0
      drac: 2.0

    # NOTE: if detections are not specified here, the code uses the default values from FeatureDetections which is
    # defined in 'schemas/detections.py'. The current thresholds have been adjusted from FeatureDetections based on
    # feature distribution analysis performed on a subset of the WOMD data, using 'run_feature_analysis.py'. We select
    # the ceil of maximum value accross vehicles, pedestrians and cyclists at the 95th percentile as the detection threshold.
    detections:
      speed: 18 # in m/s, i.e. ~90 km/h ~56 mph
      speed_limit_diff: 19 # in m/s, i.e. ~61 km/h ~38 mph
      acceleration: 5 # in m/s^2
      deceleration: 5 # in m/s^2
      jerk: 60 # in m/s^3
      waiting_period: 5 # in s/m
      kalman_difficulty: 23.0

      collision: 1
      mttcp: 2
      thw: 2
      ttc: 2
      drac: 5
