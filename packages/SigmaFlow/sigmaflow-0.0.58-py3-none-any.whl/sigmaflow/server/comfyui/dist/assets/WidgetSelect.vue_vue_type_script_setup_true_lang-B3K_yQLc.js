var ve=Object.defineProperty;var m=(s,l)=>ve(s,"name",{value:l,configurable:!0});import{defineComponent as Q,computed as p,openBlock as f,createBlock as j,withCtx as Y,createVNode as B,unref as y,mergeProps as oe,isRef as ye,createElementBlock as x,normalizeClass as U,createElementVNode as M,toDisplayString as E,createCommentVNode as R,mergeModels as X,useModel as z,useTemplateRef as ee,ref as I,withDirectives as ie,vModelText as be,Fragment as le,renderList as ae,inject as we,resolveDirective as he,createTextVNode as Se,watch as te,provide as ke,toRef as xe}from"vue";import{c as $,t as F,y as re,bQ as Me,a as $e,b_ as Ce,c4 as Ue}from"./index-6STX4Oia.js";import{bs as Ve,cj as ze}from"./vendor-other-_sromytg.js";import"primevue/button";import"vue-i18n";import"primevue/message";import"primevue/checkbox";import"primevue/divider";import"primevue/scrollpanel";import"primevue/usetoast";import"primevue/card";import"primevue/listbox";import"primevue/progressbar";import"primevue/floatlabel";import"primevue/inputtext";import"@primevue/forms";import"@primevue/forms/resolvers/zod";import"primevue/password";import"primevue/progressspinner";import"primevue/skeleton";import"primevue/tag";import"primevue/inputnumber";import"primevue/tabpanels";import"primevue/tabs";import"primevue/iconfield";import"primevue/inputicon";import"primevue/badge";import"primevue/chip";import"primevue/tabpanel";import Ae from"primevue/select";import"primevue/toggleswitch";import"primevue/colorpicker";import"primevue/radiobutton";import"primevue/knob";import"primevue/slider";import"primevue/panel";import"primevue/tabmenu";import ne from"primevue/popover";import"primevue/tab";import"primevue/tablist";import"primevue";import"./vendor-xterm-DV1MVhAx.js";import"primevue/galleria";import"primevue/tabview";import"primevue/dropdown";import"primevue/contextmenu";import"primevue/tree";import"primevue/toolbar";import"primevue/selectbutton";import"primevue/dialog";import"primevue/confirmpopup";import"primevue/useconfirm";import"primevue/confirmdialog";import{c as de}from"./useWidgetValue-BBcazAQ2.js";import{u as ue}from"./useTransformCompatOverlayProps-DkwHb7jz.js";import{f as ce,P as pe}from"./widgetPropFilter-CygYoMQt.js";import{W as me}from"./index-CmiHOCmF.js";import{_ as fe}from"./WidgetLayoutField.vue_vue_type_script_setup_true_lang-JppNXtiy.js";import{a as Oe}from"./LazyImage.vue_vue_type_script_setup_true_lang-g3Uhye0Z.js";const De=Q({__name:"WidgetSelectDefault",props:{widget:{},modelValue:{}},emits:["update:modelValue"],setup(s,{emit:l}){const e=s,h=l,{localValue:o,onChange:b}=de({widget:e.widget,modelValue:e.modelValue,defaultValue:e.widget.options?.values?.[0]||"",emit:h}),k=ue(),i=p(()=>{const t=e.widget.options;return t?.values&&Array.isArray(t.values)?t.values:[]}),d=p(()=>!!o.value&&!i.value.includes(o.value)),r=p(()=>({...ce(e.widget.options,pe),...k.value,...d.value?{placeholder:`${o.value}`}:{}}));return(t,u)=>(f(),j(fe,{widget:t.widget},{default:Y(()=>[B(y(Ae),oe({modelValue:y(o),"onUpdate:modelValue":u[0]||(u[0]=g=>ye(o)?o.value=g:null),invalid:d.value,options:i.value},r.value,{class:y($)(y(me),"w-full text-xs"),"aria-label":t.widget.name,size:"small",pt:{option:"text-xs",dropdown:"w-8"},"data-capture-wheel":"true","onUpdate:modelValue":y(b)}),null,16,["modelValue","invalid","options","class","aria-label","onUpdate:modelValue"])]),_:1},8,["widget"]))}}),Ie={class:"min-w-0 px-4 py-2 text-left"},Qe={key:0,class:"min-w-0"},Pe={key:1,class:"line-clamp-1 min-w-0 break-all"},Te=["multiple","disabled","accept"],Le=Q({__name:"FormDropdownInput",props:{isOpen:{type:Boolean,default:!1},placeholder:{default:"Select..."},files:{},items:{},selected:{},maxSelectable:{},uploadable:{type:Boolean},disabled:{type:Boolean},accept:{}},emits:["select-click","file-change"],setup(s,{emit:l}){const e=s,h=l,o=p(()=>e.items.filter(i=>e.selected.has(i.id))),b=p(()=>$("mr-2 size-4 transition-transform duration-200 flex-shrink-0 text-component-node-foreground-secondary",{"rotate-180":e.isOpen})),k=p(()=>$("border-0 bg-component-node-widget-background outline-none text-text-secondary",{"hover:bg-component-node-widget-background-hovered cursor-pointer":!e.disabled,"cursor-not-allowed":e.disabled,"text-text-primary":o.value.length>0}));return(i,d)=>(f(),x("div",{class:U(y($)(y(me),"flex text-base leading-none",{"opacity-50 cursor-not-allowed !outline-zinc-300/10":i.disabled}))},[M("button",{class:U(y($)(k.value,"flex justify-between items-center flex-1 h-8",{"rounded-l-lg":i.uploadable,"rounded-lg":!i.uploadable})),onClick:d[0]||(d[0]=r=>h("select-click",r))},[M("span",Ie,[o.value.length?(f(),x("span",Pe,E(o.value.map(r=>r.label??r.name).join(", ")),1)):(f(),x("span",Qe,E(e.placeholder),1))]),M("i",{class:U(["icon-[lucide--chevron-down]",b.value])},null,2)],2),i.uploadable?(f(),x("label",{key:0,class:U(y($)(k.value,"relative","size-8 flex justify-center items-center border-l rounded-r-lg border-zinc-300/10"))},[d[2]||(d[2]=M("i",{class:"icon-[lucide--folder-search] size-4"},null,-1)),M("input",{type:"file",class:"absolute inset-0 -z-1 opacity-0",multiple:i.maxSelectable>1,disabled:i.disabled,accept:i.accept,onChange:d[1]||(d[1]=r=>h("file-change",r))},null,40,Te)],2)):R("",!0)],2))}}),Fe={class:"text-secondary flex gap-2 px-4"},Be={key:0,class:"mr-2 icon-[lucide--loader-circle] size-4 animate-spin"},je={key:1,class:"mr-2 icon-[lucide--search] size-4"},Re={key:0,class:"absolute top-[-2px] left-[-2px] size-2 rounded-full bg-component-node-widget-background-highlighted"},We=["onClick"],Ke={key:0,class:"icon-[lucide--check] size-4"},N="bg-transparent border-0 outline-0 ring-0 text-left",se="size-6 flex justify-center items-center rounded-sm cursor-pointer transition-all duration-150 hover:scale-108 hover:text-base-foreground active:scale-95",Ee=Q({__name:"FormDropdownMenuActions",props:X({isQuerying:{type:Boolean},sortOptions:{}},{layoutMode:{},layoutModeModifiers:{},searchQuery:{},searchQueryModifiers:{},sortSelected:{},sortSelectedModifiers:{}}),emits:["update:layoutMode","update:searchQuery","update:sortSelected"],setup(s){const l=z(s,"layoutMode"),e=z(s,"searchQuery"),h=z(s,"sortSelected"),o=$("h-8 bg-zinc-500/20 rounded-lg outline outline-1 outline-offset-[-1px] outline-node-component-border transition-all duration-150"),b=ee("sortPopoverRef"),k=ee("sortTriggerRef"),i=I(!1);function d(u){!b.value||!k.value||(i.value=!i.value,b.value.toggle(u,k.value))}m(d,"toggleSortPopover");function r(){i.value=!1,b.value?.hide()}m(r,"closeSortPopover");function t(u){h.value=u.id,r()}return m(t,"handleSortSelected"),(u,g)=>(f(),x("div",Fe,[M("label",{class:U(y($)(y(o),"flex-1 flex px-2 items-center text-base leading-none cursor-text",e.value?.trim()!==""?"text-base-foreground":"","hover:outline-component-node-widget-background-highlighted/80","focus-within:outline-component-node-widget-background-highlighted/80"))},[u.isQuerying?(f(),x("i",Be)):(f(),x("i",je)),ie(M("input",{"onUpdate:modelValue":g[0]||(g[0]=S=>e.value=S),type:"text",class:U(N),placeholder:"Search"},null,512),[[be,e.value]])],2),M("button",{ref_key:"sortTriggerRef",ref:k,class:U(y($)(N,y(o),"relative w-8 flex justify-center items-center cursor-pointer","hover:outline-component-node-widget-background-highlighted","active:!scale-95")),onClick:d},[h.value!=="default"?(f(),x("div",Re)):R("",!0),g[4]||(g[4]=M("i",{class:"icon-[lucide--arrow-up-down] size-4"},null,-1))],2),B(y(ne),{ref_key:"sortPopoverRef",ref:b,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg"]}},onHide:g[1]||(g[1]=S=>i.value=!1)},{default:Y(()=>[M("div",{class:U(y($)("flex flex-col gap-2 p-2 min-w-32","bg-component-node-background","rounded-lg outline outline-offset-[-1px] outline-component-node-border"))},[(f(!0),x(le,null,ae(u.sortOptions,S=>(f(),x("button",{key:S.name,class:U(y($)(N,"flex justify-between items-center h-6 cursor-pointer","hover:!text-blue-500")),onClick:m(V=>t(S),"onClick")},[M("span",null,E(S.name),1),h.value===S.id?(f(),x("i",Ke)):R("",!0)],10,We))),128))],2)]),_:1},512),M("div",{class:U(y($)(y(o),"flex justify-center items-center p-1 gap-1 hover:outline-component-node-widget-background-highlighted"))},[M("button",{class:U(y($)(N,se,l.value==="list"?"bg-neutral-500/50 text-base-foreground":"")),onClick:g[2]||(g[2]=S=>l.value="list")},g[5]||(g[5]=[M("i",{class:"icon-[lucide--list] size-4"},null,-1)]),2),M("button",{class:U(y($)(N,se,l.value==="grid"?"bg-neutral-500/50 text-base-foreground":"")),onClick:g[3]||(g[3]=S=>l.value="grid")},g[6]||(g[6]=[M("i",{class:"icon-[lucide--layout-grid] size-4"},null,-1)]),2)],2)]))}}),qe={class:"text-secondary mb-4 flex gap-1 px-4"},He=["onClick"],Ne=Q({__name:"FormDropdownMenuFilter",props:X({filterOptions:{}},{filterSelected:{},filterSelectedModifiers:{}}),emits:["update:filterSelected"],setup(s){const l=z(s,"filterSelected");return(e,h)=>(f(),x("div",qe,[(f(!0),x(le,null,ae(e.filterOptions,o=>(f(),x("div",{key:o.id,class:U(y($)("px-4 py-2 rounded-md inline-flex justify-center items-center cursor-pointer select-none","transition-all duration-150","hover:text-base-foreground hover:bg-interface-menu-component-surface-hovered","active:scale-95",l.value===o.id?"!bg-interface-menu-component-surface-selected text-base-foreground":"bg-transparent")),onClick:m(b=>l.value=o.id,"onClick")},E(o.name),11,He))),128))]))}}),ge=Symbol("assetKind"),Xe={key:0,class:"absolute top-1 left-1 size-4 rounded-full border-1 border-base-foreground bg-primary-background"},Ze=["src"],Ge={key:3,class:"size-full bg-gradient-to-tr from-blue-400 via-teal-500 to-green-400"},Je={class:"text-secondary block text-xs"},Ye=Q({__name:"FormDropdownMenuItem",props:{index:{},selected:{type:Boolean},mediaSrc:{},name:{},label:{},metadata:{},layout:{}},emits:["click","mediaLoad"],setup(s,{emit:l}){const e=s,h=l,o=I(null),b=we(ge),k=p(()=>b?.value==="video");function i(){h("click",e.index)}m(i,"handleClick");function d(t){if(h("mediaLoad",t),!t.target||!(t.target instanceof HTMLImageElement))return;const u=t.target;u.naturalWidth&&u.naturalHeight&&(o.value=`${u.naturalWidth} x ${u.naturalHeight}`)}m(d,"handleImageLoad");function r(t){if(h("mediaLoad",t),!t.target||!(t.target instanceof HTMLVideoElement))return;const u=t.target;u.videoWidth&&u.videoHeight&&(o.value=`${u.videoWidth} x ${u.videoHeight}`)}return m(r,"handleVideoLoad"),(t,u)=>{const g=he("tooltip");return f(),x("div",{class:U(y($)("flex gap-1 select-none group/item cursor-pointer bg-component-node-widget-background","transition-all duration-150",{"flex-col text-center":t.layout==="grid","flex-row text-left max-h-16 rounded-lg hover:scale-102 active:scale-98":t.layout==="list","flex-row text-left hover:bg-component-node-widget-background-hovered rounded-lg":t.layout==="list-small","ring-2 ring-component-node-widget-background-highlighted":t.layout==="list"&&t.selected})),onClick:i},[t.layout!=="list-small"?(f(),x("div",{key:0,class:U(y($)("relative","w-full aspect-square overflow-hidden outline-1 outline-offset-[-1px] outline-interface-stroke","transition-all duration-150",{"min-w-16 max-w-16 rounded-l-lg":t.layout==="list","rounded-sm group-hover/item:scale-108 group-active/item:scale-95":t.layout==="grid","ring-2 ring-component-node-widget-background-highlighted":t.layout==="grid"&&t.selected}))},[t.selected?(f(),x("div",Xe,u[0]||(u[0]=[M("i",{class:"icon-[lucide--check] size-3 translate-y-[-0.5px] text-base-foreground bold"},null,-1)]))):R("",!0),t.mediaSrc&&k.value?(f(),x("video",{key:1,src:t.mediaSrc,class:"size-full object-cover",preload:"metadata",muted:"",onLoadeddata:r},null,40,Ze)):t.mediaSrc?(f(),j(Oe,{key:2,src:t.mediaSrc,alt:t.name,"image-class":"size-full object-cover",onLoad:d},null,8,["src","alt"])):(f(),x("div",Ge))],2)):R("",!0),M("div",{class:U(y($)("flex gap-1",{"flex-col":t.layout==="grid","flex-col px-4 py-1 w-full justify-center min-w-0":t.layout==="list","flex-row p-2 items-center justify-between w-full":t.layout==="list-small"}))},[ie((f(),x("span",{class:U(y($)("block text-xs line-clamp-2 break-words overflow-hidden","transition-colors duration-150",!!t.selected&&"text-base-foreground"))},[Se(E(t.label??t.name),1)],2)),[[g,t.layout==="grid"?t.label??t.name:void 0]]),M("span",Je,E(t.metadata||o.value),1)],2)],2)}}}),_e={class:"flex max-h-[640px] w-103 flex-col rounded-lg bg-component-node-background pt-4 outline outline-offset-[-1px] outline-node-component-border"},et={class:"relative flex h-full mt-2 overflow-y-scroll"},tt={key:0,class:"absolute inset-0 flex items-center justify-center"},ot=Q({__name:"FormDropdownMenu",props:X({items:{},isSelected:{type:Function},isQuerying:{type:Boolean},filterOptions:{},sortOptions:{}},{filterSelected:{},filterSelectedModifiers:{},layoutMode:{},layoutModeModifiers:{},sortSelected:{},sortSelectedModifiers:{},searchQuery:{},searchQueryModifiers:{}}),emits:X(["item-click"],["update:filterSelected","update:layoutMode","update:sortSelected","update:searchQuery"]),setup(s,{emit:l}){const e=l,h=z(s,"filterSelected"),o=z(s,"layoutMode"),b=z(s,"sortSelected"),k=z(s,"searchQuery");return(i,d)=>(f(),x("div",_e,[i.filterOptions.length>0?(f(),j(Ne,{key:0,"filter-selected":h.value,"onUpdate:filterSelected":d[0]||(d[0]=r=>h.value=r),"filter-options":i.filterOptions},null,8,["filter-selected","filter-options"])):R("",!0),B(Ee,{"layout-mode":o.value,"onUpdate:layoutMode":d[1]||(d[1]=r=>o.value=r),"sort-selected":b.value,"onUpdate:sortSelected":d[2]||(d[2]=r=>b.value=r),"search-query":k.value,"onUpdate:searchQuery":d[3]||(d[3]=r=>k.value=r),"sort-options":i.sortOptions,"is-querying":i.isQuerying},null,8,["layout-mode","sort-selected","search-query","sort-options","is-querying"]),M("div",et,[M("div",{class:U(y($)("h-full max-h-full grid gap-x-2 gap-y-4 overflow-y-auto px-4 pt-4 pb-4 w-full",{"grid-cols-4":o.value==="grid","grid-cols-1 gap-y-2":o.value==="list","grid-cols-1 gap-y-1":o.value==="list-small"}))},[d[5]||(d[5]=M("div",{class:"pointer-events-none absolute inset-x-3 top-0 z-10 h-5"},null,-1)),i.items.length===0?(f(),x("div",tt,d[4]||(d[4]=[M("i",{title:"No items",class:"icon-[lucide--circle-off] size-30 text-zinc-500/20"},null,-1)]))):R("",!0),(f(!0),x(le,null,ae(i.items,(r,t)=>(f(),j(Ye,{key:r.id,index:t,selected:i.isSelected(r,t),"media-src":r.mediaSrc,name:r.name,label:r.label,metadata:r.metadata,layout:o.value,onClick:m(u=>e("item-click",r,t),"onClick")},null,8,["index","selected","media-src","name","label","metadata","layout","onClick"]))),128))],2)])]))}});async function lt(s,l){if(s.trim()==="")return l;const e=s.trim().toLowerCase().split(" ");return l.filter(h=>{const o=h.name.toLowerCase();return e.every(b=>o.includes(b))})}m(lt,"defaultSearcher");function at(){return[{name:"Default",id:"default",sorter:m(({items:s})=>s.slice(),"sorter")},{name:"A-Z",id:"a-z",sorter:m(({items:s})=>s.slice().sort((l,e)=>l.name.localeCompare(e.name)),"sorter")}]}m(at,"getDefaultSortOptions");const st=Q({__name:"FormDropdown",props:X({items:{},placeholder:{default:F("widgets.uploadSelect.placeholder")},multiple:{type:[Boolean,Number],default:!1},uploadable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},accept:{},filterOptions:{default:m(()=>[],"default")},sortOptions:{default:m(()=>at(),"default")},isSelected:{type:Function,default:m((s,l,e)=>s.has(l.id),"default")},searcher:{type:Function,default:lt}},{selected:{default:new Set},selectedModifiers:{},filterSelected:{default:""},filterSelectedModifiers:{},sortSelected:{default:"default"},sortSelectedModifiers:{},layoutMode:{default:"grid"},layoutModeModifiers:{},files:{default:[]},filesModifiers:{},searchQuery:{default:""},searchQueryModifiers:{}}),emits:["update:selected","update:filterSelected","update:sortSelected","update:layoutMode","update:files","update:searchQuery"],setup(s){const l=s,e=z(s,"selected"),h=z(s,"filterSelected"),o=z(s,"sortSelected"),b=z(s,"layoutMode"),k=z(s,"files"),i=z(s,"searchQuery"),d=Ve(i,700,{maxWait:700}),r=I(!1),t=re(),u=I(),g=ee("triggerRef"),S=I(!1),V=p(()=>l.multiple===!0?1/0:typeof l.multiple=="number"?l.multiple:1),P=I([]);te(i,w=>{r.value=w!==d.value}),te([d,()=>l.items],(w,v,C)=>{let q=!1,H;C(()=>{q=!0,H?.()}),l.searcher(d.value,l.items,n=>H=n).then(n=>{q||(P.value=n)}).finally(()=>{q||(r.value=!1)})},{immediate:!0});const T=p(()=>l.sortOptions.find(v=>v.id==="default")?.sorter||(({items:v})=>v.slice())),W=p(()=>o.value==="default"?T.value:l.sortOptions.find(v=>v.id===o.value)?.sorter||T.value),L=p(()=>W.value({items:P.value})||[]);function O(w,v){return l.isSelected?.(e.value,w,v)??!1}m(O,"internalIsSelected");const Z=m(w=>{l.disabled||u.value&&g.value&&(u.value.toggle(w,g.value),S.value=!S.value)},"toggleDropdown"),G=m(()=>{u.value&&(u.value.hide(),S.value=!1)},"closeDropdown");function _(w){if(l.disabled)return;const v=w.target;v.files&&(k.value=Array.from(v.files)),v.value=""}m(_,"handleFileChange");function J(w,v){if(l.disabled)return;const C=e.value;if(O(w,v))C.delete(w.id);else if(C.size<V.value)C.add(w.id);else if(V.value===1)C.clear(),C.add(w.id);else{t.addAlert("Maximum selection limit reached");return}e.value=new Set(C),V.value===1&&G()}return m(J,"handleSelection"),(w,v)=>(f(),x("div",{ref_key:"triggerRef",ref:g},[B(Le,{files:k.value,"is-open":S.value,placeholder:w.placeholder,items:w.items,"max-selectable":V.value,selected:e.value,uploadable:w.uploadable,disabled:w.disabled,accept:w.accept,onSelectClick:Z,onFileChange:_},null,8,["files","is-open","placeholder","items","max-selectable","selected","uploadable","disabled","accept"]),B(y(ne),{ref_key:"popoverRef",ref:u,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg"]}},onHide:v[4]||(v[4]=C=>S.value=!1)},{default:Y(()=>[B(ot,{"filter-selected":h.value,"onUpdate:filterSelected":v[0]||(v[0]=C=>h.value=C),"layout-mode":b.value,"onUpdate:layoutMode":v[1]||(v[1]=C=>b.value=C),"sort-selected":o.value,"onUpdate:sortSelected":v[2]||(v[2]=C=>o.value=C),"search-query":i.value,"onUpdate:searchQuery":v[3]||(v[3]=C=>i.value=C),"filter-options":w.filterOptions,"sort-options":w.sortOptions,disabled:w.disabled,"is-querying":r.value,items:L.value,"is-selected":O,"max-selectable":V.value,onClose:G,onItemClick:J},null,8,["filter-selected","layout-mode","sort-selected","search-query","filter-options","sort-options","disabled","is-querying","items","max-selectable"])]),_:1},512)],512))}});function it(s){return{category:p(()=>{}),assets:p(()=>[]),dropdownItems:p(()=>[]),isLoading:p(()=>!1),error:p(()=>null)}}m(it,"useAssetWidgetData");const rt=Q({__name:"WidgetSelectDropdown",props:{widget:{},modelValue:{},nodeType:{},assetKind:{},allowUpload:{type:Boolean},uploadFolder:{},isAssetMode:{type:Boolean},defaultLayoutMode:{}},emits:["update:modelValue"],setup(s,{emit:l}){const e=s;ke(ge,p(()=>e.assetKind));const h=l,{localValue:o,onChange:b}=de({widget:e.widget,modelValue:m(()=>e.modelValue,"modelValue"),defaultValue:e.widget.options?.values?.[0]||"",emit:h}),k=re(),i=Me(),d=ue(),r=p(()=>({...ce(e.widget.options,pe),...d.value})),u=m(()=>e.isAssetMode&&e.nodeType?it(xe(()=>e.nodeType)):null,"getAssetData")(),g=I("all"),S=p(()=>{if(e.isAssetMode){const n=u?.category.value??"All";return[{id:"all",name:ze(n)}]}return[{id:"all",name:"All"},{id:"inputs",name:"Inputs"},{id:"outputs",name:"Outputs"}]}),V=I(new Set);function P(n){const a=e.widget.options?.getOptionLabel;if(!a)return n;try{return a(n)}catch(c){return console.error("Failed to map value:",c),n}}m(P,"getDisplayLabel");const T=p(()=>{const n=e.widget.options?.values||[];return Array.isArray(n)?n.map((a,c)=>({id:`input-${c}`,mediaSrc:H(a,"input"),name:a,label:P(a),metadata:""})):[]}),W=p(()=>{if(!["image","video"].includes(e.assetKind??""))return[];const n=new Set;return i.historyTasks.forEach(a=>{a.flatOutputs.forEach(c=>{const A=e.assetKind==="image"&&c.mediaType==="images"||e.assetKind==="video"&&c.mediaType==="video";if(c.type==="output"&&A){const K=`${c.subfolder?`${c.subfolder}/${c.filename}`:c.filename} [output]`;n.add(K)}})}),Array.from(n).map((a,c)=>({id:`output-${c}`,mediaSrc:H(a.replace(" [output]",""),"output"),name:a,label:P(a),metadata:""}))}),L=p(()=>e.isAssetMode&&u?u.dropdownItems.value:[...T.value,...W.value]),O=p(()=>{if(e.isAssetMode)return L.value;switch(g.value){case"inputs":return T.value;case"outputs":return W.value;case"all":default:return L.value}}),Z=p(()=>{const n=e.widget.options;if(n?.placeholder)return n.placeholder;switch(e.assetKind){case"image":return F("widgets.uploadSelect.placeholderImage");case"video":return F("widgets.uploadSelect.placeholderVideo");case"audio":return F("widgets.uploadSelect.placeholderAudio");case"model":return F("widgets.uploadSelect.placeholderModel");case"unknown":return F("widgets.uploadSelect.placeholderUnknown")}return F("widgets.uploadSelect.placeholder")}),G=p(()=>e.isAssetMode?!1:e.allowUpload===!0),_=p(()=>{switch(e.assetKind){case"image":return"image/*";case"video":return"video/*";case"audio":return"audio/*";default:return}}),J=I(e.defaultLayoutMode??"grid");te(o,n=>{if(n!==void 0){const a=O.value.find(c=>c.name===n);a&&(V.value.clear(),V.value.add(a.id))}else V.value.clear()},{immediate:!0});function w(n){let a;if(n.size>0&&(a=n.values().next().value),a==null){b(void 0);return}const c=O.value.find(A=>A.id===a)?.name;if(!c){b(void 0);return}b(c)}m(w,"updateSelectedItems");const v=m(async(n,a=!1,c={})=>{const A=new FormData;A.append("image",n),a&&A.append("subfolder","pasted"),c.type&&A.append("type",c.type);const D=await $e.fetchApi("/upload/image",{method:"POST",body:A});if(D.status!==200)return k.addAlert(D.status+" - "+D.statusText),null;const K=await D.json();return(c.type==="input"||!c.type&&!a)&&await Ce().updateInputs(),K.subfolder?`${K.subfolder}/${K.name}`:K.name},"uploadFile"),C=m(async n=>{const a=e.uploadFolder??"input",c=n.map(D=>v(D,!1,{type:a}));return(await Promise.all(c)).filter(D=>D!==null)},"uploadFiles");async function q(n){if(!(!n||n.length===0))try{const a=await C(n);if(a.length===0){k.addAlert("File upload failed");return}e.widget.options?.values&&a.forEach(c=>{const A=e.widget.options.values;A.includes(c)||A.push(c)}),b(a[0]),e.widget.callback&&e.widget.callback(a[0])}catch(a){console.error("Upload error:",a),k.addAlert(`Upload failed: ${a}`)}}m(q,"handleFilesUpdate");function H(n,a="input"){return["image","video"].includes(e.assetKind??"")?`/api/view?filename=${encodeURIComponent(n)}&type=${a}`:""}return m(H,"getMediaUrl"),(n,a)=>(f(),j(fe,{widget:n.widget},{default:Y(()=>[B(st,oe({selected:V.value,"onUpdate:selected":a[0]||(a[0]=c=>V.value=c),"filter-selected":g.value,"onUpdate:filterSelected":a[1]||(a[1]=c=>g.value=c),"layout-mode":J.value,"onUpdate:layoutMode":a[2]||(a[2]=c=>J.value=c),items:O.value,placeholder:Z.value,multiple:!1,uploadable:G.value,accept:_.value,"filter-options":S.value},r.value,{class:"w-full","onUpdate:selected":w,"onUpdate:files":q}),null,16,["selected","filter-selected","layout-mode","items","placeholder","uploadable","accept","filter-options"])]),_:1},8,["widget"]))}}),vo=Q({__name:"WidgetSelect",props:{widget:{},modelValue:{},nodeType:{}},emits:["update:modelValue"],setup(s,{emit:l}){const e=s,h=l;function o(S){h("update:modelValue",S)}m(o,"handleUpdateModelValue");const b=p(()=>{if(e.widget.spec&&Ue(e.widget.spec))return e.widget.spec}),k=p(()=>{const S=b.value;if(!S)return{kind:"unknown",allowUpload:!1,folder:void 0};const{image_upload:V,animated_image_upload:P,video_upload:T,image_folder:W,audio_upload:L}=S;let O="unknown";return T?O="video":V||P?O="image":L&&(O="audio"),{kind:O,allowUpload:V===!0||P===!0||T===!0||L===!0,folder:W}}),i=p(()=>!1),d=p(()=>k.value.kind),r=p(()=>i.value||d.value!=="unknown"),t=p(()=>k.value.allowUpload),u=p(()=>k.value.folder??"input"),g=p(()=>i.value?"list":"grid");return(S,V)=>r.value?(f(),j(rt,oe({key:0},e,{"asset-kind":d.value,"allow-upload":t.value,"upload-folder":u.value,"is-asset-mode":i.value,"default-layout-mode":g.value,"onUpdate:modelValue":o}),null,16,["asset-kind","allow-upload","upload-folder","is-asset-mode","default-layout-mode"])):(f(),j(De,{key:1,widget:S.widget,"model-value":S.modelValue,"onUpdate:modelValue":o},null,8,["widget","model-value"]))}});export{vo as _};
//# sourceMappingURL=WidgetSelect.vue_vue_type_script_setup_true_lang-B3K_yQLc.js.map
