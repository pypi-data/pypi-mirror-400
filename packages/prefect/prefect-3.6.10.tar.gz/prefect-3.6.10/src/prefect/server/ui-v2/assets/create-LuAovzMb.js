import{j as e,s as J,r as V,F as I}from"./vendor-tanstack-BVzzyDEt.js";import{ak as x,al as f,am as h,an as j,ao as _,ap as b,G as N,K as T,bu as R,aU as S,bv as W,bw as U,C as D,bx as q,ad as A,H as G,J as $,aj as H,q as v,w}from"./index-BJkJ93Lr.js";import{u as B,b as P,n as M,c as F,r as O,h as Q,d as z}from"./vendor-forms-BN3tpxM2.js";import{u as K,S as X}from"./use-stepper-D5a6mnYn.js";import{T as Y}from"./textarea-BWNxlLo9.js";import"./primitives-BxgEGUr4.js";import"./toggle-group-B18EYoB-.js";import{B as Z}from"./base-job-template-form-section-DiW18Fhk.js";import{R as ee,a as te}from"./radio-group-Bp8yWMIB.js";import"./vendor-react-Bce9NwRC.js";import"./vendor-radix-CTAic6HB.js";import"./vendor-recharts-Mwm2qLZp.js";import"./vendor-date-2jFo9aCm.js";import"./schema-form-savMxoOe.js";import"./use-debounce-callback-K3TIomWn.js";function re(){const o=B();return e.jsxs(e.Fragment,{children:[e.jsx(x,{control:o.control,name:"name",render:({field:a})=>e.jsxs(f,{children:[e.jsx(h,{children:"Name"}),e.jsx(j,{children:e.jsx(_,{...a})}),e.jsx(b,{})]})}),e.jsx(x,{control:o.control,name:"description",render:({field:a})=>e.jsxs(f,{children:[e.jsx(h,{children:"Description (Optional)"}),e.jsx(j,{children:e.jsx(Y,{...a,value:a.value??"",rows:7,placeholder:"Enter a description for your work pool"})}),e.jsx(b,{})]})}),e.jsx(x,{control:o.control,name:"concurrencyLimit",render:({field:a})=>e.jsxs(f,{children:[e.jsx(h,{children:"Flow Run Concurrency (Optional)"}),e.jsx(j,{children:e.jsx(_,{...a,type:"number",min:0,placeholder:"Unlimited",value:a.value??"",onChange:i=>{const n=i.target.value;a.onChange(n===""?null:Number(n))}})}),e.jsx(b,{})]})})]})}const se=P({name:F().min(1,"Name is required").refine(o=>!o.toLowerCase().startsWith("prefect"),"Work pools starting with 'prefect' are reserved for internal use."),description:F().nullable().optional(),concurrencyLimit:M().min(0).nullable().optional()});function ae(){const o=B(),a=o.watch("baseJobTemplate");return e.jsxs("div",{className:"space-y-6",children:[e.jsx(N,{children:e.jsx(T,{children:e.jsxs(R,{children:["The fields below control the default values for the base job template. These values can be overridden by deployments.",e.jsx("br",{}),e.jsx("br",{}),"A work pools job template controls infrastructure configuration for all flow runs in the work pool, and specifies the configuration that can be overridden by deployments."]})})}),e.jsx(Z,{baseJobTemplate:a,onBaseJobTemplateChange:i=>{o.setValue("baseJobTemplate",i)}})]})}const oe=P({baseJobTemplate:O(Q()).optional()}),k={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"},ne=({url:o,alt:a,size:i="md",className:n})=>o?e.jsx("img",{src:o,alt:a,className:S("rounded border bg-background/50 backdrop-blur-sm object-contain",k[i],n),onError:t=>{const r=t.target,s=document.createElement("div");s.className=S("rounded border bg-muted flex items-center justify-center text-muted-foreground text-xs",k[i],n),s.textContent=a.charAt(0).toUpperCase(),r.parentNode?.replaceChild(s,r)}}):e.jsx("div",{className:S("rounded border bg-muted flex items-center justify-center text-muted-foreground text-xs",k[i],n),children:a.charAt(0).toUpperCase()});function ie(){const o=B(),{data:a={}}=J(W()),i=V.useMemo(()=>{const n=[];return Object.values(a).forEach(t=>{t&&typeof t=="object"&&Object.values(t).forEach(r=>{if(r&&typeof r=="object"&&"type"in r){const{type:s,display_name:m,description:d,logo_url:u,documentation_url:y,is_beta:g}=r;s&&u&&d&&n.push({label:m||U(s),value:s,logoUrl:u,description:d,documentationUrl:y,isBeta:g||!1})}})}),n.sort((t,r)=>t.isBeta&&!r.isBeta?1:!t.isBeta&&r.isBeta?-1:t.label.localeCompare(r.label))},[a]);return e.jsx(x,{control:o.control,name:"type",render:({field:n,fieldState:t})=>e.jsxs(f,{children:[e.jsx(h,{className:"text-base font-medium",children:"Select the infrastructure you want to use to execute your flow runs"}),e.jsx(j,{children:e.jsx(ee,{value:n.value,onValueChange:r=>n.onChange(r),className:"space-y-3",children:i.map(({label:r,value:s,logoUrl:m,description:d,isBeta:u})=>e.jsxs("div",{className:"flex items-center space-x-3 p-4 rounded-lg border hover:bg-accent/50",children:[e.jsx(te,{value:s,id:s}),e.jsx("label",{htmlFor:s,className:"flex-1 cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ne,{url:m,alt:r,size:"md"}),e.jsxs("div",{className:"flex flex-col gap-2 flex-1",children:[e.jsxs("p",{className:"text-base font-medium flex items-center",children:[r,u&&e.jsx(D,{variant:"secondary",className:"ml-2 text-xs",children:"Beta"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:d})]})]})})]},s))})}),t.error&&e.jsx(b,{children:t.error.message})]})})}const E=["Infrastructure Type","Details","Configuration"],ce=P({type:F().min(1,"Infrastructure type is required"),...se.shape,...oe.shape});function le(){const o=I(),{createWorkPool:a,isPending:i}=q(),{data:n={}}=J(W()),t=K(E.length),r=z({resolver:A(ce),defaultValues:{description:null,concurrencyLimit:null}}),s=r.watch("type");V.useEffect(()=>{const c=Object.values(n).find(l=>l&&typeof l=="object"&&Object.values(l).find(p=>p&&typeof p=="object"&&"type"in p&&p.type===s));c&&s in c&&typeof c[s]=="object"&&c[s]&&"default_base_job_configuration"in c[s]&&r.setValue("baseJobTemplate",c[s].default_base_job_configuration)},[n,r,s]);const m=async()=>{const c=g(t.currentStep);await r.trigger(c)&&(t.isFinalStep?await y():t.incrementStep())},d=()=>{t.decrementStep()},u=()=>{o.navigate({to:"/work-pools"})},y=async()=>{if(!await r.trigger())return;const l=r.getValues();if(!l.name||!l.type){w.error("Please fill in all required fields");return}const p={name:l.name,type:l.type,description:l.description,is_paused:!1,concurrency_limit:l.concurrencyLimit,base_job_template:l.baseJobTemplate||{}};a(p,{onSuccess:C=>{w.success(`Work pool "${l.name}" created successfully`),o.navigate({to:"/work-pools/work-pool/$workPoolName",params:{workPoolName:C.data?.name||l.name}})},onError:C=>{w.error(`Failed to create work pool: ${C.message}`)}})},g=c=>{switch(c){case 0:return["type"];case 1:return["name","description","concurrencyLimit"];case 2:return["baseJobTemplate"];default:return[]}},L=()=>{switch(t.currentStep){case 0:return e.jsx(ie,{});case 1:return e.jsx(re,{});case 2:return e.jsx(ae,{});default:return null}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(N,{children:[e.jsx(G,{children:e.jsx($,{children:"Create Work Pool"})}),e.jsx(T,{children:e.jsx(X,{currentStepNum:t.currentStep,steps:E,onClick:({stepNum:c})=>{t.visitedStepsSet.has(c)&&t.changeStep(c)},completedSteps:t.completedStepsSet,visitedSteps:t.visitedStepsSet})})]}),e.jsx(N,{children:e.jsx(T,{className:"pt-6",children:e.jsx(H,{...r,children:e.jsx("form",{className:"space-y-6",children:L()})})})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[!t.isStartingStep&&e.jsx(v,{variant:"outline",onClick:d,disabled:i,children:"Back"}),e.jsx(v,{variant:"ghost",onClick:u,disabled:i,className:"ml-2",children:"Cancel"})]}),e.jsx(v,{onClick:()=>{m()},disabled:i,children:i?"Creating...":t.isFinalStep?"Create Work Pool":"Next"})]})]})}const ke=le;export{ke as component};
//# sourceMappingURL=create-LuAovzMb.js.map
