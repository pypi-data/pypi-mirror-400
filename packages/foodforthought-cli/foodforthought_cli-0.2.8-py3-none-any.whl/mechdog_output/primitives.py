"""
Primitive skills for unnamed_robot
Generated by ate robot-setup wizard
"""

import time
from typing import List, Dict, Optional
from dataclasses import dataclass

from .servo_map import ServoID, SERVO_LIMITS, ALL_SERVOS


@dataclass
class ServoCommand:
    """Command for a single servo."""
    servo_id: int
    position: int
    time_ms: int = 500


class PrimitiveSkills:
    """Low-level primitive skills for the robot."""

    def __init__(self, robot_controller):
        """
        Args:
            robot_controller: Controller with move_servo(), read_position() methods
        """
        self.controller = robot_controller

    def move_servo(self, servo_id: ServoID, position: int, time_ms: int = 500):
        """Move a single servo to position."""
        limits = SERVO_LIMITS.get(servo_id, {"min": 0, "max": 1000})
        position = max(limits["min"], min(limits["max"], position))
        self.controller.move_servo(servo_id, position, time_ms)

    def move_servos(self, commands: List[ServoCommand]):
        """Move multiple servos simultaneously."""
        for cmd in commands:
            limits = SERVO_LIMITS.get(cmd.servo_id, {"min": 0, "max": 1000})
            pos = max(limits["min"], min(limits["max"], cmd.position))
            self.controller.move_servo(cmd.servo_id, pos, cmd.time_ms)

    def home(self):
        """Move all servos to center/home position."""
        commands = [
            ServoCommand(servo_id, SERVO_LIMITS[servo_id]["center"])
            for servo_id in ALL_SERVOS
        ]
        self.move_servos(commands)

    def read_positions(self) -> Dict[ServoID, int]:
        """Read all servo positions."""
        positions = {}
        for servo_id in ALL_SERVOS:
            pos = self.controller.read_position(servo_id)
            if pos is not None:
                positions[servo_id] = pos
        return positions
